/*****************************************************************
   Copyright 2008 by iNet Solutions (info@truthinet.com.vn)

   Licensed under the iNet Solutions Corp.,;
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.truthinet.com/licenses

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
*****************************************************************/
iNet.iwebos.data.db.Table=function(c,a,b){this.conn=c;this.name=a;this.keyName=b};iNet.iwebos.data.db.Table.prototype={update:function(a,d,b){var c=this.keyName+" = ?";return this.updateBy(a,c,[a[this.keyName]],d,b)},updateBy:function(b,e,d,h,i){var j="UPDATE "+this.name+" SET ";var c=[],f=[];for(var g in b){if(b.hasOwnProperty(g)){c[c.length]=g+" = ?";f[f.length]=b[g]}}for(var g in d){if(d.hasOwnProperty(g)){f[f.length]=d[g]}}j=[j,c.join(",")," WHERE ",e].join("");return this.conn.execBy(j,f,h,i)},insert:function(d,i,f){var g="INSERT INTO "+this.name+" ";var b=[],h=[],c=[];for(var e in d){if(d.hasOwnProperty(e)){b[b.length]=e;h[h.length]="?";c[c.length]=d[e]}}g=[g,"(",b.join(","),") VALUES (",h.join(","),")"].join("");return this.conn.execBy(g,c,i,f)},selectBy:function(c,a,e,b){var d="SELECT * FROM "+this.name;if(c){d+=" WHERE "+c}a=a||{};return this.conn.queryBy(d,a,e,b)},select:function(b,c,a){return this.selectBy(b,null,c,a)},removeBy:function(c,a,e,b){var d="DELETE FROM "+this.name;if(c){d+=" WHERE "+c}a=a||{};this.conn.execBy(d,a,e,b)},remove:function(b,c,a){this.removeBy(b,null,c,a)},save:function(a,c,b){if(this.exists(a[this.keyName])){this.update(a,c,b)}else{this.insert(a,c,b)}},exists:function(c,b,a){return !!this.lookup(c,b,a)},lookup:function(c,b,a){return this.selectBy(this.keyName+" = ?",[c],b,a)[0]||null}}; 
iNet.iwebos.data.db.DBProxy=function(e,d,c,b,a,f){iNet.iwebos.data.db.DBProxy.superclass.constructor.call(this);this.conn=e;this.table=this.conn.getTable(d,c);this.keyName=c;this.store=b;this.transaction=f||false;if(a!==true){this.store.on("add",this.onAdd,this);this.store.on("update",this.onUpdate,this);this.store.on("remove",this.onRemove,this)}this.addEvents({synchadd:true,synchupdate:true,synchremove:true})};Ext.extend(iNet.iwebos.data.db.DBProxy,Ext.data.DataProxy,{load:function(b,d,g,i,j){if(!this.conn.isOpen()){this.conn.on("open",function(){this.load(b,d,g,i,j)},this,{single:true});return}if(this.fireEvent("beforeload",this,b,d,g,i,j)!==false){var f=b.where||"";var e=b.args||[];var h=b.groupBy;var c=b.sort;var a=b.dir;if(h||c){f+=" ORDER BY ";if(h&&h!=c){f+=h+" ASC, "}f+=c+" "+(a||"ASC")}this.table.selectBy(f,e,this.onLoad.createDelegate(this,[{callback:g,scope:i,arg:j,reader:d}],0))}else{g.call(i||this,null,j,false)}},onLoad:function(c,b,f,d){if(b===false){this.fireEvent("loadexception",this,null,c.arg,f);c.callback.call(c.scope||window,null,c.arg,false);return}var a=c.reader.readRecords(b);this.fireEvent("load",this,b,c.arg);c.callback.call(c.scope||window,a,c.arg,true)},processData:function(c){var b=this.store.fields;var a={};for(var d in c){var f=b.key(d),e=c[d];if(f){if(f.type=="date"){a[d]=e?e.format(Ext.sql.Proxy.DATE_FORMAT,10):""}else{if(f.type=="boolean"){a[d]=e?1:0}else{a[d]=e}}}}return a},onAdd:function(f,a,b){var e=(this.transaction)?this.conn.getTransaction():null;for(var d=0;d<a.length;d++){try{if(e!==null){e.begin()}this.table.insert(this.processData(a[d].data));if(e!==null){e.commit()}if(a[d].data.dirty){this.fireEvent("synchadd",a[d].data);a[d].data.dirty=false}}catch(c){if(e!==null){e.rollback()}}}},onUpdate:function(f,a){var e=a.getChanges();var d=this.table.keyName;var c=(this.transaction)?this.conn.getTransaction():null;try{if(c!==null){c.begin()}this.table.updateBy(this.processData(e),d+" = ?",[a.data[d]]);a.commit(true);if(c!==null){c.commit()}if(a.data.dirty){fireEvent("synchupdate",a.data);a.dirty=false}}catch(b){if(c!==null){c.rollback()}}},onRemove:function(f,a,b){var e=this.table.keyName;var d=(this.transaction)?this.conn.getTransaction():null;try{if(d!==null){d.begin()}this.table.removeBy(e+" = ?",[a.data[e]]);if(d!==null){d.rollback()}if(a.data.dirty){fireEvent("synchdelete",[a.data]);a.data.dirty=false}}catch(c){if(d!==null){d.rollback()}}}}); 
iNet.iwebos.data.db.Connection=function(a){Ext.apply(this,a);iNet.iwebos.data.db.Connection.superclass.constructor.call(this);this.addEvents({open:true,close:true})};Ext.extend(iNet.iwebos.data.db.Connection,Ext.util.Observable,{maxResults:10000,openState:false,open:function(a,c,b){},close:function(){},exec:function(b,c,a){},execBy:function(c,a,d,b){},query:function(b,c,a){},queryBy:function(c,a,d,b){},isOpen:function(){return this.openState},getTransaction:function(){return new iNet.iwebos.data.db.Transaction(this)},getTable:function(a,b){return new iNet.iwebos.data.db.Table(this,a,b)},createTable:function(b){var f=b.name;var h=b.key;var c=b.fields;var g=b.callback;var i=b.scope;if(!(c instanceof Array)){c=c.items}var a=[];for(var d=0;d<c.length;d++){var e=c[d],k=e.name;switch(e.type){case"int":case"bool":case"boolean":k+=" INTEGER";break;case"float":case"double":k+=" REAL";break;default:k+=" TEXT";break}if(e.allowNull===false||e.name==h){k+=" NOT NULL"}if(e.name==h){k+=" PRIMARY KEY"}if(e.unique===true){k+=" UNIQUE"}a[a.length]=k}var j=["CREATE TABLE IF NOT EXISTS ",f,"(",a.join(","),")"].join("");this.exec(j,g,i)}});iNet.iwebos.data.db.Connection.getInstance=function(a,b){if(window.google&&google.gears){return new iNet.iwebos.data.db.GearsConnection(b)}return new iNet.iwebos.data.db.Connection(b)}; 
iNet.iwebos.data.db.GearsConnection=Ext.extend(iNet.iwebos.data.db.Connection,{open:function(a,c,b){this.conn=google.gears.factory.create("beta.database","1.0");this.conn.open(a);this.openState=true;Ext.callback(c,b,[this]);this.fireEvent("open",this)},close:function(){this.conn.close();this.openState=false;this.fireEvent("close",this)},exec:function(b,c,a){this.conn.execute(b).close();Ext.callback(c,a,[true])},execBy:function(c,a,d,b){this.conn.execute(c,a).close();Ext.callback(d,b,[true])},query:function(d,e,c){var a=this.conn.execute(d);var b=this.readResults(a);Ext.callback(e,c,[b]);return b},queryBy:function(e,b,f,d){var a=this.conn.execute(e,b);var c=this.readResults(a);Ext.callback(f,d,[c]);return c},readResults:function(b){var e=[];if(b){var f=b.fieldCount();var a=[];for(var d=0;d<f;d++){a[d]=b.fieldName(d)}while(b.isValidRow()){var c={};for(var d=0;d<f;d++){c[a[d]]=b.field(d)}e[e.length]=c;b.next()}b.close()}return e},isOpen:function(){return this.openState},getTransaction:function(){return new iNet.iwebos.data.db.Transaction(this)},getTable:function(a,b){return new iNet.iwebos.data.db.Table(this,a,b)}}); 
iNet.iwebos.data.db.Transaction=function(a){this.conn=a};iNet.iwebos.data.db.Transaction.prototype={begin:function(b,a){if(this.conn.isOpen()){this.conn.exec("BEGIN",b,a)}},commit:function(b,a){if(this.conn.isOpen()){this.conn.exec("COMMIT",b,a)}},rollback:function(b,a){if(this.conn.isOpen()){this.conn.exec("ROLLBACK",b,a)}},transact:function(c,d,b){this.begin(d,b);try{c()}catch(a){this.rollback(d,b);throw a}this.commit(d,b)}}; 
Ext.override(Date,{getFirstDateOfWeek:function(){var b=this.getDate()-this.getDay();if(b>0){return new Date(this.getFullYear(),this.getMonth(),b)}else{var a=this.getMonth()-1;var c=this.getFullYear();if(a<0){a=0;c=c-1}b=this._getDaysInMonth(a,c)+b;return new Date(c,a,b)}},getLastDateOfWeek:function(){var b=this.getDate()-this.getDay()+6;var d=this.getDaysInMonth();if(b<=d){return new Date(this.getFullYear(),this.getMonth(),b)}else{var a=this.getMonth()+1;var c=this.getFullYear();if(a>11){a=a-12;c=c+1}b=b-d;return new Date(c,a,b)}},getLastDateOfNextWeek:function(){var a=this.getLastDateOfWeek();a=a.add(Date.DAY,7);return a},_getDaysInMonth:function(b,a){var c=!!((a&3)==0&&(a%100||(a%400==0&&a)));if(b==1){return c?29:28}return Date.daysInMonth[b]}}); 
(function(){IDGeneratorStrategy=function(a){Ext.apply(this,a||{})};IDGeneratorStrategy.prototype={generateId:function(){},_getPrefix:function(){return this.prefix},_getSuffix:function(){return this.suffix}};NumberIDGeneratorStrategy=function(a){};NumberIDGeneratorStrategy=Ext.extend(IDGeneratorStrategy,{generateId:function(){var b=new Date();var a=Math.floor(Math.random()*1000);return(b.getTime()+a)}});AlphaIDGeneratorStrategy=function(a){Ext.apply(this,a||{})};AlphaIDGeneratorStrategy=Ext.extend(IDGeneratorStrategy,{generateId:function(){var e=this._getSize();var b=String(new Date().getTime()).substr(e);var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var d=0;d<len;d++){b+=a.charAt(Math.floor(Math.random()*26))}var c=this._getPrefix();if(c){b=c+"-"+b}c=this._getSuffix();if(c){b=b+"-"+c}return b},_getSize:function(){if(this.size==undefined){return 6}return((this.size==undefined||this.size<=0)?6:this.size)}});IDGenerator=function(a){var b=a||{};Ext.apply(this,b);this.Strategy=b.strategy||NumberIDGeneratorStrategy};IDGenerator.prototype={generate:function(){var a=new this.Strategy(this);return a.generateId()}}})(); 
iNet.iwebos.ui.common.dialog.Dialog=Ext.extend(Ext.Window,{dragContent:true,initComponent:function(){iNet.iwebos.ui.common.dialog.Dialog.superclass.initComponent.call(this)},createGhost:function(a,e,b){var d=document.createElement("div");d.className="x-panel-ghost "+(a?a:"");if(this.header){d.appendChild(this.el.dom.firstChild.cloneNode(true))}if(this.dragContent){d.appendChild(this.bwrap.dom.cloneNode(true))}else{Ext.fly(d.appendChild(document.createElement("ul"))).setHeight(this.bwrap.getHeight())}d.style.width=this.el.dom.offsetWidth+"px";if(!b){this.container.dom.appendChild(d)}else{Ext.getDom(b).appendChild(d)}if(e!==false&&this.el.useShim!==false){var c=new Ext.Layer({shadow:false,useDisplay:true,constrain:false},d);c.show();return c}else{return new Ext.Element(d)}}});Ext.reg("dialog",iNet.iwebos.ui.common.dialog.Dialog); 
iNet.iwebos.ui.common.dialog.TitleDialog=Ext.extend(iNet.iwebos.ui.common.dialog.Dialog,{initComponent:function(){if(typeof this.height=="number"){this.height=this.height-iNet.INET_TITLE_DLG_HEIGHT}iNet.iwebos.ui.common.dialog.TitleDialog.superclass.initComponent.call(this)},onRender:function(c,a){iNet.iwebos.ui.common.dialog.TitleDialog.superclass.onRender.call(this,c,a);var b=['<table class="x-dlg-title-hd ',(this.hdCls?this.hdCls:""),'" border="0" cellspacing="0" cellpading="0" style="width:100%;">',"<tr>",'<td class="x-dlg-title-inner-hd-txt">','<div class="x-dlg-title-inner-hd-txt-ttext ',(this.tcls?this.tcls:""),'">',(this.ttitle?this.ttitle:"&#160;"),"</div>",'<div class="x-dlg-title-inner-hd-txt-btext ',(this.bcls?this.bcls:""),'">',(this.btitle?this.btitle:"&#160;"),"</div>","</td>",'<td class="x-dlg-title-inner-hd-img ',(this.hdImgCls?this.hdImgCls:""),'"/>',"</tr>","</table>"];this.dtitle=this.body.createChild({tag:"div",id:"dlg-title",cls:"x-dlg-title-hd-ec",html:b.join("")},this.bwrap.dom)},getFrameHeight:function(){var a=iNet.iwebos.ui.common.dialog.TitleDialog.superclass.getFrameHeight.call(this);a+=(this.dtitle?this.dtitle.getHeight():0);return a},beforeDestroy:function(){iNet.iwebos.ui.common.dialog.TitleDialog.superclass.beforeDestroy.call(this);Ext.Element.uncache(this.dtitle)},createGhost:function(a,e,b){var d=document.createElement("div");d.className="x-panel-ghost "+(a?a:"");if(this.header){d.appendChild(this.el.dom.firstChild.cloneNode(true))}if(this.dtitle){if(this.dragContent){d.appendChild(this.dtitle.dom.cloneNode(true))}else{Ext.fly(d.appendChild(document.createElement("ul"))).setHeight(this.dtitle.getHeight())}}if(this.dragContent){d.appendChild(this.bwrap.dom.cloneNode(true))}else{Ext.fly(d.appendChild(document.createElement("ul"))).setHeight(this.bwrap.getHeight())}d.style.width=this.el.dom.offsetWidth+"px";if(!b){this.container.dom.appendChild(d)}else{Ext.getDom(b).appendChild(d)}if(e!==false&&this.el.useShim!==false){var c=new Ext.Layer({shadow:false,useDisplay:true,constrain:false},d);c.show();return c}else{return new Ext.Element(d)}}});Ext.reg("tdialog",iNet.iwebos.ui.common.dialog.TitleDialog); 
iNet.iwebos.ui.common.grid.HttpProxyWrapper=function(a){iNet.iwebos.ui.common.grid.HttpProxyWrapper.superclass.constructor.call(this);this.conn=a;this.useAjax=!a||!a.events};Ext.extend(iNet.iwebos.ui.common.grid.HttpProxyWrapper,Ext.data.DataProxy,{load:function(e,b,f,c,a){if(this.fireEvent("beforeload",this,e)!==false){var d={params:e||{},request:{callback:f,scope:c,arg:a},reader:b,callback:this.loadResponse,scope:this,headers:{"X-Ghost-Request":window.location.href}};if(this.useAjax){Ext.applyIf(d,this.conn);if(this.activeRequest){Ext.Ajax.abort(this.activeRequest)}this.activeRequest=Ext.Ajax.request(d)}else{this.conn.request(d)}}else{f.call(c||this,null,a,false)}},loadResponse:function(f,d,b){this.redirect(b);delete this.activeRequest;if(!d){this.fireEvent("loadexception",this,f,b);f.request.callback.call(f.request.scope,null,f.request.arg,false);return}var a;try{a=f.reader.read(b)}catch(c){this.fireEvent("loadexception",this,f,b,c);f.request.callback.call(f.request.scope,null,f.request.arg,false);return}this.fireEvent("load",this,f,f.request.arg);f.request.callback.call(f.request.scope,a,f.request.arg,true)},redirect:function(b){try{var a=Ext.util.JSON.decode(b.responseText)||{};if(a.type==="redirect"){window.location.href=a.target}}catch(c){}},update:function(a){},updateResponse:function(a){}}); 
iNet.iwebos.ui.common.grid.WebOSGrid=Ext.extend(Ext.grid.GridPanel,{loadFirst:true,initComponent:function(){this.method=(!this.method)?"GET":this.method;this.proxy=(!this.proxy)?new iNet.iwebos.ui.common.grid.HttpProxyWrapper({url:this.url,method:this.method}):this.proxy;this.sortInfo=this.sortInfo||{field:"id",direction:"ASC"};var b=this.dsort||{field:"id",direction:"ASC"};this.sm=(!this.sm)?new Ext.grid.RowSelectionModel():this.sm;this.selectFirstRow=(!this.selectFirstRow)?true:!!this.selectFirstRow;this.groupLabel=(!this.groupLabel)?idesk.webos.message.paperwork.ppwitem:this.groupLabel;this.groupTextTpl=(!this.groupTextTpl)?'{text} ({[values.rs.length]} {[values.rs.length > 0 ? "'+this.groupLabel+'":"No item"]})':this.groupTextTpl;this.rowClass=(!this.rowClass)?function(c){return""}:this.rowClass;this.loadFirst=!!this.loadFirst;this.start=(!this.start)?0:this.start;this.limit=(!this.limit)?iNet.INET_PAGE_LIMIT:this.limit;var a;if(!this.store){a=new iNet.iwebos.ui.common.store.WebOSGroupingStore({proxy:this.proxy,sortInfo:this.sortInfo,groupField:this.groupField,baseParams:this.baseParams,reader:this.reader,filter:this.filter})}else{a=this.store;delete this.store}a=Ext.StoreMgr.lookup(a);a.setDefaultSort(b.field,b.direction);delete this.dsort;this.bind(a);if(this.loadFirst){this.store.load({params:{start:this.start,limit:this.limit}})}this.shadow=false;if(!this.view){this.view=new Ext.grid.GroupingView({forceFit:true,emptyText:idesk.webos.message.paperwork.emptyresult,groupTextTpl:this.groupTextTpl,getRowClass:this.rowClass})}if(!this.loadMask){this.loadMask={msg:idesk.webos.message.load_data}}iNet.iwebos.ui.common.grid.WebOSGrid.superclass.initComponent.call(this)},handleSearchEvent:function(params){var index=0;var buf=[];var param=null;for(index=0;index<params.length;index++){param=params[index];buf.push(param.key+":'"+param.value+"'")}var paramValue=buf.join(",");var searchParams=eval("({"+paramValue+"})");this.store.baseParams=Ext.apply(this.baseParams||{},searchParams);this.store.load()},bind:function(a){if(this.selectFirstRow){if(this.store){this.store.un("load",this.onStoreLoad,this)}if(a){a.on("load",this.onStoreLoad,this)}}this.store=a},onStoreLoad:function(){if(this.store&&this.store.getCount()>0){this.selModel.selectFirstRow()}}}); 
iNet.iwebos.ui.mail.grid.Active=function(){Ext.apply(this,{width:24,fixed:true,header:"",menuDisabled:true,dataIndex:"active",renderer:function(a){if(a){return'<div class="icon-email-true"></div>'}else{return'<div class="icon-email-false"></div>'}},init:function(a){}})};iNet.iwebos.ui.mail.grid.isMail=function(){Ext.apply(this,{header:'<div class="icon-email-ismail"></div>',menuDisabled:true,width:24,dataIndex:"isMail",fixed:true,renderer:function(a){if(a){return'<div class="icon-ismail-true"></div>'}else{return'<div class="icon-ismail-false"></div>'}},init:function(a){}})}; 
(function(){WebOSGridService={};WebOSGridService.handleSelection=function(b,a){if(!b.getSelectionModel().hasSelection()||b.getSelectionModel().singleSelect){b.getSelectionModel().selectRow(a)}else{var d=b.store.getAt(a);if(d){var c=b.getSelectionModel().isSelected(d);b.getSelectionModel().selectRow(a,c)}}}})(); 
iNet.iwebos.ui.common.grid.WebOSEditorGrid=Ext.extend(Ext.grid.EditorGridPanel,{loadFirst:true,initComponent:function(){this.method=(!this.method)?"GET":this.method;this.proxy=(!this.proxy)?new iNet.iwebos.ui.common.grid.HttpProxyWrapper({url:this.url,method:this.method}):this.proxy;this.sortInfo=(!this.sortInfo)?{field:"id",direction:"ASC"}:this.sortInfo;this.sm=(!this.sm)?new Ext.grid.RowSelectionModel():this.sm;this.selectFirstRow=(!this.selectFirstRow)?true:!!this.selectFirstRow;this.groupLabel=(!this.groupLabel)?idesk.webos.message.paperwork.ppwitem:this.groupLabel;this.groupTextTpl=(!this.groupTextTpl)?'{text} ({[values.rs.length]} {[values.rs.length > 0 ? "'+this.groupLabel+'":"No item"]})':this.groupTextTpl;this.rowClass=(!this.rowClass)?function(b){return""}:this.rowClass;this.loadFirst=!!this.loadFirst;this.start=(!this.start)?0:this.start;this.limit=(!this.limit)?iNet.INET_PAGE_LIMIT:this.limit;var a;if(!this.store){a=new iNet.iwebos.ui.common.store.WebOSGroupingStore({proxy:this.proxy,sortInfo:this.sortInfo,groupField:this.groupField,baseParams:this.baseParams,reader:this.reader,filter:this.filter})}else{a=this.store;delete this.store}a=Ext.StoreMgr.lookup(a);this.bind(a);if(this.loadFirst){this.store.load({params:{start:this.start,limit:this.limit}})}this.shadow=false;if(!this.view){this.view=new Ext.grid.GroupingView({forceFit:true,emptyText:idesk.webos.message.paperwork.emptyresult,groupTextTpl:this.groupTextTpl,getRowClass:this.rowClass})}if(!this.loadMask){this.loadMask={msg:idesk.webos.message.load_data}}iNet.iwebos.ui.common.grid.WebOSEditorGrid.superclass.initComponent.call(this)},onSearch:function(params){var index=0;var buf=[];var param=null;for(index=0;index<params.length;index++){param=params[index];buf.push(param.key+":'"+param.value+"'")}var paramValue=buf.join(",");var searchParams=eval("({"+paramValue+"})");this.store.baseParams=Ext.apply(this.baseParams||{},searchParams);this.store.load()},bind:function(a){if(this.selectFirstRow){if(this.store){this.store.un("load",this.onStoreLoad,this)}if(a){a.on("load",this.onStoreLoad,this)}}this.store=a},onStoreLoad:function(){if(this.store&&this.store.getCount()>0){this.selModel.selectFirstRow()}}}); 
iNet.iwebos.ui.mail.Header=function(b,a){this.viewer=b;Ext.apply(this,a);iNet.iwebos.ui.mail.Header.superclass.constructor.call(this,{region:"north",contentEl:"header",border:false,frame:false,height:90,width:"100%"})};Ext.extend(iNet.iwebos.ui.mail.Header,Ext.Panel,{}); 
Ext.onReady(function(){var b;function a(c){var e=Ext.get(c+"-link");if(!e){return}var f=0,d,j=Ext.getDoc();var g=function(m,l){if(l!=e.dom&&l!=d.dom&&!m.within(e)&&!m.within(d)){i()}};var i=function(){if(d){d.hide();e.setStyle("text-decoration","");j.un("mouseover",g);j.un("mousedown",h)}};var h=function(l){if(!l.within(d)){i()}};var k=function(){clearTimeout(f);f=0;if(!d){d=new Ext.Layer({shadow:"sides",hideMode:"display"},c+"-menu")}d.hideMenu=i;d.el=e;if(b&&d!=b){b.hideMenu()}b=d;if(!d.isVisible()){d.show();d.alignTo(e,"tl-bl?");d.sync();e.setStyle("text-decoration","underline");j.on("mouseover",g,null,{buffer:150});j.on("mousedown",h)}};e.on("mouseover",function(l){if(!f){f=k.defer(150)}});e.on("mouseout",function(l){if(f&&!l.within(e,true)){clearTimeout(f);f=0}})}a("iwebos");a("home");a("document");a("calendar");a("mail");a("administrator");a("contact");a("paperwork");Ext.getBody().on("click",function(g,d){d=Ext.get(d);g.stopEvent();var f=d.next("div.expandable-body");f.enableDisplayMode();var h=f.first();var c=f.isVisible();if(c){f.hide()}else{h.hide();f.show();h.slideIn("l",{duration:0.2,stopFx:true,easing:"easeOut"})}d.update(!c?"Hide details":"Show details")},null,{delegate:"a.expander"})}); 
iNet.iwebos.ui.common.search.AdvancedSearch=Ext.extend(Ext.Panel,{initComponent:function(){this.mode=(!this.mode)?false:!!this.mode;this.expandIcon=(!this.expandIcon)?"icon-expand":this.expandIcon;this.collapseIcon=(!this.collapseIcon)?"icon-collapse":this.collapseIcon;this.prefix=(!this.prefix)?"iwebos-as":this.prefix;this.quick=this.quick||[];this.id=this.nextId("cmb",6);this.chModeId=this.nextId("chbtn",6);var b={xtype:"button",id:this.chModeId,iconCls:(this.mode?this.expandIcon:this.collapseIcon),tooltip:(!this.mode?idesk.webos.message.paperwork.search_basic:idesk.webos.message.paperwork.search_more),handler:this.changeMode,scope:this};this.searchBtnId=this.nextId("sbtn",6);this.searchButton={xtype:"button",id:this.searchBtnId,iconCls:"icon-search",text:idesk.webos.message.paperwork.search_title,tooltip:idesk.webos.message.paperwork.search_title,handler:this.search,scope:this};var c=[b,"-"];for(var a=0;a<this.quick.length;a++){if(typeof this.quick[a].ct!=="string"){if(!this.quick[a].ct.id){this.quick[a].ct.id=this.nextId("qs",6)}this.quick[a]["id"]=this.quick[a].ct.id}c[c.length]=this.quick[a].ct}c[c.length]=this.searchButton;if(this.store){this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.store,displayInfo:false});if(Ext.isGecko2){c[c.length]="-"}else{c[c.length]="->"}c[c.length]=this.pagingBar}this.tbar=c;this.adSearchId=this.nextId("ads",6);this.advanced=(!this.advanced?new iNet.iwebos.ui.paperwork.EDSearchDetails({id:this.adSearchId,labelAlign:"right",labelWidth:90,frame:false,border:false,anchor:"100%",bodyStyle:"padding: 5px;"}):this.advanced);if(!this.advanced.id){this.advanced.id=this.adSearchId}else{this.adSearchId=this.advanced.id}this.items=this.advanced;iNet.iwebos.ui.common.search.AdvancedSearch.superclass.initComponent.call(this);this.addEvents("changemode","search");this.on("changemode",this.onChangeMode,this);this.on("afterlayout",this.onAfterLayout,this)},afterRender:function(){iNet.iwebos.ui.common.search.AdvancedSearch.superclass.afterRender.call(this);this.bind(this.mode)},onAfterLayout:function(a,b){this.bind(this.mode)},changeMode:function(){this.mode=!this.mode;this.bind(this.mode);this.fireEvent("changemode",!this.mode,this.mode)},search:function(){var c=this.getQuickContent(this.mode);if(this.mode){c.push({key:"mode",value:"advancedSearch"});var b=this.advanced.getSearchContent();if(!b){b=[]}var a=0;for(a=0;a<b.length;a++){c.push(b[a])}}else{c.push({key:"mode",value:"quickSearch"})}this.fireEvent("search",c)},onChangeMode:function(a,b){Ext.EventManager.fireWindowResize()},handlePanelEvent:function(a){if(this.mode){Ext.EventManager.fireWindowResize()}},bind:function(e){var d=Ext.getCmp(this.chModeId);var f=Ext.getCmp(this.adSearchId);if(d){var b=d.el;if(b){var c=b.child(d.buttonSelector)||{};c.dom[d.tooltipType]=(this.mode?idesk.webos.message.paperwork.search_basic:idesk.webos.message.paperwork.search_more)}}if(e===false){for(var a=0;a<this.quick.length;a++){if(!this.quick[a].show&&!!this.quick[a].id){Ext.getCmp(this.quick[a].id).show()}}d.setIconClass(this.expandIcon);f.hide();this.setHeight(0)}else{for(var a=0;a<this.quick.length;a++){if(!this.quick[a].show&&!!this.quick[a].id){Ext.getCmp(this.quick[a].id).hide()}}d.setIconClass(this.collapseIcon);f.show();this.setHeight(f.el.getComputedHeight()+this.tbar.getHeight())}},getQuickContent:function(e){var d=[];var c;if(e===false){for(var a=0;a<this.quick.length;a++){if(!!this.quick[a].id){c=Ext.getCmp(this.quick[a].id);var b=c.getValue();if(c.getXType()==="datefield"){b=(b==""||b==null?"":b.format("d/m/Y"))}d[d.length]={key:this.quick[a].key,value:b}}}}else{for(var a=0;a<this.quick.length;a++){if(!!this.quick[a].show&&!!this.quick[a].id){c=Ext.getCmp(this.quick[a].id);var b=c.getValue();if(c.getXType()==="datefield"){b=(b==""||b==null?"":b.format("d/m/Y"))}d[d.length]={key:this.quick[a].key,value:b}}}}return d},nextId:function(e,a){var d=String(new Date().getTime()).substr(a);var c="abcdefghijklmnopqrstuvwxyz";for(var b=0;b<a;b++){d+=c.charAt(Math.floor(Math.random()*26))}return this.prefix+"-"+e+"-"+d+"-id"}}); 
iNet.iwebos.ui.common.store.WebOSSimpleStore=function(a){var b=a.data||[];if(a.data){delete a.data}iNet.iwebos.ui.common.store.WebOSSimpleStore.superclass.constructor.call(this,a);this.proxy=new Ext.data.MemoryProxy(b)};Ext.extend(iNet.iwebos.ui.common.store.WebOSSimpleStore,Ext.data.Store,{addData:function(a){this.suspendEvents();this.clearFilter();this.resumeEvents();this.loadData([a],true);this.suspendEvents();this.resumeEvents();this.fireEvent("datachanged",this)}}); 
iNet.iwebos.ui.common.store.WebOSGroupingStore=function(a){a=a||{};a.filter=a.filter||{data:"all"};iNet.iwebos.ui.common.store.WebOSGroupingStore.superclass.constructor.call(this,a)};Ext.extend(iNet.iwebos.ui.common.store.WebOSGroupingStore,Ext.data.GroupingStore,{applyFilter:function(b){if(b!==undefined){if(typeof b=="object"){this.filter.data=b.data;this.filter.fn=b.fn;this.filter.scope=b.scope}else{this.filter.data=b}}var a=this.filter.data;if(a=="all"||!this.filter.fn){return this.clearFilter()}return this.filterBy(function(c){if(!this.filter.scope){return this.filter.fn(c,a)}else{return this.filter.fn.apply(this.filter.scope,[c,a])}})},addData:function(c){var a=this.reader.recordType;var b=new a(c,c.id);b.json=c;this.suspendEvents();this.clearFilter();this.resumeEvents();this.loadRecords({success:true,records:[b],totalRecords:1},{add:true},true);this.suspendEvents();this.applyFilter();this.applyGrouping(true);this.resumeEvents();this.fireEvent("datachanged",this)}}); 
iNet.iwebos.ui.common.store.WebOSDBStore=function(b){var a=b.readonly||false;var c=b.transaction||false;this.table=b.table||"default";this.keyName=b.key||"id";this.loadParams=b.load||{};this.addParams=b.add;this.updateParams=b.update;this.removeParams=b.remove;this.conn=b.conn||iNet.Database.getConnection();this.prepareData=b.prepare||{fn:function(d,e){d.dirty=!!e;return d}};this.record=Ext.isArray(b.record)?Ext.data.Record.create(b.record):b.record;iNet.iwebos.ui.common.store.WebOSDBStore.superclass.constructor.call(this,{sortInfo:b.sortInfo,baseParams:b.baseParams,reader:new Ext.data.JsonReader({idProperty:this.keyName},this.record)});this.proxy=new iNet.iwebos.data.db.DBProxy(this.conn,this.table,this.keyName,this,a,c);if(window.google&&google.gears){this.proxy.on("beforeload",this.prepareTable,this)}};Ext.extend(iNet.iwebos.ui.common.store.WebOSDBStore,Ext.data.Store,{prepareTable:function(){this.conn.createTable({name:this.table,key:this.keyName,fields:this.record.prototype.fields})},load:function(a){var b=a||{};if(!b.callback){b.callback=this.loadCallback;b.scope=this}iNet.iwebos.ui.common.store.WebOSDBStore.superclass.load.call(this,b)},loadCallback:function(){if(this.getCount()<1){this.loadServer(this.loadParams)}},loadServer:function(d){var b=d.url;var f=d.params||{};var a=d.success||function(g,h){};var c=d.failure||function(g,h){};var e=d.method||"GET";Ext.Ajax.request({url:b,success:this.success,successHandler:a,handlerScope:d.scope,failure:this.failure,failureHandler:c,method:e,scope:this,params:f})},success:function(b,e){var d=e.successHandler;if(d!=undefined){var f=null;if(!e.handlerScope){f=d(b)}else{f=d.apply(e.handlerScope,[b])}var a=f.length;for(var c=0;c<a;c++){this.addObject(f[c],false)}}},failure:function(a,b){var c=b.failureHandler;if(c!=undefined){if(!b.handlerScope){c(a)}else{c.apply(b.handlerScope,[a])}}},addObject:function(b,c){this.suspendEvents();this.clearFilter();this.resumeEvents();var a=null;if(!this.prepareData.scope){a=this.prepareData.fn(b,!!c)}else{a=this.prepareData.fn.apply(this.prepareData.scope,[b,!!c])}this.loadData([a],true);this.suspendEvents();this.resumeEvents();this.fireEvent("datachanged",this)}}); 
iNet.iwebos.ui.common.store.WebOSDBGroupingStore=function(b){var a=b.readonly||false;var c=b.transaction||false;this.table=b.table||"default";this.keyName=b.key||"id";this.loadParams=b.load||{};this.addParams=b.add;this.updateParams=b.update;this.removeParams=b.remove;this.conn=b.conn||iNet.Database.getConnection();this.filter=b.filter||{data:"all",fn:function(d){return d}};this.prepareData=b.prepare||{fn:function(d,e){d.dirty=!!e;return d}};this.record=Ext.isArray(b.record)?Ext.data.Record.create(b.record):b.record;iNet.iwebos.ui.common.store.WebOSDBGroupingStore.superclass.constructor.call(this,{sortInfo:b.sortInfo,groupField:b.groupField,baseParams:b.baseParams,reader:new Ext.data.JsonReader({idProperty:this.keyName},this.record)});this.proxy=new iNet.iwebos.data.db.DBProxy(this.conn,this.table,this.keyName,this,a,c);if(window.google&&google.gears){this.proxy.on("beforeload",this.prepareTable,this)}};Ext.extend(iNet.iwebos.ui.common.store.WebOSDBGroupingStore,Ext.data.GroupingStore,{prepareTable:function(){this.conn.createTable({name:this.table,key:this.keyName,fields:this.record.prototype.fields})},load:function(a){var b=a||{};if(!b.callback){b.callback=this.loadCallback;b.scope=this}iNet.iwebos.ui.common.store.WebOSDBGroupingStore.superclass.load.call(this,b)},loadCallback:function(){if(this.getCount()<1){this.loadServer(this.loadParams)}},loadServer:function(d){var b=d.url;var f=d.params||{};var a=d.success||function(g,h){};var c=d.failure||function(g,h){};var e=d.method||"GET";Ext.Ajax.request({url:b,success:this.success,successHandler:a,handlerScope:d.scope,failure:this.failure,failureHandler:c,method:e,scope:this,params:f})},success:function(b,e){var d=e.successHandler;if(d!=undefined){var f=null;if(!e.handlerScope){f=d(b)}else{f=d.apply(e.handlerScope,[b])}var a=f.length;for(var c=0;c<a;c++){this.addObject(f[c],false)}}},failure:function(a,b){var c=b.failureHandler;if(c!=undefined){if(!b.handlerScope){c(a)}else{c.apply(b.handlerScope,[a])}}},applyFilter:function(b){if(b!==undefined){if(typeof b=="object"){this.filter.data=b.data;this.filter.fn=b.fn;this.filter.scope=b.scope}else{this.filter.data=b}}var a=this.filter.data;if(a=="all"||!this.filter.fn){return this.clearFilter()}return this.filterBy(function(c){if(!this.filter.scope){return this.filter.fn(c,a)}else{return this.filter.fn.apply(this.filter.scope,[c,a])}})},addObject:function(b,c){this.suspendEvents();this.clearFilter();this.resumeEvents();var a=null;if(!this.prepareData.scope){a=this.prepareData.fn(b,!!c)}else{a=this.prepareData.fn.apply(this.prepareData.scope,[b,!!c])}this.loadData([a],true);this.suspendEvents();this.applyFilter();this.applyGrouping(true);this.resumeEvents();this.fireEvent("datachanged",this)}}); 
Ext.ux.TabCloseMenu=function(){var a,c,b;this.init=function(e){a=e;a.on("contextmenu",d)};function d(h,g,i){if(!c){c=new Ext.menu.Menu([{id:a.id+"-close",text:"Close Tab",handler:function(){a.remove(b)}},{id:a.id+"-close-others",text:"Close Other Tabs",handler:function(){a.items.each(function(e){if(e.closable&&e!=b){a.remove(e)}})}}])}b=g;var f=c.items;f.get(a.id+"-close").setDisabled(!g.closable);var j=true;a.items.each(function(){if(this!=g&&this.closable){j=false;return false}});f.get(a.id+"-close-others").setDisabled(j);c.showAt(i.getPoint())}}; 
iNet.iwebos.ui.common.tree.TreeColumnNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{renderElements:function(f,o,k,p){this.indentMarkup=f.parentNode?f.parentNode.ui.getChildIndent():"";var q=f.getOwnerTree();var m=q.columns;var l=q.borderWidth;var h=typeof o.checked=="boolean";var g=m[0];var d=m.length;var c=o.href?o.href:Ext.isGecko?"":"#";var e=['<li class="x-tree-node"><div ext:tree-node-id="',f.id,'" class="x-tree-node-el x-tree-node-leaf ',o.cls,'">','<div class="x-tree-col" style="width:',g.width-l,'px;">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow"/>',h?('<input class="x-tree-node-cb" type="checkbox" '+(o.checked?'checked="checked"/>':"/>")):"",'<img src="',o.icon||this.emptyIcon,'" class="x-tree-node-icon',(o.icon?" x-tree-node-inline-icon":""),(o.iconCls?" "+o.iconCls:""),'" unselectable="on"/>','<a hidefocus="on" class="x-tree-node-anchor" href="',c,'" tabIndex="1" ',o.hrefTarget?' target="'+o.hrefTarget+'"':"",">",'<span unselectable="on">',f.text||(g.renderer?g.renderer(o[g.dataIndex],f,o):o[g.dataIndex]),"</span>","</a>","</div>"];var j=1;for(j=1;j<d;j++){g=m[j];e.push('<div class="x-tree-col" style="width:',g.width-l,'px;">','<div class="x-tree-col-text">',(g.renderer?g.renderer(o[g.dataIndex],f,o):o[g.dataIndex]),"</div>","</div>")}e.push('<div class="x-clear"></div>',"</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>");var b;if(p!==true&&f.nextSibling&&(b=f.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",b,e.join(""))}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",k,e.join(""))}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var i=this.elNode.firstChild.childNodes;this.indentNode=i[0];this.ecNode=i[1];j=2;if(h){this.checkbox=i[j];this.checkbox.defaultChecked=this.checkbox.checked;j++}this.iconNode=i[j];this.anchor=i[j+1];this.textNode=i[j+1].firstChild}}); 
iNet.iwebos.ui.common.tree.TreeLoaderWrapper=function(a){this.baseParams={};Ext.apply(this,a);this.addEvents("beforeload","load","loadexception");iNet.iwebos.ui.common.tree.TreeLoaderWrapper.superclass.constructor.call(this)};Ext.extend(iNet.iwebos.ui.common.tree.TreeLoaderWrapper,Ext.util.Observable,{uiProviders:{},clearOnLoad:true,load:function(a,b){if(this.clearOnLoad){while(a.firstChild){a.removeChild(a.firstChild)}}if(this.doPreload(a)){if(typeof b=="function"){b()}}else{if(this.dataUrl||this.url){this.requestData(a,b)}}},doPreload:function(d){if(d.attributes.children){if(d.childNodes.length<1){var c=d.attributes.children;d.beginUpdate();for(var b=0,a=c.length;b<a;b++){var e=d.appendChild(this.createNode(c[b]));if(this.preloadChildren){this.doPreload(e)}}d.endUpdate()}return true}else{return false}},getParams:function(d){var a=[],c=this.baseParams;for(var b in c){if(typeof c[b]!="function"){a.push(encodeURIComponent(b),"=",encodeURIComponent(c[b]),"&")}}a.push("node=",encodeURIComponent(d.id));return a.join("")},requestData:function(a,b){if(this.fireEvent("beforeload",this,a,b)!==false){this.transId=Ext.Ajax.request({method:this.requestMethod,url:this.dataUrl||this.url,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:b,node:a},params:this.getParams(a),headers:{"X-Ghost-Request":window.location.href}})}else{if(typeof b=="function"){b()}}},isLoading:function(){return !!this.transId},abort:function(){if(this.isLoading()){Ext.Ajax.abort(this.transId)}},createNode:function(attr){if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}if(this.applyLoader!==false){attr.loader=this}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}if(attr.nodeType){return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}else{return attr.leaf?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr)}},processResponse:function(response,node,callback){var json=response.responseText;try{var o=eval("("+json+")");node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i]);if(n){node.appendChild(n)}}node.endUpdate();if(typeof callback=="function"){callback(this,node)}}catch(e){this.handleFailure(response)}},handleResponse:function(c){this.redirect(c);this.transId=false;var b=c.argument;this.processResponse(c,b.node,b.callback);this.fireEvent("load",this,b.node,c)},handleFailure:function(c){this.redirect(c);this.transId=false;var b=c.argument;this.fireEvent("loadexception",this,b.node,c);if(typeof b.callback=="function"){b.callback(this,b.node)}},redirect:function(b){try{var a=Ext.util.JSON.decode(b.responseText)||{};if(a.type==="redirect"){window.location.href=a.target}}catch(c){}}}); 
iNet.iwebos.ui.common.tree.TreeNodeExUI=Ext.extend(Ext.tree.TreeNodeUI,{renderElements:function(d,f,i,j){this.indentMarkup=d.parentNode?d.parentNode.ui.getChildIndent():"";var e=typeof f.checked=="boolean";var b=f.href?f.href:Ext.isGecko?"":"#";var c=['<li class="x-tree-node"><div ext:tree-node-id="',d.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',f.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow"/>',e?('<input class="x-tree-node-cb" type="checkbox" '+(f.checked?'checked="checked"/>':"/>")):"",'<img src="',f.icon||this.emptyIcon,'" class="x-tree-node-icon ',(f.icon?" x-tree-node-inline-icon ":""),(f.iconCls?" "+f.iconCls:""),'" unselectable="on"/>','<a hidefocus="on" class="x-tree-node-anchor" href="',b,'" tabIndex="1" ',f.hrefTarget?' target="'+f.hrefTarget+'"':"",">",'<span unselectable="on">',d.text,"</span>","</a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"];var a;if(j!==true&&d.nextSibling&&(a=d.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",a,c.join(""))}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",i,c.join(""))}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var h=this.elNode.childNodes;this.indentNode=h[0];this.ecNode=h[1];var g=2;if(e){this.checkbox=h[g];this.checkbox.defaultChecked=this.checkbox.checked;g++}this.iconNode=h[g];this.anchor=h[g+1];this.textNode=h[g+1].firstChild},onSelectedChange:function(a){if(this.checkbox&&!a){this.checkbox.checked=a}iNet.iwebos.ui.common.tree.TreeNodeExUI.superclass.onSelectedChange.call(this,a)}}); 
(function(){LotusService={};Ext.apply(LotusService,{handleKeyEventOnGrid:function(a,b){if(b.ctrlKey&&b.getKey()==97){a.getSelectionModel().selectAll()}b.stopEvent()}})})(); 
iNet.iwebos.ui.account.AccountPanel=function(g,c){this.viewer=g;Ext.apply(this,c);var b={field:"fname",direction:"DESC"};var f={field:"fname",direction:"DESC"};var h={iwct:"searchMailAsAccountContent",iwa:"view",id:0,action:"search"};var e=Ext.data.Record.create([{name:"id",mapping:"code",type:"string"},{name:"code",mapping:"code",type:"string"},{name:"fname",mapping:"displayname",type:"string"},{name:"email",mapping:"email",type:"string"},{name:"edit",mapping:"edit",type:"boolean"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"code"},e);var d=new Ext.grid.ColumnModel([{header:iwebos.message.mail.create.firstname,dataIndex:"fname",width:0.35},{header:iwebos.message.mail.create.email,dataIndex:"email",width:0.4}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"account-grid",region:"center",anchor:"100%",autoScroll:true,url:"jsonajax",method:"POST",baseParams:h,loadFirst:false,sortInfo:b,reader:a,dsort:f,cm:d,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),filter:{data:"all"},view:new Ext.grid.GridView({forceFit:true})});this.grid.on("rowcontextmenu",this._onRowContext,this);this.grid.on("contextmenu",this._onContextMenu,this);this.grid.on("rowdblclick",this._onDoubleClick,this);this.toolBar=new iNet.iwebos.ui.account.AccountToolbar({id:"account-main-tabs-toolbar",region:"north",width:"100%",height:30,frame:false,border:false,store:this.grid.store});this.toolBar.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});this.gridMain=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[this.toolBar,this.grid]});this.main=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[this.gridMain]});this.actions={"account-creat-new":this._onAddAccount.createDelegate(this),"account-reset-pass":this._openResetPwdDialog.createDelegate(this)};iNet.iwebos.ui.account.AccountPanel.superclass.constructor.call(this,{id:"account-main-tabs",activeTab:0,region:"center",anchor:"100%",enableTabScroll:true,autoScroll:true,frame:false,border:false,items:{id:"main-manager-account",title:iwebos.message.account.manageAccount,iconCls:"icon-mail-home",layout:"border",hideMode:"offsets",items:[this.main]}})};Ext.extend(iNet.iwebos.ui.account.AccountPanel,Ext.TabPanel,{handlePanel:function(a,e,c){if(!a){return}var d=c||{};var f=e||"main-manager-account";var b=a.body;if(a._fnDisabledAll&&typeof a._fnDisabledAll=="function"){a._fnDisabledAll()}b.select('li[id="li-action-create"]').setDisplayed(true);b.select('li[id="li-action-statistics"]').setDisplayed(true);if(f==="new-account"){b.select('li[id="li-action-search"]').setDisplayed(true);b.select('li[id="li-action-save"]').setDisplayed(true)}},onActive:function(a){this.active=true},_onContextMenu:function(a){a.stopEvent()},_onRowContext:function(d,c,f){f.stopEvent();d.getSelectionModel().selectRow(c);if(!this.menu){this.menu=new Ext.menu.Menu({id:"grid-ctx",items:[{id:"account-menu-item-update",text:iwebos.message.account.updateAccount,iconCls:"icon-account-update",handler:this._onUpdateAccount.createDelegate(this)},{id:"account-menu-item-reset-pwd",text:iwebos.message.account.resetPassword,iconCls:"icon-account-reset-pass",handler:this._openResetPwdDialog.createDelegate(this)},"-",{id:"account-menu-item-lock",text:iwebos.message.account.lockAccount,iconCls:"icon-account-lock",handler:this._fnLockAccount.createDelegate(this)},{id:"account-menu-item-unlock",text:iwebos.message.account.unlockAccount,iconCls:"icon-account-unlock",handler:this._fnUnlockAccount.createDelegate(this)},{id:"account-menu-item-delete",text:iwebos.message.account.deleteAccount,iconCls:"icon-account-delete",handler:this._onDeleteAccount.createDelegate(this)}]});this.menu.on("hide",this.onContextHide,this)}var b=d.store.getAt(c).data;var a=false;Ext.getCmp("account-menu-item-update").setDisabled(a);Ext.getCmp("account-menu-item-delete").setDisabled(a);Ext.getCmp("account-menu-item-reset-pwd").setDisabled(a);this.menu.showAt(f.getXY())},_onDoubleClick:function(d,b,f){f.stopEvent();var a=d.store.getAt(b);var c=this._fnNewTab();c.loadData(a.id)},_onAddAccount:function(){var a=this._fnNewTab()},_onUpdateAccount:function(){var a=this._getFirstSelection();if(a!=null){var b=this._fnNewTab();b.loadData(a.id)}},_getFirstSelection:function(){var a=this.grid.getSelectionModel().getSelections();if(a==null||a.length==0){return null}return a[0]},_openResetPwdDialog:function(){var a=this._getFirstSelection();if(a!=null){var b=new iNet.iwebos.ui.account.DialogResetPwd();b.setData(a.data.fname,a.data.code);b.show(this)}},_fnLockAccount:function(){this._fnHandlerAccount(false)},_fnUnlockAccount:function(){this._fnHandlerAccount(true)},_fnHandlerAccount:function(active){var __selection=this._getFirstSelection();var __data=__selection.data;if(__data!=null){var __onOk=function(answer){if(answer=="ok"||answer=="yes"){var __fnSuccess=function(response,options){var __result=eval("("+response.responseText+")");if(__result.success){Ext.MessageBox.show({title:iwebos.message.account.infomationMessage,msg:iwebos.message.account.taskSuccessfull,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.account.taskError,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}}var __baseParams={iwct:"mailAccountContent",iwa:"READ_WRITE",action:"activeAll"};var object={};object.code=__data.code;object.active=active;__baseParams.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",method:"POST",params:__baseParams,success:__fnSuccess,scope:this})};var __warning=active?iwebos.message.account.unlockAccountConfirm:iwebos.message.account.lockAccountConfirm;Ext.MessageBox.confirm(iwebos.message.account.infomationMessage,__warning,__onOk)}},_onDeleteAccount:function(){var __store=this.grid.store;var __selection=this._getFirstSelection();var __data=__selection.data;if(__data!=null){var onOk=function(answer){if(answer=="ok"||answer=="yes"){var fnSuccess=function(response,options){var result=eval("("+response.responseText+")");if(result.success){__store.remove(__selection)}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.account.deleteAccountError,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"mailAccountContent",iwa:"READ_WRITE",action:"deleteAll"};var object={};object.code=__data.code;params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",method:"POST",params:params,success:fnSuccess,scope:this})}};Ext.MessageBox.confirm(iwebos.message.account.infomationMessage,iwebos.message.account.deleteAccountConfirm,onOk)}},onContextHide:function(){if(this.ctxRow){Ext.fly(this.ctxRow).removeClass("x-node-ctx");this.ctxRow=null}},doAction:function(c,e){var d=Ext.getCmp("account-main-tabs");c.stopEvent();var b=d.getActiveTab(),a=b.getId()||null;if((a!=null)&&(a=="new-account")){b.doAction(c,e)}else{if(this.actions!==undefined){this.actions[e.id]()}}},_dlgAdd:function(){var a=new iNet.iwebos.ui.account.DialogAddAccount();a.show(this)},_fnNewTab:function(){var b=Ext.getCmp("account-main-tabs");var a=Ext.getCmp("new-account");if(!a){a=new iNet.iwebos.ui.account.CreateAccount();b.add(a).show()}b.setActiveTab(a);return a}}); 
iNet.iwebos.ui.account.AccountToolbar=Ext.extend(Ext.Panel,{initComponent:function(){this._first=true;this.toolbarSeach=new Ext.app.SearchField({width:200,onTrigger2Click:this.search.createDelegate(this)});this.prefix=(!this.prefix)?"manage-account-search":this.prefix;this.depSearchId=this.prefix+"-departmentSearch";this.domainSearchId=this.prefix+"-domainSearch";this.id=this.nextId("cmb",1);var b={iwct:"loadMailDomainContent",iwa:"view",action:"loadAll"};this._domainStore=new Ext.data.JsonStore({url:"jsonajax",baseParams:b,fields:[{name:"domainId",mapping:"id",type:"string"},{name:"domainName",mapping:"text",type:"string"},{name:"edit",mapping:"edit",type:"boolean"}]});var d=new Ext.form.ComboBox({id:this.domainSearchId,fieldLabel:iwebos.message.mail.org,store:this._domainStore,forceSelection:true,displayField:"domainId",valueField:"domainName",typeAhead:true,readOnly:true,mode:"local",triggerAction:"all",emptyText:"",selectOnFocus:false});this._departmentStore=new Ext.data.JsonStore({root:"rows",fields:[{name:"depName",type:"string"},{name:"depNumber",type:"string"}]});var a=new Ext.form.ComboBox({id:this.depSearchId,fieldLabel:"Dep",store:this._departmentStore,displayField:"depName",valueField:"depNumber",typeAhead:true,readOnly:true,mode:"local",triggerAction:"all",emptyText:"",selectOnFocus:false});var c=[this.toolbarSeach,d,a];if(this.store){this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.store,displayInfo:false});if(Ext.isGecko2){c[c.length]="-"}else{c[c.length]="->"}c[c.length]=this.pagingBar}this.tbar=c;iNet.iwebos.ui.account.AccountToolbar.superclass.initComponent.call(this);d.on("select",this._onSelectDomain,this,{stopEvent:true});this._domainStore.on("load",this._onLoadDomain,this,{stopEvent:true});this._domainStore.load()},search:function(){var d=[];var b=this.toolbarSeach.getRawValue();d.push({key:"key",value:b});var c=Ext.getCmp(this.depSearchId).getValue();d.push({key:"depNumber",value:c});var a=Ext.getCmp(this.domainSearchId).getValue();d.push({key:"domain",value:a});this.fireEvent("search",d)},_onLoadDomain:function(c,b,d){var a=Ext.getCmp(this.domainSearchId);var e=this._domainStore.getAt(0);if(e){a.setValue(e.get("domainId"));this._loadDepartment(null)}},_onSelectDomain:function(c,a,b){this._loadDepartment(c)},_loadDepartment:function(combo){var __component=combo||Ext.getCmp(this.domainSearchId);var __domain=__component.getValue();this._departmentStore.removeAll();if(__domain==null||__domain==""){return}var __fnSuccess=function(result,request){var data=result.responseText;data=eval("("+data+")");if(data){var __departments=data.list;var __item;for(var index=0;index<__departments.length;index++){__item=__departments[index];this._departmentStore.add(new Ext.data.Record({depNumber:__item.depNumber,depName:__item.depName}))}if(__departments.length>0){Ext.getCmp(this.depSearchId).setValue(__departments[0].depNumber);if(this._first){this._first=false;this.search()}}}};var loadParams={iwct:"loadMailDomainContent",iwa:"READ_WRITE",action:"loadDeps"};loadParams.text=__domain;iNet.Ajax.request({url:"jsonajax",params:loadParams,scope:this,method:"POST",success:__fnSuccess})},getDomains:function(){var b=this._domainStore.getCount();var c=[];if(b>0){for(var a=0;a<b;a++){c[a]=this._domainStore.getAt(a).data}}return c},getSelectedDomain:function(){return Ext.getCmp(this.domainSearchId).getValue()},nextId:function(e,a){var d=String(new Date().getTime()).substr(a);var c="abcdefghijklmnopqrstuvwxyzacc";for(var b=0;b<a;b++){d+=c.charAt(Math.floor(Math.random()*26))}return this.prefix+"-"+e+"-"+d+"-id"}}); 
iNet.iwebos.ui.account.CreateAccount=function(b,t){this.prefix=(!this.prefix)?"iwebos-mail-create":this.prefix;this.usernameId=this.prefix+"-uid-id";this.emailId=this.prefix+"-email-id";this.passwordId=this.prefix+"-password-id";this.confirmPasswordId=this.prefix+"-confirm-password-id";this.birthdayId=this.prefix+"-birthdaydate-id";this.sexId=this.prefix+"-sex-id";this.cityId=this.prefix+"-city-id";this.countryId=this.prefix+"-country-id";this.lastNameId=this.prefix+"-lastname-id";this.midleNameId=this.prefix+"-midlename-id";this.firstNameId=this.prefix+"-firstname-id";this.languageId=this.prefix+"-language-id";this.provinceId=this.prefix+"-province-id";this.postCodeId=this.prefix+"-postcode-id";this.timezoneId=this.prefix+"-timezone-id";this.emailsId=this.prefix+"-emails-information-id";this.infoPanel=this.prefix+"-infor-panel-id";this.__owner={code:"",action:"save"};var s={field:"uid",direction:"DESC"};var v={field:"uid",direction:"DESC"};var k={iwct:"searchMailAccountContent",iwa:"view",id:0,action:"search"};var p=Ext.data.Record.create([{name:"id",mapping:"email",type:"string"},{name:"email",mapping:"email",type:"string"},{name:"code",mapping:"code",type:"string"},{name:"uid",mapping:"uid",type:"string"},{name:"symbol",mapping:"symbol",type:"string"},{name:"domain",mapping:"domain",type:"string"},{name:"fname",mapping:"fname",type:"string"},{name:"lname",mapping:"lname",type:"string"},{name:"depNumber",mapping:"depNumber",type:"string"},{name:"smtp",mapping:"smtp",type:"boolean"},{name:"capacity",mapping:"capacity",type:"int"},{name:"active",mapping:"active",type:"boolean"},{name:"forward",mapping:"forward",type:"boolean"},{name:"virus",mapping:"virus",type:"boolean"},{name:"spam",mapping:"spam",type:"boolean"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"email"},p);var o=new Ext.grid.ColumnModel([{header:iwebos.message.mail.account,dataIndex:"uid",fixed:true,width:200},{header:"@",dataIndex:"symbol",fixed:true,width:24},{header:iwebos.message.mail.domain,dataIndex:"domain",width:100}]);var l=function(w,x){return(w.data.status===x)};var f=function(w){var x=w.data.read;return""};this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"mail-admin-create-gird",region:"north",anchor:"100%",autoScroll:true,height:180,url:"test.txt",method:"POST",sortInfo:s,loadFirst:false,baseParams:k,reader:a,rowClass:f,dsort:v,cm:o,filter:{data:"all",fn:l},view:new Ext.grid.GridView({forceFit:true}),tbar:[{id:"btn-create-newacc",xtype:"button",text:iwebos.message.mail.create.add,iconCls:"icon-mail-add",scope:this,handler:this._createMailAccount.createDelegate(this)}]});this.actions={"account-creat-new":this.onAdd.createDelegate(this),"account-save":this.onSave.createDelegate(this),"account-search":this._searchAccount.createDelegate(this)};var d=new Ext.data.SimpleStore({fields:["value","text"],data:[["male",iwebos.message.mail.create.male],["female",iwebos.message.mail.create.female]]});var e=new Ext.data.SimpleStore({fields:["value","text"],data:[["",""],["vi",iwebos.message.mail.create.vietnameseLanguage],["en",iwebos.message.mail.create.englishLanguage]]});var u=new Ext.data.SimpleStore({fields:["value","text"],data:[["vn",iwebos.message.mail.create.vietnamese],["ot",iwebos.message.mail.create.otherCountry]]});var n=[["-1200","(GMT -12:00) Eniwetok, Kwajalein"],["-1100","(GMT -11:00) Midway Island, Samoa"],["-1000","(GMT -10:00) Hawaii"],["-0900","(GMT -9:00) Alaska"],["-0800","(GMT -8:00) Pacific Time (US &amp; Canada)"],["-0700","(GMT -7:00) Mountain Time (US &amp; Canada)"],["-0600","(GMT -6:00) Central Time (US &amp; Canada), Mexico City"],["-0500","(GMT -5:00) Eastern Time (US &amp; Canada), Bogota, Lima"],["-0430","(GMT -4:30) Caracas"],["-0400","(GMT -4:00) Atlantic Time (Canada), La Paz, Santiago"],["-0330","(GMT -3:30) Newfoundland"],["-0300","(GMT -3:00) Brazil, Buenos Aires, Georgetown"],["-0200","(GMT -2:00) Mid-Atlantic"],["-0100","(GMT -1:00) Azores, Cape Verde Islands"],["0000"," (GMT) Western Europe Time, London, Lisbon, Casablanca"],["+0100","(GMT +1:00) Brussels, Copenhagen, Madrid, Paris"],["+0200","(GMT +2:00) Kaliningrad, South Africa"],["+0300","(GMT +3:00) Baghdad, Riyadh, Moscow, St. Petersburg"],["+0330","(GMT +3:30) Tehran"],["+0400","(GMT +4:00) Abu Dhabi, Muscat, Baku, Tbilisi"],["+0430","(GMT +4:30) Kabul"],["+0500","(GMT +5:00) Ekaterinburg, Islamabad, Karachi, Tashkent"],["+0530","(GMT +5:30) Mumbai, Kolkata, Chennai, New Delhi"],["+0545","(GMT +5:45) Kathmandu"],["+0600","(GMT +6:00) Almaty, Dhaka, Colombo"],["+0630","(GMT +6:30) Yangon, Cocos Islands"],["+0700","(GMT +7:00) Ha Noi, Bangkok, Jakarta"],["+0800","(GMT +8:00) Beijing, Perth, Singapore, Hong Kong"],["+0900","(GMT +9:00) Tokyo, Seoul, Osaka, Sapporo, Yakutsk"],["+0930","(GMT +9:30) Adelaide, Darwin"],["+1000","(GMT +10:00) Eastern Australia, Guam, Vladivostok"],["+1100","(GMT +11:00) Magadan, Solomon Islands, New Caledonia"],["+1200","(GMT +12:00) Auckland, Wellington, Fiji, Kamchatka"]];var h=new Ext.data.SimpleStore({fields:["value","text"],data:n});var g="*";var r=new Ext.form.FormPanel({region:"center",frame:false,border:false,autoHeight:true,anchor:"100%",labelAlign:"right",bodyStyle:"padding: 5px;",items:[{border:false,html:iwebos.message.mail.create.account_info},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",border:false,items:[{id:this.usernameId,xtype:"textfield",anchor:"95%",tabIndex:1,fieldLabel:iwebos.message.mail.create.username+g},{id:this.passwordId,xtype:"textfield",inputType:"password",tabIndex:3,fieldLabel:iwebos.message.mail.create.password+g,anchor:"95%"}]},{columnWidth:0.5,layout:"form",anchor:"100%",labelWidth:70,border:false,items:[{id:this.emailId,xtype:"textfield",anchor:"95%",vtype:"email",tabIndex:2,fieldLabel:iwebos.message.mail.create.email},{id:this.confirmPasswordId,xtype:"textfield",inputType:"password",tabIndex:4,fieldLabel:iwebos.message.mail.create.confirmpassword+g,anchor:"95%"}]}]},{border:false,html:iwebos.message.mail.create.personal_info},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",border:false,items:[{layout:"column",columnWidth:1,anchor:"95%",border:false,items:[{layout:"form",columnWidth:0.5,anchor:"100%",border:false,items:[{id:this.lastNameId,xtype:"textfield",anchor:"98%",tabIndex:5,fieldLabel:iwebos.message.mail.create.lastname+g}]},{layout:"form",columnWidth:0.5,anchor:"95%",border:false,items:[{id:this.midleNameId,xtype:"textfield",anchor:"100%",tabIndex:6,fieldLabel:iwebos.message.mail.create.middlename}]}]},{id:this.birthdayId,xtype:"datefield",format:"d/m/Y",tabIndex:8,fieldLabel:iwebos.message.mail.create.birthday,anchor:"95%"},{id:this.cityId,xtype:"textfield",anchor:"95%",tabIndex:10,fieldLabel:iwebos.message.mail.create.city}]},{columnWidth:0.5,layout:"form",anchor:"100%",labelWidth:70,border:false,items:[{id:this.firstNameId,xtype:"textfield",anchor:"95%",allowBlank:true,tabIndex:7,fieldLabel:iwebos.message.mail.create.firstname+g},{id:this.sexId,xtype:"combo",anchor:"95%",tabIndex:9,fieldLabel:iwebos.message.mail.create.sex,store:d,displayField:"text",valueField:"text",readOnly:true,mode:"local",triggerAction:"all",selectOnFocus:true},{id:this.countryId,xtype:"combo",anchor:"95%",tabIndex:11,fieldLabel:iwebos.message.mail.create.country+g,store:u,displayField:"text",valueField:"value",value:"vn",readOnly:true,mode:"local",triggerAction:"all",selectOnFocus:true}]}]},{border:false,html:iwebos.message.mail.create.other_info},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",border:false,items:[{id:this.languageId,xtype:"combo",anchor:"95%",tabIndex:12,fieldLabel:iwebos.message.mail.create.language,store:e,displayField:"text",valueField:"value",value:"vi",readOnly:true,mode:"local",triggerAction:"all",selectOnFocus:true},{id:this.postCodeId,xtype:"textfield",anchor:"95%",tabIndex:14,fieldLabel:iwebos.message.mail.create.postcode}]},{columnWidth:0.5,layout:"form",anchor:"100%",labelWidth:70,border:false,items:[{id:this.provinceId,xtype:"textfield",anchor:"95%",tabIndex:13,fieldLabel:iwebos.message.mail.create.province},{id:this.timezoneId,xtype:"combo",store:h,readOnly:true,displayField:"text",valueField:"value",anchor:"95%",tabIndex:15,allowBlank:false,value:"+0700",fieldLabel:iwebos.message.mail.create.timezone+g,mode:"local",triggerAction:"all",selectOnFocus:true}]}]}]});var j=new Ext.Panel({id:"previewPanel",region:"center",frame:true,hidden:true,border:false});var m=["<table width=100% border=0 cellspacing=0 cellpadding=0>",'<tr><td valign=top align="left" colspan="7"><b><font color="#404040">',iwebos.message.account.detail_info,":</font></b></td></tr>","<tr>",'<td width="125px"/><td align="left" width="125px" class="preview-account-text">\t',iwebos.message.account.detail_info_owner_account,':</td><td align="left" width="200px">{lname}&nbsp;{mname}&nbsp;{fname}</td>','<td valign=top align="left" width="165px" class="preview-account-text">',iwebos.message.account.detail_info_username,':</td><td align="left" colspan="2"><a href="#">{uid}{symbol}{domain}</a></td>',"</tr>",'<tr><td valign=top align="left" colspan="7"><b><font color="#404040">',iwebos.message.account.detail_info_options,":</font></b> </td></tr>","<tr>",'<td width="125px"/><td align="left" width="125px" class="preview-account-text">\t',iwebos.message.account.detail_info_sizelimit,':</td><td align="left" width="200px">{capacity}(MB)</td>','<td valign=top align="left" width="150px" class="preview-account-text">\t',iwebos.message.account.detail_info_virus,':</td><td align="left" width="75px">{[this.repl(values.virus)]}</td>','<td valign=top align="left" width="175px" class="preview-account-text">\t',iwebos.message.account.detail_info_spam,':</td><td align="left">{[this.repl(values.spam)]}</td>',"</tr>","<tr>",'<td width="125px"/><td align="left" width="125px"  class="preview-account-text">\t',iwebos.message.account.detail_info_smtp,':</td><td align="left" width="200px">{[this.repl(values.smtp)]}</td>','<td valign=top align="left" width="150px"  class="preview-account-text">\t',iwebos.message.account.detail_info_active,':</td><td align="left" width="75px">{[this.repl(values.active)]}</td>','<td valign=top align="left" width="175px"  class="preview-account-text">\t',iwebos.message.account.detail_info_transfer,':</td><td align="left">{[this.repl(values.forward)]}</td>',"</tr>","</table>"];var q=new Ext.XTemplate(m.join(""),{repl:function(w){return(w===true?iwebos.message.account.accept_value:iwebos.message.account.non_accept_value)}});this.grid.getSelectionModel().on("rowselect",function(D,B,A){var x=this.grid.store.getAt(B);var w=x.data;var C=Ext.getCmp("previewPanel");if(C){q.overwrite(C.body,w);var z=Ext.getCmp("previewPanel");var y=Ext.getCmp(this.emailsId);z.setVisible(true);y.setHeight(350)}else{}},this);var c=new Ext.FormPanel({region:"center",anchor:"98%",width:"98%",border:false,hideBorders:true,labelWidth:150,bodyStyle:"padding:5px 5px 0",items:[{id:this.emailsId,xtype:"fieldset",checkboxToggle:true,collapsed:true,hideBorders:false,border:Ext.isIE,title:iwebos.message.mail.view_info_account,height:215,layout:"border",width:"99%",items:[this.grid,j]}]});var i=new Ext.Panel({region:"center",autoScroll:true,border:false,items:[r,{border:false,html:"<br />"},c]});i.on("resize",this.__resizePanel,this);this.grid.on("contextmenu",this._contextMenu,this,{stopEvent:true});this.grid.on("rowcontextmenu",this._rowContextMenu,this,{stopEvent:true});this.grid.on("rowdblclick",this._onDoubleClick,this);iNet.iwebos.ui.account.CreateAccount.superclass.constructor.call(this,{id:"new-account",iconCls:"icon-create-account",title:iwebos.message.mail.create.atitle,header:false,enableTabScroll:true,autoScroll:true,frame:false,border:false,closable:true,layout:"border",items:[i]})};Ext.extend(iNet.iwebos.ui.account.CreateAccount,Ext.Panel,{_createMailAccount:function(){this._onOpenMailAccountDialog(null,true)},_canCreateEmail:function(){if(Ext.getCmp(this.lastNameId).getValue()==""){return iwebos.message.mail.empty_fname}if(Ext.getCmp(this.firstNameId).getValue()==""){return iwebos.message.mail.empty_lname}return""},_okHandler:function(d){var a=this.grid.store;var e=a.getById(d.email);if(e!=null&&e!=undefined){e.data.smtp=d.smtp;e.data.active=d.active;e.data.forward=d.forward;e.data.virus=d.virus;e.data.spam=d.spam;e.data.capacity=d.capacity;e.data.depNumber=d.depNumber;e.commit()}else{var c=d.email;var b=c.indexOf("@");d.uid=c.substr(0,b);d.symbol="@";d.domain=c.substr(b+1,c.length);d.id=c;a.addData(d)}},_onUpdateMailAccount:function(){var a=this.grid.getSelectionModel().getSelections()[0];if(!a){return}this._onOpenMailAccountDialog(a.data,true)},_onRemoveMailAccount:function(){var a=this.grid.getSelectionModel().getSelections()[0];if(!a){return}this.grid.store.remove(a);this.__fnHandleFunction()},_getEditDomains:function(){var b=Ext.getCmp("account-main-tabs-toolbar");var f=b.getDomains();var e=[];var d;var c=0;for(var a=0;a<f.length;a++){d=f[a];if(d.edit){e[c]=d;c++}}return e},_onOpenMailAccountDialog:function(d,e){var a=this._canCreateEmail();if(a!=""){Ext.MessageBox.show({title:iwebos.message.account.infomationMessage,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var g=new iNet.iwebos.ui.account.DialogCreateAccount();var f={save:{fn:this._okHandler,scope:this}};var c=Ext.getCmp("account-main-tabs-toolbar");if(d==null||d==undefined){var b=Ext.getCmp(this.midleNameId).getValue();b=(b!="")?(b+" "):"";d={};d.lname=Ext.getCmp(this.lastNameId).getValue();d.fname=b+Ext.getCmp(this.firstNameId).getValue()}g.show();g._setData(d,f,c.getDomains(),c.getSelectedDomain(),e)},_isEdit:function(c){var a=this.__owner.editDomains;if(a==undefined||a==null){a=this._getEditDomains();if(a==null||a.length==0){return false}this.__owner.editDomains=a}for(var b=0;b<a.length;b++){if(c.domain==a[b].domainName){return true}}return false},_rowContextMenu:function(b,a,d){d.stopEvent();b.getSelectionModel().selectRow(a);var c=b.getSelectionModel().getSelections()[0];if(!!c){this.mailMenu=new Ext.menu.Menu({items:[{id:"account-menu-add-email-account",text:iwebos.message.mail.create.add,iconCls:"icon-mail-add",scope:this,handler:this._createMailAccount.createDelegate(this)},{id:"account-menu-update-email-account",text:iwebos.message.mail.update_email_account,iconCls:"icon-mail-update",scope:this,handler:this._onUpdateMailAccount.createDelegate(this)},{id:"account-menu-delete-email-account",text:iwebos.message.mail.delete_email_account,iconCls:"icon-mail-del",scope:this,handler:this._onRemoveMailAccount.createDelegate(this)}]});var e=this._isEdit(c.data);Ext.getCmp("account-menu-update-email-account").setDisabled(!e);Ext.getCmp("account-menu-delete-email-account").setDisabled(!e);this.mailMenu.showAt(d.getXY())}},_contextMenu:function(a){a.stopEvent();this.mailMenu=new Ext.menu.Menu({items:[{id:"account-menu-create-email-account",text:iwebos.message.mail.create.add,iconCls:"icon-mail-add",scope:this,handler:this._createMailAccount.createDelegate(this)}]});this.mailMenu.showAt(a.getXY())},_onDoubleClick:function(d,c,f){f.stopEvent();var b=d.store.getAt(c);var a=b.data;this._onOpenMailAccountDialog(a,this._isEdit(a))},_searchAccount:function(){var a=new iNet.iwebos.ui.account.DialogSearchAccount();var b={fn:this._handleSelectUser,scope:this};a.__setAction(b);a.show(this)},_handleSelectUser:function(a){var b=Ext.getCmp("account-main-tabs");this.loadData(a.id)},doAction:function(a,b){if(this.actions!==undefined){this.actions[b.id]()}},validateUser:function(){var c=this.__owner.code;var a=Ext.getCmp(this.usernameId);if(a.getValue()==""){return iwebos.message.mail.error_input_username}a=Ext.getCmp(this.passwordId);var b=a.getValue();if(b==""&&(c==""||c==null||c.length==0)){return iwebos.message.mail.error_input_pass}a=Ext.getCmp(this.confirmPasswordId);if(a.getValue()!=b){return iwebos.message.mail.error_input_confirm_pass}if(Ext.getCmp(this.lastNameId).getValue()==""){return iwebos.message.mail.empty_fname}if(Ext.getCmp(this.firstNameId).getValue()==""){return iwebos.message.mail.empty_lname}a=Ext.getCmp(this.countryId);if(a.getValue()==""){return iwebos.message.mail.error_input_country}a=Ext.getCmp(this.timezoneId);if(a.getValue()==""){return iwebos.message.mail.error_input_gmt}if(this.grid.store.getCount()<=0){return iwebos.message.mail.empty_mail_account}return""},_cleanData:function(){this.__fnHandleFunction();var a=false;var b=Ext.getCmp(this.usernameId);b.setValue("");b.setDisabled(a);var c=Ext.getCmp(this.passwordId);c.setDisabled(a);c.setValue("");c=Ext.getCmp(this.confirmPasswordId);c.setDisabled(a);c.setValue("");c=Ext.getCmp(this.emailId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.birthdayId);c.setValue(null);c.setDisabled(a);c=Ext.getCmp(this.sexId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.cityId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.countryId);c.setValue("vn");c.setDisabled(a);c=Ext.getCmp(this.lastNameId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.midleNameId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.firstNameId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.languageId);c.setValue("vi");c.setDisabled(a);c=Ext.getCmp(this.provinceId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.postCodeId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.timezoneId);c.setValue("+0700");c.setDisabled(a);this.grid.store.removeAll();this.__owner.code=null;this.action="save"},setData:function(g){this.__fnHandleFunction();var i=Ext.getCmp(this.usernameId);i.setValue(g.uname);i.setDisabled(true);var e=true;this.__owner.code=g.userCode;var a=this.__owner.code;if(a==""||a==null||a.length==0){e=true}else{e=false}var h=Ext.getCmp(this.passwordId);h.setValue("");h.setDisabled(true);h=Ext.getCmp(this.confirmPasswordId);h.setValue("");h.setDisabled(true);var h=Ext.getCmp(this.emailId);h.setValue(g.email);h.setDisabled(e);h=Ext.getCmp(this.birthdayId);h.setValue((g.birthday==0)?null:new Date(g.birthday));h.setDisabled(e);h=Ext.getCmp(this.sexId);h.setValue(g.gentle);h.setDisabled(e);h=Ext.getCmp(this.cityId);h.setValue(g.city);h.setDisabled(e);h=Ext.getCmp(this.countryId);h.setValue(g.country);h.setDisabled(e);h=Ext.getCmp(this.lastNameId);h.setValue(g.lname);h.setDisabled(e);h=Ext.getCmp(this.midleNameId);h.setValue(g.mname);h.setDisabled(e);h=Ext.getCmp(this.firstNameId);h.setValue(g.fname);h.setDisabled(e);h=Ext.getCmp(this.languageId);h.setValue(g.language);h.setDisabled(e);h=Ext.getCmp(this.provinceId);h.setValue(g.state);h.setDisabled(e);h=Ext.getCmp(this.postCodeId);h.setValue(g.pcode);h.setDisabled(e);h=Ext.getCmp(this.timezoneId);h.setValue(g.tzone);h.setDisabled(e);var f=this.grid.store;f.removeAll();var c=g.list;if(c!=null&&c!=undefined){for(var b=0;b<c.length;b++){var d=c[b];d.id=d.email;f.addData(d)}}},getData:function(){var e={};e.userCode=this.__owner.code;var d=Ext.getCmp(this.usernameId);var a=d.getValue().toLowerCase();d.setValue(a);e.uname=a;d=Ext.getCmp(this.passwordId);e.pwd=d.getValue();d=Ext.getCmp(this.emailId);e.email=d.getValue();d=Ext.getCmp(this.countryId);e.country=d.getValue();d=Ext.getCmp(this.timezoneId);e.tzone=d.getValue();d=Ext.getCmp(this.birthdayId);e.birthday=((d.getValue()=="")?"":d.getValue().format("d/m/Y"));d=Ext.getCmp(this.cityId);e.city=d.getValue();d=Ext.getCmp(this.firstNameId);e.fname=d.getValue();d=Ext.getCmp(this.midleNameId);e.mname=d.getValue();d=Ext.getCmp(this.lastNameId);e.lname=d.getValue();d=Ext.getCmp(this.sexId);e.gentle=d.getValue();d=Ext.getCmp(this.provinceId);e.state=d.getValue();d=Ext.getCmp(this.languageId);e.language=d.getValue();d=Ext.getCmp(this.postCodeId);e.pcode=d.getValue();var b=this.grid.store;var g=[];var f=b.getCount();if(f>0){for(var c=0;c<f;c++){g[c]=b.getAt(c).data}e.list=g}return e},__resizePanel:function(){Ext.EventManager.fireWindowResize()},__fnHandleFunction:function(){var b=Ext.getCmp("previewPanel");var a=Ext.getCmp(this.emailsId);b.setVisible(false);a.setHeight(215)},loadData:function(a){if(a!=""){var b={iwct:"loadAccountContent",iwa:"READ_WRITE",action:"loadFull",userCode:a};this.__owner.code=a;iNet.Ajax.request({url:"jsonajax",params:b,scope:this,method:"POST",success:function(d,e){var c=Ext.util.JSON.decode(d.responseText);var f=(c.success==undefined)?true:c.success;if(f){this.setData(c)}else{Ext.MessageBox.show({title:iwebos.message.account.infomationMessage,msg:iwebos.message.mail.error_find_account_information,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},failure:function(c,d){},maskEl:this.bwrap})}else{this._cleanData()}},onSave:function(){var f=this.__owner.code;var d="update";var c=this.validateUser();if(c!=""){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:c,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var a=this.getData();var e={iwct:"accountContent",iwa:"READ_WRITE"};if(f==""||f==null||f.length==0){d="save"}else{d="update"}e.action=d;var b=function(l,v){var m=Ext.util.JSON.decode(l.responseText);var t=(m.success==undefined?true:m.success);if(t){if(d=="save"){if(m!=null){this.__owner.code=m.userCode;var q=Ext.getCmp(this.usernameId);q.setDisabled(true);q=Ext.getCmp(this.passwordId);q.setDisabled(true);q=Ext.getCmp(this.confirmPasswordId);q.setDisabled(true)}}var g=this.__owner.code;if(g!=null&&g!=undefined&&g!=""){var k=Ext.getCmp("account-main-tabs");var r=k.grid.store;var u=r.getById(g);var j=u!=null&&u!=undefined;var o=Ext.getCmp("account-main-tabs-toolbar").getSelectedDomain();var n=this.grid.store;var i=n.getCount();for(var h=0;h<i;h++){var s=n.getAt(h);if(s.data.code==null||s.data.code==undefined){s.data.code=g;s.commit();if(!j&&o==s.data.domain){var p={};p.id=g;p.code=g;p.fname=s.data.lname+" "+s.data.fname;p.email=s.data.email;p.edit=true;r.addData(p);j=true}}}}Ext.MessageBox.show({title:iwebos.message.account.savingTitle,msg:iwebos.message.mail.save_data_sucessful,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_create_account,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};e.object=Ext.util.JSON.encode(a);e.action=d;iNet.Ajax.request({url:"jsonajax",params:e,scope:this,method:"POST",success:b,failure:function(g,h){},maskEl:this.bwrap})},onAdd:function(){this.__owner.code="";this._cleanData()}}); 
iNet.iwebos.ui.account.DialogAddAccount=function(g,d){this.viewer=g;Ext.apply(this,d);var b={field:"lname",direction:"ASC"};var f={field:"lname",direction:"ASC"};var c=Ext.data.Record.create([{name:"id",mapping:"id",type:"string"},{name:"lname",mapping:"lname",type:"string"},{name:"mail",mapping:"mail",type:"string"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},c);var e=new Ext.grid.ColumnModel([{header:"Tên",dataIndex:"lname",fixed:true,width:250},{header:"Mail",dataIndex:"mail",fixed:true,width:200}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"accountSearch",region:"center",anchor:"100%",autoScroll:true,height:220,url:"account.txt",method:"POST",sortInfo:b,reader:a,dsort:f,cm:e,filter:{data:"all"}});this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[this.grid]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.account.DialogAddAccount.superclass.constructor.call(this,{id:"mail-dlgsearch-account",title:iwebos.message.mail.select_account,iconCls:"icon-email-search",region:"center",anchor:"100%",width:500,height:450,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.select_account,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.account.DialogAddAccount,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.dialog_select_account_title,btitle:iwebos.message.mail.dialog_select_account_btitle,__setAction:function(a){this.__action=a},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.account.DialogCreateAccount=function(c,a){this.viewer=c;Ext.apply(this,a);this.prefix=(!this.prefix)?"iwebos-dialog-mail-create":this.prefix;this.accountId=this.prefix+"-account-id";this.domainId=this.prefix+"-domain-id";this.smtpId=this.prefix+"-smpt-id";this.capacityId=this.prefix+"-capacity-id";this.virusId=this.prefix+"-virus-id";this.spamId=this.prefix+"-spam-id";this.forwardId=this.prefix+"-forward-id";this.fwAddressId=this.prefix+"-fw-address-id";this.activeId=this.prefix+"-active-id";this.department=this.prefix+"-department-id";this._owner={};this._domainStore=new Ext.data.JsonStore({fields:[{name:"domainId",mapping:"id",type:"string"},{name:"domainName",mapping:"text",type:"string"}]});var b=new Ext.form.FormPanel({region:"center",anchor:"100%",border:false,frame:true,layout:"column",items:[{columnWidth:1,layout:"column",anchor:"100%",border:false,items:[{columnWidth:0.5,labelWidth:90,layout:"form",border:false,items:[{id:this.accountId,border:false,xtype:"textfield",anchor:"98%",fieldLabel:iwebos.message.mail.account}]},{columnWidth:0.5,labelWidth:90,layout:"form",border:false,items:[{id:this.domainId,border:false,anchor:"98%",xtype:"combo",fieldLabel:"@",store:this._domainStore,displayField:"domainName",valueField:"domainId",anchor:"98%",mode:"local",triggerAction:"all",forceSelection:true,selectOnFocus:true}]}]},{columnWidth:1,layout:"column",anchor:"100%",border:false,items:[{columnWidth:1,anchor:"100%",xtype:"fieldset",title:iwebos.message.mail.options,height:140,bodyStyle:"padding-left:10px;",items:[{columnWidth:1,layout:"column",anchor:"100%",border:false,items:[{columnWidth:0.5,labelWidth:90,layout:"form",border:false,items:[{id:this.smtpId,xtype:"checkbox",hideLabel:true,anchor:"95%",checked:true,tabIndex:7,boxLabel:iwebos.message.mail.create.role_smtp},{id:this.spamId,xtype:"checkbox",hideLabel:true,anchor:"95%",checked:true,tabIndex:8,boxLabel:iwebos.message.mail.create.role_spam},{id:this.capacityId,xtype:"numberfield",allowDecimals:false,maxLength:5,anchor:"95%",allowBlank:false,value:50,tabIndex:12,fieldLabel:iwebos.message.mail.create.sizelimit}]},{columnWidth:0.5,labelWidth:90,layout:"form",border:false,items:[{layout:"column",border:false,columnWidth:1,anchor:"100%",items:[{layout:"form",border:false,columnWidth:0.6,anchor:"80%",items:[{id:this.forwardId,xtype:"checkbox",hideLabel:true,tabIndex:9,boxLabel:iwebos.message.mail.create.role_transfer,handler:this.hanlerForwardCheck.createDelegate(this)}]},{layout:"form",border:false,columnWidth:0.4,anchor:"98%",items:[{id:this.fwAddressId,xtype:"textfield",anchor:"88%",disabled:true,hideLabel:true}]}]},{id:this.virusId,xtype:"checkbox",hideLabel:true,anchor:"100%",checked:true,tabIndex:10,boxLabel:iwebos.message.mail.create.role_virus},{id:this.activeId,xtype:"checkbox",hideLabel:true,anchor:"100%",checked:true,tabIndex:11,boxLabel:iwebos.message.mail.create.role_active}]}]}]}]}]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.account.DialogCreateAccount.superclass.constructor.call(this,{id:"mail-dlg-create-account",title:iwebos.message.org.user_create_email_account_title,iconCls:"icon-email-createacc",region:"center",anchor:"100%",width:600,height:400,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[b],buttons:[{text:iwebos.message.mail.select_account,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.account.DialogCreateAccount,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.org.user_create_email_account_title,btitle:iwebos.message.org.user_create_email_account_sub_title,fnCancelHandler:function(){this.destroy()},fnOkHandler:function(){var a=this._onValidation();if(a!=""){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}this._onSave();this.destroy()},_onSave:function(){var a=this._getData();var b=this._owner.action.save;if(!b){return}if(!b.scope){b.fn(a)}else{b.fn.apply(b.scope,[a])}},hanlerForwardCheck:function(){var a=Ext.getCmp(this.forwardId).getValue();Ext.getCmp(this.fwAddressId).setDisabled(!a)},_setData:function(e,g,i,f,b,c){this._owner.account=e;this._owner.action=g;this._owner.groups=b;this._owner.selectedDomain=f;this.editable=c;if(e.uname!=null&&e.uname!=undefined&&e.email!=null){this._fillData(e)}else{if(i!=null){var h;var a="";for(var d=0;d<i.length;d++){h=i[d];if(h.edit){if(h.orgId==f){a=h.orgId}a=a==""?h.orgId:a;this._domainStore.add(new Ext.data.Record({domainId:h.orgId,domainName:h.organization}))}}if(a!=""){Ext.getCmp(this.domainId).setValue(a)}if(e.email!=null&&e.email!=undefined){this._fillNewInfo(e)}}}},_onValidation:function(){var d=Ext.getCmp(this.accountId);var c=d.getValue();if(c===""){return iwebos.message.mail.create.error_input_email}d=Ext.getCmp(this.domainId);if(d.getValue()===""){return iwebos.message.mail.create.error_input_domain_for_email}d=Ext.getCmp(this.capacityId);var b=d.getValue();if(b===""){return iwebos.message.mail.error_input_limit}var a=Ext.getCmp(this.forwardId).getValue();if(a&&Ext.getCmp(this.fwAddressId).getValue().trim()==""){return iwebos.message.mail.warning_input_address_need_to_forward}return""},_fillNewInfo:function(b){var c=Ext.getCmp(this.accountId);c.setValue(b.uid);var d=b.domain;var a=Ext.getCmp(this.domainId);a.setValue(d);var c=Ext.getCmp(this.smtpId);c.setValue(b.smtp);var c=Ext.getCmp(this.capacityId);c.setValue(b.capacity);var c=Ext.getCmp(this.activeId);c.setValue(b.active);var c=Ext.getCmp(this.forwardId);c.setValue(b.forward);if(b.forward){var c=Ext.getCmp(this.fwAddressId);c.setValue(b.fAddress)}var c=Ext.getCmp(this.virusId);c.setValue(b.virus);var c=Ext.getCmp(this.spamId);c.setValue(b.spam)},_fillData:function(b){this.editable=this.editable==undefined?true:this.editable;var c=Ext.getCmp(this.accountId);c.setValue(b.uid);c.setDisabled(true);var d=b.domain;this._domainStore.add(new Ext.data.Record({domainId:d,domainName:d}));var a=Ext.getCmp(this.domainId);a.setValue(d);a.setDisabled(true);var c=Ext.getCmp(this.smtpId);c.setValue(b.smtp);c.setDisabled(!this.editable);var c=Ext.getCmp(this.capacityId);c.setValue(b.capacity);c.setDisabled(!this.editable);var c=Ext.getCmp(this.activeId);c.setValue(b.active);c.setDisabled(!this.editable);var c=Ext.getCmp(this.forwardId);c.setValue(b.forward);c.setDisabled(!this.editable);if(b.forward){var c=Ext.getCmp(this.fwAddressId);c.setValue(b.fAddress);c.setDisabled(!this.editable)}var c=Ext.getCmp(this.virusId);c.setValue(b.virus);c.setDisabled(!this.editable);var c=Ext.getCmp(this.spamId);c.setValue(b.spam);c.setDisabled(!this.editable)},_getData:function(){var b={};b.lname=this._owner.account.lname;b.fname=this._owner.account.fname;__comp=Ext.getCmp(this.smtpId);b.smtp=__comp.getValue();__comp=Ext.getCmp(this.capacityId);b.capacity=__comp.getValue();__comp=Ext.getCmp(this.activeId);b.active=__comp.getValue();__comp=Ext.getCmp(this.forwardId);var a=__comp.getValue();b.forward=a;if(a){__comp=Ext.getCmp(this.fwAddressId);b.fAddress=__comp.getValue()}__comp=Ext.getCmp(this.virusId);b.virus=__comp.getValue();__comp=Ext.getCmp(this.spamId);b.spam=__comp.getValue();__comp=Ext.getCmp(this.accountId);var c=__comp.getValue().toLowerCase();__comp.setValue(c);__comp=Ext.getCmp(this.domainId);var d=__comp.getValue();b.email=c+"@"+d;if(d==this._owner.selectedDomain){b.groups=this._owner.groups}return b}}); 
iNet.iwebos.ui.account.DialogResetPwd=function(b,a){this.viewer=b;Ext.apply(this,a);this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[{region:"center",columnWidth:0.9,border:false,layout:"form",anchor:"100%",labelWidth:60,items:[{id:"reset-label-uname",xtype:"label",height:20,border:false,anchor:"97%"},{id:"reset-new-pwd",fieldLabel:iwebos.message.mail.create.password,xtype:"textfield",inputType:"password",border:false,anchor:"97%"},{id:"reset-confirm-pwd",fieldLabel:iwebos.message.mail.create.confirmpassword,xtype:"textfield",inputType:"password",border:false,anchor:"97%"}]},{layout:"fit",border:false,anchor:"100%",items:[{}]}]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.account.DialogResetPwd.superclass.constructor.call(this,{id:"mailadmin-dialog-changepass",title:iwebos.message.account.resetPwdDialogTitle,iconCls:"icon-menu-account-change-pass",region:"center",anchor:"100%",width:375,height:320,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{id:"reset-pwd-save_id",text:iwebos.message.mail.create.save,iconCls:"ok-btn",handler:this._fnOkHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this._fnCancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.account.DialogResetPwd,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.account.resetPwdDialogTitle,btitle:iwebos.message.account.inputPwdDialogTitle,setData:function(f,e,a){this._owner={uname:a,org:f};Ext.getCmp("reset-label-uname").setText(iwebos.message.account.resetPwdText+" '"+e+"'");var c=Ext.getCmp("reset-new-pwd");var b=a.indexOf("@");var d=(b>0)?a.substr(0,b):a;c.setValue(d);c.focus(true);Ext.getCmp("reset-confirm-pwd").setValue(d)},_fnOkHandler:function(){var __fnSuccess=function(response,results){var result=eval("("+response.responseText+")");if(result.success){Ext.MessageBox.show({title:iwebos.message.account.infomationMessage,msg:iwebos.message.account.resetPwdSuccessful,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.account.resetPwdError,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var pwd=Ext.getCmp("reset-new-pwd").getValue();if(pwd==""){Ext.MessageBox.show({title:iwebos.message.account.infomationMessage,msg:iwebos.message.account.inputNewPwd,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});return}else{if(pwd!=Ext.getCmp("reset-confirm-pwd").getValue()){Ext.MessageBox.show({title:iwebos.message.account.infomationMessage,msg:iwebos.message.mail.error_input_confirm_pass,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});return}}var object={};object.uname=this._owner.uname;object.org=this._owner.org;object.pwd=pwd;var __params={iwct:"userContent",iwa:"READ_WRITE",action:"resetpwd"};__params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",params:__params,method:"POST",success:__fnSuccess,failure:function(result,request){}});this.destroy()},_fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.account.DialogSearchAccount=function(g,d){this.viewer=g;Ext.apply(this,d);var b={field:"uname",direction:"DESC"};var f={field:"uname",direction:"DESC"};var h={iwct:"searchAccountContent",iwa:"view",id:0,action:"search"};var c=Ext.data.Record.create([{name:"id",mapping:"userCode",type:"string"},{name:"uname",mapping:"uname",type:"string"},{name:"lname",mapping:"lname",type:"string"},{name:"mname",mapping:"mname",type:"string"},{name:"fname",mapping:"fname",type:"string"},{name:"pwd",mapping:"pwd",type:"string"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},c);var e=new Ext.grid.ColumnModel([{header:iwebos.message.mail.account,dataIndex:"uname",fixed:true,width:150},{header:"Họ",dataIndex:"lname",fixed:true,width:120},{header:"Tên lót",dataIndex:"mname",fixed:true,width:150},{header:iwebos.message.mail.name,dataIndex:"fname",fixed:true,width:150}]);h.first=true;this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"accountSearch",region:"center",anchor:"100%",autoScroll:true,height:250,url:"jsonajax",method:"POST",sortInfo:b,baseParams:h,loadFirst:false,reader:a,dsort:f,cm:e,filter:{data:"all"}});this.search=new iNet.iwebos.ui.mail.ToolbarSearchAccount({region:"north",width:"100%",autoHeight:true,frame:false,border:false,store:this.grid.store});this.search.setLimitSearchCharacter(3);this.search.toolbarSeach.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[this.search,this.grid]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.account.DialogSearchAccount.superclass.constructor.call(this,{id:"mail-dlgsearch-account",title:iwebos.message.mail.search_account,iconCls:"icon-email-search",region:"center",anchor:"100%",width:600,height:500,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.select_account,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.account.DialogSearchAccount,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.search_account,btitle:iwebos.message.mail.search_account,__setAction:function(a){this.__action=a},fnOkHandler:function(){var c=Ext.getCmp("accountSearch");var b=c.getSelectionModel().getSelections();if(b!==undefined&&b.length!=0){var a=b[0].data;if(this.__action.scope){this.__action.fn.apply(this.__action.scope,[a])}this.destroy()}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_select_account,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.mail.AliasMailToolbar=Ext.extend(Ext.Panel,{initComponent:function(){this._first=true;this.toolbarSeach=new Ext.app.SearchField({width:200,onTrigger2Click:this.search.createDelegate(this)});this.prefix=(!this.prefix)?"mails-for-alias-search":this.prefix;this.domainSearchId=this.prefix+"-domainSearch";this.id=this.nextId("cmb",1);var a={iwct:"loadMailDomainContent",iwa:"view",action:"loadallsys"};this._domainStore=new Ext.data.JsonStore({url:"jsonajax",baseParams:a,fields:[{name:"domainId",mapping:"id",type:"string"},{name:"domainName",mapping:"disname",type:"string"},{name:"edit",mapping:"edit",type:"boolean"}]});var c=new Ext.form.ComboBox({id:this.domainSearchId,fieldLabel:iwebos.message.mail.org,store:this._domainStore,forceSelection:true,displayField:"domainName",valueField:"domainId",width:210,typeAhead:true,readOnly:true,mode:"local",triggerAction:"all",emptyText:"",selectOnFocus:false});var b=[this.toolbarSeach," ",c];if(this.store){this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.store,displayInfo:false});if(Ext.isGecko2){b[b.length]="-"}else{b[b.length]="->"}b[b.length]=this.pagingBar}this.tbar=b;iNet.iwebos.ui.mail.AliasMailToolbar.superclass.initComponent.call(this);this._domainStore.on("load",this._onLoadDomain,this,{stopEvent:true});this._domainStore.load();this._domainStore.sort("domainName")},search:function(){var c=[];var b=this.toolbarSeach.getRawValue();c.push({key:"key",value:b});var a=Ext.getCmp(this.domainSearchId).getValue();c.push({key:"domain",value:a});this.fireEvent("search",c)},_onLoadDomain:function(c,b,d){var a=Ext.getCmp(this.domainSearchId);var e=this._domainStore.getAt(0);if(e&&this.selDomain!=undefined){a.setValue(this.selDomain);this.search()}},nextId:function(e,a){var d=String(new Date().getTime()).substr(a);var c="abcdefghijklmnopqrstuvwxyzacc";for(var b=0;b<a;b++){d+=c.charAt(Math.floor(Math.random()*26))}return this.prefix+"-"+e+"-"+d+"-id"}}); 
Ext.apply(Ext.form.VTypes,{daterange:function(f,e){var b=e.parseDate(f);var d=function(g){var h=g.activeDate;g.activeDate=null;g.update(h)};if(e.startDateField){var c=Ext.getCmp(e.startDateField);c.maxValue=b;if(c.menu&&c.menu.picker){c.menu.picker.maxDate=b;d(c.menu.picker)}}else{if(e.endDateField){var a=Ext.getCmp(e.endDateField);a.minValue=b;if(a.menu&&a.menu.picker){a.menu.picker.minDate=b;d(a.menu.picker)}}}return true}}); 
iNet.iwebos.ui.mail.CreateAlias=function(h,d){this.prefix=(!this.prefix)?"iwebos-mail-create":this.prefix;this.usernameId=this.prefix+"-alias-uid";this.passwordId=this.prefix+"-alias-password";this.confirmPasswordId=this.prefix+"-alias-cfmpassword";this.aliasDomainName=this.prefix+"-alias-domain";this.lastNameId=this.prefix+"-alias-lastname";this.firstNameId=this.prefix+"-alias-fistname";this.checkSMTP=this.prefix+"-alias-check-smtp";this.checkActive=this.prefix+"-alias-check-active";this.checkVirus=this.prefix+"-alias-check-virus";this.checkSpam=this.prefix+"-alias-check-spam";this.cmdSave=this.prefix+"-alias-save-button";this.cmdNew=this.prefix+"-alias-new-alias-button";this.addMaildrop=this.prefix+"-add-maildrop-button";this.addOutsideEmail=this.prefix+"-add-outside-email-button";this.removeMaildrop=this.prefix+"-remove-maildrop-button";this.__owner={};var b={field:"email",direction:"ASC"};var g={field:"email",direction:"ASC"};var c=Ext.data.Record.create([{name:"id",mapping:"email",type:"int"},{name:"email",mapping:"email",type:"string"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},c);var e=new Ext.grid.ColumnModel([{header:iwebos.message.mail.create.username,dataIndex:"email",fixed:false,width:100}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"new-alias-grid-id",region:"center",anchor:"100%",minSize:150,autoScroll:true,url:"jsonajax",method:"POST",loadFirst:false,sortInfo:b,tbar:[{id:this.addMaildrop,xtype:"button",text:iwebos.message.mail.add_email_account,iconCls:"icon-mail-add",scope:this,handler:this._onOpenSearchDialog.createDelegate(this)},{id:this.addOutsideEmail,xtype:"button",text:iwebos.message.mail.add_outside_email_account,iconCls:"icon-mail-add",scope:this,handler:this._openInputEmailDialog.createDelegate(this)},{id:this.removeMaildrop,xtype:"button",text:iwebos.message.mail.delete_email_account,iconCls:"icon-mail-del",scope:this,handler:this._onRemoveEmail.createDelegate(this)}],reader:a,dsort:g,cm:e,filter:{data:"all"},view:new Ext.grid.GridView({forceFit:true})});var f=new Ext.form.FormPanel({id:"alias-new-info-id",region:"center",frame:false,border:false,autoHeight:true,anchor:"100%",labelAlign:"right",bodyStyle:"padding: 5px;",items:[{border:false,html:iwebos.message.mail.create.account_info},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",border:false,items:[{id:this.usernameId,xtype:"textfield",anchor:"95%",tabIndex:1,fieldLabel:iwebos.message.mail.create.username},{id:this.passwordId,xtype:"textfield",inputType:"password",tabIndex:2,fieldLabel:iwebos.message.mail.create.password,anchor:"95%"},{id:this.lastNameId,xtype:"textfield",anchor:"95%",tabIndex:4,fieldLabel:iwebos.message.mail.create.lastname}]},{columnWidth:0.5,layout:"form",anchor:"100%",labelWidth:70,border:false,items:[{id:this.aliasDomainName,xtype:"textfield",anchor:"98%",vtype:"domain",disabled:true,fieldLabel:iwebos.message.mail.create.domain},{id:this.confirmPasswordId,xtype:"textfield",inputType:"password",tabIndex:3,fieldLabel:iwebos.message.mail.create.confirmpassword,anchor:"98%"},{id:this.firstNameId,xtype:"textfield",anchor:"98%",tabIndex:5,fieldLabel:iwebos.message.mail.create.firstname}]}]},{border:false,html:iwebos.message.mail.create.role_mail},{layout:"column",columnWidth:1,anchor:"98%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",bodyStyle:"padding-left:90px;",border:false,items:[{id:this.checkSMTP,xtype:"checkbox",hideLabel:true,tabIndex:6,boxLabel:iwebos.message.mail.create.role_smtp},{id:this.checkActive,xtype:"checkbox",hideLabel:true,checked:true,tabIndex:8,boxLabel:iwebos.message.mail.create.role_active}]},{columnWidth:0.5,layout:"form",anchor:"100%",bodyStyle:"padding-left:70px;",border:false,items:[{id:this.checkVirus,xtype:"checkbox",hideLabel:true,tabIndex:7,boxLabel:iwebos.message.mail.create.role_virus},{id:this.checkSpam,xtype:"checkbox",hideLabel:true,tabIndex:9,boxLabel:iwebos.message.mail.create.role_spam}]}]},{border:false,html:iwebos.message.mail.create.group_member}],tbar:[{id:this.cmdSave,xtype:"button",iconCls:"icon-save",text:iwebos.message.mail.create.save,scope:this,handler:this._onSave.createDelegate(this)},"|",{id:this.cmdNew,xtype:"button",iconCls:"mail-action-alias",text:iwebos.message.mail.create_alias_account,scope:this,handler:this._cleanData.createDelegate(this)}]});this.toppanel=new Ext.Panel({region:"north",collapsible:false,anchor:"100%",border:false,width:"100%",height:300,items:[f]});this.grid.on("contextmenu",this._contextMenu,this,{stopEvent:true});this.grid.on("rowcontextmenu",this._rowContextMenu,this,{stopEvent:true});this.grid.on("keypress",this.__handleKeyEvent,this,{stopEvent:true});this.toppanel.on("resize",this.__resizePanel,this);this.grid.un("resize",this.__resizePanel,this);this.grid.on("resize",this.__resizePanel,this);iNet.iwebos.ui.mail.CreateAlias.superclass.constructor.call(this,{id:"new-alias-main-id",iconCls:"mail-action-alias",title:iwebos.message.mail.create.alias,header:false,frame:false,border:false,closable:true,autoScroll:true,layout:"border",renderTo:Ext.getBody(),items:[this.toppanel,this.grid]})};Ext.extend(iNet.iwebos.ui.mail.CreateAlias,Ext.Panel,{__resizePanel:function(){Ext.EventManager.fireWindowResize()},__handleKeyEvent:function(a){LotusService.handleKeyEventOnGrid(this.grid,a)},_getData:function(){var i=this.__owner;var h={};var d=Ext.getCmp(this.usernameId);var g=d.getValue().toLowerCase();d.setValue(g);h.email=g+"@"+i.domain;var d=Ext.getCmp(this.passwordId);h.pwd=d.getValue();var d=Ext.getCmp(this.firstNameId);h.fname=d.getValue();var d=Ext.getCmp(this.lastNameId);h.lastName=d.getValue();var d=Ext.getCmp(this.checkSMTP);h.smtp=d.getValue();var d=Ext.getCmp(this.checkVirus);h.virus=d.getValue();var d=Ext.getCmp(this.checkSpam);h.spam=d.getValue();var d=Ext.getCmp(this.checkActive);h.active=d.getValue();h.isMail=false;h.group=this.__owner.department||"";var e=this.grid.store;var b=e.getCount();var f=[];var c={};if(b>0){for(var a=0;a<b;a++){c=e.getAt(a).data;f[a]={email:c.email}}}h.list=f;return h},_cleanData:function(){var a=false;var b=Ext.getCmp(this.usernameId);b.setValue("");b.setDisabled(a);b=Ext.getCmp(this.passwordId);b.setValue("");b.setDisabled(a);b=Ext.getCmp(this.confirmPasswordId);b.setValue("");b.setDisabled(a);b=Ext.getCmp(this.lastNameId);b.setValue("");b.setDisabled(a);b=Ext.getCmp(this.firstNameId);b.setValue("");b.setDisabled(a);b=Ext.getCmp(this.checkSMTP);b.setValue(false);b.setDisabled(a);b=Ext.getCmp(this.checkActive);b.setValue(true);b.setDisabled(a);b=Ext.getCmp(this.checkVirus);b.setValue(false);b.setDisabled(a);b=Ext.getCmp(this.checkSpam);b.setValue(false);b.setDisabled(a);__store=this.grid.store;__store.removeAll();Ext.getCmp(this.cmdSave).setDisabled(a);Ext.getCmp(this.addMaildrop).setDisabled(a);Ext.getCmp(this.removeMaildrop).setDisabled(a);this.__owner.account=""},_setData:function(f){var h=Ext.getCmp(this.usernameId);var e=f.email;var d=e.indexOf("@");h.setValue(e.substr(0,d));h.setDisabled(true);var h=Ext.getCmp(this.lastNameId);h.setValue(f.lastName);h.setDisabled(!this.editable);var h=Ext.getCmp(this.firstNameId);h.setValue(f.fname);h.setDisabled(!this.editable);var h=Ext.getCmp(this.checkSMTP);h.setValue(f.smtp);h.setDisabled(!this.editable);var h=Ext.getCmp(this.checkActive);h.setValue(f.active);h.setDisabled(!this.editable);var h=Ext.getCmp(this.checkVirus);h.setValue(f.virus);h.setDisabled(!this.editable);var h=Ext.getCmp(this.checkSpam);h.setValue(f.spam);h.setDisabled(!this.editable);var b=f.list;var c=this.grid.store;c.removeAll();var a=[];var g=null;if(b.length>0){for(var d=0;d<b.length;d++){g=b[d];a[d]=new Ext.data.Record({id:g.email,email:g.email})}c.add(a);c.sort("email","ASC")}},_onOpenSearchDialog:function(){var a=this.grid.store;var b=function(){var d=this.getData();if(!d||d.length==0){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_select_email,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var c=[];for(var g=0;g<d.length;g++){var f=d[g];var e=a.getById(f.email);if(!e){c[g]=new Ext.data.Record({id:f.email,email:f.email})}}if(c.length>0){a.add(c)}this.destroy()};this.dlg=new iNet.iwebos.ui.mail.DialogSearchAlias(this,{domain:this.__owner.domain,scope:this.dlg,okHandler:b});this.dlg.show(this)},_openInputEmailDialog:function(){var a=this.grid.store;var b=function(){var e=Ext.getCmp("input-email-dialog-email-id").getValue();if(e.trim()!=""){var d=a.getById(e);if(!d){a.addData({id:e,email:e})}this.destroy()}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.alias_input_email_to_add_to_alias,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var c=new iNet.iwebos.ui.mail.InputEmailDialog(this,{scope:c,okHandler:b});c.show(this)},_onValidation:function(){var c=Ext.getCmp(this.usernameId);var e=c.getValue();if(e===""){return iwebos.message.mail.error_input_alias_account}c=Ext.getCmp(this.passwordId);var g=c.getValue();c=Ext.getCmp(this.confirmPasswordId);var b=c.getValue();var f=(this.__owner.account==""?"save":"update");if(f=="update"){if(g!=b){return iwebos.message.mail.error_input_confirm_pass}}else{if(g===""||g!=b){return iwebos.message.mail.error_input_alias_pass}}c=Ext.getCmp(this.lastNameId);var i=c.getValue();if(i===""){return iwebos.message.mail.error_input_alias_lastname}c=Ext.getCmp(this.firstNameId);var h=c.getValue();if(h===""){return iwebos.message.mail.error_input_alias_firstname}var d=this.grid.store;var a=d.getCount();if(a==0){return iwebos.message.mail.error_input_mail_drop}return""},_onSave:function(){var c=this._onValidation();if(c!=""){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:c,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var a=this._getData();var g=this.__owner||{};var e=g.action||{};var d=g.account||"";var b=e.save||{};var f=d==""?"save":"update";if(!b.fn){return}if(!b.scope){b.fn(this,a,f)}else{b.fn.apply(b.scope,[this,a,f])}},handleAfterSave:function(){var a=Ext.getCmp(this.usernameId);a.setDisabled(true);var a=Ext.getCmp(this.lastNameId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.firstNameId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.checkSMTP);a.setDisabled(!this.editable);var a=Ext.getCmp(this.checkActive);a.setDisabled(!this.editable);var a=Ext.getCmp(this.checkVirus);a.setDisabled(!this.editable);var a=Ext.getCmp(this.checkSpam);a.setDisabled(!this.editable)},loadInfo:function(domain,department,account,action,editable){this.__owner.action=action;this.__owner.domain=domain;this.__owner.department=department;this.editable=editable;var __cmdSave=Ext.getCmp(this.cmdSave);__cmdSave.setDisabled(!this.editable);Ext.getCmp(this.addMaildrop).setDisabled(!this.editable);Ext.getCmp(this.removeMaildrop).setDisabled(!this.editable);var __account=account||"";this.__owner.account=__account;var __txtDomain=Ext.getCmp(this.aliasDomainName);__txtDomain.setValue("@"+domain);var __loadSuccess=function(response,options){var __data=eval("("+response.responseText+")");var __success=(__data.success==undefined?true:!!__data.success);if(__success){this._setData(__data)}};if(__account!=""){var __params={iwct:"loadMailAliasContent",iwa:"READ_WRITE",action:"load"};__params.email=__account;iNet.Ajax.request({url:"jsonajax",params:__params,method:"POST",success:__loadSuccess,scope:this,failure:function(result,request){},maskEl:this.bwrap})}else{this._cleanData()}},_contextMenu:function(a){a.stopEvent();var b=this.editable||false;if(b){this.mailMenu=new Ext.menu.Menu({items:[{id:"mail-menu-create-email",text:iwebos.message.mail.add_email_account,iconCls:"icon-mail-add",scope:this,handler:this._onOpenSearchDialog.createDelegate(this)},{id:"mail-menu-add-outside-email",text:iwebos.message.mail.add_outside_email_account,iconCls:"icon-mail-add",scope:this,handler:this._openInputEmailDialog.createDelegate(this)}]});this.mailMenu.showAt(a.getXY())}},_rowContextMenu:function(b,a,d){d.stopEvent();b.getSelectionModel().selectRow(a);var e=this.editable||false;var c=b.getSelectionModel().getSelections()[0];if(!!c&&e){this.mailMenu=new Ext.menu.Menu({items:[{id:"mail-menu-add-email",text:iwebos.message.mail.add_email_account,iconCls:"icon-mail-add",scope:this,handler:this._onOpenSearchDialog.createDelegate(this)},{id:"mail-menu-add-outside-email",text:iwebos.message.mail.add_outside_email_account,iconCls:"icon-mail-add",scope:this,handler:this._openInputEmailDialog.createDelegate(this)},{id:"mail-menu-delete-email",text:iwebos.message.mail.delete_email_account,iconCls:"icon-mail-del",scope:this,handler:this._onRemoveEmail.createDelegate(this)}]});this.mailMenu.showAt(d.getXY())}},_onRemoveEmail:function(){var c=Ext.getCmp("new-alias-grid-id");var a=c.getSelectionModel().getSelections();if(!!a&&a.length>0){for(var b=0;b<a.length;b++){c.store.remove(a[b])}}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.alias_select_email_to_delete,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}}); 
iNet.iwebos.ui.mail.CreateEmail=function(c,a){this.prefix=(!this.prefix)?"iwebos-mail-create-email":this.prefix;this.accountId=this.prefix+"-account-id";this.domainId=this.prefix+"-domain-id";this.fullNameId=this.prefix+"-fullname-id";this.lastNameId=this.prefix+"-lastname-id";this.ownerAccountId=this.prefix+"-owner-account-id";this.smtpId=this.prefix+"-smpt-id";this.capacityId=this.prefix+"-capacity-id";this.virusId=this.prefix+"-virus-id";this.spamId=this.prefix+"-spam-id";this.forwardId=this.prefix+"-forward-id";this.fwAddressId=this.prefix+"-fw-address-id";this.activeId=this.prefix+"-active-id";this.userButtonId=this.prefix+"-select-user-button-id";this.groupId=this.prefix+"-group-id";this.cmdSave=this.prefix+"-mail-save-button";this.cmdNew=this.prefix+"-mail-new-mail-button";this.editable=true;this.__owner={};var b=new Ext.form.FormPanel({region:"center",frame:false,border:false,autoHeight:true,anchor:"100%",labelAlign:"right",bodyStyle:"padding: 5px;",items:[{border:false,html:iwebos.message.mail.create.email_info},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{layout:"form",columnWidth:0.5,anchor:"100%",border:false,items:[{id:this.accountId,xtype:"textfield",anchor:"95%",tabIndex:1,fieldLabel:iwebos.message.mail.create.account},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{layout:"form",columnWidth:0.9,anchor:"95%",border:false,items:[{id:this.ownerAccountId,xtype:"textfield",readOnly:true,fieldLabel:iwebos.message.mail.create.owner_account,anchor:"95%"}]},{layout:"form",columnWidth:0.1,border:false,items:[{id:this.userButtonId,xtype:"button",border:false,iconCls:"icon-mail-add",tabIndex:4,handler:this._fnSelectUser.createDelegate(this)}]}]}]},{layout:"form",columnWidth:0.5,anchor:"100%",border:false,items:[{id:this.domainId,xtype:"textfield",anchor:"95%",fieldLabel:iwebos.message.mail.create.domain,disabled:true},{id:this.groupId,xtype:"textfield",readOnly:true,anchor:"95%",fieldLabel:iwebos.message.mail.create.department}]}]},{border:false,html:iwebos.message.mail.create.role_mail},{layout:"column",columnWidth:1,border:false,anchor:"100%",labelWidth:55,labelAlign:"left",items:[{layout:"form",columnWidth:0.5,anchor:"100%",bodyStyle:"padding-left:30px;",border:false,items:[{id:this.lastNameId,xtype:"textfield",anchor:"95%",tabIndex:5,fieldLabel:iwebos.message.mail.create.lastname},{id:this.smtpId,xtype:"checkbox",hideLabel:true,anchor:"95%",checked:true,tabIndex:7,boxLabel:iwebos.message.mail.create.role_smtp},{id:this.spamId,xtype:"checkbox",hideLabel:true,anchor:"95%",checked:true,tabIndex:8,boxLabel:iwebos.message.mail.create.role_spam},{id:this.capacityId,xtype:"numberfield",allowDecimals:false,maxLength:5,anchor:"95%",allowBlank:false,value:50,tabIndex:12,fieldLabel:iwebos.message.mail.create.sizelimit}]},{layout:"form",columnWidth:0.5,anchor:"100%",bodyStyle:"padding-left:30px;",border:false,items:[{id:this.fullNameId,xtype:"textfield",anchor:"95%",tabIndex:6,fieldLabel:iwebos.message.mail.create.firstname},{layout:"column",border:false,columnWidth:1,anchor:"100%",items:[{layout:"form",border:false,columnWidth:0.6,anchor:"80%",items:[{id:this.forwardId,xtype:"checkbox",hideLabel:true,tabIndex:9,boxLabel:iwebos.message.mail.create.role_transfer,handler:this.hanlerForwardCheck.createDelegate(this)}]},{layout:"form",border:false,columnWidth:0.4,anchor:"98%",items:[{id:this.fwAddressId,xtype:"textfield",anchor:"88%",disabled:true,hideLabel:true}]}]},{id:this.virusId,xtype:"checkbox",hideLabel:true,anchor:"100%",checked:true,tabIndex:10,boxLabel:iwebos.message.mail.create.role_virus},{id:this.activeId,xtype:"checkbox",hideLabel:true,anchor:"100%",checked:true,tabIndex:11,boxLabel:iwebos.message.mail.create.role_active}]}]},{border:false,html:iwebos.message.mail.create.account_desc}],tbar:[{id:this.cmdSave,xtype:"button",iconCls:"icon-save",text:iwebos.message.mail.create.save,scope:this,handler:this._onSave},"|",{id:this.cmdNew,xtype:"button",iconCls:"icon-email-createacc",text:iwebos.message.mail.create_email_account,scope:this,handler:this.cleanData}]});iNet.iwebos.ui.mail.CreateEmail.superclass.constructor.call(this,{id:"new-email-panel",iconCls:"icon-email-createacc",title:iwebos.message.mail.create.title,header:false,frame:false,border:false,closable:true,layout:"border",renderTo:Ext.getBody(),items:[b]})};Ext.extend(iNet.iwebos.ui.mail.CreateEmail,Ext.Panel,{hanlerForwardCheck:function(){var a=Ext.getCmp(this.forwardId).getValue();Ext.getCmp(this.fwAddressId).setDisabled(!a)},_onValidation:function(){var f=Ext.getCmp(this.accountId);var e=f.getValue().trim();if(e===""){return iwebos.message.mail.create.error_input_email}if(e.indexOf("@")>=0){return iwebos.message.mail.create.input_invalid_mail_uid}var g=(this.__owner.account==""?"save":"update");f=Ext.getCmp(this.ownerAccountId);var b=f.getValue();if(b===""&&g==="save"){return iwebos.message.mail.create.error_input_owner}f=Ext.getCmp(this.fullNameId);var h=f.getValue();if(h===""){return iwebos.message.mail.error_input_alias_firstname}f=Ext.getCmp(this.lastNameId);var a=f.getValue();if(a===""){return iwebos.message.mail.error_input_alias_lastname}f=Ext.getCmp(this.capacityId);var d=f.getValue();if(d===""){return iwebos.message.mail.error_input_limit}var c=Ext.getCmp(this.forwardId).getValue();if(c&&Ext.getCmp(this.fwAddressId).getValue()==""){return iwebos.message.mail.warning_input_address_need_to_forward}return""},_getData:function(){var b={};b.pwd=this.__owner.pwd;var c=Ext.getCmp(this.fullNameId);b.fname=c.getValue();c=Ext.getCmp(this.lastNameId);b.lname=c.getValue();c=Ext.getCmp(this.smtpId);b.smtp=c.getValue();c=Ext.getCmp(this.capacityId);b.capacity=c.getValue();c=Ext.getCmp(this.activeId);b.active=c.getValue();c=Ext.getCmp(this.forwardId);var e=c.getValue();b.forward=e;if(e){c=Ext.getCmp(this.fwAddressId);b.fAddress=c.getValue()}c=Ext.getCmp(this.virusId);b.virus=c.getValue();c=Ext.getCmp(this.spamId);b.spam=c.getValue();b.code=this.__owner.userCode;b.uname=this.__owner.uname;c=Ext.getCmp(this.accountId);var g=c.getValue().toLowerCase();c.setValue(g);c=Ext.getCmp(this.domainId);var i=c.getValue();b.email=g+i;b.isMail=true;var f=Ext.getCmp(this.groupId).getValue().trim();if(f!=""){var h=f.split(",");var d=[];for(var a=0;a<h.length;a++){d[a]={group:h[a]}}b.groups=d}return b},cleanData:function(){var a=false;var b=Ext.getCmp(this.accountId);b.setValue("");b.setDisabled(a);Ext.getCmp(this.ownerAccountId).setValue("");b=Ext.getCmp(this.userButtonId);b.setDisabled(a);b=Ext.getCmp(this.fullNameId);b.setValue("");b.setDisabled(a);b=Ext.getCmp(this.lastNameId);b.setValue("");b.setDisabled(a);b=Ext.getCmp(this.smtpId);b.setValue(true);b.setDisabled(a);b=Ext.getCmp(this.capacityId);b.setValue("50");b.setDisabled(a);b=Ext.getCmp(this.activeId);b.setValue(true);b.setDisabled(a);b=Ext.getCmp(this.forwardId);b.setValue(false);b.setDisabled(a);b=Ext.getCmp(this.virusId);b.setValue(true);b.setDisabled(a);b=Ext.getCmp(this.spamId);b.setValue(true);b.setDisabled(a);this.__owner.account=""},_setData:function(d){this.__owner.department=d.group;var f=Ext.getCmp(this.accountId);var c=d.email;var b=c.indexOf("@");f.setValue(c.substr(0,b));f.setDisabled(true);var a=d.groups;if(a!=null&&a.length>0){var e=a[0].group;for(var b=1;b<a.length;b++){e=e+", "+a[b].group}Ext.getCmp(this.groupId).setValue(e)}Ext.getCmp(this.ownerAccountId).setValue(d.uname);var f=Ext.getCmp(this.userButtonId);f.setDisabled(!(this.editable&&d.chgOwner));var f=Ext.getCmp(this.fullNameId);f.setValue(d.fname);f.setDisabled(!this.editable);var f=Ext.getCmp(this.lastNameId);f.setValue(d.lname);f.setDisabled(!this.editable);var f=Ext.getCmp(this.smtpId);f.setValue(d.smtp);f.setDisabled(!this.editable);var f=Ext.getCmp(this.capacityId);f.setValue(d.capacity);f.setDisabled(!this.editable);var f=Ext.getCmp(this.activeId);f.setValue(d.active);f.setDisabled(!this.editable);var f=Ext.getCmp(this.forwardId);f.setValue(d.forward);f.setDisabled(!this.editable);if(d.forward){var f=Ext.getCmp(this.fwAddressId);f.setValue(d.fAddress);f.setDisabled(!this.editable)}var f=Ext.getCmp(this.virusId);f.setValue(d.virus);f.setDisabled(!this.editable);var f=Ext.getCmp(this.spamId);f.setValue(d.spam);f.setDisabled(!this.editable)},_onSave:function(){var c=this._onValidation();if(c!=""){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:c,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var a=this._getData();var g=this.__owner||{};var e=g.action||{};var d=g.account||"";var b=e.save||{};var f=d==""?"save":"update";if(!b.fn){return}if(!b.scope){b.fn(this,a,f)}else{b.fn.apply(b.scope,[this,a,f])}},handleAfterSave:function(){var a=Ext.getCmp(this.accountId);a.setDisabled(true);var a=Ext.getCmp(this.userButtonId);a.setDisabled(true);var a=Ext.getCmp(this.fullNameId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.lastNameId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.smtpId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.capacityId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.activeId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.forwardId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.virusId);a.setDisabled(!this.editable);var a=Ext.getCmp(this.spamId);a.setDisabled(!this.editable)},loadInfo:function(domain,departments,selectedDep,account,action,editable){this.__owner.action=action;this.__owner.domain=domain;this.__owner.department=selectedDep;this.editable=editable;var __cmdSave=Ext.getCmp(this.cmdSave);__cmdSave.setDisabled(!this.editable);Ext.getCmp(this.cmdNew).setDisabled(!this.editable);__account=account||"";this.__owner.account=__account;var __txtDomain=Ext.getCmp(this.domainId);__txtDomain.setValue("@"+domain);Ext.getCmp(this.groupId).setValue("");var __loadSuccess=function(response,options){var __data=eval("("+response.responseText+")");var __success=(__data.success==undefined?true:!!__data.success);if(__success){this._setData(__data)}};if(__account!=""){var __params={iwct:"loadMailAccountContent",iwa:"READ_WRITE",action:"load"};__params.email=__account;iNet.Ajax.request({url:"jsonajax",params:__params,method:"POST",success:__loadSuccess,scope:this,failure:function(result,request){},maskEl:this.bwrap})}else{this.cleanData()}},_fnSelectUser:function(){var a=new iNet.iwebos.ui.mail.DialogSearchAccount();var b={fn:this._loadAccount.createDelegate(this),scope:this};a.__setAction(b);a.show(this);a.disabledDelChk()},_loadAccount:function(b){if(b!=undefined&&b!=null&&b.uname!=""){this.__owner.code=b.id;var a=function(e,f){var d=Ext.util.JSON.decode(e.responseText);var g=(d.success==undefined)?true:d.success;if(g){this._fillUserInfo(d)}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_load_account,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var c={iwct:"loadUserContent",iwa:"READ_WRITE",action:"loadlotus",uname:b.uname,org:this.__owner.domain};iNet.Ajax.request({url:"jsonajax",params:c,scope:this,method:"POST",success:a,failure:function(d,e){},maskEl:this.bwrap})}else{this._cleanData()}},_fillUserInfo:function(c){var d=c||{};if(this.__owner.domain==c.org){var a=c.groups;if(a!=null&&a.length>0){var e=a[0].group;for(var b=1;b<a.length;b++){e=e+", "+a[b].group}Ext.getCmp(this.groupId).setValue(e)}else{Ext.getCmp(this.groupId).setValue("")}}else{Ext.getCmp(this.groupId).setValue("")}if(!c.edit){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.warning_user_can_not_manage_user,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}var h=Ext.getCmp(this.ownerAccountId);if(!!h){h.setValue(d.uname);this.__owner.userCode=this.__owner.code;this.__owner.uname=d.uname;this.__owner.pwd=d.pwd}var g=d.fname||"";var f="";if(d.mname){f=d.mname+" "+g}else{f=g}Ext.getCmp(this.fullNameId).setValue(f);Ext.getCmp(this.lastNameId).setValue(d.lname)}}); 
iNet.iwebos.ui.mail.DialogCreateDomain=function(g,d){this.viewer=g;Ext.apply(this,d);this.prefix="mail-admin";this.domainNameId=this.prefix+"-domain-name-id";this.domainDescId=this.prefix+"-domain-desc-id";this.editAccountId=this.prefix+"-edit-account-id";var b={field:"uname",direction:"DESC"};var f={field:"uname",direction:"DESC"};var c=Ext.data.Record.create([{name:"id",mapping:"uname",type:"string"},{name:"uname",mapping:"uname",type:"string"},{name:"lname",mapping:"lname",type:"string"},{name:"mname",mapping:"mname",type:"string"},{name:"fname",mapping:"fname",type:"string"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},c);var e=new Ext.grid.ColumnModel([{header:iwebos.message.mail.create.username,dataIndex:"uname",fixed:true,width:150},{header:iwebos.message.mail.create.lastname,dataIndex:"lname",fixed:true,width:120},{header:iwebos.message.mail.create.middlename,dataIndex:"mname",fixed:true,width:150},{header:iwebos.message.mail.create.firstname,dataIndex:"fname",fixed:true,width:150}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"new-admin-grid-id",region:"center",anchor:"100%",minSize:150,autoScroll:true,height:170,url:"jsonajax",method:"POST",loadFirst:false,sortInfo:b,tbar:[{id:"account-add-button",xtype:"button",text:iwebos.message.mail.domain_add_manager,border:false,iconCls:"icon-mail-add",handler:this._fnSelectUser.createDelegate(this)},{id:"account-delete-button",xtype:"button",text:iwebos.message.mail.domain_delete_manager,border:false,iconCls:"icon-mail-del",handler:this._onRemoveUser.createDelegate(this)}],reader:a,dsort:f,cm:e,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),filter:{data:"all"}});this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[{columnWidth:0.9,border:false,layout:"form",anchor:"100%",items:[{id:this.domainNameId,fieldLabel:iwebos.message.mail.domain,xtype:"textfield",border:false,anchor:"100%"},{id:this.domainDescId,fieldLabel:iwebos.message.mail.domain_desc,xtype:"textfield",border:false,anchor:"100%"},{border:false,html:"<br/><b>"+iwebos.message.mail.domain_list_domain_manager+"</b><br/><br/>"},this.grid,{id:this.editAccountId,xtype:"checkbox",boxLabel:iwebos.message.mail.enable_modify_email,hideLabel:true,checked:true}]},{layout:"fit",border:false,anchor:"100%",items:[{}]}]});this.grid.on("rowcontextmenu",this._onRowContext,this,{stopEvent:true});this.grid.on("contextmenu",this._onContextMenu,this,{stopEvent:true});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogCreateDomain.superclass.constructor.call(this,{id:"mail-create-domain-dialog",title:iwebos.message.mail.create_domain,iconCls:"icon-email-domain",region:"center",anchor:"100%",width:600,height:500,modal:true,frame:true,resizable:false,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.create.save,iconCls:"ok-btn",scope:this,handler:this.fnOkHandler},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",scope:this,handler:this.fnCancelHandler}]})};Ext.extend(iNet.iwebos.ui.mail.DialogCreateDomain,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.create_domain,btitle:iwebos.message.mail.create.input_domain_info,setData:function(b,a){this.__owner={id:b,action:a};if(b){this.loadData(b)}},loadData:function(id){var baseParams={iwct:"loadMailDomainContent",iwa:"view",action:"load"};baseParams.text=id;fnSuccess=function(result,request){var data=result.responseText;data=eval("("+data+")");if(data){var component=Ext.getCmp(this.domainNameId);component.setValue(data.text);component.setDisabled(true);component=Ext.getCmp(this.domainDescId);component.setValue(data.desc);var __store=this.grid.store;__store.removeAll();var __owners=data.list;if(__owners!=null&&__owners!=undefined){for(var __index=0;__index<__owners.length;__index++){var __owner=__owners[__index];__owner.id=__owner.uname;__store.addData(__owner)}}component=Ext.getCmp(this.editAccountId);component.setValue(data.edit)}};iNet.Ajax.request({url:"jsonajax",params:baseParams,method:"POST",scope:this,success:fnSuccess})},getData:function(){var d={};d.id=this.__owner.id;var f=Ext.getCmp(this.domainNameId);var g=f.getValue().trim().toLowerCase();f.setValue(g);d.text=g;f=Ext.getCmp(this.domainDescId);d.desc=f.getValue();var b=this.grid.store;var e=b.getCount();var a=[];var h={};if(e>0){for(var c=0;c<e;c++){h=b.getAt(c).data;a[c]={uname:h.uname}}}d.list=a;f=Ext.getCmp(this.editAccountId);d.edit=f.getValue();return d},__onSave:function(){var a=this.getData();var b=this.__owner.action.save;if(!b){return}if(!b.scope){b.fn(a)}else{b.fn.apply(b.scope,[a])}},_onRemoveUser:function(){var a=this.grid.getSelectionModel().getSelections()[0];if(!!a){this.grid.store.remove(a)}},_onRowContext:function(b,a,c){c.stopEvent();b.getSelectionModel().selectRow(a);if(!this.menuRowAdmin){this.menuRowAdmin=new Ext.menu.Menu({id:"grid-ctx",items:[{id:"account-add-menu",text:iwebos.message.mail.domain_add_manager,iconCls:"icon-mail-add",scope:this,handler:this._fnSelectUser.createDelegate(this)},{id:"account-delete-menu",text:iwebos.message.mail.domain_delete_manager,iconCls:"icon-mail-del",scope:this,handler:this._onRemoveUser.createDelegate(this)}]})}this.menuRowAdmin.showAt(c.getXY())},_onContextMenu:function(a){a.stopEvent();if(!this.menuContextAdmin){this.menuContextAdmin=new Ext.menu.Menu({items:[{id:"account-add-menu-context",text:iwebos.message.mail.domain_add_manager,iconCls:"icon-mail-add",scope:this,handler:this._fnSelectUser.createDelegate(this)}]})}this.menuContextAdmin.showAt(a.getXY())},fnOkHandler:function(){var b=Ext.getCmp(this.domainNameId).getValue();var a=this.grid.store.getCount();if(""===b||0==a){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_input_info,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return false}this.__onSave();this.destroy()},_fnSelectUser:function(){var a=new iNet.iwebos.ui.mail.DialogSearchAccount();var b={fn:this._handleSelectUser.createDelegate(this),scope:this};a.__setAction(b);a.show(this)},_handleSelectUser:function(b){if(b==null||b==undefined){return}var a=this.grid.store;var c=a.getById(b.uname);if(c==null||c==undefined){b.id=b.uname;a.addData(b)}},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.mail.DialogDepartment=function(b,a){this.viewer=b;Ext.apply(this,a);this.prefix="mail-admin-department";this.departmentNameId=this.prefix+"-department-name-id";this.adminNameId=this.prefix+"-admin-name-id";this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[{columnWidth:0.9,border:false,layout:"form",anchor:"100%",items:[{id:this.departmentNameId,fieldLabel:iwebos.message.mail.create.department,xtype:"textfield",border:false,anchor:"97%"},{layout:"column",columnWidth:1,items:[{layout:"form",border:false,columnWidth:0.9,items:[{id:this.adminNameId,fieldLabel:iwebos.message.mail.create.manager,xtype:"textfield",readOnly:true,border:false,anchor:"98%"}]},{layout:"form",border:false,columnWidth:0.1,items:[{id:"select-admin-button",xtype:"button",border:false,iconCls:"icon-mail-add",handler:this._fnSelectUser.createDelegate(this)}]}]}]},{layout:"fit",border:false,anchor:"100%",items:[{}]}]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogDepartment.superclass.constructor.call(this,{id:"mail-admin-department-id",title:iwebos.message.mail.create.department,iconCls:"icon-email-adddomain",region:"center",anchor:"100%",width:400,height:300,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.create.save,iconCls:"ok-btn",handler:this.fnOkHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:iwebos.message.mail.cancel,handler:this.fnCancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogDepartment,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.create.dialog_department_title,btitle:iwebos.message.mail.create.dialog_department_btitle,setData:function(c,a,b){this.__owner={id:c,edit:a,action:b}},loadData:function(id){var baseParams={iwct:"loadMailDomainContent",iwa:"view",action:"load"};baseParams.text=id;fnSuccess=function(result,request){var data=result.responseText;data=eval("("+data+")");if(data){var component=Ext.getCmp(this.departmentNameId);component.setValue(data.text);component.setDisabled(true);component=Ext.getCmp(this.adminNameId);component.setValue(data.uname)}};iNet.Ajax.request({url:"jsonajax",params:baseParams,method:"POST",scope:this,success:fnSuccess})},getData:function(){var a={};a.text=this.__owner.id;a.edit=this.__owner.edit;var b=Ext.getCmp(this.departmentNameId);a.depName=b.getValue();a.code=this.__userCode;return a},__onSave:function(){var a=this.getData();var b=this.__owner.action.save;if(!b){return}if(!b.scope){b.fn(a)}else{b.fn.apply(b.scope,[a])}},fnOkHandler:function(){var a=Ext.getCmp(this.departmentNameId).getValue();var b=Ext.getCmp(this.adminNameId).getValue();if(""===a||""===b){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_input_info,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return false}this.__onSave();this.destroy()},_fnSelectUser:function(){var a=new iNet.iwebos.ui.mail.DialogSearchAccount();var b={fn:this._handleSelectUser.createDelegate(this),scope:this};a.__setAction(b);a.show(this)},_handleSelectUser:function(a){var b=a||{};this.__userCode=b.id;this.__userName=b.uname;var c=Ext.getCmp(this.adminNameId);if(!!c){c.setValue(a.uname)}},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.mail.DialogForwardAddress=function(b,a){this.viewer=b;Ext.apply(this,a);this.mailId="mail-admin-forward-address";this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[{border:false,layout:"form",anchor:"100%",labelWidth:60,bodyStyle:"padding:15px",items:[{id:this.mailId,fieldLabel:iwebos.message.mail.forward_address,xtype:"textfield",border:false,vtype:"email",anchor:"92%"}]}]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogForwardAddress.superclass.constructor.call(this,{id:"mail-forward-address-dialog",title:iwebos.message.mail.input_address_need_to_forward,region:"center",anchor:"100%",width:400,height:270,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.create.save,iconCls:"ok-btn",handler:this.fnOkHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.fnCancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogForwardAddress,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.input_address_need_to_forward,btitle:"",setAction:function(a){this.action=a},fnOkHandler:function(){var a=Ext.getCmp(this.mailId).getValue();if(""==a){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.warning_input_address_need_to_forward,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var b=this.action.save;if(!b){return}if(!b.scope){b.fn(a)}else{b.fn.apply(b.scope,[a])}this.destroy()},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.mail.DialogSearchAccount=function(g,d){this.viewer=g;Ext.apply(this,d);var b={field:"uname",direction:"ASC"};var f={field:"uname",direction:"ASC"};var h={iwct:"searchAccountContent",iwa:"view",id:0,action:"search"};var c=Ext.data.Record.create([{name:"id",mapping:"userCode",type:"string"},{name:"uname",mapping:"uname",type:"string"},{name:"lname",mapping:"lname",type:"string"},{name:"mname",mapping:"mname",type:"string"},{name:"fname",mapping:"fname",type:"string"},{name:"pwd",mapping:"pwd",type:"string"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},c);var e=new Ext.grid.ColumnModel([{header:iwebos.message.mail.account,dataIndex:"uname",fixed:true,width:150},{header:"Họ",dataIndex:"lname",fixed:true,width:120},{header:"Tên lót",dataIndex:"mname",fixed:true,width:150},{header:iwebos.message.mail.name,dataIndex:"fname",fixed:true,width:150}]);h.first=true;this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"accountSearch",region:"center",anchor:"100%",autoScroll:true,height:250,url:"jsonajax",method:"POST",sortInfo:b,baseParams:h,loadFirst:false,reader:a,dsort:f,cm:e,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),filter:{data:"all"}});this.search=new iNet.iwebos.ui.mail.ToolbarSearchAccount({region:"north",width:"100%",autoHeight:true,frame:false,border:false,store:this.grid.store});this.search.setLimitSearchCharacter(3);this.search.toolbarSeach.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[this.search,this.grid]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogSearchAccount.superclass.constructor.call(this,{id:"mail-dlgsearch-account",title:iwebos.message.mail.search_account,iconCls:"icon-email-search",region:"center",anchor:"100%",width:600,height:500,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{id:"dialog-search-account-ok-id",text:iwebos.message.mail.select_account,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogSearchAccount,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.search_account,btitle:iwebos.message.mail.search_account,__setAction:function(a){this.__action=a},disabledOkButton:function(){Ext.getCmp("dialog-search-account-ok-id").setDisabled(true)},disabledDelChk:function(){Ext.getCmp("toolbar-search-account-deleted-id").setDisabled(true)},setEnableDelChk:function(c,b){var a=Ext.getCmp("toolbar-search-account-deleted-id");if(c!=undefined){a.setDisabled(!c)}if(b!=undefined){a.setValue(b)}},fnOkHandler:function(){var c=Ext.getCmp("accountSearch");var b=c.getSelectionModel().getSelections();if(b!==undefined&&b.length!=0){var a=b[0].data;if(this.__action.scope){this.__action.fn.apply(this.__action.scope,[a])}this.destroy()}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_select_account,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.mail.DialogSearchAlias=function(g,d){this.viewer=g;Ext.apply(this,d);var b={field:"email",direction:"ASC"};var f={field:"email",direction:"ASC"};var h={iwct:"searchMailAccountContent",iwa:"view",id:0,action:"search"};var c=Ext.data.Record.create([{name:"id",mapping:"email",type:"string"},{name:"email",mapping:"email",type:"string"},{name:"displayname",mapping:"displayname",type:"string"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},c);var e=new Ext.grid.ColumnModel([{header:iwebos.message.mail.account,dataIndex:"email",fixed:true,width:250},{header:iwebos.message.mail.name,dataIndex:"displayname",fixed:true,width:330}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"emailAliasSearchGrid",region:"center",anchor:"100%",autoScroll:true,height:270,url:"jsonajax",method:"POST",sortInfo:b,loadFirst:false,baseParams:h,reader:a,dsort:f,cm:e,filter:{data:"all"}});this.toolbarSearchAccount=new iNet.iwebos.ui.mail.AliasMailToolbar({region:"north",width:"100%",autoHeight:true,frame:false,border:false,store:this.grid.store,selDomain:this.domain});this.toolbarSearchAccount.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[this.toolbarSearchAccount,this.grid]});this.grid.on("keypress",this.__handleKeyEvent,this,{stopEvent:true});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogSearchAlias.superclass.constructor.call(this,{id:"mail-dlgsearch-alias",title:iwebos.message.mail.search_alias,iconCls:"icon-email-search",region:"center",anchor:"100%",width:630,height:520,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.select_account,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogSearchAlias,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.search_alias,btitle:iwebos.message.mail.select_mail_account,__handleKeyEvent:function(a){LotusService.handleKeyEventOnGrid(this.grid,a)},fnCancelHandler:function(){this.destroy()},getData:function(){var d=Ext.getCmp("emailAliasSearchGrid");var c=d.getSelectionModel().getSelections();var a=[];if(c!==undefined){for(var b=0;b<c.length;b++){a[b]=c[b].data}}return a}}); 
iNet.iwebos.ui.mail.DialogSelectedAlias=function(g,d){this.viewer=g;Ext.apply(this,d);var b={field:"email",direction:"DESC"};var f={field:"email",direction:"DESC"};var h={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"MAIL",iwa:"view",id:0,action:"search"};var c=Ext.data.Record.create([{name:"id",mapping:"emailID",type:"int"},{name:"email",mapping:"email",type:"string"},{name:"name",mapping:"name",type:"string"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},c);var e=new Ext.grid.ColumnModel([{header:iwebos.message.mail.create.username,dataIndex:"email",fixed:true,width:250},{header:iwebos.message.mail.create.firstname,dataIndex:"name",fixed:true,width:200}]);this.emailAccountGrid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"accountSearch",region:"center",anchor:"100%",autoScroll:true,height:200,url:"jsonajax",method:"POST",sortInfo:b,baseParams:h,reader:a,dsort:f,cm:e,filter:{data:"all"}});this.ToolbarSearchAccount=new iNet.iwebos.ui.mail.ToolbarSearchAccount({region:"north",width:"100%",autoHeight:true,frame:false,border:false,store:this.emailAccountGrid.store});this.text=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[this.ToolbarSearchAccount,this.emailAccountGrid]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogSelectedAlias.superclass.constructor.call(this,{id:"mail-dlgsearch-account",title:"Tìm kiếm tài khoản",iconCls:"icon-email-search-account",region:"center",anchor:"100%",width:500,height:400,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.select_account,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogSelectedAlias,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.search_account,btitle:iwebos.message.mail.dialog_search_user_btitle,fnOkHandler:function(){var c=Ext.getCmp("accountSearch");var b=c.getSelectionModel().getSelections();if(b!==undefined){for(var a=0;a<b.length;a++){alert(b[a].data.id)}}},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.mail.InputEmailDialog=function(c,a){this.viewer=c;Ext.apply(this,a);var b=new Ext.form.FormPanel({region:"center",frame:true,border:false,anchor:"100%",items:[{border:false,layout:"form",anchor:"100%",labelWidth:60,bodyStyle:"padding:15px",items:[{id:"input-email-dialog-email-id",fieldLabel:iwebos.message.mail.email_address,xtype:"textfield",vtype:"email",border:false,anchor:"95%"}]}]});this.okHandler=this.okHandler||this.fnOkHandler;this.okhScope=this.okhScope||this;iNet.iwebos.ui.mail.InputEmailDialog.superclass.constructor.call(this,{id:"mail-create-domain-dialog",title:iwebos.message.mail.alias_input_email_title,iconCls:"icon-email-createacc",region:"center",anchor:"100%",width:420,height:270,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[b],buttons:[{text:iwebos.message.mail.ok,iconCls:"ok-btn",scope:this,handler:this.okHandler},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",scope:this,handler:this.fnCancelHandler}]})};Ext.extend(iNet.iwebos.ui.mail.InputEmailDialog,iNet.iwebos.ui.common.dialog.TitleDialog,{ttitle:iwebos.message.mail.alias_input_email_title,btitle:iwebos.message.mail.alias_input_email_subtitle,fnOkHandler:function(){this.destroy()},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.mail.grid.MailViewPanel=function(viewer,config){this.viewer=viewer;Ext.apply(this,config);this.__owner={};this._superRole="ROLE_SUPER";this._domainRole="ROLE_DOMAIN";var sortInfo={field:"email",direction:"ASC"};var defaultSort={field:"email",direction:"ASC"};var baseParams={iwct:"searchMailAccountContent",iwa:"view",id:0,action:"search"};var mailRecord=Ext.data.Record.create([{name:"id",mapping:"email",type:"string"},{name:"isMail",mapping:"isMail",type:"boolean"},{name:"email",mapping:"email",type:"string"},{name:"displayname",mapping:"displayname",type:"string"},{name:"smtp",mapping:"smtp",type:"boolean"},{name:"capacity",mapping:"capacity",type:"string"},{name:"active",mapping:"active",type:"boolean"},{name:"forward",mapping:"forward",type:"boolean"},{name:"virus",mapping:"virus",type:"boolean"},{name:"spam",mapping:"spam",type:"boolean"},{name:"date",mapping:"date",type:"int"}]);var reader=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"email"},mailRecord);var columnModel=new Ext.grid.ColumnModel([new iNet.iwebos.ui.mail.grid.isMail(),{header:iwebos.message.mail.mail_account,dataIndex:"email",sortable:true,width:200},{header:iwebos.message.mail.fullname,dataIndex:"displayname",sortable:true,width:180},{header:iwebos.message.mail.create.sizelimit,dataIndex:"capacity",sortable:true,fixed:true,width:100},{header:iwebos.message.mail.create_date,dataIndex:"date",sortable:true,width:80,fixed:true,renderer:iNet.dateRenderer("d/m/Y"),groupRenderer:iNet.dateGroupRenderer()},new iNet.iwebos.ui.mail.grid.Active()]);var filterFn=function(item,value){return(item.data.status===value)};var fnRowClass=function(record){var read=record.data.read;return"grid-show-rows"};this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"emailMessageId",region:"center",anchor:"100%",autoScroll:true,url:"jsonajax",method:"POST",sortInfo:sortInfo,loadFirst:false,baseParams:baseParams,reader:reader,rowClass:fnRowClass,dsort:defaultSort,cm:columnModel,filter:{data:"all",fn:filterFn},view:new Ext.grid.GridView({forceFit:true})});this.grid.on("rowcontextmenu",this._onRowContextMenu,this,{stopEvent:true});this.grid.on("contextmenu",this._onContextMenu.createDelegate(this),this,{stopEvent:true});this.grid.on("rowdblclick",this.onDoubleClick,this);this.grid.un("resize",this.onGridResize,this);this.adSearch=new iNet.iwebos.ui.mail.Toolbar({region:"north",width:"100%",frame:false,border:false,height:25,store:this.grid.store});this.adSearch.toolbarSeach.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});this.adSearch.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});var __params={iwct:"loadPermissionContent",iwa:"READ_WRITE",action:"load"};var __permissionOk=function(response,options){var __result=eval("("+response.responseText+")");if(!!__result){var __role=__result.role||this._domainRole;this.__owner.role=__role;var __taskPanel=Ext.getCmp("mail-panel-action-id")||{};var __roleSystem=(__role===this._superRole?true:false);Ext.getCmp("domain-id").setEditDomain(__roleSystem);if(__taskPanel&&__taskPanel.body){var __bd=__taskPanel.body;__bd.select('li[id="li-task-view-create-domain"]').setDisplayed(__roleSystem);__bd.select('li[id="li-task-report"]').setDisplayed(true);__bd.select('li[id="li-task-import"]').setDisplayed(true)}}};iNet.Ajax.request({url:"jsonajax",success:__permissionOk,failure:function(response,options){},method:"POST",params:__params,scope:this,maskEl:this.bwrap});this.actions={"task-view-create-domain":this._fnCreateDomain.createDelegate(this),"task-report":this._fnReport.createDelegate(this),"task-import":this._fnImport.createDelegate(this)};var followupColumn=new Ext.grid.ColumnModel([{fixed:true,width:"100%",sortable:true,dataIndex:"subject"}]);this.groupBy=new Ext.Panel({frame:true,region:"center",height:50});this.gridMain=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[this.adSearch,this.grid]});this.main=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[this.groupBy,this.gridMain]});iNet.iwebos.ui.mail.grid.MailViewPanel.superclass.constructor.call(this,{id:"main-tabs",activeTab:0,region:"center",anchor:"100%",enableTabScroll:true,autoScroll:true,frame:false,border:false,items:{title:iwebos.message.mail.manage_account,iconCls:"icon-mail-home",layout:"border",hideMode:"offsets",items:[this.main]}})};Ext.extend(iNet.iwebos.ui.mail.grid.MailViewPanel,Ext.TabPanel,{_fnCreateDomain:function(){var a=Ext.getCmp("domain-id");if(!a){return}var b=new iNet.iwebos.ui.mail.DialogCreateDomain();var c={save:{fn:a.__onSave,scope:a}};b.setData(null,c);b.show(this)},_fnReport:function(){var b=Ext.getCmp("main-tabs");var a=Ext.getCmp("report-mail-acc-tab");if(!a){a=new iNet.iwebos.ui.mail.ReportPanel();b.add(a).show()}b.setActiveTab(a)},_fnImport:function(){var b=Ext.getCmp("main-tabs");var a=Ext.getCmp("import-mail-acc-tab");if(!a){a=new iNet.iwebos.ui.mail.ImportPanel();b.add(a).show()}b.setActiveTab(a)},_newAlias:function(c){var d=Ext.getCmp("main-tabs");var a=Ext.getCmp("new-alias-main-id");var f=this.__owner.domain||"";var b="";var e={save:{fn:this._onSaveAlias,scope:this}};if(!a){a=new iNet.iwebos.ui.mail.CreateAlias();d.add(a).show()}d.setActiveTab(a);a.loadInfo(f,this.adSearch.getDepartmentName(),b,e,true)},_newAccountEmail:function(){var c=Ext.getCmp("main-tabs");var a=Ext.getCmp("new-email-panel");var e=this.__owner.domain||"";var b="";var d={save:{fn:this._onSaveAccount,scope:this}};if(!a){a=new iNet.iwebos.ui.mail.CreateEmail();c.add(a).show()}c.setActiveTab(a);a.loadInfo(e,this.adSearch.getDepartments(),this.adSearch.getDepartmentName(),b,d,true)},_onSaveAlias:function(panel,object,action){var __store=this.grid.store;var __object=object||{};var __action=action||"save";var saveSuccess=function(response,options){var __data=eval("("+response.responseText+")");if(__data.success){if(__action=="save"){__object.date=(new Date()).getTime();__object.displayname=__object.lastName+" "+__object.fname;__object.id=__object.email;__store.addData(__object);panel.__owner.account=__object.email;panel.handleAfterSave()}else{var __oldRecord=__store.getById(__object.email);if(__oldRecord!=null&&__oldRecord!=undefined){__oldRecord.data.displayname=__object.lastName+" "+__object.fname;__oldRecord.data.smtp=__object.smtp;__oldRecord.data.active=__object.active;__oldRecord.data.forward=__object.forward;__oldRecord.data.virus=__object.virus;__oldRecord.data.spam=__object.spam;__oldRecord.commit()}}Ext.MessageBox.show({title:iwebos.message.mail.saving_mail_alias,msg:iwebos.message.mail.save_data_sucessful,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_create_account,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var __params={iwct:"mailAliasContent",iwa:"READ_WRITE"};__params.action=__action;__params.object=Ext.util.JSON.encode(__object);iNet.Ajax.request({url:"jsonajax",params:__params,method:"POST",success:saveSuccess,failure:function(result,request){},maskEl:this.bwrap})},_onSaveAccount:function(panel,object,action){var __store=this.grid.store;var __object=object||{};var __action=action||"save";var saveSuccess=function(response,options){var __data=eval("("+response.responseText+")");if(__data.success){if(__action=="save"){__object.date=(new Date()).getTime();__object.displayname=__object.lname+" "+__object.fname;__object.id=__object.email;__store.addData(__object);panel.__owner.account=__object.email;panel.handleAfterSave()}else{var __oldRecord=__store.getById(__object.email);if(__oldRecord!=null&&__oldRecord!=undefined){__oldRecord.data.displayname=__object.lname+" "+__object.fname;__oldRecord.data.smtp=__object.smtp;__oldRecord.data.capacity=__object.capacity;__oldRecord.data.active=__object.active;__oldRecord.data.forward=__object.forward;__oldRecord.data.virus=__object.virus;__oldRecord.data.spam=__object.spam;__oldRecord.commit()}}Ext.MessageBox.show({title:iwebos.message.mail.saving_mail_account,msg:iwebos.message.mail.save_data_sucessful,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_create_account,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var __params={iwct:"mailAccountContent",iwa:"READ_WRITE"};__params.action=__action;__params.object=Ext.util.JSON.encode(__object);iNet.Ajax.request({url:"jsonajax",params:__params,method:"POST",success:saveSuccess,failure:function(result,request){},maskEl:this.bwrap})},_onRowContextMenu:function(b,a,d){d.stopEvent();b.getSelectionModel().selectRow(a);var g=this.__owner||{};var f=g.edit;if(!f){return}var c=b.getSelectionModel().getSelections()[0].data;if(c.isMail){this.createEmailMenu();this.mailMenu.on("hide",this.onContextHide,this);this.enableMailMenu(this.mailMenu,c);d.stopEvent();this.mailMenu.showAt(d.getXY())}else{if(!this.aliasMenu){this.createAliasMenu();this.aliasMenu.on("hide",this.onContextHide,this)}this.enableAliasMenu(this.aliasMenu,c);d.stopEvent();this.aliasMenu.showAt(d.getXY())}},_onContextMenu:function(a){a.stopEvent();var c=this.__owner||{};var b=c.edit;if(b){this.mailMenu=new Ext.menu.Menu({items:[{id:"mail-menu-create-email",text:iwebos.message.mail.create_email_account,iconCls:"icon-ismail-true",scope:this,handler:this._newAccountEmail.createDelegate(this)},{id:"mail-menu-create-alias",text:iwebos.message.mail.create_alias_account,iconCls:"icon-ismail-false",scope:this,handler:this._newAlias}]});this.mailMenu.showAt(a.getXY())}},enableMailMenu:function(a,b){a.items.get("mailActive").setText(b.active==true?iwebos.message.mail.inactive_account:iwebos.message.mail.active_account);a.items.get("mailActive").setIconClass(b.active==true?"icon-email-false":"icon-email-true");a.items.get("mailSMTP").setText(b.smtp==true?iwebos.message.mail.autheticate_smtp_no:iwebos.message.mail.autheticate_smtp_yes);a.items.get("mailSMTP").setIconClass(b.smtp==true?"icon-email-false":"icon-email-true");a.items.get("mailForward").setText(b.forward==true?iwebos.message.mail.forward_no:iwebos.message.mail.forward_yes);a.items.get("mailForward").setIconClass(b.forward==true?"icon-email-false":"icon-email-true");a.items.get("mailVirus").setText(b.virus==true?iwebos.message.mail.uncheck_virus:iwebos.message.mail.check_virus);a.items.get("mailVirus").setIconClass(b.virus==true?"icon-email-false":"icon-email-true");a.items.get("mailSPAM").setText(b.spam==true?iwebos.message.mail.uncheck_spam:iwebos.message.mail.check_spam);a.items.get("mailSPAM").setIconClass(b.spam==true?"icon-email-false":"icon-email-true")},enableAliasMenu:function(b,a){b.items.get("aliasActive").setText(a.active==true?iwebos.message.mail.inactive_account:iwebos.message.mail.active_account);b.items.get("aliasActive").setIconClass(a.active==true?"icon-email-false":"icon-email-true");b.items.get("aliasSMTP").setText(a.smtp==true?iwebos.message.mail.autheticate_smtp_no:iwebos.message.mail.autheticate_smtp_yes);b.items.get("aliasSMTP").setIconClass(a.smtp==true?"icon-email-false":"icon-email-true");b.items.get("aliasVirus").setText(a.virus==true?iwebos.message.mail.uncheck_virus:iwebos.message.mail.check_virus);b.items.get("aliasVirus").setIconClass(a.virus==true?"icon-email-false":"icon-email-true");b.items.get("aliasSpam").setText(a.spam==true?iwebos.message.mail.uncheck_spam:iwebos.message.mail.check_spam);b.items.get("aliasSpam").setIconClass(a.spam==true?"icon-email-false":"icon-email-true")},createEmailMenu:function(){this.mailMenu=new Ext.menu.Menu({items:[{id:"mailCreateNewAccount",text:iwebos.message.mail.create_email_account,iconCls:"icon-ismail-true",scope:this,handler:this._newAccountEmail},{id:"mailCreateNewAlias",text:iwebos.message.mail.create_alias_account,iconCls:"icon-ismail-false",scope:this,handler:this._newAlias},{id:"mailDel",text:iwebos.message.mail.delete_account,iconCls:"icon-mail-del",scope:this,handler:this.onDeleteMail},{id:"mailUpdate",text:iwebos.message.mail.update_account,iconCls:"icon-mail-update",scope:this,handler:this.onUpdate},"-",{id:"mailActive",iconCls:"icon-email-active_mail",scope:this,handler:this._onActiveMail},{id:"mailSMTP",iconCls:"icon-email-delete_mail",scope:this,handler:this._onSmtpMail},{id:"mailForward",iconCls:"icon-email-delete_mail",scope:this,handler:this._onForwardMail},{id:"mailVirus",iconCls:"icon-email-delete_mail",scope:this,handler:this._onVirusMail},{id:"mailSPAM",iconCls:"icon-email-delete_mail",scope:this,handler:this._onSpamMail}]})},createAliasMenu:function(){this.aliasMenu=new Ext.menu.Menu({items:[{id:"mailCreateNewAccount",text:iwebos.message.mail.create_email_account,iconCls:"icon-ismail-true",scope:this,handler:this._newAccountEmail},{id:"mailCreateNewAlias",text:iwebos.message.mail.create_alias_account,iconCls:"icon-ismail-false",scope:this,handler:this._newAlias},{id:"aliasDel",text:iwebos.message.mail.delete_alias,iconCls:"icon-mail-del",scope:this,handler:this.onDeleteAlias},{id:"aliasUpdate",text:iwebos.message.mail.update_account,iconCls:"icon-mail-update",scope:this,handler:this.onUpdate},"-",{id:"aliasActive",scope:this,handler:this._onActiveAlias},{id:"aliasSMTP",iconCls:"icon-email-delete_mail",scope:this,handler:this._onSmtpAlias},{id:"aliasVirus",iconCls:"icon-email-delete_mail",scope:this,handler:this._onVirusAlias},{id:"aliasSpam",iconCls:"icon-email-delete_mail",scope:this,handler:this._onSpamAlias}]})},onContextHide:function(){if(this.ctxRow){Ext.fly(this.ctxRow).removeClass("x-node-ctx");this.ctxRow=null}},onDoubleClick:function(d,c,f){f.stopEvent();var b=d.store.getAt(c);var a=b.data;if(a.isMail){this.openEmailTab(a)}else{this.openAliasTab(a)}},openEmailTab:function(b){var c=Ext.getCmp("main-tabs");var a=Ext.getCmp("new-email-panel");var e=this.__owner.domain||"";var d={save:{fn:this._onSaveAccount,scope:this}};var f=this.__owner.edit||false;if(!a){a=new iNet.iwebos.ui.mail.CreateEmail();c.add(a).show()}c.setActiveTab(a);a.loadInfo(this.__owner.domain,this.adSearch.getDepartments(),"",b.email,d,f)},openAliasTab:function(c){var d=Ext.getCmp("main-tabs");var a=Ext.getCmp("new-alias-main-id");var f=this.__owner.domain||"";var b=c.email;var g=this.__owner.edit||false;var e={save:{fn:this._onSaveAlias,scope:this}};if(!a){a=new iNet.iwebos.ui.mail.CreateAlias();d.add(a).show()}d.setActiveTab(a);a.loadInfo(f,"",b,e,g)},onUpdate:function(){var b=Ext.getCmp("emailMessageId");var c=b.getSelectionModel().getSelections();var a=c[0].data;if(a.isMail){this.openEmailTab(a)}else{this.openAliasTab(a)}},_onActiveMail:function(){this._fnHandlerUpdateMail("active","active")},__onSaveForward:function(forwardAddress){var __grid=Ext.getCmp("emailMessageId");var __record=__grid.getSelectionModel().getSelections()[0];var selection=__record.data;var fnSuccess=function(response,options){var data=eval("("+response.responseText+")");if(data.success){__record.data.forward=!__record.data.forward;__record.commit()}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_perform_task,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"mailAccountContent",iwa:"READ_WRITE",action:"forward"};var object={};object.email=selection.email;object.fAddress=forwardAddress;object.forward=!selection.forward;params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",params:params,method:"POST",scope:this,success:fnSuccess,failure:function(result,request){}})},_onSmtpMail:function(){this._fnHandlerUpdateMail("smtpAuth","smtp")},_onForwardMail:function(){var e=Ext.getCmp("emailMessageId");var a=e.getSelectionModel().getSelections()[0];var c=a.data;if(c.forward){this.__onSaveForward(null)}else{var b=new iNet.iwebos.ui.mail.DialogForwardAddress();var d={save:{fn:this.__onSaveForward,scope:this}};b.setAction(d);b.show(this)}},_onVirusMail:function(){this._fnHandlerUpdateMail("checkVirus","virus")},_onSpamMail:function(){this._fnHandlerUpdateMail("checkSpam","spam")},_onActiveAlias:function(){this._fnHandlerUpdateAlias("active","active")},_onSmtpAlias:function(){this._fnHandlerUpdateAlias("smtpAuth","smtp")},_onVirusAlias:function(){this._fnHandlerUpdateAlias("checkVirus","virus")},_onSpamAlias:function(){this._fnHandlerUpdateAlias("checkSpam","spam")},_fnHandlerUpdateMail:function(action,attribute){var __grid=Ext.getCmp("emailMessageId");var __record=__grid.getSelectionModel().getSelections()[0];var selection=__record.data;var fnSuccess=function(response,options){var data=eval("("+response.responseText+")");if(data.success){__record.data[attribute]=!__record.data[attribute];__record.commit()}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_perform_task,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"mailAccountContent",iwa:"READ_WRITE",action:action};var object={};object.email=selection.email;object[attribute]=!selection[attribute];params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",params:params,method:"POST",scope:this,success:fnSuccess,failure:function(result,request){}})},_fnHandlerUpdateAlias:function(action,attribute){var __grid=Ext.getCmp("emailMessageId");var __record=__grid.getSelectionModel().getSelections()[0];var selection=__record.data;var fnSuccess=function(response,options){var data=eval("("+response.responseText+")");if(data.success){var __indexRecord=__grid.store.indexOf(__record);__grid.store.remove(__record);__record.data[attribute]=!__record.data[attribute];__grid.store.insert(__indexRecord,__record)}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_perform_task,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"mailAliasContent",iwa:"READ_WRITE",action:action};var object={};object.email=selection.email;object[attribute]=!selection[attribute];params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",params:params,method:"POST",scope:this,success:fnSuccess,failure:function(result,request){}})},doAction:function(c,e){var d=Ext.getCmp("main-tabs");c.stopEvent();var b=d.getActiveTab(),a=b.getId()||null;if(a!=null&&a=="main-newdocin"){b.doAction(c,e)}else{if(this.actions!==undefined&&e.id!=undefined&&e.id!=""){this.actions[e.id]()}}},onDeleteMail:function(){var __grid=Ext.getCmp("emailMessageId");var __record=__grid.getSelectionModel().getSelections()[0];var selection=__record.data;if(selection!=null){agree=function(answer){if(answer=="yes"||answer=="ok"){fnSuccess=function(response,options){var result=eval("("+response.responseText+")");if(result.success){__grid.store.remove(__record)}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_delete_mail,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"mailAccountContent",iwa:"READ_WRITE",action:"delete"};var object={};object.email=selection.id;params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",params:params,scope:this,method:"POST",success:fnSuccess})}}}Ext.MessageBox.confirm(iwebos.message.mail.error,iwebos.message.mail.confirm_delete_account_mail,agree)},onDeleteAlias:function(){var __grid=Ext.getCmp("emailMessageId");var __record=__grid.getSelectionModel().getSelections()[0];var selection=__record.data;if(selection!=null){agree=function(answer){if(answer=="yes"||answer=="ok"){fnSuccess=function(response,options){var result=eval("("+response.responseText+")");if(result.success){__grid.store.remove(__record)}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_delete_alias,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"mailAliasContent",iwa:"READ_WRITE",action:"delete"};var object={};object.email=selection.id;params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",params:params,scope:this,method:"POST",success:fnSuccess})}}}Ext.MessageBox.confirm(iwebos.message.mail.error,iwebos.message.mail.confirm_delete_account_alias,agree)},onRequestSuccess:function(c,e){var a=Ext.util.JSON.decode(c.responseText);if(a.success){var f=e.removeItems;for(var d=0;d<f.length;d++){this.grid.store.remove(f[d])}}var b=Ext.getCmp("pro-in-task-action-id");if(!e.active){this.handlePanel(b,false,{id:e.params.doclistid})}else{this.handlePanel(b,true,{})}},onCellClick:function(a,d,b,c){a.getSelectionModel().selectRow(d)},onGridResize:function(a){Ext.EventManager.fireWindowResize()},setData:function(c,b,d){this.__owner.domain=c;this.adSearch.setData(c,d);var a=this.__owner.role||this._domainRole;if(a==this._superRole){this.__owner.edit=true}else{this.__owner.edit=b}}}); 
Ext.app.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){this._limit=0;Ext.app.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){this.onTrigger2Click()}},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,hasSearch:false,paramName:"key",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value="";var a={start:0};this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]="";this.store.reload({params:a});this.triggers[0].hide();this.hasSearch=false}},afterRender:function(){Ext.app.SearchField.superclass.afterRender.call(this);if(Ext.isIE&&/msie 8/.test(navigator.userAgent.toLowerCase())){this.el.setStyle("top","1px")}},setData:function(a){this.domain=a},setLimitSearchCharacter:function(a){this._limit=a},canSearch:function(){return(this.domain!=null&&this.domain!=undefined)}}); 
iNet.iwebos.ui.mail.Toolbar=Ext.extend(Ext.Panel,{initComponent:function(){this.toolbarSeach=new Ext.app.SearchField({width:250,onTrigger2Click:this.search,top:0});this.prefix=(!this.prefix)?"iwebos-as":this.prefix;this.id=this.nextId("cmb",6);var c=new Ext.data.SimpleStore({fields:["val","searchAction"],data:[["EMAIL",iwebos.message.mail.create.searching_mail],["ALIAS",iwebos.message.mail.create.searching_alias]]});var b=new Ext.form.ComboBox({id:"moreSearch",store:c,displayField:"searchAction",valueField:"val",value:"EMAIL",typeAhead:true,readOnly:true,mode:"local",triggerAction:"all",selectOnFocus:false});this.departmentStore=new Ext.data.JsonStore({root:"rows",fields:[{name:"depName",type:"string"}]});var a=new Ext.form.ComboBox({id:"departmentSearch",store:this.departmentStore,displayField:"depName",valueField:"depName",typeAhead:true,readOnly:true,mode:"local",triggerAction:"all",emptyText:"",selectOnFocus:false});var d=[this.toolbarSeach,a,b];if(this.store){this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.store,displayInfo:false});if(Ext.isGecko2){d[d.length]="-"}else{d[d.length]="->"}d[d.length]=this.pagingBar}this.tbar=d;iNet.iwebos.ui.mail.Toolbar.superclass.initComponent.call(this);this.addEvents("search");this.on("changemode",this.onChangeMode,this);this.on("afterlayout",this.onAfterLayout,this)},afterRender:function(){iNet.iwebos.ui.mail.Toolbar.superclass.afterRender.call(this)},onAfterLayout:function(a,b){},showDepartment:function(a){Ext.getCmp("departmentSearch").setVisible(a)},setData:function(d,h){this.toolbarSeach.setData(d);this.departmentStore.removeAll();var g;for(var b=0;b<h.length;b++){g=h[b];this.departmentStore.add(new Ext.data.Record({depName:g.name}))}this.departmentStore.sort("depName","ASC");this.departmentStore.suspendEvents();this.departmentStore.clearFilter();this.departmentStore.resumeEvents();if(h.length>0){Ext.getCmp("departmentSearch").setValue(h[0].name);var f=[];var a=this.toolbarSeach.getRawValue();f.push({key:"key",value:a});var c=Ext.getCmp("moreSearch").getValue();if("ALIAS"==c){f.push({key:"iwct",value:"searchMailAliasContent"})}else{f.push({key:"iwct",value:"searchMailAccountContent"})}var e=Ext.getCmp("departmentSearch").getValue();f.push({key:"group",value:e});this._fireEvent("search",f)}},_fireEvent:function(a,b){this.fireEvent(a,b)},search:function(){if(!this.canSearch()){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_select_domain_to_view,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var d=[];var a=this.getRawValue();d.push({key:"key",value:a});var b=Ext.getCmp("moreSearch").getValue();if("ALIAS"==b){d.push({key:"iwct",value:"searchMailAliasContent"})}else{d.push({key:"iwct",value:"searchMailAccountContent"})}var c=Ext.getCmp("departmentSearch").getValue();d.push({key:"group",value:c});this.fireEvent("search",d)},getDepartmentName:function(){return Ext.getCmp("departmentSearch").getValue()},getDepartments:function(){var c=this.departmentStore.getCount();var b=[];if(c>0){for(var a=0;a<c;a++){b[a]=this.departmentStore.getAt(a).data}}return b},nextId:function(e,a){var d=String(new Date().getTime()).substr(a);var c="abcdefghijklmnopqrstuvwxyz";for(var b=0;b<a;b++){d+=c.charAt(Math.floor(Math.random()*26))}return this.prefix+"-"+e+"-"+d+"-id"},_deleteEmail:function(){var a=Ext.getCmp("main-tabs");a.onDelete()}}); 
function printDMReport(){Ext.getCmp("report-mail-acc-tab").printDomainReport()}iNet.iwebos.ui.mail.ReportPanel=function(f,b){this.viewer=f;Ext.apply(this,b);this.prefix=(!this.prefix)?"report-mail-acc":this.prefix;this.tabId=this.prefix+"-tab";this.exportButtonId=this.prefix+"-export-button-id";this.exportExcelButtonId=this.prefix+"-export-excel-button-id";this.gridId=this.prefix+"-grid-id";this.statisticPanelId=this.prefix+"-statistic-view-id";this.pbar=null;var h=['<div style="font-size:13px;font-weight:bold;text-align:left;">',iwebos.message.mail.report_statistic_common_title,"</div>",'<table width="100%" border="0" cellspacing="0" cellpadding="0">',"<tr>",'<td align="left" width="175px">',iwebos.message.mail.report_total_domain,":</td>",'<td align="left">{domain}</td>','<td align="left" valign="center" width="175px" colspam="2"><img class="icon-printer" src="./images/s.gif"/>&nbsp;<a href="#" onclick="javascript:printDMReport()">',iwebos.message.mail.report_print,"</a></td>","</tr>","<tr>",'<td align="left" width="175px">',iwebos.message.mail.report_total_email,":</td>",'<td align="left">{emailnumber}</td>','<td align="left" width="175px">',iwebos.message.mail.report_total_alias,":</td>",'<td align="left">{aliasnumber}</td>',"</tr>","</table>","<br>",'<div style="font-size:13px;font-weight:bold;text-align:left;">',iwebos.message.mail.report_statistic_domain_title,"</div>"];this.template=new Ext.XTemplate(h.join(""),{});var e={domain:"",emailnumber:"",aliasnumber:""};var g=this.template.apply(e);var j=new Ext.Panel({id:this.statisticPanelId,region:"center",hidden:false,border:false,height:80,html:g});var a=new Ext.Panel({region:"north",anchor:"100%",border:false,hideBorders:true,labelWidth:150,height:80,layout:"border",items:[j]});var m={field:"text",direction:"ASC"};var d={field:"text",direction:"ASC"};var k=Ext.data.Record.create([{name:"text",mapping:"text",type:"string"},{name:"desc",mapping:"desc",type:"string"},{name:"tmail",mapping:"tmail",type:"int"},{name:"talias",mapping:"talias",type:"int"}]);var l=new Ext.data.JsonReader({id:"text"},k);var i=new Ext.grid.ColumnModel([{header:iwebos.message.mail.report_domain,dataIndex:"text",sortable:true,width:250,fixed:true},{header:iwebos.message.mail.report_domain_desc,dataIndex:"desc",sortable:true,width:300},{header:iwebos.message.mail.report_email,dataIndex:"tmail",width:140,sortable:true,fixed:true},{header:iwebos.message.mail.report_alias,dataIndex:"talias",width:140,sortable:true,fixed:true}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:this.gridId,region:"center",autoScroll:true,url:"jsonajax",method:"POST",loadFirst:false,reader:l,sortInfo:m,dsort:d,cm:i,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),filter:{data:"all"},tbar:[{id:this.exportButtonId,xtype:"button",iconCls:"icon-menu-report-preview",text:iwebos.message.mail.report_detail_button,disabled:true,scope:this,handler:this.fnLoadData.createDelegate(this)},{id:this.exportExcelButtonId,xtype:"button",iconCls:"icon-menu-excel",text:"Kết xuất dữ liệu",tooltip:"Kết xuất dữ liệu ra tập tin excel",disabled:true,scope:this,handler:this.fnExportData.createDelegate(this)}]});this.grid.on("rowcontextmenu",this._onRowContextMenu,this,{stopEvent:true});this.grid.on("contextmenu",this._onContextMenu,this,{stopEvent:true});this.grid.on("rowdblclick",this.fnLoadData,this);this.grid.selModel.on("selectionchange",function(o){var n=o.getSelections();if(n.length==1){Ext.getCmp(this.exportButtonId).enable();Ext.getCmp(this.exportExcelButtonId).enable()}else{Ext.getCmp(this.exportButtonId).disable();Ext.getCmp(this.exportExcelButtonId).disable()}},this);var c=new Ext.form.FormPanel({region:"center",frame:true,border:false,layout:"border",bodyStyle:"padding: 0px;",items:[a,this.grid]});c.on("resize",this.__fnResizePanel,this);iNet.iwebos.ui.mail.ReportPanel.superclass.constructor.call(this,{id:this.tabId,iconCls:"icon-menu-report",title:iwebos.message.mail.report_statistic_title,header:false,frame:false,enableTabScroll:true,autoScroll:true,border:false,closable:true,layout:"border",items:[c]});this.__fnLoad()};Ext.extend(iNet.iwebos.ui.mail.ReportPanel,Ext.Panel,{_onRowContextMenu:function(b,a,c){c.stopEvent()},_onContextMenu:function(a){a.stopEvent()},__fnResizePanel:function(){Ext.EventManager.fireWindowResize()},__fnLoad:function(){var a={fn:this.__fnStatistic,scope:this};var b=function(e,f){var d=Ext.util.JSON.decode(e.responseText);var g=(d.success==undefined)?true:d.success;if(g){if(d.length==0){}else{a.fn.apply(a.scope,[d,0])}}};var c={iwct:"loadMailDomainContent",iwa:"view",action:"loadAll"};iNet.Ajax.request({url:"jsonajax",params:c,method:"POST",success:b,failure:function(d,e){},maskEl:this.bwrap})},__fnStatistic:function(i,b){var e=this.grid.store;var f={fn:this.__fnStatistic,scope:this};var h={fn:this.__computeData,scope:this};var a=function(k,l){var j=Ext.util.JSON.decode(k.responseText);var n=(j.success==undefined)?true:j.success;if(j.length>0){var m=new Ext.LoadMask(h.scope.bwrap,{msg:Ext.LoadMask.prototype.msg});m.show();e.loadData(j,true);m.hide();b=b+iNet.INET_REPORT_DOMAIN_LIMIT;if(b<i.length){f.fn.apply(f.scope,[i,b])}else{h.fn.apply(h.scope,[]);e.sort("text","ASC")}}};var d={iwct:"mailDomainContent",iwa:"view",action:"report"};var g="";for(var c=0;c<iNet.INET_REPORT_DOMAIN_LIMIT&&(b+c)<i.length;c++){g=g+i[b+c].id+";"}g.substr(0,g.length-1);d.domains=g;iNet.Ajax.request({url:"jsonajax",params:d,method:"POST",success:a,failure:function(j,k){},maskEl:this.bwrap})},__computeData:function(){var g=this.grid.store.getCount();var e=0;var f=0;var d;for(var c=0;c<g;c++){d=this.grid.store.getAt(c);e=e+d.data.tmail;f=f+d.data.talias}var a={domain:g,emailnumber:e,aliasnumber:f};var b=Ext.getCmp(this.statisticPanelId);this.template.overwrite(b.body,a)},fnLoadData:function(){var e=this.grid.getSelectionModel().getSelections();if(e==null||e.length==0){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.report_select_domain,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var a=e[0].data;var d={};d.domain=a.text;d.desc=a.desc;d.emailnumber=a.tmail;d.aliasnumber=a.talias;var b=new Ext.data.JsonStore({fields:[{name:"email",mapping:"email",type:"string"},{name:"displayname",mapping:"displayname",type:"string"},{name:"capicity",mapping:"capacity",type:"int"}]});var f=new Ext.data.JsonStore({fields:[{name:"email",mapping:"email",type:"string"},{name:"displayname",mapping:"displayname",type:"string"}]});d.emailStore=b;d.aliasStore=f;var i=iNet.INET_REPORT_ACCOUNT_LIMIT;var c=0;var g={iwct:"reportMailAccountContent",iwa:"view",action:"search",key:""};g.domain=d.domain;g.limit=i;var h={iwct:"reportMailAliasAjaxContent",iwa:"view",action:"search",key:""};h.domain=d.domain;h.limit=i;this.__fnLoadMailAcc(g,h,c,d)},fnExportData:function(a){var b=this.grid.getSelectionModel().getSelected();var c=function(f,g){var e=Ext.util.JSON.decode(f.responseText);if(!!e&&!!e.success){this.fnPrepareData(e.key)}else{}};var d={iwct:"mailExportContent",iwa:"view",action:"read",id:b.data.text};iNet.Ajax.request({url:"jsonajax",params:d,method:"POST",success:c,failure:function(e,f){},maskEl:this.bwrap,scope:this})},fnPrepareData:function(a){var b=function(e,f){var d=Ext.util.JSON.decode(e.responseText);if(!!d&&d.success!=false){if(!!d.COMPLETE){this.fnDownloadExportData(a)}else{this.fnPrepareData(a)}}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:"Có lỗi xảy ra trong quá trình kết xuất tài khoản email.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var c={iwct:"mailExportContent",iwa:"view",action:"export",key:a};iNet.Ajax.request({url:"jsonajax",params:c,method:"POST",success:b,failure:function(d,e){},maskEl:this.bwrap,scope:this})},fnDownloadExportData:function(a){var b=this.grid.getSelectionModel().getSelections();if(b==null||b.length==0){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.report_select_domain,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var c=document.getElementById("viewdownload_");c.action="export-email-file";c.id.value=a;c.target="ViewDocument";c.bean.value="exportEmailBean";c.submit()},__fnLoadMailAcc:function(f,e,h,c){var d=new Ext.LoadMask(this.body,{msg:Ext.LoadMask.prototype.msg});var g=function(m){var l=['<div style="font-size:16px;font-weight:bold;text-align:center;">',iwebos.message.mail.report_list_account,"</div>",'<table width="100%" border="0" cellspacing="0" cellpadding="0">',"<tr>",'<td align="left" valign="top" width="20%">',iwebos.message.mail.report_domain,":</td>",'<td align="left" valign="top" width="30%">{domain}</td>','<td align="left" valign="top" width="20%">',iwebos.message.mail.report_domain_desc,":</td>",'<td align="left" valign="top" width="30%">{desc}</td>',"</tr>","<tr>",'<td align="left" width="20%">',iwebos.message.mail.report_email,":</td>",'<td align="left" width="30%">{emailnumber}</td>','<td align="left" width="20%">',iwebos.message.mail.report_alias,":</td>",'<td align="left" width="30%">{aliasnumber}</td>',"</tr>","</table>","<br>",'<table width="100%"  border="0" cellspacing="0" cellpadding="0">',"<tr>",'<td align="left"><b>',iwebos.message.mail.report_email,"</b><br></td>","</tr>","<tr>",'<td align="left">','<table width="100%" border="0" cellspacing="0" cellpadding="2" class="main">',"<tr>",'<td class="docin-main-head" width=50px>STT</td>','<td class="docin-main-head">',iwebos.message.mail.mail_account,"</td>",'<td class="docin-main-head">',iwebos.message.mail.fullname,"</td>",'<td class="docin-main-head">',iwebos.message.mail.create.sizelimit,"</td>","</tr>",'<tpl for="account">',"<tr>",'<td align="left">{#}</td>','<td align="left">{[this.getEmail(values.data)]}</td>','<td align="left">{[this.getName(values.data)]}</td>','<td align="left">{[this.getCapicity(values.data)]}</td>',"</tr>","</tpl>","</table>","</td>","</tr>","</table>","<br>",'<table width="100%"  border="0" cellspacing="0" cellpadding="0" >',"<tr>",'<td align="left"><b>',iwebos.message.mail.report_alias,"</b><br></td>","</tr>","<tr>",'<td align="left">','<table width="100%"  border="0" cellspacing="0" cellpadding="2" class="main">',"<tr>",'<td class="docin-main-head" width=50px>',iwebos.message.mail.report_order_number,"</td>",'<td class="docin-main-head">',iwebos.message.mail.mail_account,"</td>",'<td class="docin-main-head">',iwebos.message.mail.fullname,"</td>","</tr>",'<tpl for="alias">',"<tr>",'<td align="left">{#}</td>','<td align="left">{[this.getEmail(values.data)]}</td>','<td align="left">{[this.getName(values.data)]}</td>',"</tr>","</tpl>","</table>","</td>","</tr>","</table>"];var k=new Ext.XTemplate(l.join(""),{getEmail:function(n){return n.email},getName:function(n){return n.displayname},getCapicity:function(n){return n.capicity}});var j=k.apply(m);var i=new iNet.iwebos.ui.common.dialog.Dialog({width:750,height:450,autoScroll:true,bodyStyle:"padding: 5px;",enableTabScroll:true,maximizable:true,title:iwebos.message.mail.report_list_account_title,tools:[{id:"print",qtip:iwebos.message.mail.report_print_tooltip,handler:function(q,p,n){var o=window.open("","printReport");o.document.write("<head>");o.document.write("<title>",iwebos.message.mail.report_list_account_title,"</title>");o.document.write('<link rel="stylesheet" type="text/css" href="js/ext/resources/css/ext-all.css" />');o.document.write('<link rel="stylesheet" type="text/css" href="js/ext/resources/css/extjs.css" />');o.document.write('<link rel="stylesheet" type="text/css" href="css/paperwork.css" />');o.document.write("</head>");o.document.write("<html><body>");o.document.write(j);o.document.write("</body></html>");o.document.close();o.print()}}],html:j});i.show();d.hide()};__fnLoadAliasSuccess=function(k,l){var i=Ext.util.JSON.decode(k.responseText);var m=(i.success==undefined)?true:i.success;if(m){var j=i.rows;if(j!=null&&j.length!=0){c.aliasStore.loadData(j,true)}h=h+f.limit;if(h<c.aliasnumber){b(e,h,c)}else{c.emailStore.sort("email","ASC");c.aliasStore.sort("email","ASC");c.account=c.emailStore.data.items;c.alias=c.aliasStore.data.items;g(c)}}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.report_loading_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});d.hide();return}};var a={fn:this.__fnLoadMailAcc,scope:this};var b=function(j,k,i){j.start=k;iNet.Ajax.request({url:"jsonajax",params:j,method:"POST",success:__fnLoadAliasSuccess,failure:function(l,m){d.hide()}})};__fnLoadMailSuccess=function(k,l){var i=Ext.util.JSON.decode(k.responseText);var m=(i.success==undefined)?true:i.success;if(m){var j=i.rows;if(j!=null&&j.length!=0){c.emailStore.loadData(j,true)}h=h+f.limit;if(h<c.emailnumber){a.fn.apply(a.scope,[f,e,h,c])}else{h=0;b(e,h,c)}}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.report_loading_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});d.hide();return}};f.start=h;iNet.Ajax.request({url:"jsonajax",params:f,method:"POST",success:__fnLoadMailSuccess,failure:function(i,j){d.hide()}});d.show()},_getData:function(){var d={};var b=this.grid.store.data.items;if(b==undefined&&b.length==0){d.domainnumber=0;d.emailnumber=0;d.aliasnumber=0;d.domains=[];return d}var g=0,a=0;var f=[];var e;for(var c=0;c<b.length;c++){e=b[c].data;f[c]=e;g+=e.tmail;a+=e.talias}d.domainnumber=b.length;d.emailnumber=g;d.aliasnumber=a;d.domains=f;return d},printDomainReport:function(){var b=['<div style="font-size:16px;font-weight:bold;text-align:center;">',iwebos.message.mail.report_statistic_system_title,"</div>",'<table width="100%" border="0" cellspacing="0" cellpadding="0">',"<tr>",'<td align="left" width="175px">',iwebos.message.mail.report_total_domain,":</td>",'<td align="left" colspam="3">{domainnumber}</td>',"</tr>","<tr>",'<td align="left" width="175px">',iwebos.message.mail.report_total_email,":</td>",'<td align="left">{emailnumber}</td>','<td align="left" width="175px">',iwebos.message.mail.report_total_alias,":</td>",'<td align="left">{aliasnumber}</td>',"</tr>","</table>","<br>",'<div style="font-size:13px;font-weight:bold;text-align:left;">',iwebos.message.mail.report_statistic_domain_title,"</div>",'<table width="100%" border="0" cellspacing="0" cellpadding="2" class="main">',"<tr>",'<td class="docin-main-head" width="4%">',iwebos.message.mail.report_order_number,"</td>",'<td class="docin-main-head" width="30%">',iwebos.message.mail.report_domain,"</td>",'<td class="docin-main-head" width="40%">',iwebos.message.mail.report_domain_desc,"</td>",'<td class="docin-main-head" width="13%">',iwebos.message.mail.report_email,"</td>",'<td class="docin-main-head" width="13%">',iwebos.message.mail.report_alias,"</td>","</tr>",'<tpl for="domains">',"<tr>",'<td align="left" valign="top" width="4%">{#}</td>','<td align="left" valign="top" width="30%">{text}</td>','<td align="left" valign="top" width="40%">{[this.getValue(values.desc)]}</td>','<td align="left" valign="top" width="13%">{tmail}</td>','<td align="left" valign="top" width="13%">{talias}</td>',"</tr>","</tpl>","</table>"];var c=new Ext.XTemplate(b.join(""),{getValue:function(e){if(e==""){return"&nbsp;"}return e}});var d=c.apply(this._getData());var a=window.open("","printDMReport");a.document.write("<head>");a.document.write("<title>",iwebos.message.mail.report_statistic_system_title,"</title>");a.document.write('<link rel="stylesheet" type="text/css" href="js/ext/resources/css/ext-all.css" />');a.document.write('<link rel="stylesheet" type="text/css" href="js/ext/resources/css/extjs.css" />');a.document.write('<link rel="stylesheet" type="text/css" href="css/paperwork.css" />');a.document.write("</head>");a.document.write("<html><body>");a.document.write(d);a.document.write("</body></html>");a.document.close();a.print()}}); 
iNet.iwebos.ui.mail.ImportPanel=function(d,b){this.viewer=d;Ext.apply(this,b);this.prefix=(!this.prefix)?"import-mail-acc":this.prefix;this.tabId=this.prefix+"-tab";this.exportButtonId=this.prefix+"-export-button-id";this.exportExcelButtonId=this.prefix+"-export-excel-button-id";this.gridId=this.prefix+"-grid-id";this.statisticPanelId=this.prefix+"-statistic-view-id";this.key="";this.org=b.org;var f=['<div style="font-size:13px;font-weight:bold;text-align:left;">',"Kết nhập dữ liệu: {total} tài khoản","</div>",'<table width="100%" border="0" cellspacing="0" cellpadding="0" style="margin-left:15px;">',"<tr>",'<td align="left" width="110px">',"Tài khoản mới",":</td>",'<td align="left">{newuser}</td>','<td align="left" width="220px">',"Tài khoản đã tồn tại người dùng",":</td>",'<td align="left">{existuser}</td>',"</tr>","<tr>",'<td align="left" width="110px">',"Tài khoản lỗi",":</td>",'<td align="left">{error}</td>','<td align="left" width="220px">',"Tài khoản đã tồn tại",":</td>",'<td align="left">{exist}</td>',"</tr>","<tr>",'<td align="left" width="110px">',"Tài khoản bị trùng",":</td>",'<td align="left">{duplicate}</td>','<td align="left" width="220px"></td><td align="left"></td>',"	</tr>","</table>","<br>",'<div style="font-size:13px;font-weight:bold;text-align:left;">',"Tài khoản bị trùng,bị lỗi","</div>"];this.template=new Ext.XTemplate(f.join(""),{});this.data={total:0,existuser:0,newuser:0,exist:0,error:0,duplicate:0};var e=this.template.apply(this.data);var h=new Ext.Panel({id:this.statisticPanelId,region:"center",hidden:false,border:false,height:110,html:e});var a=new Ext.Panel({region:"north",anchor:"100%",border:false,frame:true,hideBorders:true,labelWidth:150,height:110,layout:"border",items:[h]});var k={field:"number",direction:"ASC"};var c={field:"number",direction:"ASC"};var i=Ext.data.Record.create([{name:"number",mapping:"number",type:"string"},{name:"fullname",mapping:"fullname",type:"string"},{name:"id",mapping:"id",type:"string"},{name:"status",mapping:"status",type:"int"},{name:"duplicate",mapping:"duplicate",type:"string"}]);var j=new Ext.data.JsonReader({id:"STT"},i);var g=new Ext.grid.ColumnModel([{header:"STT",dataIndex:"number",sortable:true,width:50,fixed:true},{header:"Họ và tên",dataIndex:"fullname",sortable:true,width:300},{header:"Email",dataIndex:"id",width:200,sortable:true,fixed:true},{header:"Tình trạng",dataIndex:"status",width:200,sortable:true,fixed:true,renderer:function(l){if(l==1){return"Tồn tại người dùng"}else{if(l==2){return"Tồn tại người dùng và email"}else{if(l==3){return"Không kết nhập được"}else{if(l==4){return"Trùng lặp tài khoản"}}}}}},{header:"Tài khoản trùng với",dataIndex:"duplicate",width:250,sortable:true,fixed:true}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:this.gridId,region:"center",autoScroll:true,url:"jsonajax",method:"POST",loadFirst:false,reader:j,sortInfo:k,dsort:c,cm:g,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),filter:{data:"all"},tbar:[{id:this.exportExcelButtonId,xtype:"button",iconCls:"icon-menu-excel",text:"Kết xuất dữ liệu",tooltip:"Kết xuất dữ liệu ra tập tin excel",scope:this,disabled:true,handler:this.onExportEmail.createDelegate(this)}]});this.grid.on("rowcontextmenu",this._onRowContextMenu,this,{stopEvent:true});this.grid.on("contextmenu",this._onContextMenu,this,{stopEvent:true});this.grid.store.on("load",function(l){if(l.getCount()>0){Ext.getCmp(this.exportExcelButtonId).setDisabled(false)}else{Ext.getCmp(this.exportExcelButtonId).setDisabled(true)}},this,{stopEvent:true});iNet.iwebos.ui.mail.ReportPanel.superclass.constructor.call(this,{id:this.tabId,iconCls:"icon-menu-import",title:"Kết nhập tài khoản email tên miền - "+this.org,header:false,frame:false,enableTabScroll:true,autoScroll:true,border:false,closable:true,layout:"border",items:[a,this.grid],tbar:[{xtype:"button",iconCls:"icon-menu-import",text:"Kết nhập dữ liệu",tooltip:"Kết nhập dữ liệu từ tập tin excel",scope:this,handler:this.fnUploadData.createDelegate(this)},"-",{xtype:"button",iconCls:"icon-menu-download",text:"Tải mẫu",tooltip:"Tải mẫu danh sách thông tin người dùng cần kết nhập",scope:this,handler:this.onDownload.createDelegate(this)}]})};Ext.extend(iNet.iwebos.ui.mail.ImportPanel,Ext.Panel,{_onRowContextMenu:function(b,a,c){c.stopEvent()},_onContextMenu:function(a){a.stopEvent()},__fnResizePanel:function(){Ext.EventManager.fireWindowResize()},_fnComputeData:function(f,a){var b=0,d=0,h=0,g=0;var e;for(var c=0;c<f.length;c++){e=f[c].status;if(e==1){h++}else{if(e==2){d++}else{if(e==3){b++}else{if(e==4){g++}}}}}this.data.existuser=this.data.existuser+h;this.data.exist=this.data.exist+d;this.data.error=this.data.error+b;this.data.duplicate=this.data.duplicate+g;this.data.newuser=this.data.newuser+(a-b-d-h-g)},fnExportData:function(){var a=this.grid.getSelectionModel().getSelections();if(a==null||a.length==0){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.report_select_domain,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var b=document.getElementById("viewdownload_");b.action="export-email-file";b.id.value=__selection.text;b.target="ViewDocument";b.bean.value="exportEmailBean";b.submit()},fnUploadData:function(){if(!this.udialog){this.udialog=new Ext.ux.UploadDialog.Dialog({url:"mail-upload-file",reset_on_hide:false,allow_close_on_upload:true,upload_autostart:false,permitted_extensions:["xls"],post_var_name:"upload"});this.udialog.on("uploadsuccess",this.onUploadSuccess,this)}this.udialog.show(this)},onUploadSuccess:function(g,a,d,e){if(d.success){var h=d.files;var i="";var b=null,c=null;for(var f=0;f<h.length;f++){b=h[f];this.data={total:0,existuser:0,newuser:0,exist:0,error:0,duplicate:0};this.grid.store.removeAll();this._fnReadData(b.file)}this.udialog.hide()}},_fnReadData:function(c){var a=this.grid.store;var d=function(g,h){var e=Ext.util.JSON.decode(g.responseText);var i=(e.success==undefined)?true:e.success;if(i){this.data.total=e.total;var f=Ext.getCmp(this.statisticPanelId);this.template.overwrite(f.body,this.data);this._fnImportData(e.key,0,5,e.total);this.key=e.key}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:"Nội dung tập tin kết nhập không đúng cú pháp.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var b={iwct:"mailImportContent",iwa:"write",action:"read",key:c,org:this.org};iNet.Ajax.request({url:"jsonajax",params:b,method:"POST",scope:this,success:d,failure:function(e,f){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:"Nội dung tập tin kết nhập không đúng cú pháp.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})},maskEl:this.bwrap})},_fnImportData:function(c,f,a,d){if(f>=d){return}var e=function(j,k){var h=Ext.util.JSON.decode(j.responseText);var l=(h.success==undefined)?true:h.success;if(l){this.grid.store.loadData(h.rows,true);this._fnComputeData(h.rows,a);var i=Ext.getCmp(this.statisticPanelId);this.template.overwrite(i.body,this.data);var m=f+a;var g=((m+a)>d)?(d-m):a;this._fnImportData(c,m,g,d)}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:"Quá trình kết nhập không thành công.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var b={iwct:"mailImportContent",iwa:"write",action:"import",key:c,start:f,limit:a};iNet.Ajax.request({url:"jsonajax",params:b,method:"POST",scope:this,success:e,failure:function(g,h){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:"Quá trình kết nhập không thành công.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})},maskEl:this.bwrap})},onExportEmail:function(){var a=document.getElementById("viewdownload_");a.action="export-error-account";a.id.value=this.key;a.target="ViewDocument";a.bean.value="exportErrorBean";a.submit()},onDownload:function(){location.href="/data/import_template.xls"}}); 
iNet.iwebos.ui.mail.ToolbarSearchAccount=Ext.extend(Ext.Panel,{initComponent:function(){this.toolbarSeach=new Ext.app.SearchField({width:200,onTrigger2Click:this.search});this.prefix=(!this.prefix)?"mail-search":this.prefix;this.id=this.nextId("cmb",1);this.deleteChk=new Ext.form.Checkbox({id:"toolbar-search-account-deleted-id",boxLabel:"Tài khoản đã bị xoá",checked:false,disabled:true});var a=[this.toolbarSeach," ",this.deleteChk];if(this.store){this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.store,displayInfo:false});if(Ext.isGecko2){a[a.length]="-"}else{a[a.length]="->"}a[a.length]=this.pagingBar}this.tbar=a;iNet.iwebos.ui.mail.ToolbarSearchAccount.superclass.initComponent.call(this)},search:function(){var b=[];var a=this.getRawValue()||"";if(a.length<this._limit){Ext.MessageBox.show({title:iwebos.message.account.infomationMessage,msg:iwebos.message.mail.error_input_search_key_first+this._limit+iwebos.message.mail.error_input_search_key_second,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});return}b.push({key:"deleted",value:Ext.getCmp("toolbar-search-account-deleted-id").getValue()});b.push({key:"key",value:a});this.fireEvent("search",b)},setLimitSearchCharacter:function(a){this.toolbarSeach.setLimitSearchCharacter(a)},nextId:function(e,a){var d=String(new Date().getTime()).substr(a);var c="abcdefghijklmnopqrstuvwxyz";for(var b=0;b<a;b++){d+=c.charAt(Math.floor(Math.random()*26))}return this.prefix+"-"+e+"-"+d+"-id"}}); 
iNet.iwebos.ui.mail.TreeMailbox=function(){var a={iwct:"loadMailDomainContent",iwa:"view",action:"loadAll"};this.__owner={load:false};this.treeroot=new Ext.tree.AsyncTreeNode({text:iwebos.message.mail.create.domains,iconCls:"icon-email-treeview",draggable:false,expanded:true,id:-1});iNet.iwebos.ui.mail.TreeMailbox.superclass.constructor.call(this,{id:"domain-id",region:"center",border:true,frame:false,useArrows:true,animate:true,enableDD:true,width:"100%",draggable:false,loader:new iNet.iwebos.ui.common.tree.TreeLoaderWrapper({dataUrl:"jsonajax",baseParams:a}),root:this.treeroot});this.treesort=new Ext.tree.TreeSorter(this,{folderSort:true,dir:"asc",property:"text"});this.getSelectionModel().on({beforeselect:function(c,b){return b.id!="-1"},selectionchange:this.loadmail.createDelegate(this)});this.treeroot.on("contextmenu",function(b){b.stopEvent()},this,{stopEvent:true});this.on("contextmenu",this.onTreeContextClick,this);this.on("dblclick",this.onDoubleClick,this);this.on("load",function(b){if(!b){return}b.sort(function(e,d){return e.text>d.text});var c=b.firstChild;if(c){c.ensureVisible();c.select()}},this)};Ext.extend(iNet.iwebos.ui.mail.TreeMailbox,Ext.tree.TreePanel,{init:function(){this.render();this.root.expand()},treeResize:function(){var a=false;var c=Ext.getCmp("domain-id");a=c.__owner.load;c=Ext.getCmp("action-panel");var d=c.getSize().height;c=Ext.getCmp("mail-panel-action-id");var b=c.getSize().height;c=Ext.getCmp("tree-mailbox-panel");if(a){c.setHeight(d-b)}else{c.setHeight(d-b-50);c=Ext.getCmp("domain-id");c.__owner.load=true}Ext.EventManager.fireWindowResize()},afterRender:function(){iNet.iwebos.ui.mail.TreeMailbox.superclass.afterRender.call(this);this.treeResize();var a=Ext.getCmp("main-tabs");a.on("resize",this.treeResize,this)},loadmail:function(d,c){if(c){var b=function(f,g){var e=Ext.util.JSON.decode(f.responseText);var h=(e.success==undefined)?true:e.success;if(h){c.attributes.role=e.role;c.attributes.departments=e.list;this._fillDomainInfo(c,e.list)}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_group_load_all_group_in_org,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};if(!c.attributes.role||c.attributes.role==undefined){var a={iwct:"loadGroupContent",iwa:"READ_WRITE",action:"loadall"};a.org=c.id;iNet.Ajax.request({url:"jsonajax",params:a,scope:this,method:"POST",success:b})}else{this._fillDomainInfo(c,c.attributes.departments)}}},_fillDomainInfo:function(c,e){var b=Ext.getCmp("main-tabs");var a=b.grid.store;var d=a.baseParams;d.domain=c.id;a.baseParams=d;b.setData(c.id,c.attributes.edit,e);b.setActiveTab(0)},setEditDomain:function(a){this.edit=a},onTreeContextClick:function(a,b){a.select();b.stopEvent();if(this.edit){if(!this.menu){this.menu=new Ext.menu.Menu({id:"tree-ctx",items:[{id:"doman-update",text:iwebos.message.mail.update_domain,iconCls:"icon-mail-update",scope:this,handler:this.updateDomain},{id:"domain-active-menu",text:iwebos.message.mail.active_domain,scope:this,handler:this.activeDomain},{id:"domain-delete",text:iwebos.message.mail.delete_domain,iconCls:"icon-mail-del",scope:this,handler:this.deleteDomain},"-",{id:"domain-export-address-book",text:"Xuất sổ địa chỉ",iconCls:"icon-menu-export",scope:this,handler:this.onExportUnicode},{id:"domain-export-address-book-nonutf8",text:"Xuất sổ địa chỉ không dấu",iconCls:"icon-menu-export-non-utf",scope:this,handler:this.onExportNonUnicode},"-",{id:"domain-standardized",text:"Chuẩn hóa tên người dùng",iconCls:"icon-menu-standardized",scope:this,handler:this.onStandardized},{id:"domain-import",text:"Kết nhập tài khoản",iconCls:"icon-menu-import",scope:this,handler:this.onImport}]})}this.setEnableMenu(a)}else{if(!this.menu){this.menu=new Ext.menu.Menu({id:"tree-ctx",items:[{id:"domain-export-address-book",text:"Xuất sổ địa chỉ",iconCls:"icon-menu-export",scope:this,handler:this.onExportUnicode},{id:"domain-export-address-book-nonutf8",text:"Xuất sổ địa chỉ không dấu",iconCls:"icon-menu-export-non-utf",scope:this,handler:this.onExportNonUnicode},"-",{id:"domain-standardized",text:"Chuẩn hóa tên người dùng",iconCls:"icon-menu-standardized",scope:this,handler:this.onStandardized},{id:"domain-import",text:"Kết nhập tài khoản",iconCls:"icon-menu-import",scope:this,handler:this.onImport}]})}}this.menu.showAt(b.getXY())},setEnableMenu:function(a){var b=this.menu.items.get("domain-active-menu");b.setText(a.attributes.active==true?iwebos.message.mail.inactive_domain:iwebos.message.mail.active_domain);b.setIconClass(a.attributes.active==true?"icon-email-false":"icon-email-true")},insertNode:function(a){this.treeroot.appendChild(a)},__onSave:function(object){var params={iwct:"mailDomainContent",iwa:"READ_WRITE",action:"save"};params.object=Ext.util.JSON.encode(object);var action=(object.id==null)?"save":"update";params.action=action;fnSuccess=function(response,options){var result=eval("("+response.responseText+")");if(result.success){if(!object.id){var node=new Ext.tree.TreeNode({text:object.text,draggable:false,expanded:false,id:object.text,iconCls:"icon-email-treeview-br",cls:"email-treeview-text",leaf:true});this.insertNode(node)}}else{if(!object.id){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_create_domain,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_update_domain,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}};iNet.Ajax.request({url:"jsonajax",params:params,scope:this,method:"POST",success:fnSuccess})},activeDomain:function(){var node=this.getFirstSelection();if(node!=null){fnSuccess=function(response,options){var result=eval("("+response.responseText+")");if(result.success){node.attributes.active=!node.attributes.active}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_update_data,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"mailDomainContent",iwa:"READ_WRITE",action:"active"};var object={};object.text=node.id;object.active=!node.attributes.active;params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",params:params,scope:this,method:"POST",success:fnSuccess})}},getFirstSelection:function(){return this.getSelectionModel().getSelectedNode()},deleteDomain:function(){var node=this.getFirstSelection();if(node!=null){agree=function(answer){if(answer=="yes"||answer=="ok"){fnSuccess=function(response,options){var result=eval("("+response.responseText+")");if(result.success){this.treeroot.removeChild(node);var __mainTab=Ext.getCmp("main-tabs");var __store=__mainTab.grid.store;__store.removeAll()}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:iwebos.message.mail.error_delete_domain,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"mailDomainContent",iwa:"READ_WRITE",action:"delete"};var object={};object.text=node.id;params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",params:params,scope:this,method:"POST",success:fnSuccess})}};Ext.Msg.confirm(iwebos.message.mail.create.delete_domain_title,iwebos.message.mail.create.warning_delele_domain,agree,this)}},updateDomain:function(){var a=this.getFirstSelection();if(a!=null){this.openUpdateDialog(a.id)}},openUpdateDialog:function(c){var a=new iNet.iwebos.ui.mail.DialogCreateDomain();var b={save:{fn:this.__onSave,scope:this}};a.setData(c,b);a.show(this)},onDoubleClick:function(b,a){a.stopEvent();if(!this.edit){return}this.openUpdateDialog(b.id)},onExportUnicode:function(){this.onExport("unicode")},onExportNonUnicode:function(){this.onExport("nonunicode")},onExport:function(a){var d=this.getFirstSelection();if(d!=undefined&&d!=null){var b=d.attributes.text;var c=document.getElementById("viewdownload_");c.action="exportab-download-file";c.id.value=b;c.encode.value=a;c.type.value="ORIGINAL";c.style.value="view";c.target="ViewDocument";c.bean.value="addressBookBean";c.submit()}},onStandardized:function(){var c=this.getFirstSelection();if(c!=undefined&&c!=null){var a=Ext.getCmp("main-tabs");var b=a.grid.bwrap;this._fnStandardized(c.id,0,50,b)}},_fnStandardized:function(b,e,a,d){fnSuccess=function(g,h){var f=Ext.util.JSON.decode(g.responseText);if(!f.success){Ext.MessageBox.show({title:iwebos.message.mail.error,msg:"Có lỗi xảy ra trong quá trình chuẩn hóa",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{if(f.total>(e+a)){this._fnStandardized(b,e+a,a,d)}else{Ext.MessageBox.show({title:iwebos.message.mail.error,msg:"Quá trình chuẩn hóa <strong>"+f.total+"</strong> tài khoản đã thành công",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}}};var c={iwct:"standardizedContent",iwa:"READ_WRITE",action:"active",domain:b,start:e,limit:a};iNet.Ajax.request({url:"jsonajax",params:c,scope:this,method:"POST",success:fnSuccess,maskEl:d})},onImport:function(){var c=this.getFirstSelection();if(c!=undefined&&c!=null){var b=Ext.getCmp("main-tabs");var a=Ext.getCmp("import-mail-acc-tab");if(!a){a=new iNet.iwebos.ui.mail.ImportPanel(this,{org:c.id});b.add(a).show()}b.setActiveTab(a)}}}); 
iNet.iwebos.ui.org.UserPanel=function(e,a){this.viewer=e;Ext.apply(this,a);this.prefix=(!this.prefix)?"manage-user-search":this.prefix;this.mainId=this.prefix+"-main-tab";this.mainContendId=this.prefix+"-main-contend";this.toolbarId=this.prefix+"-toolbar";this.gridId=this.prefix+"-grid";this._owner={};var i={field:"fullname",direction:"ASC"};var c={field:"fullname",direction:"ASC"};var d={iwct:"searchUserContent",iwa:"view",action:"search"};var g=Ext.data.Record.create([{name:"id",mapping:"uname",type:"string"},{name:"uname",mapping:"uname",type:"string"},{name:"fullname",mapping:"fullname",type:"string"},{name:"title",mapping:"title",type:"string"},{name:"email",mapping:"email",type:"string"}]);var h=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"uname"},g);var f=new Ext.grid.ColumnModel([{header:iwebos.message.org.user_account,dataIndex:"uname",sortable:true,width:0.2},{header:iwebos.message.org.user_full_name,dataIndex:"fullname",sortable:true,width:0.3},{header:iwebos.message.org.user_title,dataIndex:"title",sortable:true,width:0.2},{header:iwebos.message.org.user_alternate_email,dataIndex:"email",sortable:true,width:0.3}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:this.gridId,region:"center",autoScroll:true,url:"jsonajax",method:"POST",baseParams:d,loadFirst:false,reader:h,sortInfo:i,dsort:c,cm:f,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),filter:{data:"all"},view:new Ext.grid.GridView({forceFit:true})});this.toolbar=new iNet.iwebos.ui.org.SearchUserToolbar({id:this.toolbarId,region:"north",width:"100%",height:30,frame:false,border:false,store:this.grid.store});this.toolbar.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});var b=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[this.toolbar,this.grid]});b.on("resize",this._fnResize,this);this.grid.on("rowcontextmenu",this._onRowContext,this);this.grid.on("contextmenu",this._onContextMenu,this);this.grid.on("rowdblclick",this._onDoubleClick,this);this.actions={"user-create-new":this._onAddUser.createDelegate(this),"group-management":this._onManageGroup.createDelegate(this),"view-lotus-account":this._viewLotusAccount.createDelegate(this)};iNet.iwebos.ui.org.UserPanel.superclass.constructor.call(this,{id:this.mainId,activeTab:0,region:"center",width:"100%",enableTabScroll:true,autoScroll:true,frame:false,border:false,items:{id:this.mainContendId,title:iwebos.message.org.user_in_org,iconCls:"icon-mail-home",layout:"border",hideMode:"offsets",items:[b]}})};Ext.extend(iNet.iwebos.ui.org.UserPanel,Ext.TabPanel,{_viewLotusAccount:function(){var a=new iNet.iwebos.ui.mail.DialogSearchAccount();a.show(this);a.disabledOkButton();a.setEnableDelChk(true,false)},_onAddUser:function(){this.__openNewTab()},__openNewTab:function(){var b=Ext.getCmp(this.mainId);var a=Ext.getCmp("manage-user-create-new-tab");if(!a){a=new iNet.iwebos.ui.org.CreateUserPanel();b.add(a).show()}b.setActiveTab(a);a.setInfo(this.toolbar.getSelectedOrg(),this.toolbar.getSelectedGroup());return a},_onManageGroup:function(){if(!this._owner.isLoadDROrg){this._owner.isLoadDROrg=true;var a=function(d,e){var c=Ext.util.JSON.decode(d.responseText);var f=(c.success==undefined)?true:c.success;if(f&&c.length>0){this._owner.drOrgs=c;this.__openGroupManagementTab(c)}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.user_not_have_permition_to_user_function,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var b={iwct:"loadMailDomainContent",iwa:"view",action:"loaddrs"};iNet.Ajax.request({url:"jsonajax",method:"POST",params:b,scope:this,success:a,maskEl:this.bwrap})}else{if(this._owner.drOrgs==undefined){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.user_not_have_permition_to_user_function,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{this.__openGroupManagementTab(this._owner.drOrgs)}}},__openGroupManagementTab:function(a){var c=Ext.getCmp(this.mainId);var b=Ext.getCmp("manage-group-tab");if(!b){b=new iNet.iwebos.ui.org.GroupPanel();c.add(b).show();b.setOrganization(a)}c.setActiveTab(b);return b},_onAddGroup:function(){var b=Ext.getCmp(this.mainId);var a=Ext.getCmp("manage-group-create-new-tab");if(!a){a=new iNet.iwebos.ui.org.CreateGroupPanel();b.add(a).show()}b.setActiveTab(a);return a},_onDoubleClick:function(d,b,f){f.stopEvent();var a=d.store.getAt(b);var c=this.__openNewTab();c.loadUser(this.toolbar.getSelectedOrg(),a.data.uname)},_getFirstSelection:function(){var a=this.grid.getSelectionModel().getSelections();if(a==null||a.length==0){return null}return a[0]},_onUpdateAccount:function(){var a=this._getFirstSelection();if(a!=null){var b=this.__openNewTab();b.loadUser(this.toolbar.getSelectedOrg(),a.data.uname)}},_openResetPwdDialog:function(){var a=this._getFirstSelection();if(a!=null){var b=new iNet.iwebos.ui.account.DialogResetPwd();b.setData(this.toolbar.getSelectedOrg(),a.data.fullname,a.data.uname);b.show(this)}},_onDeleteAccount:function(){var b=this._getFirstSelection();var a=b.data;if(a!=null){this._fnCanDelete(a)}},_fnCanDelete:function(b){var a=function(e,f){var d=Ext.util.JSON.decode(e.responseText);if(d.success){if(d.error=="nopermit"){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_not_permit_delete_user,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{if(d.error=="noexist"){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_not_exist_in_org,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{this._fnOpenDeleteDialog(b)}}}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_check_delete_user,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var c={iwct:"userContent",iwa:"view",action:"candelete"};c.uname=b.uname;c.org=this.toolbar.getSelectedOrg();iNet.Ajax.request({url:"jsonajax",method:"POST",params:c,scope:this,success:a,maskEl:this.bwrap})},_fnOpenDeleteDialog:function(a){var b=new iNet.iwebos.ui.org.DeleteUserDialog();var c={fn:this.__fnDeleteUser,scope:this};b.setData(a.uname,c);b.show()},__fnDeleteUser:function(a,d,f){var b=function(h,j){var g=Ext.util.JSON.decode(h.responseText);if(g.success){var i=this._getFirstSelection();this.grid.store.remove(i)}else{if(g.error=="manager"){Ext.MessageBox.show({title:iwebos.message.org.message,msg:String.format(iwebos.message.org.message_user_can_not_delete_manager_group,a,g.group),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_delete_user,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}};var e={iwct:"userContent",iwa:"view",action:"delete"};var c={};c.uname=a;c.org=this.toolbar.getSelectedOrg();c.delall=d;c.list=f;e.object=Ext.util.JSON.encode(c);iNet.Ajax.request({url:"jsonajax",method:"POST",params:e,scope:this,success:b,maskEl:this.bwrap})},_onRowContext:function(d,c,f){f.stopEvent();d.getSelectionModel().selectRow(c);if(!this.menu){this.menu=new Ext.menu.Menu({id:"grid-ctx",items:[{id:"account-menu-item-add",text:iwebos.message.org.user_add_new,iconCls:"icon-create-account",handler:this._onAddUser.createDelegate(this)},{id:"account-menu-item-add-member",text:iwebos.message.org.user_add_member,iconCls:"icon-create-account",handler:this._onAddMembers.createDelegate(this)},"-",{id:"account-menu-item-remove-member",text:iwebos.message.org.user_remove_member,iconCls:"icon-account-delete",handler:this._onRemoveMember.createDelegate(this)},{id:"account-menu-item-update",text:iwebos.message.org.user_update,iconCls:"icon-account-update",handler:this._onUpdateAccount.createDelegate(this)},{id:"account-menu-item-reset-pwd",text:iwebos.message.org.user_reset_password,iconCls:"icon-account-reset-pass",handler:this._openResetPwdDialog.createDelegate(this)},{id:"account-menu-item-delete",text:iwebos.message.org.user_reset_delete,iconCls:"icon-account-delete",handler:this._onDeleteAccount.createDelegate(this)}]})}var b=d.store.getAt(c).data;var a=this.toolbar.getSelectedGroup()=="---";Ext.getCmp("account-menu-item-add-member").setDisabled(a);Ext.getCmp("account-menu-item-remove-member").setDisabled(a);this.menu.showAt(f.getXY())},_onContextMenu:function(b){b.stopEvent();if(!this.contextMenu){this.contextMenu=new Ext.menu.Menu({items:[{id:"account-menu-item-add-ct",text:iwebos.message.org.user_add_new,iconCls:"icon-create-account",handler:this._onAddUser.createDelegate(this)},{id:"account-menu-item-add-member-ct",text:iwebos.message.org.user_add_member,iconCls:"icon-create-account",handler:this._onAddMembers.createDelegate(this)}]})}var a=this.toolbar.getSelectedGroup()=="---";Ext.getCmp("account-menu-item-add-member-ct").setDisabled(a);this.contextMenu.showAt(b.getXY())},_onAddMembers:function(){var a=new iNet.iwebos.ui.org.SearchUserDialog();var b={fn:this._fnHandleAddMembers,scope:this};a.setData(this.toolbar.getSelectedOrg(),b);a.show()},_fnHandleAddMembers:function(g){var d=[];var f=[];for(var a=0;a<g.length;a++){var c=g[a].data;f[a]=c;d[a]={uname:c.uname}}var b=function(i,j){var h=Ext.util.JSON.decode(i.responseText);if(h.success){this._fnAddDataToGrid(f)}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_add_member_to_group,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var e={iwct:"groupContent",iwa:"READ_WRITE",action:"addmember"};e.members=Ext.util.JSON.encode(d);e.name=this.toolbar.getSelectedGroup();e.org=this.toolbar.getSelectedOrg();iNet.Ajax.request({url:"jsonajax",method:"POST",params:e,scope:this,success:b,maskEl:this.bwrap})},_onRemoveMember:function(){var b=this._getFirstSelection();var c=b.data;if(c!=null){var a=function(f,g){var e=Ext.util.JSON.decode(f.responseText);if(e.success){if(e.error=="noexist"){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_not_exist_in_group,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{if(e.error=="manager"){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_user_can_not_remove_manager_group_out_group,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{this.grid.store.remove(b)}}}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_remove_member_out_group,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}}var d={iwct:"groupContent",iwa:"READ_WRITE",action:"removemember"};d.uname=c.uname;d.name=this.toolbar.getSelectedGroup();d.org=this.toolbar.getSelectedOrg();iNet.Ajax.request({url:"jsonajax",method:"POST",params:d,scope:this,success:a,maskEl:this.bwrap})},_fnAddDataToGrid:function(a){for(var b=0;b<a.length;b++){this.grid.store.addData(a[b])}},handlePanel:function(a,e,c){if(!a){return}var d=c||{};var f=e||this.mainContendId;var b=a.body;if(a._fnDisabledAll&&typeof a._fnDisabledAll=="function"){a._fnDisabledAll()}if(f==this.mainContendId){b.select('li[id="li-action-create-user"]').setDisplayed(true);b.select('li[id="li-action-manage-group"]').setDisplayed(true);b.select('li[id="li-action-view-lotus-account"]').setDisplayed(true)}else{if(f=="manage-user-create-new-tab"){b.select('li[id="li-action-create-user"]').setDisplayed(true);b.select('li[id="li-action-user-save"]').setDisplayed(true);b.select('li[id="li-action-user-search"]').setDisplayed(true)}else{if(f=="manage-group-tab"){b.select('li[id="li-action-create-group"]').setDisplayed(true)}else{if(f=="manage-group-create-new-tab"){b.select('li[id="li-action-create-group"]').setDisplayed(true);b.select('li[id="li-action-group-save"]').setDisplayed(true)}}}}},fnDoAction:function(d,e){var c=Ext.getCmp(this.mainId);d.stopEvent();var b=c.getActiveTab(),a=b.getId()||null;if((a!=null)&&((a=="manage-user-create-new-tab"))||(a=="manage-group-tab")||(a=="manage-group-create-new-tab")){b.fnDoAction(d,e)}else{if(this.actions!==undefined&&this.actions[e.id]!==undefined&&typeof this.actions[e.id]=="function"){this.actions[e.id]()}}},_fnResize:function(a){Ext.EventManager.fireWindowResize()}}); 
iNet.iwebos.ui.org.CreateGroupPanel=function(e,c){this.viewer=e;Ext.apply(this,c);this.prefix=(!this.prefix)?"manage-group-create-new":this.prefix;this.tabId=this.prefix+"-tab";this.nameId=this.prefix+"-group-name";this.managerPanelId=this.prefix+"manager-panel-id";this.memberPanelId=this.prefix+"member-panel-id";this.descriptionId=this.prefix+"-group-description";this.organizationId=this.prefix+"-organization-id";this.contentId=this.prefix+"-content-id";this._owner={};var b=new iNet.iwebos.ui.org.MemberGridPanel({id:this.managerPanelId,height:150});this.managerGrid=b.grid;var d=new iNet.iwebos.ui.org.MemberGridPanel({id:this.memberPanelId,region:"center"});this.memberGrid=d.grid;var a=new Ext.Panel({id:this.contentId,region:"center",frame:false,border:false,anchor:"100%",autoHeight:true,items:[{border:false,html:"<div><b>"+iwebos.message.org.group_information+"</b></div>"},{layout:"column",frame:false,border:false,anchor:"100%",items:[{layout:"form",bodyStyle:"padding: 5px;",anchor:"100%",border:false,columnWidth:0.5,labelWidth:75,items:[{id:this.nameId,xtype:"textfield",anchor:"95%",fieldLabel:iwebos.message.org.group_name}]},{layout:"form",bodyStyle:"padding: 5px;",anchor:"100%",border:false,columnWidth:0.5,labelWidth:75,items:[{id:this.organizationId,xtype:"textfield",anchor:"95%",readOnly:true,fieldLabel:iwebos.message.org.organization}]}]},{layout:"form",bodyStyle:"padding: 5px;",anchor:"100%",labelWidth:75,border:false,items:[{id:this.descriptionId,xtype:"textfield",anchor:"97.5%",fieldLabel:iwebos.message.org.group_description}]},{border:false,html:"<b>"+iwebos.message.org.group_manager+"</b><br />"},{layout:"form",border:false,anchor:"100%",items:[b]},{border:false,html:"<b>"+iwebos.message.org.group_member+"</b><br />"},d]});a.on("resize",this.__resizePanel,this);this.actions={"group-create-new":this._onAdd.createDelegate(this),"group-save":this._onSave.createDelegate(this)};iNet.iwebos.ui.org.CreateGroupPanel.superclass.constructor.call(this,{id:this.tabId,layout:"border",iconCls:"icon-menu-group-add-new",title:iwebos.message.org.group,anchor:"100%",header:false,enableTabScroll:true,autoScroll:true,frame:false,border:false,closable:true,items:[a]});this.on("activate",this.__resizePanel,this)};Ext.extend(iNet.iwebos.ui.org.CreateGroupPanel,Ext.Panel,{__validate:function(){var a=Ext.getCmp(this.organizationId);if(a.getValue()==""){return iwebos.message.org.message_group_select_org}a=Ext.getCmp(this.nameId);if(a.getValue()==""){return iwebos.message.org.message_group_input_group_name}if(this.managerGrid.store.getCount()==0){return iwebos.message.org.message_group_select_group_manager}return""},__getData:function(){var c={};var b=Ext.getCmp(this.organizationId);c.org=b.getValue();b=Ext.getCmp(this.nameId);c.name=b.getValue();b=Ext.getCmp(this.descriptionId);c.description=b.getValue();var d=Ext.getCmp(this.managerPanelId).getDatas();if(d!=null){c.managers=d}var a=Ext.getCmp(this.memberPanelId).getDatas();if(a!=null){c.members=a}return c},__fillData:function(b){var a=Ext.getCmp(this.organizationId);a.setValue(this._owner.org);a=Ext.getCmp(this.nameId);a.setValue(b.name);a=Ext.getCmp(this.descriptionId);a.setValue(b.description);Ext.getCmp(this.managerPanelId).addDatas(b.managers);Ext.getCmp(this.memberPanelId).addDatas(b.members)},__cleanData:function(){var a=Ext.getCmp(this.organizationId);a.setValue(this._owner.org);a=Ext.getCmp(this.nameId);a.setDisabled(false);a.setValue("");a=Ext.getCmp(this.descriptionId);a.setValue("");Ext.getCmp(this.memberPanelId).removeAll();Ext.getCmp(this.managerPanelId).removeAll()},_onAdd:function(){this._owner.action="save";this.__cleanData()},loadData:function(b,d){this._owner.org=b;Ext.getCmp(this.organizationId).setValue(b);Ext.getCmp(this.managerPanelId).setDefaultOrg(b);Ext.getCmp(this.memberPanelId).setDefaultOrg(b);if(d==undefined||d==null||d==""){this._owner.action="save";this.__cleanData();return}this._owner.action="update";Ext.getCmp(this.nameId).setDisabled(true);var c=function(f,g){var e=Ext.util.JSON.decode(f.responseText);var h=(e.success==undefined)?true:e.success;if(h){this.__fillData(e)}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_group_error_load_group,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var a={iwct:"loadGroupContent",iwa:"READ_WRITE",action:"load"};a.name=d;a.org=b;iNet.Ajax.request({url:"jsonajax",params:a,method:"POST",scope:this,success:c,maskEl:this.bwrap})},_onSave:function(){var d=(this._owner.action!=undefined&&this._owner.action!=null)?this._owner.action:"save";var c=this.__validate();if(c!=""){Ext.MessageBox.show({title:iwebos.message.org.message,msg:c,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var a=this.__getData();var b=function(f,i){var h=Ext.util.JSON.decode(f.responseText);var k=(h.success==undefined)?true:h.success;if(k){this.__handleAfterSaving();var j=Ext.getCmp("manage-group-tab");if(j!=undefined&&j!=null){var m=Ext.getCmp(this.organizationId).getValue();if(j.getSelectedOrg()==m){var g=j.grid.store;if(d=="save"){g.addData(a)}else{var l=g.getById(a.name);if(l!=undefined&&l!=null){l.data.name=a.name;l.data.description=a.description;l.commit()}}}}Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_group_saving_successful,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_group_error_saving_data,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var e={iwct:"groupContent",iwa:"READ_WRITE",action:d};e.object=Ext.util.JSON.encode(a);iNet.Ajax.request({url:"jsonajax",params:e,scope:this,method:"POST",success:b,failure:function(f,g){},maskEl:this.bwrap})},__handleAfterSaving:function(){this._owner.action="update";Ext.getCmp(this.nameId).setDisabled(true)},setDefaultOrg:function(a){this._owner.defaultOrg=a;Ext.getCmp(this.organizationId).setValue(a);Ext.getCmp(this.managerPanelId).setDefaultOrg(a);Ext.getCmp(this.memberPanelId).setDefaultOrg(a)},fnDoAction:function(a,b){if(this.actions!==undefined&&this.actions[b.id]!==undefined&&typeof this.actions[b.id]=="function"){this.actions[b.id]()}},__resizePanel:function(a){Ext.EventManager.fireWindowResize();var b=Ext.getCmp(this.memberPanelId);b.setHeight(this.getSize().height-285);b=Ext.getCmp(this.contentId)}}); 
function checking(){Ext.getCmp("manage-user-create-new-tab")._isExist()}iNet.iwebos.ui.org.CreateUserPanel=function(f,r){this.viewer=f;Ext.apply(this,r);this.prefix=(!this.prefix)?"manage-user-create-new":this.prefix;this.tabId=this.prefix+"-tab";this.unameId=this.prefix+"-user-name";this.checkExistId=this.prefix+"-check-exist";this.checkExistHtmlId=this.prefix+"-check-exist-html";this.orgId=this.prefix+"-org-name";this.pwdId=this.prefix+"-password";this.confirmPwdId=this.prefix+"-confirm-pwd";this.fnameId=this.prefix+"-first-name";this.mnameId=this.prefix+"-middle-name";this.lnameId=this.prefix+"-last-name";this.employeeNumberId=this.prefix+"-employee-number";this.titleId=this.prefix+"-user-title";this.emailId=this.prefix+"-email";this.workPhoneId=this.prefix+"-work-phone";this.mobileId=this.prefix+"-mobile";this.homePhoneId=this.prefix+"-home-phone";this.emailsId=this.prefix+"-email-accounts";this.panelViewId=this.prefix+"-panel-view-id";this.emailCheckId=this.prefix+"-email-check-id";this.emailForwardCheckId=this.prefix+"-email-forward-check-id";this.emailForwardId=this.prefix+"-email-forward-id";this.emailForwardPanelId=this.prefix+"-email-fwd-panel-id";this._owner={};var o="*";var d=new Ext.form.TextField({id:this.unameId,fieldLabel:iwebos.message.org.user_name+o,tabIndex:1,enableKeyEvents:true,labelWidth:80,anchor:"99%"});var e=/^\+|(\d{1,})|\s/;this.buttonIconCls="icon-account-check-valid";this.originalIcon=true;this.imageHtml="<div id="+this.checkExistId+' class="{0}"></div>';this.linkHtml='<a href="#" onclick="checking()">'+this.imageHtml+"</a>";var a=new Ext.Panel({region:"center",frame:false,border:false,autoHeight:true,anchor:"100%",labelAlign:"right",bodyStyle:"padding: 5px;",items:[{border:false,html:"<b>"+iwebos.message.org.user_account_information+"</b>"},{layout:"column",columnWidth:1,border:false,anchor:"100%",items:[{layout:"column",anchor:"100%",border:false,columnWidth:0.5,items:[{layout:"form",border:false,columnWidth:0.9,labelWidth:100,anchor:"100%",items:[d]},{layout:"form",border:false,columnWidth:0.1,anchor:"98%",items:[{html:"<div id="+this.checkExistHtmlId+" >"+String.format(this.linkHtml,this.buttonIconCls)+"</div>",border:false}]}]},{layout:"form",border:false,columnWidth:0.5,labelWidth:80,anchor:"100%",items:[{id:this.orgId,xtype:"textfield",fieldLabel:iwebos.message.org.organization,readOnly:true,labelWidth:80,anchor:"95%"}]}]},{layout:"column",columnWidth:1,border:false,anchor:"100%",items:[{layout:"form",border:false,columnWidth:0.5,labelWidth:100,anchor:"100%",items:[{id:this.pwdId,xtype:"textfield",inputType:"password",fieldLabel:iwebos.message.org.user_password,tabIndex:2,anchor:"95%"},{id:this.emailCheckId,xtype:"checkbox",boxLabel:iwebos.message.org.user_email_check,checked:true,hideLabel:true,listeners:{check:function(v,u){var t=Ext.getCmp(this.emailForwardPanelId);if(t){t.setVisible(u)}},scope:this}}]},{layout:"form",border:false,columnWidth:0.5,labelWidth:80,anchor:"100%",items:[{id:this.confirmPwdId,xtype:"textfield",inputType:"password",fieldLabel:iwebos.message.org.user_confirm_password,tabIndex:3,anchor:"95%"},{id:this.emailForwardPanelId,layout:"column",columnWidth:1,border:false,anchor:"95%",items:[{width:185,layout:"form",anchor:"100%",border:false,items:[{id:this.emailForwardCheckId,xtype:"checkbox",boxLabel:iwebos.message.org.user_email_forward_check,hideLabel:true,listeners:{check:function(v,u){var t=Ext.getCmp(this.emailForwardId);if(t){t.setDisabled(!u);t.focus(true,true)}},scope:this}}]},{columnWidth:1,lyout:"form",anchor:"100%",border:false,items:[{id:this.emailForwardId,width:"97%",xtype:"textfield",vtype:"email",disabled:true,hideLabel:true}]}]}]}]},{border:false,html:"<br /><b>"+iwebos.message.org.user_information+"</b>"},{layout:"column",columnWidth:1,border:false,anchor:"100%",items:[{layout:"form",border:false,columnWidth:0.5,labelWidth:100,anchor:"100%",items:[{layout:"column",columnWidth:1,border:false,anchor:"100%",items:[{layout:"form",border:false,columnWidth:0.45,labelWidth:100,anchor:"100%",items:[{id:this.lnameId,xtype:"textfield",fieldLabel:iwebos.message.org.user_last_name+o,tabIndex:4,anchor:"95%"}]},{layout:"form",border:false,columnWidth:0.55,labelWidth:80,anchor:"100%",items:[{id:this.mnameId,xtype:"textfield",fieldLabel:iwebos.message.org.user_middle_name,tabIndex:5,anchor:"92.5%"}]}]},{id:this.employeeNumberId,xtype:"textfield",fieldLabel:iwebos.message.org.user_employee_number,tabIndex:7,anchor:"95%"},{id:this.emailId,xtype:"textfield",fieldLabel:iwebos.message.org.user_alternate_email,vtype:"email",tabIndex:9,anchor:"95%"},{id:this.mobileId,xtype:"textfield",fieldLabel:iwebos.message.org.user_mobile,tabIndex:11,maskRe:e,anchor:"95%"}]},{layout:"form",border:false,columnWidth:0.5,labelWidth:80,anchor:"100%",items:[{id:this.fnameId,xtype:"textfield",fieldLabel:iwebos.message.org.user_first_name+o,tabIndex:6,anchor:"95%"},{id:this.titleId,xtype:"textfield",fieldLabel:iwebos.message.org.user_title,tabIndex:8,anchor:"95%"},{id:this.workPhoneId,xtype:"textfield",fieldLabel:iwebos.message.org.user_word_phone,tabIndex:10,maskRe:e,anchor:"95%"},{id:this.homePhoneId,xtype:"textfield",fieldLabel:iwebos.message.org.user_home_phone,tabIndex:12,maskRe:e,anchor:"95%"}]}]}]});var q={field:"uid",direction:"ASC"};var s={field:"uid",direction:"ASC"};var n=Ext.data.Record.create([{name:"id",mapping:"email",type:"string"},{name:"email",mapping:"email",type:"string"},{name:"code",mapping:"code",type:"string"},{name:"uid",mapping:"uid",type:"string"},{name:"symbol",mapping:"symbol",type:"string"},{name:"domain",mapping:"domain",type:"string"},{name:"fname",mapping:"fname",type:"string"},{name:"lname",mapping:"lname",type:"string"},{name:"depNumber",mapping:"depNumber",type:"string"},{name:"smtp",mapping:"smtp",type:"boolean"},{name:"capacity",mapping:"capacity",type:"int"},{name:"active",mapping:"active",type:"boolean"},{name:"forward",mapping:"forward",type:"boolean"},{name:"fAddress",mapping:"fAddress",type:"string"},{name:"virus",mapping:"virus",type:"boolean"},{name:"spam",mapping:"spam",type:"boolean"}]);var c=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"email"},n);var m=new Ext.grid.ColumnModel([{header:iwebos.message.mail.account,dataIndex:"uid",fixed:true,width:200},{header:"@",dataIndex:"symbol",fixed:true,width:24},{header:iwebos.message.mail.domain,dataIndex:"domain",width:100}]);var k=function(t,u){return(t.data.status===u)};var h=function(t){var u=t.data.read;return""};this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"mail-admin-create-gird",region:"center",anchor:"100%",autoScroll:true,border:true,url:"jsonajax",method:"POST",sortInfo:q,loadFirst:false,reader:c,rowClass:h,dsort:s,cm:m,filter:{data:"all",fn:k},tbar:[{id:"btn-create-new-email",xtype:"button",text:iwebos.message.org.user_add_email,iconCls:"icon-mail-add",scope:this,handler:this._createMailAccount.createDelegate(this)},{id:"btn-delete-email",xtype:"button",text:iwebos.message.mail.delete_email_account,iconCls:"icon-mail-del",scope:this,handler:this._onRemoveMailAccount.createDelegate(this)}]});this.grid.getSelectionModel().on("rowselect",function(y,w,v){var u=this.grid.store.getAt(w);var t=u.data;this.openId=t.id;var x=Ext.getCmp("previewPanel");if(x){p.overwrite(x.body,t);x.setVisible(true)}},this);var j=new Ext.Panel({id:"previewPanel",width:"97%",region:"south",frame:true,hidden:true,border:false});var l=["<table width=100% border=0 cellspacing=0 cellpadding=0>",'<tr><td valign=top align="left" colspan="7"><b><font color="#404040">',iwebos.message.account.detail_info,":</font></b></td></tr>","<tr>",'<td width="125px"/><td align="left" width="125px" class="preview-account-text">\t',iwebos.message.account.detail_info_owner_account,':</td><td align="left" width="200px">{lname}&nbsp;{mname}&nbsp;{fname}</td>','<td valign=top align="left" width="165px" class="preview-account-text">',iwebos.message.account.detail_info_username,':</td><td align="left" colspan="2"><a href="#">{uid}{symbol}{domain}</a></td>',"</tr>",'<tr><td valign=top align="left" colspan="7"><b><font color="#404040">',iwebos.message.account.detail_info_options,":</font></b> </td></tr>","<tr>",'<td width="125px"/><td align="left" width="125px" class="preview-account-text">\t',iwebos.message.account.detail_info_sizelimit,':</td><td align="left" width="200px">{capacity}(MB)</td>','<td valign=top align="left" width="150px" class="preview-account-text">\t',iwebos.message.account.detail_info_virus,':</td><td align="left" width="75px">{[this.repl(values.virus)]}</td>','<td valign=top align="left" width="175px" class="preview-account-text">\t',iwebos.message.account.detail_info_spam,':</td><td align="left">{[this.repl(values.spam)]}</td>',"</tr>","<tr>",'<td width="125px"/><td align="left" width="125px"  class="preview-account-text">\t',iwebos.message.account.detail_info_smtp,':</td><td align="left" width="200px">{[this.repl(values.smtp)]}</td>','<td valign=top align="left" width="150px"  class="preview-account-text">\t',iwebos.message.account.detail_info_active,':</td><td align="left" width="75px">{[this.repl(values.active)]}</td>','<td valign=top align="left" width="175px"  class="preview-account-text">\t',iwebos.message.account.detail_info_transfer,':</td><td align="left">{[this.repl(values.forward)]}</td>',"</tr>","</table>"];var p=new Ext.XTemplate(l.join(""),{repl:function(t){return(t===true?iwebos.message.account.accept_value:iwebos.message.account.non_accept_value)}});var g=new Ext.FormPanel({id:this.panelViewId,region:"center",anchor:"100%",border:false,hideBorders:true,labelWidth:150,items:[{id:this.emailsId,xtype:"fieldset",checkboxToggle:true,collapsed:true,hideBorders:false,border:Ext.isIE,title:iwebos.message.mail.view_info_account,layout:"border",width:"95%",items:[this.grid]},{layout:"form",bodyStyle:"padding: 10px;",items:[j]}]});this.grid.on("contextmenu",this._contextMenu,this,{stopEvent:true});this.grid.on("rowcontextmenu",this._rowContextMenu,this,{stopEvent:true});this.grid.on("rowdblclick",this._onDoubleClick,this);d.on("keypress",this._fnUNamePress,this,{stopEvent:true});var i=new Ext.Panel({region:"center",autoScroll:true,frame:false,border:false,items:[a,g]});i.on("resize",this.__resizePanel,this);var b=Ext.getCmp(this.emailsId);b.on("expand",function(t){if(this.openId){j.setVisible(true)}},this);b.on("collapse",function(t){j.setVisible(false)},this);this.actions={"user-create-new":this.onAdd.createDelegate(this),"user-save":this.onSave.createDelegate(this),"user-search":this._searchAccount.createDelegate(this)};iNet.iwebos.ui.org.CreateUserPanel.superclass.constructor.call(this,{id:this.tabId,iconCls:"icon-create-account",title:iwebos.message.org.user,anchor:"100%",header:false,enableTabScroll:true,autoScroll:true,frame:false,border:false,closable:true,layout:"border",items:[i]})};Ext.extend(iNet.iwebos.ui.org.CreateUserPanel,Ext.Panel,{onAdd:function(){this.update=true;this._cleanData()},setInfo:function(b,a){this._owner.group=a;this._owner.groups=[{group:a}];this._owner.org=b;Ext.getCmp(this.orgId).setValue(b)},_fnUNamePress:function(b,a){if(!this.originalIcon&&a.getKey()!=a.ENTER){this.originalIcon=true;document.getElementById(this.checkExistHtmlId).innerHTML=String.format(this.linkHtml,this.buttonIconCls)}else{if(this.originalIcon&&a.getKey()==a.ENTER){this._isExist()}}},_isExist:function(){var b=Ext.getCmp(this.unameId);var a=b.getValue().trim().toLowerCase();if(a==""){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.warning_user_input_user_name_to_check,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}b.setValue(a);var d=document.getElementById(this.checkExistId);this.originalIcon=false;var c=function(g,i){var f=Ext.util.JSON.decode(g.responseText);var j=(f.success==undefined)?true:f.success;if(j){var h=f.exist?"icon-account-invalid":"icon-account-valid";var k=f.exist?Ext.getCmp(this.unameId):Ext.getCmp(this.pwdId);k.focus(true);document.getElementById(this.checkExistHtmlId).innerHTML=String.format(this.imageHtml,h)}else{d.className=this.buttonIconCls;if(f.error=="invaliduname"){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_user_invalid_user_name,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_cheking_user_name_to_check,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}};d.className="icon-account-waiting";var e={iwct:"userContent",iwa:"READ_WRITE",action:"checkuname"};e.uname=a;e.org=Ext.getCmp(this.orgId).getValue();iNet.Ajax.request({url:"jsonajax",params:e,scope:this,method:"POST",success:c})},validateUser:function(){var b=Ext.getCmp(this.unameId);if(b.getValue().trim()==""){return iwebos.message.org.message_user_input_user_name}b=Ext.getCmp(this.pwdId);var d=b.getValue().trim();if(d==""&&(this.update==undefined||this.update==false)){return iwebos.message.org.message_user_input_user_password}b=Ext.getCmp(this.confirmPwdId);if(b.getValue()!=d){return iwebos.message.org.message_user_password_not_match}if(Ext.getCmp(this.lnameId).getValue().trim()==""){return iwebos.message.org.message_user_input_last_name}if(Ext.getCmp(this.fnameId).getValue().trim()==""){return iwebos.message.org.message_user_input_first_name}if(!Ext.getCmp(this.emailId).validate()){return iwebos.message.org.message_user_input_email_invalid}if(!this.isPhoneNumber(Ext.getCmp(this.workPhoneId).getValue())){return iwebos.message.org.message_user_invalid_work_number}if(!this.isPhoneNumber(Ext.getCmp(this.mobileId).getValue())){return iwebos.message.org.message_user_invalid_mobile_number}if(!this.isPhoneNumber(Ext.getCmp(this.homePhoneId).getValue())){return iwebos.message.org.message_user_invalid_home_number}b=Ext.getCmp(this.emailCheckId);if(b.isVisible()&&!!(b.getValue())){var a=Ext.getCmp(this.emailForwardCheckId).getValue();if(a){var c=Ext.getCmp(this.emailForwardId).getValue();if(c.trim()==""){return iwebos.message.mail.warning_input_address_need_to_forward}}}return""},isPhoneNumber:function(e){if(e==""){return true}var c=e.lastIndexOf("+");if(c>=1){return false}if(e.indexOf("  ")!=-1||e.indexOf(" ")==0||e.lastIndexOf(" ")==e.length-1){return false}if(c<0){return !isNaN(e)}var a=e.split(" ");var d=a.length;if(d!=1&&d!=4){return false}for(var b=0;b<d;b++){if(isNaN(a[b])){return false}}return true},setData:function(c){this.__fnHandleFunction();var b=Ext.getCmp(this.unameId);b.setValue(c.duname);b.setDisabled(true);this.originalIcon=true;document.getElementById(this.checkExistHtmlId).innerHTML=String.format(this.imageHtml,this.buttonIconCls);var f=c.edit==undefined?true:c.edit;this._owner.edit=f;this._owner.uname=c.uname;var a=!f;if(c.org!=undefined&&c.org!=null&&c.org!=""){Ext.getCmp(this.orgId).setValue(c.org);this._owner.groups=c.groups}else{Ext.getCmp(this.orgId).setValue(this._owner.org);this._owner.groups=[{group:this._owner.group}]}var d=Ext.getCmp(this.pwdId);d.setValue("");d.setDisabled(true);d=Ext.getCmp(this.confirmPwdId);d.setValue("");d.setDisabled(true);d=Ext.getCmp(this.emailId);d.setValue(c.email);d.setDisabled(a);d=Ext.getCmp(this.lnameId);d.setValue(c.lname);d.setDisabled(a);d=Ext.getCmp(this.mnameId);d.setValue(c.mname);d.setDisabled(a);d=Ext.getCmp(this.fnameId);d.setValue(c.fname);d.setDisabled(a);d=Ext.getCmp(this.employeeNumberId);d.setValue(c.employee);d.setDisabled(a);d=Ext.getCmp(this.titleId);d.setValue(c.title);d.setDisabled(a);d=Ext.getCmp(this.workPhoneId);d.setValue(c.wphone);d.setDisabled(a);d=Ext.getCmp(this.mobileId);d.setValue(c.mobile);d.setDisabled(a);d=Ext.getCmp(this.homePhoneId);d.setValue(c.hphone);d.setDisabled(a);var e=c.list;this._fillDataToGrid(e);this.grid.setDisabled(a);d=Ext.getCmp(this.emailCheckId);if(d){d.setVisible(false)}d=Ext.getCmp(this.emailForwardPanelId);if(d){d.setVisible(false)}},_fillDataToGrid:function(e){var c=this.grid.store;c.removeAll();var b=[];if(e!=null&&e!=undefined){for(var d=0;d<e.length;d++){var a=e[d];a.id=a.email;b[d]=new Ext.data.Record(a)}c.add(b);c.sort("uid","ASC")}},getData:function(){var g={};var m=Ext.getCmp(this.unameId);var j=m.getValue().trim().toLowerCase();m.setValue(j);g.duname=j;if(this._owner.uname!=undefined&&this._owner.uname!=null){g.uname=this._owner.uname}m=Ext.getCmp(this.pwdId);g.pwd=m.getValue();m=Ext.getCmp(this.emailId);g.email=m.getValue();m=Ext.getCmp(this.fnameId);g.fname=m.getValue();m=Ext.getCmp(this.mnameId);g.mname=m.getValue();m=Ext.getCmp(this.lnameId);g.lname=m.getValue();m=Ext.getCmp(this.employeeNumberId);g.employee=m.getValue();m=Ext.getCmp(this.titleId);g.title=m.getValue();m=Ext.getCmp(this.workPhoneId);g.wphone=m.getValue();m=Ext.getCmp(this.mobileId);g.mobile=m.getValue();m=Ext.getCmp(this.homePhoneId);g.hphone=m.getValue();m=Ext.getCmp(this.orgId);g.org=m.getValue();g.groups=this._owner.groups;g.list=[];var i=this.grid.store;var f=[];var c=i.getCount();if(c>0){for(var d=0;d<c;d++){f[d]=i.getAt(d).data}g.list=f}m=Ext.getCmp(this.emailCheckId);if(m.isVisible()&&!!(m.getValue())){var l="@";var e=String.format("{0}{1}{2}",j,l,g.org);var n=null;var h=Ext.getCmp(this.emailForwardCheckId).getValue();if(h){var b=Ext.getCmp(this.emailForwardId);n=b.getValue().trim();if(n==""){h=false}}var a=this._getExisted(g.list,e);if(a==null){var k=Ext.getCmp(this.mnameId).getValue();k=(k!="")?(k+" "):"";g.list.push({active:true,capacity:50,code:"",domain:g.org,groups:this._owner.groups,email:e,fAddress:n,fname:k+g.fname,forward:h,id:e,lname:g.lname,smtp:true,spam:true,symbol:l,uid:j,virus:true})}else{a.forward=h;a.fAddress=n}}return g},_getExisted:function(d,b){var c;for(var a=0;a<d.length;a++){c=d[a];if(c.email==b){return c}}return null},_createMailAccount:function(){this._onOpenMailAccountDialog(null,true)},_onUpdateMailAccount:function(){var a=this.grid.getSelectionModel().getSelections()[0];if(!a){return}this._onOpenMailAccountDialog(a.data,this._isEdit(a.data))},_canCreateEmail:function(){if(Ext.getCmp(this.lnameId).getValue()==""){return iwebos.message.mail.empty_fname}if(Ext.getCmp(this.fnameId).getValue()==""){return iwebos.message.mail.empty_lname}return""},_onOpenMailAccountDialog:function(d,e){var a=this._canCreateEmail();if(a!=""){Ext.MessageBox.show({title:iwebos.message.account.infomationMessage,msg:a,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var g=new iNet.iwebos.ui.account.DialogCreateAccount();var f={save:{fn:this._okHandler,scope:this}};var c=Ext.getCmp("manage-user-search-toolbar");if(d==null||d==undefined){var b=Ext.getCmp(this.mnameId).getValue();b=(b!="")?(b+" "):"";d={};d.lname=Ext.getCmp(this.lnameId).getValue();d.fname=b+Ext.getCmp(this.fnameId).getValue()}g.show();g._setData(d,f,c.getOrgs(),c.getSelectedOrg(),this._owner.groups,e)},_okHandler:function(d){var a=this.grid.store;var e=a.getAt(a.find("email",d.email));if(e!=null&&e!=undefined){e.data.smtp=d.smtp;e.data.active=d.active;e.data.forward=d.forward;if(e.data.forward){e.data.fAddress=d.fAddress}e.data.virus=d.virus;e.data.spam=d.spam;e.data.capacity=d.capacity;e.data.depNumber=d.depNumber;e.commit()}else{var c=d.email;var b=c.indexOf("@");d.uid=c.substr(0,b);d.symbol="@";d.domain=c.substr(b+1,c.length);d.id=c;a.addData(d)}},_searchAccount:function(){var a=new iNet.iwebos.ui.mail.DialogSearchAccount();var b={fn:this._handleSelectUser,scope:this};a.__setAction(b);a.show(this);a.setEnableDelChk(true,true)},_handleSelectUser:function(a){this.loadAccount(a.uname)},loadUser:function(d,a){if(a!=""){var b={iwct:"loadUserContent",iwa:"READ_WRITE",action:"loadfull"};b.uname=a;b.org=d;this.update=true;var c=function(f,g){var e=Ext.util.JSON.decode(f.responseText);var h=(e.success==undefined)?true:e.success;if(h){e.org=d;this.setData(e)}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_load_user,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};iNet.Ajax.request({url:"jsonajax",params:b,method:"POST",scope:this,success:c,maskEl:this.bwrap})}else{this._cleanData()}},loadAccount:function(a){if(a!=""){var b={iwct:"loadUserContent",iwa:"READ_WRITE",action:"loadfulllotus",uname:a};this.update=true;iNet.Ajax.request({url:"jsonajax",params:b,scope:this,method:"POST",success:function(d,e){var c=Ext.util.JSON.decode(d.responseText);var f=(c.success==undefined)?true:c.success;if(f){this.setData(c)}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_load_account,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},failure:function(c,d){},maskEl:this.bwrap})}else{this._cleanData()}},onSave:function(){if(this._owner.edit==false){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_user_not_permit_update_user,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var d="update";var c=this.validateUser();if(c!=""){Ext.MessageBox.show({title:iwebos.message.org.message,msg:c,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var a=this.getData();var e={iwct:"userContent",iwa:"READ_WRITE"};if(!this.update){d="save"}else{d="update"}e.action=d;var b=function(g,h){var f=Ext.util.JSON.decode(g.responseText);var j=(f.success==undefined?true:f.success);if(j&&f.uname!=undefined){a.uname=f.uname;this._owner.uname=f.uname;if(d=="save"){this.update=true;this._fnHandleAfterSaving();var i=Ext.getCmp("manage-user-search-main-tab");var l=i.grid.store;a.fullname=a.lname+" "+a.mname+" "+a.fname;a.id=a.uname;l.addData(a)}else{var i=Ext.getCmp("manage-user-search-main-tab");var l=i.grid.store;var k=l.getById(a.uname);if(k){k.data.fullname=a.lname+" "+a.mname+" "+a.fname;k.data.email=a.email;k.data.title=a.title;k.commit()}else{a.fullname=a.lname+" "+a.mname+" "+a.fname;a.id=a.uname;l.addData(a)}}this._fillDataToGrid(f.list);Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_user_saving_successful,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}else{if(f.error=="exist"){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_user_add_exist_user,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{if(f.error=="invaliduname"){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_user_invalid_user_name,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_user_saving_user,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}}};e.object=Ext.util.JSON.encode(a);e.action=d;iNet.Ajax.request({url:"jsonajax",params:e,scope:this,method:"POST",success:b,failure:function(f,g){},maskEl:this.bwrap})},_createMailAccount:function(){this._onOpenMailAccountDialog(null,true)},_contextMenu:function(a){a.stopEvent();this.mailMenu=new Ext.menu.Menu({items:[{id:"account-menu-create-email-account",text:iwebos.message.mail.create.add,iconCls:"icon-mail-add",scope:this,handler:this._createMailAccount.createDelegate(this)}]});this.mailMenu.showAt(a.getXY())},_rowContextMenu:function(b,a,d){d.stopEvent();b.getSelectionModel().selectRow(a);var c=b.getSelectionModel().getSelections()[0];if(!!c){this.mailMenu=new Ext.menu.Menu({items:[{id:"account-menu-add-email-account",text:iwebos.message.org.user_add_email,iconCls:"icon-mail-add",scope:this,handler:this._createMailAccount.createDelegate(this)},{id:"account-menu-update-email-account",text:iwebos.message.mail.update_email_account,iconCls:"icon-mail-update",scope:this,handler:this._onUpdateMailAccount.createDelegate(this)},{id:"account-menu-delete-email-account",text:iwebos.message.mail.delete_email_account,iconCls:"icon-mail-del",scope:this,handler:this._onRemoveMailAccount.createDelegate(this)}]});var e=this._isEdit(c.data);Ext.getCmp("account-menu-update-email-account").setDisabled(!e);Ext.getCmp("account-menu-delete-email-account").setDisabled(!e);this.mailMenu.showAt(d.getXY())}},_onDoubleClick:function(d,c,f){f.stopEvent();var b=d.store.getAt(c);var a=b.data;this._onOpenMailAccountDialog(a,this._isEdit(a))},_isEdit:function(a){return true},_getEditDomains:function(){var b=Ext.getCmp("manage-user-search-toolbar");var f=b.getOrgs();var e=[];var d;var c=0;for(var a=0;a<f.length;a++){d=f[a];if(d.edit){e[c]=d;c++}}return e},_onRemoveMailAccount:function(){var a=this.grid.getSelectionModel().getSelections()[0];if(!a){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_user_delete_email,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}this.grid.store.remove(a);this.__fnHandleFunction()},_cleanData:function(){this.__fnHandleFunction();var a=false;var b=Ext.getCmp(this.unameId);b.setValue("");b.setDisabled(a);this.originalIcon=true;document.getElementById(this.checkExistHtmlId).innerHTML=String.format(this.linkHtml,this.buttonIconCls);var c=Ext.getCmp(this.pwdId);c.setDisabled(a);c.setValue("");c=Ext.getCmp(this.confirmPwdId);c.setDisabled(a);c.setValue("");c=Ext.getCmp(this.emailCheckId);c.setValue(true);c=Ext.getCmp(this.emailId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.lnameId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.mnameId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.fnameId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.employeeNumberId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.titleId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.workPhoneId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.homePhoneId);c.setValue("");c.setDisabled(a);c=Ext.getCmp(this.mobileId);c.setValue("");c.setDisabled(a);Ext.getCmp(this.orgId).setValue(this._owner.org);this.grid.setDisabled(a);this.grid.store.removeAll();this.action="save";this.update=false;this._owner.uname=undefined;this._owner.edit=true;c=Ext.getCmp(this.emailCheckId);if(c){c.setVisible(!a)}c=Ext.getCmp(this.emailForwardPanelId);if(c){c.setVisible(!a)}},_fnHandleAfterSaving:function(){var a=Ext.getCmp(this.unameId);a.setDisabled(true);a=Ext.getCmp(this.pwdId);a.setDisabled(true);a=Ext.getCmp(this.confirmPwdId);a.setDisabled(true);a=Ext.getCmp(this.emailCheckId);a.setValue(false);a.setVisible(false);a=Ext.getCmp(this.emailForwardPanelId);a.setVisible(false)},__fnHandleFunction:function(){var b=Ext.getCmp("previewPanel");var a=Ext.getCmp(this.emailsId);b.setVisible(false)},fnDoAction:function(a,b){if(this.actions!==undefined&&this.actions[b.id]!==undefined&&typeof this.actions[b.id]=="function"){this.actions[b.id]()}},__resizePanel:function(){Ext.EventManager.fireWindowResize();var a=Ext.getCmp(this.panelViewId);var b=this.getSize().height;a=Ext.getCmp(this.emailsId);a.setHeight(b-225)}}); 
iNet.iwebos.ui.org.DeleteUserDialog=function(f,b){this.viewer=f;Ext.apply(this,b);this.prefix=(!this.prefix)?"delete-user-dialog":this.prefix;this.deleteEmailCheckId=this.prefix+"-delete-email-check-id";this.notDeleteEmailCheckId=this.prefix+"-not-delete-email-check-id";this.deleteAllEmailCheckId=this.prefix+"-delete-all-email-check-id";this._owner={};var h=new Ext.form.Radio({id:this.deleteEmailCheckId,boxLabel:iwebos.message.org.user_select_delete_email_from_grid,name:"radio-delete-email-group",anchor:"100%",checked:false});var j=new Ext.form.FormPanel({region:"north",frame:true,border:false,autoHeight:true,anchor:"100%",layout:"form",bodyStyle:"padding: 2px;",items:[{border:false,html:iwebos.message.org.user_delete_user_out_org_and_email},{xtype:"radiogroup",labelSeparator:"",columns:1,items:[{id:this.deleteAllEmailCheckId,boxLabel:iwebos.message.org.user_delete_all_email,name:"radio-delete-email-group",anchor:"100%",checked:true},{id:this.notDeleteEmailCheckId,boxLabel:iwebos.message.org.user_non_delete_email,name:"radio-delete-email-group",anchor:"100%",checked:false},h]}]});var m={field:"uid",direction:"DESC"};var e={field:"uid",direction:"DESC"};var a=Ext.data.Record.create([{name:"id",mapping:"email",type:"string"},{name:"uid",mapping:"uid",type:"string"},{name:"symbol",mapping:"symbol",type:"string"},{name:"domain",mapping:"domain",type:"string"}]);var i=new Ext.data.JsonReader({totalProperty:"results",root:"list",id:"uid"},a);var d=new Ext.grid.CheckboxSelectionModel();var g=new Ext.grid.ColumnModel([d,{header:iwebos.message.mail.account,dataIndex:"uid",fixed:true,width:200},{header:"@",dataIndex:"symbol",fixed:true,width:24},{header:iwebos.message.mail.domain,dataIndex:"domain",width:100}]);var k=function(n){var o=n.data.read;return""};var l={iwct:"loadMailAccountContent",iwa:"READ_WRITE",action:"loadall"};this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"delete-user-dialog-grid",region:"center",anchor:"100%",autoScroll:true,border:true,url:"jsonajax",method:"POST",baseParams:l,loadFirst:false,sortInfo:m,reader:i,rowClass:k,dsort:e,cm:g,sm:d,filter:{data:"all"},view:new Ext.grid.GridView({forceFit:true})});var c=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[j,this.grid]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;this.grid.setDisabled(true);h.on("check",this.onSelectEmail,this);iNet.iwebos.ui.org.DeleteUserDialog.superclass.constructor.call(this,{id:"delete-user-dialog",title:iwebos.message.org.user_delete_user,iconCls:"icon-mail-del",region:"center",anchor:"100%",width:520,height:470,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[c],buttons:[{text:iwebos.message.org.ok,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.org.DeleteUserDialog,iNet.iwebos.ui.common.dialog.TitleDialog,{ttitle:iwebos.message.org.user_select_email_to_delete,btilte:iwebos.message.org.user_select_email_to_delete,__onLoadEmail:function(a){if(this._owner.load!=true&&a!=undefined&&a!=""){this._owner.load=true;var b=[{key:"uname",value:a}];this.grid.handleSearchEvent(b)}},onSelectEmail:function(a,b){this.__onLoadEmail(this._owner.uname);this.grid.setDisabled(!b)},setData:function(a,b){this._owner.uname=a;this._owner.action=b},fnOkHandler:function(){var d=[];var c=Ext.getCmp(this.deleteAllEmailCheckId).getValue();if(!c&&Ext.getCmp(this.deleteEmailCheckId).getValue()){var b=this.grid.getSelectionModel().getSelections();if(b!==undefined&&b.length!=0){for(var a=0;a<b.length;a++){d[a]={email:b[a].data.id}}}}if(this._owner.action.scope){this._owner.action.fn.apply(this._owner.action.scope,[this._owner.uname,c,d])}this.destroy()},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.org.GroupPanel=function(f,a){this.viewer=f;Ext.apply(this,a);this.prefix=(!this.prefix)?"manage-group":this.prefix;this.tabId=this.prefix+"-tab";this.organizationId=this.prefix+"-organization-id";this.gridId=this.prefix+"-grid-id";this._toolbar=new Ext.app.SearchField({width:200,onTrigger2Click:this._fnSearch.createDelegate(this)});this._orgStore=new Ext.data.JsonStore({fields:[{name:"orgId",mapping:"id",type:"string"},{name:"organization",mapping:"disname",type:"string"}]});var h=new Ext.form.ComboBox({id:this.organizationId,store:this._orgStore,displayField:"organization",valueField:"orgId",width:300,forceSelection:true,readOnly:false,mode:"local",triggerAction:"all",emptyText:"",selectOnFocus:false});var c=new Ext.Panel({frame:false,region:"north",border:false,height:25,tbar:[this._toolbar,h]});var k={field:"name",direction:"ASC"};var b={field:"name",direction:"ASC"};var i=Ext.data.Record.create([{name:"name",mapping:"name",type:"string"},{name:"description",mapping:"description",type:"string"}]);var j=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"name"},i);var g=new Ext.grid.ColumnModel([{header:iwebos.message.org.group_name,dataIndex:"name",width:0.4},{header:iwebos.message.org.group_description,dataIndex:"description",width:0.6}]);var e={iwct:"loadGroupContent",iwa:"view",action:"search"};this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:this.gridId,region:"center",autoScroll:true,url:"jsonajax",method:"POST",baseParams:e,loadFirst:false,reader:j,sortInfo:k,dsort:b,cm:g,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),filter:{data:"all"}});var d=new Ext.Panel({region:"center",layout:"border",frame:false,border:false,items:[c,this.grid]});d.on("resize",this.__fnResizePanel,this);this._toolbar.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});this.grid.on("contextmenu",this._contextMenu,this,{stopEvent:true});this.grid.on("rowcontextmenu",this._rowContextMenu,this,{stopEvent:true});this.grid.on("rowdblclick",this._onDoubleClick,this);h.on("select",this._fnSearch,this,{stopEvent:true});this.actions={"group-create-new":this._onAddGroup.createDelegate(this)};iNet.iwebos.ui.org.GroupPanel.superclass.constructor.call(this,{id:this.tabId,layout:"border",anchor:"100%",iconCls:"icon-create-group",title:iwebos.message.org.group_management,header:false,enableTabScroll:true,autoScroll:true,frame:false,border:false,closable:true,layout:"border",items:[d]});this.on("activate",this.__fnResizePanel,this)};Ext.extend(iNet.iwebos.ui.org.GroupPanel,Ext.Panel,{setOrganization:function(a){this._orgStore.removeAll();this._orgStore.loadData(a);this._orgStore.sort("organization");var c=this._orgStore.getAt(0);if(!!c){var b=Ext.getCmp(this.organizationId);b.setValue(c.get("orgId"))}this._fnSearch()},_fnSearch:function(){var c=[];var b=this._toolbar.getRawValue();c.push({key:"key",value:b});var a=Ext.getCmp(this.organizationId).getValue();c.push({key:"org",value:a});this._toolbar.fireEvent("search",c)},getSelectedOrg:function(){return Ext.getCmp(this.organizationId).getValue()},_onAddGroup:function(){var b=Ext.getCmp("manage-user-search-main-tab");var a=Ext.getCmp("manage-group-create-new-tab");if(!a){a=new iNet.iwebos.ui.org.CreateGroupPanel();b.add(a).show()}b.setActiveTab(a);a.loadData(Ext.getCmp(this.organizationId).getValue(),null);return a},_onOpenGroupTab:function(c){var b=Ext.getCmp("manage-user-search-main-tab");var a=Ext.getCmp("manage-group-create-new-tab");if(!a){a=new iNet.iwebos.ui.org.CreateGroupPanel();b.add(a).show()}b.setActiveTab(a);a.loadData(Ext.getCmp(this.organizationId).getValue(),c);return a},_contextMenu:function(a){a.stopEvent();this.mailMenu=new Ext.menu.Menu({items:[{id:"account-menu-create-email-account",text:iwebos.message.org.group_create_group,iconCls:"icon-menu-group-add-new",scope:this,handler:this._onAddGroup.createDelegate(this)}]});this.mailMenu.showAt(a.getXY())},_onDoubleClick:function(d,c,f){f.stopEvent();var b=d.store.getAt(c);var a=b.data;this._onOpenGroupTab(a.name)},_onUpdate:function(){var a=this.grid.getSelectionModel().getSelections()[0];if(!a){return}this._onOpenGroupTab(a.data.name)},_onDelete:function(){var __store=this.grid.store;var __org=Ext.getCmp(this.organizationId).getValue();var __selection=this.grid.getSelectionModel().getSelections()[0];if(!__selection){return}var __data=__selection.data;if(__data!=null){var onOk=function(answer){if(answer=="ok"||answer=="yes"){var fnSuccess=function(response,options){var result=eval("("+response.responseText+")");if(result.success){__store.remove(__selection)}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_group_delete_group,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var params={iwct:"groupContent",iwa:"READ_WRITE",action:"delete"};var object={};object.name=__data.name;object.org=__org;params.object=Ext.util.JSON.encode(object);iNet.Ajax.request({url:"jsonajax",method:"POST",params:params,success:fnSuccess,scope:this})}};Ext.MessageBox.confirm(iwebos.message.org.message,iwebos.message.org.message_group_warning_delete_group,onOk)}},_rowContextMenu:function(b,a,d){d.stopEvent();b.getSelectionModel().selectRow(a);var c=b.getSelectionModel().getSelections()[0];if(!!c){this.mailMenu=new Ext.menu.Menu({items:[{id:"manager-group-menu-add-group",text:iwebos.message.org.group_create_group,iconCls:"icon-menu-group-add-new",scope:this,handler:this._onAddGroup.createDelegate(this)},{id:"manager-group-menu-update-group",text:iwebos.message.org.group_update_group,iconCls:"icon-mail-update",scope:this,handler:this._onUpdate.createDelegate(this)},{id:"manager-group-menu-delete-group",text:iwebos.message.org.group_delete_group,iconCls:"icon-mail-del",scope:this,handler:this._onDelete.createDelegate(this)}]});this.mailMenu.showAt(d.getXY())}},fnDoAction:function(a,b){if(this.actions!==undefined&&this.actions[b.id]!==undefined&&typeof this.actions[b.id]=="function"){this.actions[b.id]()}},__fnResizePanel:function(a){Ext.EventManager.fireWindowResize()}}); 
iNet.iwebos.ui.org.MemberGridPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.prefix=(!this.prefix)?"member-grid":this.prefix;this.gridId=this.prefix+"-grid-id";var b={field:"fullname",direction:"ASC"};var e={field:"fullname",direction:"ASC"};this._owner={};var d=new Ext.data.Record.create([{name:"id",mapping:"uname",type:"string"},{name:"uname",mapping:"uname",type:"string"},{name:"fullname",mapping:"fullname",type:"string"}]);var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"uname"},d);var f=new Ext.grid.CheckboxSelectionModel();var c=new Ext.grid.ColumnModel([f,{header:iwebos.message.org.user_account,dataIndex:"uname",width:0.3},{header:iwebos.message.org.user_full_name,dataIndex:"fullname",width:0.7}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({region:"center",autoScroll:true,url:"jsonajax",method:"POST",loadFirst:false,reader:a,sortInfo:b,dsort:e,cm:c,sm:f,filter:{data:"all"},view:new Ext.grid.GridView({forceFit:true}),tbar:[{id:"btn-add-new_user",xtype:"button",text:iwebos.message.org.group_select_new_user,iconCls:"icon-mail-add",scope:this,handler:this._openSearchUserDialog.createDelegate(this)},{id:"btn-delete-current_user",xtype:"button",text:iwebos.message.org.group_remove_user,iconCls:"icon-mail-del",scope:this,handler:this._onRemove.createDelegate(this)}]});this.layout="border";this.items=[this.grid];this.grid.on("contextmenu",this._contextMenu,this,{stopEvent:true});this.grid.on("rowcontextmenu",this._rowContextMenu,this,{stopEvent:true});this.grid.on("keypress",this.__handleKeyEvent,this,{stopEvent:true});iNet.iwebos.ui.org.MemberGridPanel.superclass.initComponent.call(this)},__handleKeyEvent:function(a){LotusService.handleKeyEventOnGrid(this.grid,a)},_openSearchUserDialog:function(){var a=new iNet.iwebos.ui.org.SearchUserDialog();var b={fn:this._handleSelectUser,scope:this};a.setData(this._owner.defaultOrg,b);a.show()},setDefaultOrg:function(a){this._owner.defaultOrg=a},_handleSelectUser:function(d){for(var a=0;a<d.length;a++){var b=d[a].data;var c={};c.id=b.uname;c.uname=b.uname;c.fullname=b.fullname;this.grid.store.addData(c)}},_rowContextMenu:function(b,a,d){d.stopEvent();b.getSelectionModel().selectRow(a);var c=b.getSelectionModel().getSelections()[0];if(!!c){this.mailMenu=new Ext.menu.Menu({items:[{id:"group-menu-add-member",text:iwebos.message.org.group_select_new_user,iconCls:"icon-mail-add",scope:this,handler:this._openSearchUserDialog.createDelegate(this)},{id:"group-menu-remove-member",text:iwebos.message.org.group_remove_user,iconCls:"icon-mail-del",scope:this,handler:this._onRemove.createDelegate(this)}]});this.mailMenu.showAt(d.getXY())}},_contextMenu:function(a){a.stopEvent();this.mailMenu=new Ext.menu.Menu({items:[{id:"account-menu-create-email-account",text:iwebos.message.org.group_select_new_user,iconCls:"icon-mail-add",scope:this,handler:this._openSearchUserDialog.createDelegate(this)}]});this.mailMenu.showAt(a.getXY())},_onRemove:function(){var a=this.grid.getSelectionModel().getSelections();if(!a||a.length==0){Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_group_select_user_delete_out_of_group,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}for(var b=0;b<a.length;b++){this.grid.store.remove(a[b])}},removeAll:function(){this.grid.store.removeAll()},getDatas:function(){var a=this.grid.store;if(a.getCount()>0){var c=[];for(var b=0;b<a.getCount();b++){c[b]=a.getAt(b).data}return c}return null},addDatas:function(b){var c=this.grid.store;c.removeAll();if(b!=undefined&&b!=null&&b.length>0){var e=[];for(var d=0;d<b.length;d++){var a=b[d];e[d]=new Ext.data.Record({id:a.uname,uname:a.uname,fullname:a.fullname})}c.add(e);c.sort("fullname","ASC")}}}); 
iNet.iwebos.ui.org.SearchUserDialog=function(f,a){this.viewer=f;Ext.apply(this,a);var j={field:"fullname",direction:"ASC"};var d={field:"fullname",direction:"ASC"};var e={iwct:"searchUserContent",iwa:"view",action:"search"};var h=Ext.data.Record.create([{name:"id",mapping:"uname",type:"string"},{name:"uname",mapping:"uname",type:"string"},{name:"fullname",mapping:"fullname",type:"string"},{name:"title",mapping:"title",type:"string"},{name:"email",mapping:"email",type:"string"}]);var i=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"uname"},h);var c=new Ext.grid.CheckboxSelectionModel();var g=new Ext.grid.ColumnModel([c,{header:iwebos.message.org.user_account,dataIndex:"uname",width:0.2},{header:iwebos.message.org.user_full_name,dataIndex:"fullname",width:0.3},{header:iwebos.message.org.user_title,dataIndex:"title",width:0.2},{header:iwebos.message.org.user_email,dataIndex:"email",width:0.3}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({region:"center",autoScroll:true,url:"jsonajax",method:"POST",baseParams:e,loadFirst:false,reader:i,sortInfo:j,dsort:d,cm:g,sm:c,filter:{data:"all"},view:new Ext.grid.GridView({forceFit:true})});this.toolbar=new iNet.iwebos.ui.org.SearchUserToolbar({id:"search-user-dialog-tool-id",region:"north",width:"100%",height:30,prefix:"search-user-dialog-prefix",firstLoad:false,frame:false,border:false,store:this.grid.store});this.toolbar.on("search",this.grid.handleSearchEvent,this.grid,{stopEvent:true});var b=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[this.toolbar,this.grid]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;this.grid.on("keypress",this.__handleKeyEvent,this);iNet.iwebos.ui.org.SearchUserDialog.superclass.constructor.call(this,{id:"mail-dlgsearch-account",title:iwebos.message.org.user_find_user_in_org,iconCls:"icon-email-search",region:"center",anchor:"100%",width:600,height:500,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[b],buttons:[{text:iwebos.message.org.ok,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]});this.toolbar.hideOrganization();this.toolbar.hideGroup()};Ext.extend(iNet.iwebos.ui.org.SearchUserDialog,iNet.iwebos.ui.common.dialog.TitleDialog,{ttitle:iwebos.message.org.user_select_user,btilte:iwebos.message.org.user_select_user,__handleKeyEvent:function(a){LotusService.handleKeyEventOnGrid(this.grid,a)},setData:function(a,b){this.toolbar.setDefaultOrg(a);this.__action=b;this.toolbar.search()},fnOkHandler:function(){var a=this.grid.getSelectionModel().getSelections();if(a!==undefined&&a.length!=0){if(this.__action.scope){this.__action.fn.apply(this.__action.scope,[a])}this.destroy()}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.message_group_select_user_for_group,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.org.SearchUserToolbar=Ext.extend(Ext.Panel,{firstLoad:true,initComponent:function(){this.prefix=(!this.prefix)?"search-user-toolbar":this.prefix;this.organizationId=this.prefix+"-organization";this.groupId=this.prefix+"-group";this._owner={};this._owner.defaultGroup="";this._owner.defaultOrg="";this.toolbarSearch=new Ext.app.SearchField({width:200,onTrigger2Click:this.search.createDelegate(this)});this.id=this.nextId("cmb",1);var c={iwct:"loadMailDomainContent",iwa:"view",action:"loadAll"};this._orgStore=new Ext.data.JsonStore({url:"jsonajax",baseParams:c,fields:[{name:"orgId",mapping:"id",type:"string"},{name:"organization",mapping:"disname",type:"string"},{name:"edit",mapping:"edit",type:"boolean"}]});var b=new Ext.form.ComboBox({id:this.organizationId,store:this._orgStore,displayField:"organization",valueField:"orgId",width:240,forceSelection:true,readOnly:false,mode:"local",triggerAction:"all",emptyText:"",selectOnFocus:true});this._groupStore=new Ext.data.JsonStore({fields:[{name:"name",mapping:"name",type:"string"}]});var a=new Ext.form.ComboBox({id:this.groupId,store:this._groupStore,displayField:"name",valueField:"name",width:180,forceSelection:true,typeAhead:true,readOnly:true,mode:"local",triggerAction:"all",emptyText:"",selectOnFocus:false});var d=[this.toolbarSearch,b,a];if(this.store){this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.store,displayInfo:false});if(Ext.isGecko2){d[d.length]="-"}else{d[d.length]="->"}d[d.length]=this.pagingBar}this.tbar=d;iNet.iwebos.ui.org.SearchUserToolbar.superclass.initComponent.call(this);if(this.firstLoad){b.on("select",this._onLoadGroup,this,{stopEvent:true});this._orgStore.on("load",this._onLoadDomain,this,{stopEvent:true});this._orgStore.load();this._orgStore.sort("organization")}},_onLoadDomain:function(c,b,d){var a=Ext.getCmp(this.organizationId);var e=this._orgStore.getAt(0);if(e){a.setValue(e.get("orgId"));this._onLoadGroup(Ext.getCmp(this.organizationId))}},_onLoadGroup:function(combo){var __org=combo.getValue();this._groupStore.removeAll();if(__org==null||__org==""){return}var __fnSuccess=function(result,request){var __data=result.responseText;__data=eval("("+__data+")");if(__data.list){var __groups=__data.list;this._groupStore.loadData(__groups);this._groupStore.sort("name","ASC");if(__groups.length>0){Ext.getCmp(this.groupId).setValue(__groups[0].name);this.search()}}else{Ext.MessageBox.show({title:iwebos.message.org.message,msg:iwebos.message.org.error_group_load_all_group_in_org,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var __param={iwct:"loadGroupContent",iwa:"READ_WRITE",action:"loadall"};__param.org=__org;iNet.Ajax.request({url:"jsonajax",params:__param,method:"POST",scope:this,success:__fnSuccess})},search:function(){var e=[];var b=this.toolbarSearch.getRawValue();e.push({key:"key",value:b});var a=Ext.getCmp(this.groupId);if(a.isVisible()){var d=a.getValue();e.push({key:"group",value:d})}else{e.push({key:"group",value:this._owner.defaultGroup})}var f=Ext.getCmp(this.organizationId);if(f.isVisible()){var c=f.getValue();e.push({key:"org",value:c})}else{e.push({key:"org",value:this._owner.defaultOrg})}this.fireEvent("search",e)},getOrgs:function(){var b=this._orgStore.getCount();var c=[];if(b>0){for(var a=0;a<b;a++){c[a]=this._orgStore.getAt(a).data}}return c},getSelectedOrg:function(){return Ext.getCmp(this.organizationId).getValue()},getSelectedGroup:function(){return Ext.getCmp(this.groupId).getValue()},setDefaultOrg:function(a){this._owner.defaultOrg=a;Ext.getCmp(this.organizationId).setValue(a)},setDefaultGroup:function(a){this._owner.defaultGroup=a;Ext.getCmp(this.groupId).setValue(a)},hideOrganization:function(){Ext.getCmp(this.organizationId).hide()},hideGroup:function(){Ext.getCmp(this.groupId).hide()},nextId:function(e,a){var d=String(new Date().getTime()).substr(a);var c="abcdefghlmnopqrstuvwxyzacsdsdsssc";for(var b=0;b<a;b++){d+=c.charAt(Math.floor(Math.random()*26))}return this.prefix+"-"+e+"-"+d+"-id"}}); 
