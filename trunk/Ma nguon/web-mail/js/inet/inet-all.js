/*****************************************************************
   Copyright 2008 by iNet Solutions (info@truthinet.com.vn)

   Licensed under the iNet Solutions Corp.,;
   you may not use this file except in compliance with the License.
   You may obtain a copy of the License at

       http://www.truthinet.com/licenses

   Unless required by applicable law or agreed to in writing, software
   distributed under the License is distributed on an "AS IS" BASIS,
   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
   See the License for the specific language governing permissions and
   limitations under the License.
*****************************************************************/
iNet.iwebos.data.db.Table=function(c,a,b){this.conn=c;this.name=a;this.keyName=b};iNet.iwebos.data.db.Table.prototype={update:function(a,d,b){var c=this.keyName+" = ?";return this.updateBy(a,c,[a[this.keyName]],d,b)},updateBy:function(b,e,d,h,i){var j="UPDATE "+this.name+" SET ";var c=[],f=[];for(var g in b){if(b.hasOwnProperty(g)){c[c.length]=g+" = ?";f[f.length]=b[g]}}for(var g in d){if(d.hasOwnProperty(g)){f[f.length]=d[g]}}j=[j,c.join(",")," WHERE ",e].join("");return this.conn.execBy(j,f,h,i)},insert:function(d,i,f){var g="INSERT INTO "+this.name+" ";var b=[],h=[],c=[];for(var e in d){if(d.hasOwnProperty(e)){b[b.length]=e;h[h.length]="?";c[c.length]=d[e]}}g=[g,"(",b.join(","),") VALUES (",h.join(","),")"].join("");return this.conn.execBy(g,c,i,f)},selectBy:function(c,a,e,b){var d="SELECT * FROM "+this.name;if(c){d+=" WHERE "+c}a=a||{};return this.conn.queryBy(d,a,e,b)},select:function(b,c,a){return this.selectBy(b,null,c,a)},removeBy:function(c,a,e,b){var d="DELETE FROM "+this.name;if(c){d+=" WHERE "+c}a=a||{};this.conn.execBy(d,a,e,b)},remove:function(b,c,a){this.removeBy(b,null,c,a)},save:function(a,c,b){if(this.exists(a[this.keyName])){this.update(a,c,b)}else{this.insert(a,c,b)}},exists:function(c,b,a){return !!this.lookup(c,b,a)},lookup:function(c,b,a){return this.selectBy(this.keyName+" = ?",[c],b,a)[0]||null}}; 
iNet.iwebos.data.db.DBProxy=function(e,d,c,b,a,f){iNet.iwebos.data.db.DBProxy.superclass.constructor.call(this);this.conn=e;this.table=this.conn.getTable(d,c);this.keyName=c;this.store=b;this.transaction=f||false;if(a!==true){this.store.on("add",this.onAdd,this);this.store.on("update",this.onUpdate,this);this.store.on("remove",this.onRemove,this)}this.addEvents({synchadd:true,synchupdate:true,synchremove:true})};Ext.extend(iNet.iwebos.data.db.DBProxy,Ext.data.DataProxy,{load:function(b,d,g,i,j){if(!this.conn.isOpen()){this.conn.on("open",function(){this.load(b,d,g,i,j)},this,{single:true});return}if(this.fireEvent("beforeload",this,b,d,g,i,j)!==false){var f=b.where||"";var e=b.args||[];var h=b.groupBy;var c=b.sort;var a=b.dir;if(h||c){f+=" ORDER BY ";if(h&&h!=c){f+=h+" ASC, "}f+=c+" "+(a||"ASC")}this.table.selectBy(f,e,this.onLoad.createDelegate(this,[{callback:g,scope:i,arg:j,reader:d}],0))}else{g.call(i||this,null,j,false)}},onLoad:function(c,b,f,d){if(b===false){this.fireEvent("loadexception",this,null,c.arg,f);c.callback.call(c.scope||window,null,c.arg,false);return}var a=c.reader.readRecords(b);this.fireEvent("load",this,b,c.arg);c.callback.call(c.scope||window,a,c.arg,true)},processData:function(c){var b=this.store.fields;var a={};for(var d in c){var f=b.key(d),e=c[d];if(f){if(f.type=="date"){a[d]=e?e.format(Ext.sql.Proxy.DATE_FORMAT,10):""}else{if(f.type=="boolean"){a[d]=e?1:0}else{a[d]=e}}}}return a},onAdd:function(f,a,b){var e=(this.transaction)?this.conn.getTransaction():null;for(var d=0;d<a.length;d++){try{if(e!==null){e.begin()}this.table.insert(this.processData(a[d].data));if(e!==null){e.commit()}if(a[d].data.dirty){this.fireEvent("synchadd",a[d].data);a[d].data.dirty=false}}catch(c){if(e!==null){e.rollback()}}}},onUpdate:function(f,a){var e=a.getChanges();var d=this.table.keyName;var c=(this.transaction)?this.conn.getTransaction():null;try{if(c!==null){c.begin()}this.table.updateBy(this.processData(e),d+" = ?",[a.data[d]]);a.commit(true);if(c!==null){c.commit()}if(a.data.dirty){fireEvent("synchupdate",a.data);a.dirty=false}}catch(b){if(c!==null){c.rollback()}}},onRemove:function(f,a,b){var e=this.table.keyName;var d=(this.transaction)?this.conn.getTransaction():null;try{if(d!==null){d.begin()}this.table.removeBy(e+" = ?",[a.data[e]]);if(d!==null){d.rollback()}if(a.data.dirty){fireEvent("synchdelete",[a.data]);a.data.dirty=false}}catch(c){if(d!==null){d.rollback()}}}}); 
iNet.iwebos.data.db.Connection=function(a){Ext.apply(this,a);iNet.iwebos.data.db.Connection.superclass.constructor.call(this);this.addEvents({open:true,close:true})};Ext.extend(iNet.iwebos.data.db.Connection,Ext.util.Observable,{maxResults:10000,openState:false,open:function(a,c,b){},close:function(){},exec:function(b,c,a){},execBy:function(c,a,d,b){},query:function(b,c,a){},queryBy:function(c,a,d,b){},isOpen:function(){return this.openState},getTransaction:function(){return new iNet.iwebos.data.db.Transaction(this)},getTable:function(a,b){return new iNet.iwebos.data.db.Table(this,a,b)},createTable:function(b){var f=b.name;var h=b.key;var c=b.fields;var g=b.callback;var i=b.scope;if(!(c instanceof Array)){c=c.items}var a=[];for(var d=0;d<c.length;d++){var e=c[d],k=e.name;switch(e.type){case"int":case"bool":case"boolean":k+=" INTEGER";break;case"float":case"double":k+=" REAL";break;default:k+=" TEXT";break}if(e.allowNull===false||e.name==h){k+=" NOT NULL"}if(e.name==h){k+=" PRIMARY KEY"}if(e.unique===true){k+=" UNIQUE"}a[a.length]=k}var j=["CREATE TABLE IF NOT EXISTS ",f,"(",a.join(","),")"].join("");this.exec(j,g,i)}});iNet.iwebos.data.db.Connection.getInstance=function(a,b){if(window.google&&google.gears){return new iNet.iwebos.data.db.GearsConnection(b)}return new iNet.iwebos.data.db.Connection(b)}; 
iNet.iwebos.data.db.GearsConnection=Ext.extend(iNet.iwebos.data.db.Connection,{open:function(a,c,b){this.conn=google.gears.factory.create("beta.database","1.0");this.conn.open(a);this.openState=true;Ext.callback(c,b,[this]);this.fireEvent("open",this)},close:function(){this.conn.close();this.openState=false;this.fireEvent("close",this)},exec:function(b,c,a){this.conn.execute(b).close();Ext.callback(c,a,[true])},execBy:function(c,a,d,b){this.conn.execute(c,a).close();Ext.callback(d,b,[true])},query:function(d,e,c){var a=this.conn.execute(d);var b=this.readResults(a);Ext.callback(e,c,[b]);return b},queryBy:function(e,b,f,d){var a=this.conn.execute(e,b);var c=this.readResults(a);Ext.callback(f,d,[c]);return c},readResults:function(b){var e=[];if(b){var f=b.fieldCount();var a=[];for(var d=0;d<f;d++){a[d]=b.fieldName(d)}while(b.isValidRow()){var c={};for(var d=0;d<f;d++){c[a[d]]=b.field(d)}e[e.length]=c;b.next()}b.close()}return e},isOpen:function(){return this.openState},getTransaction:function(){return new iNet.iwebos.data.db.Transaction(this)},getTable:function(a,b){return new iNet.iwebos.data.db.Table(this,a,b)}}); 
iNet.iwebos.data.db.Transaction=function(a){this.conn=a};iNet.iwebos.data.db.Transaction.prototype={begin:function(b,a){if(this.conn.isOpen()){this.conn.exec("BEGIN",b,a)}},commit:function(b,a){if(this.conn.isOpen()){this.conn.exec("COMMIT",b,a)}},rollback:function(b,a){if(this.conn.isOpen()){this.conn.exec("ROLLBACK",b,a)}},transact:function(c,d,b){this.begin(d,b);try{c()}catch(a){this.rollback(d,b);throw a}this.commit(d,b)}}; 
iNet.ModuleMgr=function(){var a=new Ext.util.MixedCollection();return{register:function(c,b){a.add({id:c,value:b})},unregister:function(b){a.removeKey(b)},all:a,get:function(b){return a.get(b)}}}(); 
Ext.override(Date,{getFirstDateOfWeek:function(){var b=this.getDate()-this.getDay();if(b>0){return new Date(this.getFullYear(),this.getMonth(),b)}else{var a=this.getMonth()-1;var c=this.getFullYear();if(a<0){a=0;c=c-1}b=this._getDaysInMonth(a,c)+b;return new Date(c,a,b)}},getLastDateOfWeek:function(){var b=this.getDate()-this.getDay()+6;var d=this.getDaysInMonth();if(b<=d){return new Date(this.getFullYear(),this.getMonth(),b)}else{var a=this.getMonth()+1;var c=this.getFullYear();if(a>11){a=a-12;c=c+1}b=b-d;return new Date(c,a,b)}},getLastDateOfNextWeek:function(){var a=this.getLastDateOfWeek();a=a.add(Date.DAY,7);return a},_getDaysInMonth:function(c,b){var a=[31,28,31,30,31,30,31,31,30,31,30,31];var d=!!((b&3)==0&&(b%100||(b%400==0&&b)));if(c==1){return d?29:28}return a[c]}}); 
(function(){IDGeneratorStrategy=function(a){Ext.apply(this,a||{})};IDGeneratorStrategy.prototype={generateId:function(){},_getPrefix:function(){return this.prefix},_getSuffix:function(){return this.suffix}};NumberIDGeneratorStrategy=function(a){};NumberIDGeneratorStrategy=Ext.extend(IDGeneratorStrategy,{generateId:function(){var b=new Date();var a=Math.floor(Math.random()*1000);return(b.getTime()+a)}});AlphaIDGeneratorStrategy=function(a){Ext.apply(this,a||{})};AlphaIDGeneratorStrategy=Ext.extend(IDGeneratorStrategy,{generateId:function(){var e=this._getSize();var b=String(new Date().getTime()).substr(e);var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ";for(var d=0;d<len;d++){b+=a.charAt(Math.floor(Math.random()*26))}var c=this._getPrefix();if(c){b=c+"-"+b}c=this._getSuffix();if(c){b=b+"-"+c}return b},_getSize:function(){if(this.size==undefined){return 6}return((this.size==undefined||this.size<=0)?6:this.size)}});IDGenerator=function(a){var b=a||{};Ext.apply(this,b);this.Strategy=b.strategy||NumberIDGeneratorStrategy};IDGenerator.prototype={generate:function(){var a=new this.Strategy(this);return a.generateId()}}})(); 
iNet.iwebos.ui.common.control.FollowUpPanel=Ext.extend(Ext.grid.GridPanel,{width:180,minSize:180,collapsible:true,initComponent:function(){var e=this.operator||{};var r=this.url||"";var j=this.baseParams||{};if(this.url){delete this.url}if(this.baseParams){delete this.baseParams}if(this.operator){delete this.operator}if(!e.load){e.load={url:r,params:j}}this.operator=e;var q=(this.selectFirstRow==undefined?true:!!this.selectFirstRow);delete this.selectFirstRow;this.selectFirstRow=q;var p=Ext.data.Record.create([{name:"id",type:"int"},{name:"name",type:"string"},{name:"date",type:"int"},{name:"data",type:"int"},{name:"flag",type:"string"}]);var m=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},p);var i="date";var k=new Ext.data.HttpProxy({url:e.load.url,method:"POST"});var n={field:"date",direction:"DESC"};var c=new iNet.iwebos.ui.common.store.WebOSGroupingStore({proxy:k,sortInfo:n,groupField:i,reader:m,baseParams:j});var o=function(w){var s=new Date();var v=s.clearTime(true).getTime();var t=s.add(Date.DAY,1).clearTime(true).getTime();var x=s.getLastDateOfWeek().clearTime(true).getTime();var u=s.getLastDateOfNextWeek().clearTime(true).getTime();if(w>0){w=new Date(w).clearTime(true).getTime()}if(w===-1){return 0}if(w===0){return 5}if(w===t){return 2}if(w>t&&w<=x){return 3}if(w>x&&w<=u){return 4}return 1};c.sortData=function(u,t){t=t|"ASC";var v=this.fields.get(u).sortType;var s=function(x,w){var z=v(x.data[u]),y=v(w.data[u]);if(u==="date"){z=o(z);y=o(y)}return(z>y?1:(z<y)?-1:0)};this.data.sort(t,s);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(t,s)}};c=Ext.StoreMgr.lookup(c);this._bind(c);this.loadMask={msg:idesk.webos.message.load_data};var h=function(x){var s=new Date();var v=s.clearTime(true).getTime();var t=s.add(Date.DAY,1).clearTime(true).getTime();var y=s.getLastDateOfWeek().clearTime(true).getTime();var u=s.getLastDateOfNextWeek().clearTime(true).getTime();var w=(x==undefined||x===0)?0:x;if(w>0){w=new Date(w).clearTime(true).getTime()}if(w===-1){return'<div class="task-today"></div>'}else{if(w===0){return'<div class="task-nodate"></div>'}else{if(w===t){return'<div class="task-tomorrow"></div>'}else{if(w>t&&w<=y){return'<div class="task-week"></div>'}else{if(w>y&&w<=u){return'<div class="task-nextweek"></div>'}}}}}return'<div class="task-today"></div>'};var g=function(x){var s=new Date();var v=s.clearTime(true).getTime();var t=s.add(Date.DAY,1).clearTime(true).getTime();var y=s.getLastDateOfWeek().clearTime(true).getTime();var u=s.getLastDateOfNextWeek().clearTime(true).getTime();var w=(x==undefined||x===0)?0:x;if(w>0){w=new Date(w).clearTime(true).getTime()}if(w===-1){return iwebos.message.followup.important}else{if(w===0){return idesk.webos.message.paperwork.weekunavailable}else{if(w===t){return idesk.webos.message.paperwork.tomorrow}else{if(w>t&&w<=y){return idesk.webos.message.paperwork.weekin}else{if(w>y&&w<=u){return idesk.webos.message.paperwork.weeknext}}}}}return idesk.webos.message.paperwork.today};var d={width:24,fixed:true,dataIndex:"date",menuDisabled:true,header:'<div class="flag-col-hd"></div>',id:"flag-col",renderer:h,groupRenderer:g};var f={sortable:false,menuDisabled:true,dataIndex:"name"};var l=new iNet.iwebos.ui.mail.grid.StatusColumn({header:""});var a=new Ext.grid.ColumnModel([d,l,f]);this.cm=a;this.sm=new Ext.grid.RowSelectionModel({singleSelect:false});var b='{group} ({[values.rs.length]} {[values.rs.length > 0 ? "'+idesk.webos.message.paperwork.task+'":"No item"]})';this.view=new Ext.grid.GroupingView({forceFit:true,emptyText:idesk.webos.message.paperwork.emptyresult,groupTextTpl:b});iNet.iwebos.ui.common.control.FollowUpPanel.superclass.initComponent.call(this);this.addEvents("remove","update","view","save","dbevent");this.store.load();this.on("contextmenu",function(s){s.stopEvent(true)},this,{stopEvent:true});this.on("rowcontextmenu",this._bindContextMenu,this,{stopEvent:true});this.on("rowdblclick",this._rowDoubleClick,this,{stopEvent:true});this.on("dbevent",this._storedb,this,{stopEvent:true})},add:function(a){this._savedb(a)},remove:function(b){var a=this._findByData(b);if(a==null){return}this._remove(a)},update:function(c,b){var a=this._findByData(c);if(a==null){return}this._update(a,b)},_bind:function(a){if(this.selectFirstRow){if(this.store){this.store.un("load",this._onStoreLoad,this)}if(a){a.on("load",this._onStoreLoad,this)}}this.store=a},_onStoreLoad:function(){if(this.store&&this.store.getCount()>0){this.selModel.selectFirstRow()}},_bindContextMenu:function(b,a,c){WebOSGridService.handleSelection(b,a);if(!this.menu){this.menu=new Ext.menu.Menu({items:[{id:"fu-menu-ctx-view",text:iwebos.message.followup.view,iconCls:"icon-followup-view",scope:this,handler:this._onView},{id:"fu-menu-ctx-remove",text:iwebos.message.followup.remove,iconCls:"icon-followup-remove",scope:this,handler:this._onRemove},{id:"fu-menu-submnu-id",iconCls:"icon-followup-flags",text:iwebos.message.followup.flags,menu:{items:[{id:"fu-menu-ctx-today",text:iwebos.message.followup.today,iconCls:"icon-followup-today",scope:this,handler:this._onToday},{id:"fu-menu-ctx-tomorrow",text:iwebos.message.followup.tomorrow,iconCls:"icon-followup-tomorrow",scope:this,handler:this._onTomorrow},{id:"fu-menu-ctx-week",text:iwebos.message.followup.week,iconCls:"icon-followup-week",scope:this,handler:this._onWeek},{id:"fu-menu-ctx-nextweek",text:iwebos.message.followup.nextweek,iconCls:"icon-followup-nextweek",scope:this,handler:this._onNextWeek},{id:"fu-menu-ctx-others",text:iwebos.message.followup.others,iconCls:"icon-followup-others",scope:this,handler:this._onOthers}]}}]});this.menu.on("hide",this._onHideContextMenu,this)}c.stopEvent(true);this._handleMenu(this.menu);this.menu.showAt(c.getXY())},_handleMenu:function(e){if(this.getSelectionModel().getCount()<=0){return}var j=this.getSelectionModel().getSelections();var o=j[0];var i=new Date();var c=i.clearTime(true).getTime();var k=i.add(Date.DAY,1).clearTime(true).getTime();var b=i.getLastDateOfWeek().clearTime(true).getTime();var f=i.getLastDateOfNextWeek().clearTime(true).getTime();var d=o.data.date;if(d>0){d=new Date(d).clearTime(true).getTime()}var g=(d===0);var n=(d===k);var m=(d>k&&d<=b);var h=(d>b&&d<=f);var l=!(g||h||m||n);var a=e.items.get("fu-menu-submnu-id").menu;e.items.get("fu-menu-submnu-id").setDisabled(d===-1);e.items.get("fu-menu-ctx-remove").setDisabled(d===-1);a.items.get("fu-menu-ctx-today").setDisabled(l);a.items.get("fu-menu-ctx-tomorrow").setDisabled(n);a.items.get("fu-menu-ctx-week").setDisabled(m);a.items.get("fu-menu-ctx-nextweek").setDisabled(h);a.items.get("fu-menu-ctx-others").setDisabled(g)},_onHideContextMenu:function(a){if(this.ctxRow){Ext.fly(this.ctxRow).removeClass("x-node-ctx");this.ctxRow=null}},_onToday:function(){this._onUpdate(iNet.iwebos.ui.common.control.FollowUpPanel.TODAY)},_rowDoubleClick:function(d,c,g){g.stopEvent(true);var b=d.store.getAt(c)||{};var a=b.data||{};var f=this.operator||{};var e=f.view||{};if(e.fn){if(!e.scope){a=e.fn(a)}else{a=e.fn.apply(e.scope,[a])}}this.fireEvent("view",a||{})},_onView:function(){var d=this.operator||{};var c=d.view||{};if(this.getSelectionModel().getCount()<=0){return}var e=this.getSelectionModel().getSelections();var b=e[0];var a=b.data;if(c.fn){if(!c.scope){a=c.fn(a)}else{a=c.fn.apply(c.scope,[a])}}this.fireEvent("view",a||{})},_onRemove:function(){if(this.getSelectionModel().getCount()<=0){return}var b=this.getSelectionModel().getSelections();var c=[];for(var a=0;a<b.length;a++){c[a]=b[a].data.id}this._remove(c)},_onTomorrow:function(){this._onUpdate(iNet.iwebos.ui.common.control.FollowUpPanel.TOMORROW)},_onWeek:function(){this._onUpdate(iNet.iwebos.ui.common.control.FollowUpPanel.WEEK)},_onNextWeek:function(){this._onUpdate(iNet.iwebos.ui.common.control.FollowUpPanel.NEXT_WEEK)},_onOthers:function(){this._onUpdate(iNet.iwebos.ui.common.control.FollowUpPanel.OTHERS)},_remove:function(b){if(this.store){try{this._removedb(b)}catch(a){}}},_onUpdate:function(a){if(this.getSelectionModel().getCount()<=0){return}var b=this.getSelectionModel().getSelections();if(b){this._update(b,a)}},_findByData:function(c){if(this.store==null||this.store.getCount()==0){return null}var a=null;for(var b=0;b<this.store.getCount();b++){a=this.store.getAt(b);if(a.data.data===c){return a}}return null},_update:function(b,a){this._updatedb(b,a)},_getDate:function(d){var b=new Date();var e="";var f=d||iNet.iwebos.ui.common.control.FollowUpPanel.TODAY;switch(f){case iNet.iwebos.ui.common.control.FollowUpPanel.TODAY:e=b.format("d/m/Y");break;case iNet.iwebos.ui.common.control.FollowUpPanel.TOMORROW:__tomorrow=b.add(Date.DAY,1);e=__tomorrow.format("d/m/Y");break;case iNet.iwebos.ui.common.control.FollowUpPanel.WEEK:var a=b.getLastDateOfWeek();e=a.format("d/m/Y");break;case iNet.iwebos.ui.common.control.FollowUpPanel.NEXT_WEEK:var c=b.getLastDateOfNextWeek();e=c.format("d/m/Y");break;case iNet.iwebos.ui.common.control.FollowUpPanel.OTHERS:e="";break}return e},_removedb:function(b){var a=this.operator.remove||{};if(!a.fn){return false}if(!a.scope){return a.fn(b)}else{return a.fn.apply(a.scope,[b])}},_updatedb:function(c,b){var a=this.operator.update||{};if(!a.fn){return false}if(!a.scope){return a.fn(c,b)}else{return a.fn.apply(a.scope,[c,b])}},_savedb:function(a){var b=this.operator.save||{};if(!b.fn){return false}if(!b.scope){return b.fn(a)}else{return b.fn.apply(b.scope,[a])}},_storedb:function(c,f,e){if(!f){return}if(c==="save"){if(e!==null||e!==undefined){for(var b=0;b<e.length;b++){this.store.addData(e[b])}}this.store.applyGrouping();this.fireEvent("save",e||{})}else{if(c==="update"){var d=e||[];for(var b=0;b<d.length;b++){var a=this.store.getById(d[b].id);if(a){a.data.date=d[b].date;a.data.flag=d[b].flag;a.commit()}}this.store.applyGrouping();this.fireEvent("update",d||{})}else{if(c==="delete"){var d=e||[];for(var b=0;b<d.length;b++){var a=this.store.getById(d[b]);if(a){this.store.remove(a)}}this.fireEvent("remove",d||{})}}}}});Ext.apply(iNet.iwebos.ui.common.control.FollowUpPanel,{TODAY:"today",TOMORROW:"tomorrow",WEEK:"week",NEXT_WEEK:"next-week",OTHERS:"others"}); 
iNet.iwebos.ui.common.dialog.Dialog=Ext.extend(Ext.Window,{dragContent:true,initComponent:function(){iNet.iwebos.ui.common.dialog.Dialog.superclass.initComponent.call(this)},createGhost:function(a,e,b){var d=document.createElement("div");d.className="x-panel-ghost "+(a?a:"");if(this.header){d.appendChild(this.el.dom.firstChild.cloneNode(true))}if(this.dragContent){d.appendChild(this.bwrap.dom.cloneNode(true))}else{Ext.fly(d.appendChild(document.createElement("ul"))).setHeight(this.bwrap.getHeight())}d.style.width=this.el.dom.offsetWidth+"px";if(!b){this.container.dom.appendChild(d)}else{Ext.getDom(b).appendChild(d)}if(e!==false&&this.el.useShim!==false){var c=new Ext.Layer({shadow:false,useDisplay:true,constrain:false},d);c.show();return c}else{return new Ext.Element(d)}}});Ext.reg("dialog",iNet.iwebos.ui.common.dialog.Dialog); 
iNet.iwebos.ui.common.dialog.TitleDialog=Ext.extend(iNet.iwebos.ui.common.dialog.Dialog,{initComponent:function(){if(typeof this.height=="number"){this.height=this.height-iNet.INET_TITLE_DLG_HEIGHT}iNet.iwebos.ui.common.dialog.TitleDialog.superclass.initComponent.call(this)},onRender:function(c,a){iNet.iwebos.ui.common.dialog.TitleDialog.superclass.onRender.call(this,c,a);var b=['<table class="x-dlg-title-hd ',(this.hdCls?this.hdCls:""),'" border="0" cellspacing="0" cellpading="0" style="width:100%;">',"<tr>",'<td class="x-dlg-title-inner-hd-txt">','<div class="x-dlg-title-inner-hd-txt-ttext ',(this.tcls?this.tcls:""),'">',(this.ttitle?this.ttitle:"&#160;"),"</div>",'<div class="x-dlg-title-inner-hd-txt-btext ',(this.bcls?this.bcls:""),'">',(this.btitle?this.btitle:"&#160;"),"</div>","</td>",'<td class="x-dlg-title-inner-hd-img ',(this.hdImgCls?this.hdImgCls:""),'"/>',"</tr>","</table>"];this.dtitle=this.body.createChild({tag:"div",id:"dlg-title",cls:"x-dlg-title-hd-ec",html:b.join("")},this.bwrap.dom)},getFrameHeight:function(){var a=iNet.iwebos.ui.common.dialog.TitleDialog.superclass.getFrameHeight.call(this);a+=(this.dtitle?this.dtitle.getHeight():0);return a},beforeDestroy:function(){iNet.iwebos.ui.common.dialog.TitleDialog.superclass.beforeDestroy.call(this);Ext.Element.uncache(this.dtitle)},createGhost:function(a,e,b){var d=document.createElement("div");d.className="x-panel-ghost "+(a?a:"");if(this.header){d.appendChild(this.el.dom.firstChild.cloneNode(true))}if(this.dtitle){if(this.dragContent){d.appendChild(this.dtitle.dom.cloneNode(true))}else{Ext.fly(d.appendChild(document.createElement("ul"))).setHeight(this.dtitle.getHeight())}}if(this.dragContent){d.appendChild(this.bwrap.dom.cloneNode(true))}else{Ext.fly(d.appendChild(document.createElement("ul"))).setHeight(this.bwrap.getHeight())}d.style.width=this.el.dom.offsetWidth+"px";if(!b){this.container.dom.appendChild(d)}else{Ext.getDom(b).appendChild(d)}if(e!==false&&this.el.useShim!==false){var c=new Ext.Layer({shadow:false,useDisplay:true,constrain:false},d);c.show();return c}else{return new Ext.Element(d)}}});Ext.reg("tdialog",iNet.iwebos.ui.common.dialog.TitleDialog); 
Ext.app.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.app.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){this.onTrigger2Click()}},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value="";var a={start:0};this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]="";this.store.reload({params:a});this.triggers[0].hide();this.hasSearch=false}},onTrigger2Click:function(){var a=this.getRawValue();if(a.length<1){this.onTrigger1Click();return}var b={start:0};this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]=a;this.store.reload({params:b});this.hasSearch=true;this.triggers[0].show()}}); 
iNet.iwebos.ui.common.form.HtmlEditorPlugins.Table=Ext.extend(Ext.util.Observable,{langTitle:iwebos.message.mail.table_title,langInsert:iwebos.message.mail.table_insert,langCancel:Ext.MessageBox.buttonText.cancel,langRows:iwebos.message.mail.table_rows,langColumns:iwebos.message.mail.table_colum,langBorder:iwebos.message.mail.table_border,langCellLabel:iwebos.message.mail.table_cell_label,cmd:"table",showCellLocationText:true,cellLocationText:"{0}&nbsp;-&nbsp;{1}",tableBorderOptions:[["1px solid #000","Sold Thin"],["2px solid #000","Solid Thick"],["1px dashed #000","Dashed"],["1px dotted #000","Dotted"],["none","None"]],init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-table",handler:function(){if(!this.tableWindow){this.tableWindow=new Ext.Window({title:this.langTitle,closeAction:"hide",width:300,items:[{itemId:"insert-table",xtype:"form",border:false,plain:true,bodyStyle:"padding: 10px;",labelWidth:90,labelAlign:"right",items:[{xtype:"numberfield",allowBlank:false,allowDecimals:false,fieldLabel:this.langRows,name:"row",width:60},{xtype:"numberfield",allowBlank:false,allowDecimals:false,fieldLabel:this.langColumns,name:"col",width:60},{xtype:"combo",fieldLabel:this.langBorder,name:"border",forceSelection:true,mode:"local",store:this.tableBorderOptions,triggerAction:"all",value:"none",displayField:"text",valueField:"value",anchor:"100%"},{xtype:"checkbox",fieldLabel:this.langCellLabel,checked:this.showCellLocationText,listeners:{check:function(){this.showCellLocationText=!this.showCellLocationText},scope:this}}]}],buttons:[{text:this.langInsert,handler:function(){var g=this.tableWindow.getComponent("insert-table").getForm();if(g.isValid()){var d=g.findField("border").getValue();var b=[g.findField("row").getValue(),g.findField("col").getValue()];if(b.length==2&&b[0]>0&&b[1]>0){var i=Math.floor(100/b[0]);var f="<table style='border-collapse: collapse'>";var e="&nbsp;";if(this.showCellLocationText){e=this.cellLocationText}for(var h=0;h<b[0];h++){f+="<tr>";for(var c=0;c<b[1];c++){f+="<td width='"+i+"%' style='border: "+d+";'>"+String.format(e,(h+1),String.fromCharCode(c+65))+"</td>"}f+="</tr>"}f+="</table>";this.cmp.insertAtCursor(f)}this.tableWindow.hide()}else{if(!g.findField("row").isValid()){g.findField("row").getEl().frame()}else{if(!g.findField("col").isValid()){g.findField("col").getEl().frame()}}}},scope:this},{text:this.langCancel,handler:function(){this.tableWindow.hide()},scope:this}]})}else{this.tableWindow.getEl().frame()}this.tableWindow.show()},scope:this,tooltip:{title:this.langTitle},overflowText:this.langTitle})}}); 
iNet.iwebos.ui.common.grid.HttpProxyWrapper=function(a){iNet.iwebos.ui.common.grid.HttpProxyWrapper.superclass.constructor.call(this);this.conn=a;this.useAjax=!a||!a.events};Ext.extend(iNet.iwebos.ui.common.grid.HttpProxyWrapper,Ext.data.DataProxy,{load:function(e,b,f,c,a){if(this.fireEvent("beforeload",this,e)!==false){var d={params:e||{},request:{callback:f,scope:c,arg:a},reader:b,callback:this.loadResponse,scope:this,headers:{"X-Ghost-Request":window.location.href}};if(this.useAjax){Ext.applyIf(d,this.conn);if(this.activeRequest){Ext.Ajax.abort(this.activeRequest)}this.activeRequest=Ext.Ajax.request(d)}else{this.conn.request(d)}}else{f.call(c||this,null,a,false)}},loadResponse:function(f,d,b){this.redirect(b);delete this.activeRequest;if(!d){this.fireEvent("loadexception",this,f,b);f.request.callback.call(f.request.scope,null,f.request.arg,false);return}var a;try{a=f.reader.read(b)}catch(c){this.fireEvent("loadexception",this,f,b,c);f.request.callback.call(f.request.scope,null,f.request.arg,false);return}this.fireEvent("load",this,f,f.request.arg);f.request.callback.call(f.request.scope,a,f.request.arg,true)},redirect:function(b){try{var a=Ext.util.JSON.decode(b.responseText)||{};if(a.type==="redirect"){window.location.href=a.target}}catch(c){}},update:function(a){},updateResponse:function(a){}}); 
iNet.iwebos.ui.common.grid.WebOSGrid=Ext.extend(Ext.grid.GridPanel,{loadFirst:true,initComponent:function(){this.method=(!this.method)?"GET":this.method;this.proxy=(!this.proxy)?new iNet.iwebos.ui.common.grid.HttpProxyWrapper({url:this.url,method:this.method}):this.proxy;this.sortInfo=this.sortInfo||{field:"id",direction:"ASC"};var b=this.dsort||{field:"id",direction:"ASC"};this.sm=(!this.sm)?new Ext.grid.RowSelectionModel():this.sm;this.selectFirstRow=(!this.selectFirstRow)?true:!!this.selectFirstRow;this.groupLabel=(!this.groupLabel)?idesk.webos.message.paperwork.ppwitem:this.groupLabel;this.groupTextTpl=(!this.groupTextTpl)?'{text} ({[values.rs.length]} {[values.rs.length > 0 ? "'+this.groupLabel+'":"No item"]})':this.groupTextTpl;this.rowClass=(!this.rowClass)?function(c){return""}:this.rowClass;this.loadFirst=!!this.loadFirst;this.start=(!this.start)?0:this.start;this.limit=(!this.limit)?iNet.INET_PAGE_LIMIT:this.limit;var a;if(!this.store){a=new iNet.iwebos.ui.common.store.WebOSGroupingStore({proxy:this.proxy,sortInfo:this.sortInfo,groupField:this.groupField,baseParams:this.baseParams,reader:this.reader,filter:this.filter})}else{a=this.store;delete this.store}a=Ext.StoreMgr.lookup(a);a.setDefaultSort(b.field,b.direction);delete this.dsort;this.bind(a);if(this.loadFirst){this.store.load({params:{start:this.start,limit:this.limit}})}this.shadow=false;if(!this.view){this.view=new Ext.grid.GroupingView({forceFit:true,emptyText:idesk.webos.message.paperwork.emptyresult,groupTextTpl:this.groupTextTpl,getRowClass:this.rowClass})}if(!this.loadMask){this.loadMask={msg:idesk.webos.message.load_data}}iNet.iwebos.ui.common.grid.WebOSGrid.superclass.initComponent.call(this)},handleSearchEvent:function(params){var index=0;var buf=[];var param=null;for(index=0;index<params.length;index++){param=params[index];buf.push(param.key+":'"+param.value+"'")}var paramValue=buf.join(",");var searchParams=eval("({"+paramValue+"})");this.store.baseParams=Ext.apply(this.baseParams||{},searchParams);this.store.load()},bind:function(a){if(this.selectFirstRow){if(this.store){this.store.un("load",this.onStoreLoad,this)}if(a){a.on("load",this.onStoreLoad,this)}}this.store=a},onStoreLoad:function(){if(this.store&&this.store.getCount()>0){this.selModel.selectFirstRow()}}}); 
iNet.iwebos.ui.common.grid.EmailImportantColumn=function(){Ext.apply(this,{width:24,header:'<div class="icon-email-urgent"></div>',menuDisabled:true,fixed:true,dataIndex:"priority",id:"important-col",renderer:function(a){switch(a){case"LOW":return'<div class="icon-email-urgent-low"></div>';case"NORMAL":return"";case"HIGH":return'<div class="icon-email-urgent"></div>';default:return""}},init:function(a){}})};iNet.iwebos.ui.mail.grid.AttachmentColumn=function(){Ext.apply(this,{width:24,header:'<div class="icon-email-attachment"></div>',menuDisabled:true,fixed:true,dataIndex:"attached",id:"attached-col",renderer:function(a){if(a){return'<div class="icon-email-attachment"></div>'}else{return""}},init:function(a){}})};iNet.iwebos.ui.mail.grid.StatusColumn=function(a){Ext.apply(this,{width:24,header:'<div class="flag-col-hd"></div>',menuDisabled:true,fixed:true,dataIndex:"flag",id:"flag-col",renderer:function(b){switch(b){case"WORK":return'<div class="icon-email-work"></div>';case"PERSONAL":return'<div class="icon-email-personal"></div>';case"TODO":return'<div class="icon-email-todo"></div>';case"LATE":return'<div class="icon-email-late"></div>';case"REPLY":return'<div class="icon-email-reply"></div>';case"CALL":return'<div class="icon-email-phone"></div>';case"FU":return'<div class="icon-email-fu"></div>';case"FYI":return'<div class="icon-email-fyi"></div>';case"REVIEW":return'<div class="icon-email-approve_mail"></div>';case"CUSTOM":return'<div class="icon-email-custom"></div>';case"NOTHING":return"";default:return""}},init:function(b){}});Ext.apply(this,a||{})};iNet.iwebos.ui.mail.grid.TypeColumn=function(){Ext.apply(this,{width:24,header:'<div class="icon-email-unread_mail"></div>',menuDisabled:true,fixed:true,dataIndex:"type",id:"type-col",renderer:function(a){switch(a){case"FORWARD":return'<div class="icon-email-forward"></div>';case"REPLY":return'<div class="icon-email-reply"></div>';default:return""}},init:function(a){}})};iNet.iwebos.ui.common.grid.FlagColumn=function(b){var c;function d(e,f){if(Ext.fly(f).hasClass("task-check")||Ext.fly(f).hasClass("task-today")||Ext.fly(f).hasClass("task-tomorrow")||Ext.fly(f).hasClass("task-week")||Ext.fly(f).hasClass("task-nodate")){Ext.fly(f.parentNode).addClass("task-over")}}function a(e,f){if(Ext.fly(f).hasClass("task-check")||Ext.fly(f).hasClass("task-today")||Ext.fly(f).hasClass("task-tomorrow")||Ext.fly(f).hasClass("task-week")||Ext.fly(f).hasClass("task-nodate")){Ext.fly(f.parentNode).removeClass("task-over")}}Ext.apply(this,{width:24,header:'<div class="flag-col-hd"></div>',menuDisabled:true,fixed:true,id:"flag-col",renderer:function(e){switch(e){case 0:return'<div class="task-today"></div>';case 1:return'<div class="task-tomorror"></div>';case 2:return'<div class="task-week"></div>';case 3:return'<div class="task-nodate"></div>';case 4:return'<div class="task-completed"></div>';default:return'<div class="task-check"></div>'}return'<div class="task-check"></div>'},init:function(e){c=e;c.on("render",function(){var f=c.getView();f.mainBody.on("mouseover",d);f.mainBody.on("mouseout",a)})}});Ext.apply(this,b||{})}; 
(function(){WebOSGridService={};WebOSGridService.handleSelection=function(b,a){if(!b.getSelectionModel().hasSelection()||b.getSelectionModel().singleSelect){b.getSelectionModel().selectRow(a)}else{var d=b.store.getAt(a);if(d){var c=b.getSelectionModel().isSelected(d);b.getSelectionModel().selectRow(a,c)}}}})(); 
iNet.iwebos.ui.common.grid.WebOSEditorGrid=Ext.extend(Ext.grid.EditorGridPanel,{loadFirst:true,initComponent:function(){this.method=(!this.method)?"GET":this.method;this.proxy=(!this.proxy)?new iNet.iwebos.ui.common.grid.HttpProxyWrapper({url:this.url,method:this.method}):this.proxy;this.sortInfo=(!this.sortInfo)?{field:"id",direction:"ASC"}:this.sortInfo;this.sm=(!this.sm)?new Ext.grid.RowSelectionModel():this.sm;this.selectFirstRow=(!this.selectFirstRow)?true:!!this.selectFirstRow;this.groupLabel=(!this.groupLabel)?idesk.webos.message.paperwork.ppwitem:this.groupLabel;this.groupTextTpl=(!this.groupTextTpl)?'{text} ({[values.rs.length]} {[values.rs.length > 0 ? "'+this.groupLabel+'":"No item"]})':this.groupTextTpl;this.rowClass=(!this.rowClass)?function(b){return""}:this.rowClass;this.loadFirst=!!this.loadFirst;this.start=(!this.start)?0:this.start;this.limit=(!this.limit)?iNet.INET_PAGE_LIMIT:this.limit;var a;if(!this.store){a=new iNet.iwebos.ui.common.store.WebOSGroupingStore({proxy:this.proxy,sortInfo:this.sortInfo,groupField:this.groupField,baseParams:this.baseParams,reader:this.reader,filter:this.filter})}else{a=this.store;delete this.store}a=Ext.StoreMgr.lookup(a);this.bind(a);if(this.loadFirst){this.store.load({params:{start:this.start,limit:this.limit}})}this.shadow=false;if(!this.view){this.view=new Ext.grid.GroupingView({forceFit:true,emptyText:idesk.webos.message.paperwork.emptyresult,groupTextTpl:this.groupTextTpl,getRowClass:this.rowClass})}if(!this.loadMask){this.loadMask={msg:idesk.webos.message.load_data}}iNet.iwebos.ui.common.grid.WebOSEditorGrid.superclass.initComponent.call(this)},onSearch:function(params){var index=0;var buf=[];var param=null;for(index=0;index<params.length;index++){param=params[index];buf.push(param.key+":'"+param.value+"'")}var paramValue=buf.join(",");var searchParams=eval("({"+paramValue+"})");this.store.baseParams=Ext.apply(this.baseParams||{},searchParams);this.store.load()},bind:function(a){if(this.selectFirstRow){if(this.store){this.store.un("load",this.onStoreLoad,this)}if(a){a.on("load",this.onStoreLoad,this)}}this.store=a},onStoreLoad:function(){if(this.store&&this.store.getCount()>0){this.selModel.selectFirstRow()}}}); 
iNet.iwebos.ui.paperwork.Header=function(b,a){this.viewer=b;Ext.apply(this,a);iNet.iwebos.ui.paperwork.Header.superclass.constructor.call(this,{region:"north",contentEl:"header",border:false,frame:false,height:55,width:"100%"})};Ext.extend(iNet.iwebos.ui.paperwork.Header,Ext.Panel,{}); 
Ext.onReady(function(){var b;function a(c){var e=Ext.get(c+"-link");if(!e){return}var f=0,d,j=Ext.getDoc();var g=function(m,l){if(l!=e.dom&&l!=d.dom&&!m.within(e)&&!m.within(d)){i()}};var i=function(){if(d){d.hide();e.setStyle("text-decoration","");j.un("mouseover",g);j.un("mousedown",h)}};var h=function(l){if(!l.within(d)){i()}};var k=function(){clearTimeout(f);f=0;if(!d){d=new Ext.Layer({shadow:"sides",hideMode:"display"},c+"-menu")}d.hideMenu=i;d.el=e;if(b&&d!=b){b.hideMenu()}b=d;if(!d.isVisible()){d.show();d.alignTo(e,"tl-bl?");d.sync();e.setStyle("text-decoration","underline");j.on("mouseover",g,null,{buffer:150});j.on("mousedown",h)}};e.on("mouseover",function(l){if(!f){f=k.defer(150)}});e.on("mouseout",function(l){if(f&&!l.within(e,true)){clearTimeout(f);f=0}})}a("option");Ext.getBody().on("click",function(g,d){d=Ext.get(d);g.stopEvent();var f=d.next("div.expandable-body");f.enableDisplayMode();var h=f.first();var c=f.isVisible();if(c){f.hide()}else{h.hide();f.show();h.slideIn("l",{duration:0.2,stopFx:true,easing:"easeOut"})}d.update(!c?"Hide details":"Show details")},null,{delegate:"a.expander"})}); 
iNet.iwebos.ui.common.search.AdvancedSearch=Ext.extend(Ext.Panel,{initComponent:function(){this.mode=(!this.mode)?false:!!this.mode;this.expandIcon=(!this.expandIcon)?"icon-expand":this.expandIcon;this.collapseIcon=(!this.collapseIcon)?"icon-collapse":this.collapseIcon;this.prefix=(!this.prefix)?"iwebos-as":this.prefix;this.quick=this.quick||[];this.id=this.nextId("cmb",6);this.chModeId=this.nextId("chbtn",6);var b={xtype:"button",id:this.chModeId,iconCls:(this.mode?this.expandIcon:this.collapseIcon),tooltip:(!this.mode?idesk.webos.message.paperwork.search_basic:idesk.webos.message.paperwork.search_more),handler:this.changeMode,scope:this};this.searchBtnId=this.nextId("sbtn",6);this.searchButton={xtype:"button",id:this.searchBtnId,iconCls:"icon-search",text:idesk.webos.message.paperwork.search_title,tooltip:idesk.webos.message.paperwork.search_title,handler:this.search,scope:this};var c=[b,"-"];for(var a=0;a<this.quick.length;a++){if(typeof this.quick[a].ct!=="string"){if(!this.quick[a].ct.id){this.quick[a].ct.id=this.nextId("qs",6)}this.quick[a]["id"]=this.quick[a].ct.id}c[c.length]=this.quick[a].ct}c[c.length]=this.searchButton;if(this.store){this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.store,displayInfo:false});if(Ext.isGecko2){c[c.length]="-"}else{c[c.length]="->"}c[c.length]=this.pagingBar}this.tbar=c;this.adSearchId=this.nextId("ads",6);this.advanced=(!this.advanced?new iNet.iwebos.ui.paperwork.EDSearchDetails({id:this.adSearchId,labelAlign:"right",labelWidth:90,frame:false,border:false,anchor:"100%",bodyStyle:"padding: 5px;"}):this.advanced);if(!this.advanced.id){this.advanced.id=this.adSearchId}else{this.adSearchId=this.advanced.id}this.items=this.advanced;iNet.iwebos.ui.common.search.AdvancedSearch.superclass.initComponent.call(this);this.addEvents("changemode","search");this.on("changemode",this.onChangeMode,this);this.on("afterlayout",this.onAfterLayout,this)},afterRender:function(){iNet.iwebos.ui.common.search.AdvancedSearch.superclass.afterRender.call(this);this.bind(this.mode)},onAfterLayout:function(a,b){this.bind(this.mode)},changeMode:function(){this.mode=!this.mode;this.bind(this.mode);this.fireEvent("changemode",!this.mode,this.mode)},search:function(){var c=this.getQuickContent(this.mode);if(this.mode){c.push({key:"mode",value:"advancedSearch"});var b=this.advanced.getSearchContent();if(!b){b=[]}var a=0;for(a=0;a<b.length;a++){c.push(b[a])}}else{c.push({key:"mode",value:"quickSearch"})}this.fireEvent("search",c)},onChangeMode:function(a,b){Ext.EventManager.fireWindowResize()},handlePanelEvent:function(a){if(this.mode){Ext.EventManager.fireWindowResize()}},bind:function(e){var d=Ext.getCmp(this.chModeId);var f=Ext.getCmp(this.adSearchId);if(d){var b=d.el;if(b){var c=b.child(d.buttonSelector)||{};c.dom[d.tooltipType]=(this.mode?idesk.webos.message.paperwork.search_basic:idesk.webos.message.paperwork.search_more)}}if(e===false){for(var a=0;a<this.quick.length;a++){if(!this.quick[a].show&&!!this.quick[a].id){Ext.getCmp(this.quick[a].id).show()}}d.setIconClass(this.expandIcon);f.hide();this.setHeight(0)}else{for(var a=0;a<this.quick.length;a++){if(!this.quick[a].show&&!!this.quick[a].id){Ext.getCmp(this.quick[a].id).hide()}}d.setIconClass(this.collapseIcon);f.show();this.setHeight(f.el.getComputedHeight()+this.tbar.getHeight())}},getQuickContent:function(e){var d=[];var c;if(e===false){for(var a=0;a<this.quick.length;a++){if(!!this.quick[a].id){c=Ext.getCmp(this.quick[a].id);var b=c.getValue();if(c.getXType()==="datefield"){b=(b==""||b==null?"":b.format("d/m/Y"))}d[d.length]={key:this.quick[a].key,value:b}}}}else{for(var a=0;a<this.quick.length;a++){if(!!this.quick[a].show&&!!this.quick[a].id){c=Ext.getCmp(this.quick[a].id);var b=c.getValue();if(c.getXType()==="datefield"){b=(b==""||b==null?"":b.format("d/m/Y"))}d[d.length]={key:this.quick[a].key,value:b}}}}return d},nextId:function(e,a){var d=String(new Date().getTime()).substr(a);var c="abcdefghijklmnopqrstuvwxyz";for(var b=0;b<a;b++){d+=c.charAt(Math.floor(Math.random()*26))}return this.prefix+"-"+e+"-"+d+"-id"}}); 
iNet.iwebos.ui.common.store.WebOSSimpleStore=function(a){var b=a.data||[];if(a.data){delete a.data}iNet.iwebos.ui.common.store.WebOSSimpleStore.superclass.constructor.call(this,a);this.proxy=new Ext.data.MemoryProxy(b)};Ext.extend(iNet.iwebos.ui.common.store.WebOSSimpleStore,Ext.data.Store,{addData:function(a){this.suspendEvents();this.clearFilter();this.resumeEvents();this.loadData([a],true);this.suspendEvents();this.resumeEvents();this.fireEvent("datachanged",this)}}); 
iNet.iwebos.ui.common.store.WebOSGroupingStore=function(a){a=a||{};a.filter=a.filter||{data:"all"};iNet.iwebos.ui.common.store.WebOSGroupingStore.superclass.constructor.call(this,a)};Ext.extend(iNet.iwebos.ui.common.store.WebOSGroupingStore,Ext.data.GroupingStore,{applyFilter:function(b){if(b!==undefined){if(typeof b=="object"){this.filter.data=b.data;this.filter.fn=b.fn;this.filter.scope=b.scope}else{this.filter.data=b}}var a=this.filter.data;if(a=="all"||!this.filter.fn){return this.clearFilter()}return this.filterBy(function(c){if(!this.filter.scope){return this.filter.fn(c,a)}else{return this.filter.fn.apply(this.filter.scope,[c,a])}})},addData:function(c){var a=this.reader.recordType;var b=new a(c,c.id);b.json=c;this.suspendEvents();this.clearFilter();this.resumeEvents();this.loadRecords({success:true,records:[b],totalRecords:1},{add:true},true);this.suspendEvents();this.applyFilter();this.applyGrouping(true);this.resumeEvents();this.fireEvent("datachanged",this)}}); 
iNet.iwebos.ui.common.store.WebOSDBStore=function(b){var a=b.readonly||false;var c=b.transaction||false;this.table=b.table||"default";this.keyName=b.key||"id";this.loadParams=b.load||{};this.addParams=b.add;this.updateParams=b.update;this.removeParams=b.remove;this.conn=b.conn||iNet.Database.getConnection();this.prepareData=b.prepare||{fn:function(d,e){d.dirty=!!e;return d}};this.record=Ext.isArray(b.record)?Ext.data.Record.create(b.record):b.record;iNet.iwebos.ui.common.store.WebOSDBStore.superclass.constructor.call(this,{sortInfo:b.sortInfo,baseParams:b.baseParams,reader:new Ext.data.JsonReader({idProperty:this.keyName},this.record)});this.proxy=new iNet.iwebos.data.db.DBProxy(this.conn,this.table,this.keyName,this,a,c);if(window.google&&google.gears){this.proxy.on("beforeload",this.prepareTable,this)}};Ext.extend(iNet.iwebos.ui.common.store.WebOSDBStore,Ext.data.Store,{prepareTable:function(){this.conn.createTable({name:this.table,key:this.keyName,fields:this.record.prototype.fields})},load:function(a){var b=a||{};if(!b.callback){b.callback=this.loadCallback;b.scope=this}iNet.iwebos.ui.common.store.WebOSDBStore.superclass.load.call(this,b)},loadCallback:function(){if(this.getCount()<1){this.loadServer(this.loadParams)}},loadServer:function(d){var b=d.url;var f=d.params||{};var a=d.success||function(g,h){};var c=d.failure||function(g,h){};var e=d.method||"GET";Ext.Ajax.request({url:b,success:this.success,successHandler:a,handlerScope:d.scope,failure:this.failure,failureHandler:c,method:e,scope:this,params:f})},success:function(b,e){var d=e.successHandler;if(d!=undefined){var f=null;if(!e.handlerScope){f=d(b)}else{f=d.apply(e.handlerScope,[b])}var a=f.length;for(var c=0;c<a;c++){this.addObject(f[c],false)}}},failure:function(a,b){var c=b.failureHandler;if(c!=undefined){if(!b.handlerScope){c(a)}else{c.apply(b.handlerScope,[a])}}},addObject:function(b,c){this.suspendEvents();this.clearFilter();this.resumeEvents();var a=null;if(!this.prepareData.scope){a=this.prepareData.fn(b,!!c)}else{a=this.prepareData.fn.apply(this.prepareData.scope,[b,!!c])}this.loadData([a],true);this.suspendEvents();this.resumeEvents();this.fireEvent("datachanged",this)}}); 
iNet.iwebos.ui.common.store.WebOSDBGroupingStore=function(b){var a=b.readonly||false;var c=b.transaction||false;this.table=b.table||"default";this.keyName=b.key||"id";this.loadParams=b.load||{};this.addParams=b.add;this.updateParams=b.update;this.removeParams=b.remove;this.conn=b.conn||iNet.Database.getConnection();this.filter=b.filter||{data:"all",fn:function(d){return d}};this.prepareData=b.prepare||{fn:function(d,e){d.dirty=!!e;return d}};this.record=Ext.isArray(b.record)?Ext.data.Record.create(b.record):b.record;iNet.iwebos.ui.common.store.WebOSDBGroupingStore.superclass.constructor.call(this,{sortInfo:b.sortInfo,groupField:b.groupField,baseParams:b.baseParams,reader:new Ext.data.JsonReader({idProperty:this.keyName},this.record)});this.proxy=new iNet.iwebos.data.db.DBProxy(this.conn,this.table,this.keyName,this,a,c);if(window.google&&google.gears){this.proxy.on("beforeload",this.prepareTable,this)}};Ext.extend(iNet.iwebos.ui.common.store.WebOSDBGroupingStore,Ext.data.GroupingStore,{prepareTable:function(){this.conn.createTable({name:this.table,key:this.keyName,fields:this.record.prototype.fields})},load:function(a){var b=a||{};if(!b.callback){b.callback=this.loadCallback;b.scope=this}iNet.iwebos.ui.common.store.WebOSDBGroupingStore.superclass.load.call(this,b)},loadCallback:function(){if(this.getCount()<1){this.loadServer(this.loadParams)}},loadServer:function(d){var b=d.url;var f=d.params||{};var a=d.success||function(g,h){};var c=d.failure||function(g,h){};var e=d.method||"GET";Ext.Ajax.request({url:b,success:this.success,successHandler:a,handlerScope:d.scope,failure:this.failure,failureHandler:c,method:e,scope:this,params:f})},success:function(b,e){var d=e.successHandler;if(d!=undefined){var f=null;if(!e.handlerScope){f=d(b)}else{f=d.apply(e.handlerScope,[b])}var a=f.length;for(var c=0;c<a;c++){this.addObject(f[c],false)}}},failure:function(a,b){var c=b.failureHandler;if(c!=undefined){if(!b.handlerScope){c(a)}else{c.apply(b.handlerScope,[a])}}},applyFilter:function(b){if(b!==undefined){if(typeof b=="object"){this.filter.data=b.data;this.filter.fn=b.fn;this.filter.scope=b.scope}else{this.filter.data=b}}var a=this.filter.data;if(a=="all"||!this.filter.fn){return this.clearFilter()}return this.filterBy(function(c){if(!this.filter.scope){return this.filter.fn(c,a)}else{return this.filter.fn.apply(this.filter.scope,[c,a])}})},addObject:function(b,c){this.suspendEvents();this.clearFilter();this.resumeEvents();var a=null;if(!this.prepareData.scope){a=this.prepareData.fn(b,!!c)}else{a=this.prepareData.fn.apply(this.prepareData.scope,[b,!!c])}this.loadData([a],true);this.suspendEvents();this.applyFilter();this.applyGrouping(true);this.resumeEvents();this.fireEvent("datachanged",this)}}); 
Ext.ux.TabCloseMenu=function(){var a,c,b;this.init=function(e){a=e;a.on("contextmenu",d)};function d(h,g,i){if(!c){c=new Ext.menu.Menu([{id:a.id+"-close",text:"Close Tab",handler:function(){a.remove(b)}},{id:a.id+"-close-others",text:"Close Other Tabs",handler:function(){a.items.each(function(e){if(e.closable&&e!=b){a.remove(e)}})}}])}b=g;var f=c.items;f.get(a.id+"-close").setDisabled(!g.closable);var j=true;a.items.each(function(){if(this!=g&&this.closable){j=false;return false}});f.get(a.id+"-close-others").setDisabled(j);c.showAt(i.getPoint())}}; 
iNet.iwebos.ui.common.tree.TreeColumnNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{renderElements:function(f,o,k,p){this.indentMarkup=f.parentNode?f.parentNode.ui.getChildIndent():"";var q=f.getOwnerTree();var m=q.columns;var l=q.borderWidth;var h=typeof o.checked=="boolean";var g=m[0];var d=m.length;var c=o.href?o.href:Ext.isGecko?"":"#";var e=['<li class="x-tree-node"><div ext:tree-node-id="',f.id,'" class="x-tree-node-el x-tree-node-leaf ',o.cls,'">','<div class="x-tree-col" style="width:',g.width-l,'px;">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow"/>',h?('<input class="x-tree-node-cb" type="checkbox" '+(o.checked?'checked="checked"/>':"/>")):"",'<img src="',o.icon||this.emptyIcon,'" class="x-tree-node-icon',(o.icon?" x-tree-node-inline-icon":""),(o.iconCls?" "+o.iconCls:""),'" unselectable="on"/>','<a hidefocus="on" class="x-tree-node-anchor" href="',c,'" tabIndex="1" ',o.hrefTarget?' target="'+o.hrefTarget+'"':"",">",'<span unselectable="on">',f.text||(g.renderer?g.renderer(o[g.dataIndex],f,o):o[g.dataIndex]),"</span>","</a>","</div>"];var j=1;for(j=1;j<d;j++){g=m[j];e.push('<div class="x-tree-col" style="width:',g.width-l,'px;">','<div class="x-tree-col-text">',(g.renderer?g.renderer(o[g.dataIndex],f,o):o[g.dataIndex]),"</div>","</div>")}e.push('<div class="x-clear"></div>',"</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>");var b;if(p!==true&&f.nextSibling&&(b=f.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",b,e.join(""))}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",k,e.join(""))}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var i=this.elNode.firstChild.childNodes;this.indentNode=i[0];this.ecNode=i[1];j=2;if(h){this.checkbox=i[j];this.checkbox.defaultChecked=this.checkbox.checked;j++}this.iconNode=i[j];this.anchor=i[j+1];this.textNode=i[j+1].firstChild}}); 
iNet.iwebos.ui.common.tree.ColumnTreePanel=Ext.extend(Ext.tree.TreePanel,{lines:false,borderWidth:Ext.isBorderBox?0:2,cls:"x-column-tree",onRender:function(){iNet.iwebos.ui.common.tree.ColumnTreePanel.superclass.onRender.apply(this,arguments);this.headers=this.body.createChild({cls:"x-tree-headers"},this.innerCt.dom);var e=this.columns;var c=e.length;var d;var a=0;for(var b=0;b<c;b++){d=e[b];a+=d.width;this.headers.createChild({cls:"x-tree-hd "+(d.cls?d.cls+"-hd":""),cn:{cls:"x-tree-hd-text",html:d.header},style:"width:"+(d.width-this.borderWidth)+"px;"})}this.headers.createChild({cls:"x-clear",style:"width:*"});this.innerCt.setWidth(a)}}); 
iNet.iwebos.ui.common.tree.TreeLoaderWrapper=function(a){this.baseParams={};Ext.apply(this,a);this.addEvents("beforeload","load","loadexception");iNet.iwebos.ui.common.tree.TreeLoaderWrapper.superclass.constructor.call(this)};Ext.extend(iNet.iwebos.ui.common.tree.TreeLoaderWrapper,Ext.util.Observable,{uiProviders:{},clearOnLoad:true,load:function(a,b){if(this.clearOnLoad){while(a.firstChild){a.removeChild(a.firstChild)}}if(this.doPreload(a)){if(typeof b=="function"){b()}}else{if(this.dataUrl||this.url){this.requestData(a,b)}}},doPreload:function(d){if(d.attributes.children){if(d.childNodes.length<1){var c=d.attributes.children;d.beginUpdate();for(var b=0,a=c.length;b<a;b++){var e=d.appendChild(this.createNode(c[b]));if(this.preloadChildren){this.doPreload(e)}}d.endUpdate()}return true}else{return false}},getParams:function(d){var a=[],c=this.baseParams;for(var b in c){if(typeof c[b]!="function"){a.push(encodeURIComponent(b),"=",encodeURIComponent(c[b]),"&")}}a.push("node=",encodeURIComponent(d.id));return a.join("")},requestData:function(a,b){if(this.fireEvent("beforeload",this,a,b)!==false){this.transId=Ext.Ajax.request({method:this.requestMethod,url:this.dataUrl||this.url,success:this.handleResponse,failure:this.handleFailure,scope:this,argument:{callback:b,node:a},params:this.getParams(a),headers:{"X-Ghost-Request":window.location.href}})}else{if(typeof b=="function"){b()}}},isLoading:function(){return !!this.transId},abort:function(){if(this.isLoading()){Ext.Ajax.abort(this.transId)}},createNode:function(attr){if(this.baseAttrs){Ext.applyIf(attr,this.baseAttrs)}if(this.applyLoader!==false){attr.loader=this}if(typeof attr.uiProvider=="string"){attr.uiProvider=this.uiProviders[attr.uiProvider]||eval(attr.uiProvider)}if(attr.nodeType){return new Ext.tree.TreePanel.nodeTypes[attr.nodeType](attr)}else{return attr.leaf?new Ext.tree.TreeNode(attr):new Ext.tree.AsyncTreeNode(attr)}},processResponse:function(response,node,callback){var json=response.responseText;try{var o=eval("("+json+")");node.beginUpdate();for(var i=0,len=o.length;i<len;i++){var n=this.createNode(o[i]);if(n){node.appendChild(n)}}node.endUpdate();if(typeof callback=="function"){callback(this,node)}}catch(e){this.handleFailure(response)}},handleResponse:function(c){this.redirect(c);this.transId=false;var b=c.argument;this.processResponse(c,b.node,b.callback);this.fireEvent("load",this,b.node,c)},handleFailure:function(c){this.redirect(c);this.transId=false;var b=c.argument;this.fireEvent("loadexception",this,b.node,c);if(typeof b.callback=="function"){b.callback(this,b.node)}},redirect:function(b){try{var a=Ext.util.JSON.decode(b.responseText)||{};if(a.type==="redirect"){window.location.href=a.target}}catch(c){}}}); 
iNet.iwebos.ui.common.tree.TreeNodeExUI=Ext.extend(Ext.tree.TreeNodeUI,{renderElements:function(d,f,i,j){this.indentMarkup=d.parentNode?d.parentNode.ui.getChildIndent():"";var e=typeof f.checked=="boolean";var b=f.href?f.href:Ext.isGecko?"":"#";var c=['<li class="x-tree-node"><div ext:tree-node-id="',d.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',f.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow"/>',e?('<input class="x-tree-node-cb" type="checkbox" '+(f.checked?'checked="checked"/>':"/>")):"",'<img src="',f.icon||this.emptyIcon,'" class="x-tree-node-icon ',(f.icon?" x-tree-node-inline-icon ":""),(f.iconCls?" "+f.iconCls:""),'" unselectable="on"/>','<a hidefocus="on" class="x-tree-node-anchor" href="',b,'" tabIndex="1" ',f.hrefTarget?' target="'+f.hrefTarget+'"':"",">",'<span unselectable="on">',d.text,"</span>","</a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"];var a;if(j!==true&&d.nextSibling&&(a=d.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",a,c.join(""))}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",i,c.join(""))}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var h=this.elNode.childNodes;this.indentNode=h[0];this.ecNode=h[1];var g=2;if(e){this.checkbox=h[g];this.checkbox.defaultChecked=this.checkbox.checked;g++}this.iconNode=h[g];this.anchor=h[g+1];this.textNode=h[g+1].firstChild},onSelectedChange:function(a){if(this.checkbox&&!a){this.checkbox.checked=a}iNet.iwebos.ui.common.tree.TreeNodeExUI.superclass.onSelectedChange.call(this,a)}}); 
iNet.iwebos.ui.mail.AddressBookPanel=function(b,u){this.viewer=b;Ext.apply(this,u);this.prefix=(!this.prefix)?"iwebos-addressbook":this.prefix;this.gridId=this.prefix+"-personal-grid-id";this.globalGridId=this.prefix+"-global-grid-id";this.previewId=this.prefix+"-preview-id";this.searchBtnId=this.prefix+"-btn-search-id";this.btnAdd=this.prefix+"-btn-add-id";this.btnDelete=this.prefix+"-btn-delete-id";this.btnImport=this.prefix+"-btn-import-id";this.btnExport=this.prefix+"-btn-export-id";this.txtWordId=this.prefix+"-txt-word-id";this.departmentId=this.prefix+"-department-id";this.personalPanelId=this.prefix+"-personal-panel-id";this.globalPanelId=this.prefix+"-global-panel-id";this.__owner={mode:"global",id:0,load:false};this.DOMAIN_STORE=new Ext.data.JsonStore({fields:[{name:"text",type:"string"},{name:"value",type:"string"},{name:"desc",type:"string"}]});var t={field:"dname",direction:"ASC"};var w={field:"dname",direction:"ASC"};var h={iwct:"searchAddressBookContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",mode:"personal",action:"search"};var e={iwct:"searchAddressBookContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",mode:"global",action:"search"};var v=Ext.data.Record.create([{name:"id",mapping:"name",type:"string"},{name:"name",mapping:"name",type:"string"},{name:"dname",mapping:"dname",type:"string"},{name:"mail",mapping:"mail",type:"string"},{name:"hphone",mapping:"hphone",type:"string"},{name:"mphone",mapping:"mphone",type:"string"},{name:"fax",mapping:"fax",type:"string"},{name:"pager",mapping:"pager",type:"string"},{name:"addr",mapping:"addr",type:"string"},{name:"group",mapping:"group",type:"string"}]);var r=Ext.data.Record.create([{name:"id",mapping:"id",type:"int"},{name:"fname",mapping:"fname",type:"string"},{name:"lname",mapping:"lname",type:"string"},{name:"dname",mapping:"dname",type:"string"},{name:"mail",mapping:"mail",type:"string"},{name:"alias",mapping:"alias",type:"boolean"},{name:"mailDrop",mapping:"mailDrop"}]);var k=function(x,y){return false};var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},r);var p=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},v);var q=new Ext.grid.ColumnModel([{fixed:true,width:24,menuDisabled:true,renderer:function(x){return'<div class="icon-contact-account"></div>'}},{dataIndex:"name",menuDisabled:true,sortable:true,renderer:function(A,y,x){var z=x.data.mail;if(z==""){return A}else{return A+"&lt;"+z+"&gt;"}}},{header:iwebos.message.mail.contact.group,dataIndex:"group",menuDisabled:true,hidden:true}]);var f=new Ext.grid.ColumnModel([{dataIndex:"alias",fixed:true,width:24,menuDisabled:true,renderer:function(x){if(x){return'<div class="icon-contact-group"></div>'}else{return'<div class="icon-contact-account"></div>'}}},{dataIndex:"dname",menuDisabled:true,sortable:true,renderer:function(A,y,x){var z=x.data.mail;if(z==""){return A}else{return A+"&lt;"+z+"&gt;"}}}]);var d=function(x){return""};this.globalGrid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:this.globalGridId,region:"center",anchor:"100%",autoScroll:true,url:"jsonajax",method:"POST",sortInfo:t,baseParams:e,reader:a,cm:f,dsort:w,sm:new Ext.grid.RowSelectionModel({singleSelect:true}),filter:{data:"all",fn:true},loadFirst:false,rowClass:d});this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:this.gridId,region:"center",anchor:"100%",autoScroll:true,url:"jsonajax",method:"POST",sortInfo:t,baseParams:h,reader:p,groupLabel:iwebos.message.mail.contact.grid_group_label,groupField:"group",cm:q,loadFirst:false,dsort:w,filter:{data:"all",fn:true},sm:new Ext.grid.RowSelectionModel({singleSelect:true}),rowClass:d});this.personalPanel=new Ext.Panel({id:this.personalPanelId,title:iwebos.message.mail.contact.personal,border:false,collapsed:true,frame:false,layout:"border",filter:null,iconCls:"icon-contact-personal",items:[this.grid]});this.globalPanel=new Ext.Panel({id:this.globalPanelId,title:iwebos.message.mail.contact.global,border:false,frame:false,layout:"border",iconCls:"icon-contact-global",items:[this.globalGrid]});this.grid.on("rowdblclick",this.onDoubleClick,this,{stopEvent:true});this.grid.on("contextmenu",this._onGridContext,this,{stopEvent:true});this.grid.on("rowcontextmenu",this._onGridRowContextMenu,this,{stopEvent:true});this.globalGrid.on("contextmenu",function(x){x.stopEvent(true)},this,{stopEvent:true});this.globalGrid.on("rowcontextmenu",this._onGlobalGridRowContextMenu,this);this.personalPanel.on("beforeexpand",this.onClickExpand,this,{stopEvent:true});this.globalPanel.on("beforeexpand",this.onClickExpand,this,{stopEvent:true});this.personalPanel.on("collapse",this.onClickCollapse,this,{stopEvent:true});this.globalPanel.on("collapse",this.onClickCollapse,this,{stopEvent:true});this.previewPanel=new Ext.Panel({id:this.previewId,region:"center",frame:false,autoScroll:true,border:true});var g=new Ext.Panel({border:false,frame:false,region:"center",layout:"accordion",anchor:"100%",items:[this.personalPanel,this.globalPanel]});var o=new Ext.Panel({region:"west",border:false,frame:false,layout:"border",minSize:250,maxSize:800,width:400,split:true,items:[g]});this.main=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[o,this.previewPanel]});this.cboDepartment={id:this.departmentId,xtype:"combo",store:this.DOMAIN_STORE,valueField:"value",displayField:"text",mode:"local",triggerAction:"all",width:300,selectOnFocus:true,forceSelection:true,value:""};var j=new Ext.form.TextField({id:this.txtWordId,xtype:"textfield",width:200,itemCls:"required"});this.searchButton={xtype:"button",id:this.searchBtnId,iconCls:"icon-search",text:iwebos.message.mail.search,tooltip:iwebos.message.mail.search,handler:this.search,scope:this};this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.grid.store,displayInfo:false,hidden:true});this.pagingBar2=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.globalGrid.store,displayInfo:false});function m(x){var y=Ext.getCmp("main-tabs");if(!y){y.composeWithAddress(x)}}var c=['<table class="preview-contact-table" boder=0 width=100% cellspacing=1>','<tr class="preview-contact-hd"><td width=48px><img class="icon-contact-infor" src="images/s.gif"/></td><td align=left>\t\t{dname}</td></tr>','<tr><td align="right"><div class="icon-contact-mail" /></td><td><a style="cursor:pointer;" onclick="newComposerWAddress(\'{mail}\')">{mail}</a></td></tr>','<tr class="preview-contact-head"><td colspan=2>',iwebos.message.mail.contact.group_phone,"</td></tr>","<tr><td></td><td>","<table  boder=0 width=100%>","<tr><td width=150px>",iwebos.message.mail.contact.hphone,':</td><td align=left>{hphone}</td><td align="left">',iwebos.message.mail.contact.fax,":</td><td align=left>{fax}</td></tr>","<tr><td width=150px>",iwebos.message.mail.contact.mphone,':</td><td align=left>{mphone}</td><td align="left">',iwebos.message.mail.contact.pager,':</td><td align=left><a href="http://{pager}" target="_blank">{pager}</a></td></tr>',"</table>","</td></tr>",'<tr class="preview-contact-head"><td colspan=2>',iwebos.message.mail.contact.group_other,"</td></tr>","<tr><td></td><td>","<table  boder=0 width=100%>","<tr><td width=150px>",iwebos.message.mail.contact.addr,":</td><td align=left>{addr}</td></tr>","<tr><td width=150px>",iwebos.message.mail.contact.group,":</td><td align=lef>{group}</td></tr>","</table>","</td></tr>","</table>"];var s=new Ext.XTemplate(c.join(""),{});var l=['<table class="preview-contact-table" boder=0 width=100% cellspacing=1>','<tr class="preview-contact-hd"><td width=48px>','<tpl if="alias==true">','<img class="icon-contact-office" src="images/s.gif"/>',"</tpl>",'<tpl if="alias==false">','<img class="icon-contact-infor" src="images/s.gif"/>',"</tpl>","</td><td align=left>\t\t{dname}</td></tr>",'<tr><td align="right"><div class="icon-contact-mail" /></td><td><a style="cursor:pointer;" onclick="newComposerWAddress(\'{mail}\')">{mail}</a></td></tr>','<tpl if="alias==true">','<tr class="preview-contact-head"><td colspan=2>',iwebos.message.mail.contact.mail_member,"</td></tr>",'<tpl for="mailDrop">',"<tr><td></td><td>","<table boder=0 width=100%>",'<tr><td><a style="cursor:pointer;" onclick="newComposerWAddress(\'{mail}\')">{mail}</a></td></tr>',"</table>","</tpl>","</tpl>","</table>"];var n=new Ext.XTemplate(l.join(""),{});var i=Ext.getCmp(this.previewId);this.grid.getSelectionModel().on("rowselect",function(z,y,x){s.overwrite(i.body,x.data)},this);this.globalGrid.getSelectionModel().on("rowselect",function(z,y,x){n.overwrite(i.body,x.data)},this);this.grid.store.on("beforeload",this.__fnOnStore,this);this.globalGrid.store.on("beforeload",this.__fnOnStore,this);this.loadDomain();iNet.iwebos.ui.mail.AddressBookPanel.superclass.constructor.call(this,{id:"main-addressbook-panel",title:iwebos.message.mail.contact.title,iconCls:"icon-contact-users",layout:"border",header:false,closable:true,frame:false,border:false,renderTo:Ext.getBody(),tbar:[this.cboDepartment,j,this.searchButton,this.pagingBar,this.pagingBar2],items:[this.main]});this.on("activate",function(){Ext.EventManager.fireWindowResize()},this);j.on("specialkey",function(y,x){if(x.getKey()==Ext.EventObject.ENTER){this.search()}},this)};Ext.extend(iNet.iwebos.ui.mail.AddressBookPanel,Ext.Panel,{createBaseParams:function(d,b,a,c){return{iwm:d,iwct:b,iwc:a,iwa:c}},__fnOnStore:function(b,d){var f=Ext.getCmp(this.txtWordId);var a=f.getValue();var c=Ext.getCmp(this.departmentId);var e=c.getValue();e=(e===""||e===null?"":e);b.baseParams={iwct:"searchAddressBookContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",action:"search",keyword:a,group:e,mode:this.__owner.mode}},search:function(){if(this.__owner.mode=="personal"){this.grid.store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}else{this.globalGrid.store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}},loadDomain:function(){var a=this.createBaseParams("MAIL","searchAddressBookContent","READ_ONLY","loadDomain");a.action="loadDomain";iNet.Ajax.request({url:"jsonajax",params:a,scope:this,method:"POST",success:function(b,g){var i=Ext.util.JSON.decode(b.responseText);var h=Ext.getCmp(this.departmentId);this.DOMAIN_STORE.removeAll();this.DOMAIN_STORE.add(new Ext.data.Record({text:iwebos.message.mail.filter_object_all,value:"",desc:""}));var c=function(j,k){if(k==" "){return j}else{return j+" ["+k+"]"}};if(i!==null){if(i.length>0){var f=Ext.getCmp("main-tabs");var e=f.getDomainDefault();var d=false;for(index=0;index<i.length;index++){if(i[index].domain==e){d=true}this.DOMAIN_STORE.add(new Ext.data.Record({text:c(i[index].domain,i[index].desc),value:i[index].domain,desc:i[index].desc}))}this.DOMAIN_STORE.sort("value");h.store.loadData(this.DOMAIN_STORE,true);if(e!=null){if(d){h.setValue(e)}else{h.setValue("")}}}}this.globalGrid.store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})},failure:function(b,c){},maskEl:this.bwrap})},onDoubleClick:function(d,c,e){e.stopEvent();var b=d.store.getAt(c);var a=b.data;this.onUpdate(a)},onClickExpand:function(d,b){var c=Ext.getCmp(this.departmentId);if(d.id==this.personalPanelId){this.__owner.mode="personal";c.setDisabled(true);this.pagingBar.setVisible(true);this.pagingBar2.setVisible(false);if(!this.grid.loadFirst){this.grid.loadFirst=true;this.grid.store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}}else{this.__owner.mode="global";c.setDisabled(false);this.pagingBar.setVisible(false);this.pagingBar2.setVisible(true)}},onClickCollapse:function(a){if(a){var c=(a.id==this.personalPanelId?this.globalPanelId:this.personalPanelId);var b=Ext.getCmp(c);if(b){b.expand(true)}}},onAdd:function(){var d=this.createBaseParams("MAIL","addressBookContent","READ_WRITE","insert");var a=Ext.getCmp(this.gridId);var b=function(){var e=this.getData();if(e.mail===""||e.name===""||e.dname===""){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.contact.error_valid_data,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var g="insert";var f=function(i,j){var h=Ext.util.JSON.decode(i.responseText);var k=(h.success===undefined?true:h.success);if(k){a.store.addData(e)}else{Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.contact.add_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}};d.object=Ext.util.JSON.encode(e);d.action=g;iNet.Ajax.request({url:"jsonajax",params:d,scope:this,method:"POST",success:f,failure:function(h,i){},maskEl:this.bwrap});Ext.form.Field.prototype.msgTarget="side";this.destroy()};var c=new iNet.iwebos.ui.mail.ContactDialog({title:iwebos.message.mail.contact.dialog_title,ttitle:iwebos.message.mail.contact.dialog_desc,btitle:"",iconCls:"icon-contact-users",okHandler:b,width:500,height:470,resizable:false,modal:true,hscope:c});c.show(this)},onUpdate:function(c){var a=Ext.getCmp(this.gridId);var e=this.createBaseParams("MAIL","addressBookContent","READ_WRITE","update");var b=function(){var f=this.getData();if(f.mail===""||f.name===""||f.dname===""){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.contact.error_valid_data,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var h="update";var g=function(j,k){var i=Ext.util.JSON.decode(j.responseText);var n=(i.success===undefined?true:i.success);var m=a.store.getById(c.id);var l=a.getSelectionModel().getSelections();if(n){a.store.remove(l[0]);a.store.addData(f)}else{Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.contact.update_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}};f.id=c.id;e.object=Ext.util.JSON.encode(f);e.action=h;iNet.Ajax.request({url:"jsonajax",params:e,scope:this,method:"POST",success:g,failure:function(i,j){},maskEl:this.bwrap});Ext.form.Field.prototype.msgTarget="side";this.destroy()};var d=new iNet.iwebos.ui.mail.ContactDialog({title:iwebos.message.mail.contact.dialog_title,ttitle:iwebos.message.mail.contact.dialog_desc,btitle:"",iconCls:"icon-contact-users",okHandler:b,width:500,height:470,resizable:false,modal:true,editor:true,hscope:d});d.setData(c);d.show(this)},onDelete:function(){var c=Ext.getCmp(this.gridId);var b=c.getSelectionModel().getSelections();var a=b[0].data;var d=function(g){if(g==="ok"||g==="yes"){var f=function(i,j){var h=Ext.util.JSON.decode(i.responseText);if(h.success){var k=j.removeItems;c.store.remove(k[0])}else{Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.contact.update_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};a=Ext.util.JSON.encode(a);var e={iwct:"addressBookContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"delete",action:"delete",object:a};iNet.Ajax.request({url:"jsonajax",success:f,failure:f,method:"POST",params:e,removeItems:b,maskEl:c.bwrap})}};Ext.MessageBox.confirm(iwebos.message.paperwork.ed.msg.title,iwebos.message.mail.contact.delete_confirm,d)},_fnCreateMenu:function(){if(!this.menu){this.menu=new Ext.menu.Menu({id:"grid-personal-ctx",items:[{id:"grid-ctx-mnu-add-id",text:iwebos.message.mail.contact.add,iconCls:"icon-contact-add",scope:this,handler:this.onAdd},{id:"grid-ctx-mnu-remove-id",text:iwebos.message.mail.contact.remove,iconCls:"icon-contact-delete",scope:this,disabled:true,handler:this.onDelete},{id:"grid-ctx-mnu-send-message-id",type:"button",text:iwebos.message.mail.contact.send_message,iconCls:"icon-email-new-mail",scope:this,handler:this.onSendMessage,disabled:true}]})}return this.menu},_fnHandleMenu:function(c,a){var b=a||{};if(!b.data){c.items.get("grid-ctx-mnu-remove-id").setDisabled(true);c.items.get("grid-ctx-mnu-send-message-id").setDisabled(true)}else{c.items.get("grid-ctx-mnu-add-id").setDisabled(false);c.items.get("grid-ctx-mnu-remove-id").setDisabled(false);c.items.get("grid-ctx-mnu-send-message-id").setDisabled(false)}},_onGridContext:function(b){b.stopEvent();var a=this._fnCreateMenu();this._fnHandleMenu(a);a.showAt(b.getXY())},_onGridRowContextMenu:function(c,b,d){d.stopEvent();WebOSGridService.handleSelection(c,b);var a=this._fnCreateMenu();this._fnHandleMenu(a,c.store.getAt(b));a.showAt(d.getXY())},_onGlobalGridRowContextMenu:function(b,a,c){c.stopEvent();WebOSGridService.handleSelection(b,a);if(!this.globalMenu){this.globalMenu=new Ext.menu.Menu({items:[{text:iwebos.message.mail.contact.send_message,iconCls:"icon-email-new-mail",scope:this,handler:this.onSendMessageGlobal}]})}this.globalMenu.showAt(c.getXY())},onSendMessage:function(){var a=this.grid.getSelectionModel().getSelected();this.composeWithAddress(a.data.mail)},onSendMessageGlobal:function(){var a=this.globalGrid.getSelectionModel().getSelected();this.composeWithAddress(a.data.mail)},composeWithAddress:function(a){var c=Ext.getCmp("main-tabs");var b=Ext.getCmp("mail-compose");if(!b){b=new iNet.iwebos.ui.mail.MailCompose();c.add(b).show();b.loadInfo(0,"")}else{var d=b.__owner||{};if(d.close){b.clearData();b.loadInfo(0,"")}}c.setActiveTab(b);b.setToAddress(a)}}); 
iNet.iwebos.ui.mail.ContactDialog=Ext.extend(iNet.iwebos.ui.common.dialog.TitleDialog,{ttitle:iwebos.message.mail.contact.dialog_title,btitle:iwebos.message.mail.contact.dialog_desc,okTitle:Ext.MessageBox.buttonText.ok,cancelTitle:Ext.MessageBox.buttonText.cancel,bodyBorder:false,dragContent:false,closeAction:"hide",resizable:true,minWidth:530,minHeight:600,hdImgCls:"icon-contact-infor",bodyStyle:"padding:1px;",resizable:true,initComponent:function(){Ext.form.Field.prototype.msgTarget="qtip";var d=this.prefix||"iwebos-contact-dialog";delete this.prefix;this.nameId=d+"-name-id";this.dNameId=d+"-displayname-id";this.emailId=d+"-email-id";this.hphoneId=d+"-home-phone-id";this.mphoneId=d+"-mobile-phone-id";this.faxId=d+"-fax-id";this.siteId=d+"-site-id";this.groupId=d+"-group-id";this.addressId=d+"-address-id";var a=new Ext.form.FormPanel({region:"center",frame:false,border:false,anchor:"100%",labelWidth:75,autoScroll:false,bodyStyle:"padding:5px;",items:[{xtype:"fieldset",title:iwebos.message.mail.contact.group_info,collapsible:false,autoHeight:true,items:[{layout:"form",frame:false,border:false,items:[{id:this.nameId,xtype:"textfield",fieldLabel:iwebos.message.mail.fullname,allowBlank:false,disabled:this.editor,anchor:"100%"},{id:this.dNameId,xtype:"textfield",fieldLabel:iwebos.message.mail.contact.dname,allowBlank:false,anchor:"100%"},{id:this.emailId,xtype:"textfield",vtype:"email",fieldLabel:iwebos.message.mail.contact.email,allowBlank:false,anchor:"100%"}]}]},{xtype:"fieldset",title:iwebos.message.mail.contact.group_phone,collapsible:true,autoHeight:true,items:[{layout:"form",frame:false,border:false,items:[{xtype:"panel",layout:"column",columnWidth:1,frame:false,border:false,anchor:"100%",items:[{columnWidth:0.5,layout:"form",border:false,items:[{id:this.hphoneId,xtype:"textfield",fieldLabel:iwebos.message.mail.contact.hphone,anchor:"98%"},{id:this.mphoneId,xtype:"textfield",fieldLabel:iwebos.message.mail.contact.mphone,anchor:"98%"}]},{columnWidth:0.5,layout:"form",border:false,items:[{id:this.faxId,xtype:"textfield",fieldLabel:iwebos.message.mail.contact.fax,anchor:"100%"},{id:this.siteId,xtype:"textfield",fieldLabel:iwebos.message.mail.contact.pager,anchor:"100%"}]},{columnWidth:1,layout:"form",border:false,items:[{id:this.groupId,xtype:"textfield",fieldLabel:iwebos.message.mail.contact.group,anchor:"100%"},{id:this.addressId,xtype:"textfield",fieldLabel:iwebos.message.mail.contact.addr,anchor:"100%"}]}]}]}]}]});this.items=[a];var b=this.okHandler||this._fnOkHandler;var c=this.cancelHandler||this._fnCancelHandler;this.hScope=this.hScope||this;this.buttons=[{text:this.okTitle,iconCls:"ok-btn",handler:b,scope:this.hScope},{text:this.cancelTitle,iconCls:"cancel-btn",handler:c,scope:this.hScope}];this.layout="border";this.hideMode="offsets";iNet.iwebos.ui.mail.ContactDialog.superclass.initComponent.call(this)},_fnOkHandler:function(){Ext.form.Field.prototype.msgTarget="side";this.destroy()},_fnCancelHandler:function(){Ext.form.Field.prototype.msgTarget="side";this.destroy()},setData:function(b){var a=Ext.getCmp(this.dNameId);a.setValue(b.dname);a=Ext.getCmp(this.nameId);a.setValue(b.name);a=Ext.getCmp(this.emailId);a.setValue(b.mail);a=Ext.getCmp(this.hphoneId);a.setValue(b.hphone);a=Ext.getCmp(this.mphoneId);a.setValue(b.mphone);a=Ext.getCmp(this.faxId);a.setValue(b.fax);a=Ext.getCmp(this.siteId);a.setValue(b.pager);a=Ext.getCmp(this.groupId);a.setValue(b.group);a=Ext.getCmp(this.addressId);a.setValue(b.addr)},getData:function(){var h=Ext.getCmp(this.dNameId);var a=h.getValue()||"";h=Ext.getCmp(this.nameId);var i=h.getValue()||"";h=Ext.getCmp(this.emailId);var c=h.getValue()||"";h=Ext.getCmp(this.hphoneId);var g=h.getValue()||"";h=Ext.getCmp(this.mphoneId);var d=h.getValue()||"";h=Ext.getCmp(this.siteId);var j=h.getValue()||"";h=Ext.getCmp(this.faxId);var b=h.getValue()||"";h=Ext.getCmp(this.groupId);var e=h.getValue()||"";h=Ext.getCmp(this.addressId);var f=h.getValue()||"";return{dname:a,name:i,mail:c,hphone:g,mphone:d,fax:b,pager:j,group:e,addr:f}},afterRender:function(){iNet.iwebos.ui.mail.ContactDialog.superclass.afterRender.call(this);this.on("hide",this.onHide,this)},onHide:function(){Ext.form.Field.prototype.msgTarget="side";this.destroy(this)},setEmail:function(a){__component=Ext.getCmp(this.nameId);__component.setValue(a.fullname);__component=Ext.getCmp(this.dNameId);__component.setValue(a.fullname);__component=Ext.getCmp(this.emailId);__component.setValue(a.email)}}); 
var _divContext;var _writeMailMenu;var _addContactMenu;var _replaceContext=false;var _mouseOverContext=false;var _noContext=false;function InitContext(){_divContext=$("divAddressContext");_writeMailMenu=$("ctx-write-mail");_addContactMenu=$("ctx-add-contact");_divContext.onmouseover=function(){_mouseOverContext=true};_divContext.onmouseout=function(){_mouseOverContext=false};document.body.onmousedown=ContextMouseDown}function ContextMouseDown(b){if(_noContext||_mouseOverContext){return}if(b==null){b=window.event}var c=b.target!=null?b.target:b.srcElement;var a=(b.button==0);if(Ext.isIE){a=(b.button==5)}if(a&&c.tagName.toLowerCase()=="a"&&c.className=="aaaaa"){_replaceContext=true;ContextShow(b)}else{if(!_mouseOverContext){_divContext.style.display="none"}}}function ContextShow(a){if(_noContext||_mouseOverContext){return}if(a==null){a=window.event}var c=a.target!=null?a.target:a.srcElement;var b=document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop;var d=document.body.scrollLeft?document.body.scrollLeft:document.documentElement.scrollLeft;_divContext.style.left=a.clientX+d+"px";_divContext.style.top=a.clientY+b+"px";_divContext.style.display="block";_replaceContext=false;_writeMailMenu.href='javascript:newComposerWAddress("'+a.target.text+'");';_addContactMenu.href='javascript:newContact("'+a.target.text+'");';return false}function $(a){return document.getElementById(a)}; 
function newComposerWAddress(a){var b=Ext.getCmp("main-tabs");if(!!b){_divContext.style.display="none";b.composeWithAddress(a)}}function newContact(a){var b=Ext.getCmp("main-tabs");if(!!b){_divContext.style.display="none";b.addContact(a)}}function checkMailLoading(a,f){var e=function(h){var g=h.indexOf(":");if(g==-1){return h}return h.substring(g+1)};if(a){document.getElementById("action-check").className="task-loading"}else{var c=Ext.getCmp("main-tabs");if(c.tooltipError!=null){c.tooltipError.destroy()}if(f.length>0){var d="";for(var b=0;b<f.length;b++){d=d+e(f[b])+"<br/>"}c.tooltipError=new Ext.ToolTip({id:"mail-error-tooltip",target:"action-check",html:d,autoHeight:true,closable:true,title:iwebos.message.mail.check_mail_error_tootip,draggable:true,animCollapse:true,trackMouse:true});document.getElementById("action-check").className="icon-email-error"}else{document.getElementById("action-check").className="task-action-viewall"}}}Ext.grid.RowSelectionModel.prototype.rsmHandleMouseDown=Ext.grid.RowSelectionModel.prototype.handleMouseDown;Ext.grid.CheckboxSelectionModel.override({handleMouseDown:function(a,c,b){}});Ext.grid.RowSelectionModel.override({initEvents:function(){if(!this.grid.enableDragDrop&&!this.grid.enableDrag){this.grid.on("rowmousedown",this.rsmHandleMouseDown,this)}else{this.grid.on("rowclick",function(b,f,d){var c=d.getTarget();if(c.className!=="x-grid3-row-checker"){this.rsmHandleMouseDown(b,f,d);b.view.focusRow(f)}},this)}this.rowNav=new Ext.KeyNav(this.grid.getGridEl(),{up:function(c){if(!c.shiftKey){this.selectPrevious(c.shiftKey)}else{if(this.last!==false&&this.lastActive!==false){var b=this.last;this.selectRange(this.last,this.lastActive-1);this.grid.getView().focusRow(this.lastActive);if(b!==false){this.last=b}}else{this.selectFirstRow()}}},down:function(c){if(!c.shiftKey){this.selectNext(c.shiftKey)}else{if(this.last!==false&&this.lastActive!==false){var b=this.last;this.selectRange(this.last,this.lastActive+1);this.grid.getView().focusRow(this.lastActive);if(b!==false){this.last=b}}else{this.selectFirstRow()}}},scope:this});var a=this.grid.view;a.on("refresh",this.onRefresh,this);a.on("rowupdated",this.onRowUpdated,this);a.on("rowremoved",this.onRemove,this)}});function showHeaderMail(e){var a=document.getElementById("mail-head-down");var c=document.getElementById("header-mail-show");var b='<div class="mail-head-down" onclick="showHeaderMail(false);"></div>';var d='<div class="mail-head-right" onclick="showHeaderMail(true);"></div>';a.innerHTML=(true==e)?b:d;c.style.display=(true==e)?"":"none";Ext.EventManager.fireWindowResize()}function openConfigPanel(){var a=Ext.getCmp("main-tabs");if(a){a.configAccount()}}iNet.iwebos.ui.mail.grid.MailViewPanel=function(viewer,config){this.viewer=viewer;Ext.apply(this,config);this.__owner={};this.fetchInfo={fetching:false,status:0,total:0,fetched:0,accounts:[],errors:[]};this.recipients=null;this.lastIndex=0;this.config={};this.tooltipError=null;var __sortInfo={field:"received",direction:"DESC"};var __defaultSort={field:"received",direction:"DESC"};var __groupField="received";var __baseParams={iwct:"loadMailHeaderContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",id:0,action:"search",mode:"basic",field:"all"};var __mailRecord=Ext.data.Record.create([{name:"id",mapping:"hid",type:"int"},{name:"priority",mapping:"priority",type:"string"},{name:"sender",mapping:"sender",type:"string"},{name:"recipient",mapping:"recipient",type:"string"},{name:"subject",mapping:"subject",type:"string"},{name:"attached",mapping:"attached",type:"boolean"},{name:"size",mapping:"size",type:"string"},{name:"read",mapping:"read",type:"string"},{name:"sent",mapping:"sent",type:"int"},{name:"received",mapping:"received",type:"int"},{name:"flag",mapping:"flag",type:"string"},{name:"type",mapping:"type",type:"string"},{name:"contentId",mapping:"contentId",type:"string"}]);var __reader=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},__mailRecord);var __priorityColumn=new iNet.iwebos.ui.common.grid.EmailImportantColumn();var __fileAttachment=new iNet.iwebos.ui.mail.grid.AttachmentColumn();var __statusColumn=new iNet.iwebos.ui.mail.grid.StatusColumn({});var __typeColumn=new iNet.iwebos.ui.mail.grid.TypeColumn();var __checkbox=new Ext.grid.CheckboxSelectionModel();var __columnModel=new Ext.grid.ColumnModel([__checkbox,__priorityColumn,__statusColumn,__fileAttachment,__typeColumn,{header:iwebos.message.mail.grid_sender,dataIndex:"sender",sortable:true,width:150,renderer:function(value,cell){return"<p style='white-space:normal'>"+value+"</p>"}},{dataIndex:"recipient",header:"Người nhận",width:150,hidden:true},{header:iwebos.message.mail.grid_subject,dataIndex:"subject",sortable:true,renderer:function(value,cell){return"<p style='white-space:normal'>"+value+"</p>"}},{dataIndex:"received",header:iwebos.message.mail.filter_object_date_received,sortable:true,width:110,fixed:true,renderer:iNet.dateRenderer("H:i d/m/Y"),groupRenderer:iNet.dateGroupRenderer()},{header:iwebos.message.mail.grid_size,dataIndex:"size",sortable:true,width:70,fixed:true}]);var _filterFn=function(item,value){return(item.data.status===value)};var __fnRowClass=function(record){var __read=record.data.read;if(__read==="Y"){return""}else{return"mail-grid-unread"}};this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:"email-message-grid-id",ddGroup:"Mail-drag-drop-group",region:"center",anchor:"100%",autoScroll:true,url:"jsonajax",method:"POST",sortInfo:__sortInfo,baseParams:__baseParams,loadFirst:false,reader:__reader,enableDrag:true,groupLabel:iwebos.message.mail.grid_groupLabel,groupField:__groupField,rowClass:__fnRowClass,dsort:__defaultSort,cm:__columnModel,sm:__checkbox,filter:{data:"all",fn:_filterFn},viewConfig:{forceFit:true},plugins:[__priorityColumn,__fileAttachment]});this.grid.on("contextmenu",this._onGridContext,this,{stopEvent:true});this.grid.on("rowcontextmenu",this._onGridRowContextMenu,this,{stopEvent:true});this.grid.on("rowdblclick",this._onDoubleClick,this);this.grid.on("rowclick",function(grid,rowIndex,e){var __records=grid.getSelectionModel().getSelections();if(__records.length>1){return}var __record=grid.store.getAt(rowIndex);var __hId=__record.data.id;if(this.lastIndex==__hId){if(__record.data.read==="N"){this._markRead("Y")}var __sPanel=Ext.getCmp("preview-mail-panel");if(!__sPanel.isVisible()){__sPanel.setVisible(true);Ext.EventManager.fireWindowResize()}}},this);this.grid.selModel.on("selectionchange",this._fnHandleFunction,this);this.grid.store.on("load",this._onStoreLoad,this);this.grid.store.on("remove",this._onStoreRemove,this);this.grid.store.on("add",this._fnOnStoreInsert,this);this.adSearch=new iNet.iwebos.ui.mail.Toolbar({region:"north",width:"100%",height:30,frame:false,border:false,showmybutton:false,store:this.grid.store});this.adSearch.on("delete",this.onDelete,this);this.adSearch.on("reply",this.replyEmail,this);this.adSearch.on("replyall",this.replyAllEmail,this);this.adSearch.on("forward",this.forwardEmail,this);this.adSearch.on("spam",this.spamEmail,this);this.actions={"action-create":this._newEmail,"action-check":this._checkEmail.createDelegate(this),"action-config-account":this.configAccount,"action-address-book":this.openAddressBook};this.preViewHeader=new Ext.Panel({id:"previewPanelHeader",autoHeight:true,region:"north",cls:"w3c",frame:true});this.preViewBody=new Ext.Panel({id:"previewPanelBody",region:"center",frame:false,cls:"w3c",border:false,autoScroll:true});this.south=new Ext.Panel({id:"preview-mail-panel",region:"south",layout:"border",height:50,split:true,border:true,autoScroll:true,baseCls:"preview",collapseMode:"mini",minSize:80,hidden:true,items:[this.preViewHeader,this.preViewBody]});var itemTplHeaderMarkup=["<table width=100% border=0 cellspacing=0 cellpadding=0>","<tr>",'<td width="16">&nbsp;</td>','<td width="84" align="right" valign="top" class="mail-subject-content" >&nbsp;'+iwebos.message.mail.subject+":&nbsp;</td>",'<td class="mail-subject-content" colspan="2" >{subject}</td>',"</tr>","<tr>",'<td width="16" align="left" valign="top"><div id="mail-head-down"><div class="mail-head-right" onclick="showHeaderMail(true);"></div></div></td>','<td align="right" valign="top" width="84">&nbsp;<b>'+iwebos.message.mail.grid_sender+":&nbsp;</td>",'<td valign="top"><a class="aaaaa" style="cursor:pointer;">{from}</a></td>','<td valign="top" align="right">&nbsp;<b>'+iwebos.message.mail.grid_sent+": &nbsp;</b> {[this.format(values.sent)]}</td>","</tr>","</table>",'<table width=100% border=0 cellspacing=0 cellpadding=0 id="header-mail-show" style="display:NONE ;">','<tpl if="this.isCheck(to)">',"<tr>",'<td width="100" align="right" valign="top">&nbsp;<b>'+iwebos.message.mail.template_mailto+":&nbsp;</b> </td>",'<td valign="top"><tpl for="to"><a class="aaaaa" style="cursor:pointer;">{[this.formatAddress(values.name,values.address)]},</a> </tpl></td>',"</tr>","</tpl>",'<tpl if="this.isCheck(cc)">',"<tr>",'<td align="right" valign="top"><b>CC:&nbsp;</b></td>','<td valign="top">','<tpl for="cc"><a class="aaaaa" style="cursor:pointer;">{[this.formatAddress(values.name,values.address)]}</a>, </tpl>',"</td>","</tr>","</tpl>",'<tpl if="this.isCheck(bcc)">',"<tr>",'<td align="right" valign="top"><b>BCC:&nbsp;</b></td>','<td valign="top">','<tpl for="bcc"><a style="cursor:pointer;" onclick="newComposerWAddress(\'{[this.formatAddress(values.name,values.address)]}\')">{[this.formatAddress(values.name,values.address)]}</a>, </tpl>',"</td>","</tr>","</tpl>","</table>",'<tpl if="this.isCheck(attachments)">','<table width=100% border=0 cellspacing=0 cellpadding=0 id="attach-panel" style="display: ;">',"<tr>",'<td width="100" align="right" valign="top" NOWRAP>','<tpl if="this.isDownloadAll(attachments)">','<a class="icon-email-download-all" style="cursor:pointer;" onclick="MailService.downloadAttach(\'{id}\', \'all\')">&nbsp;&nbsp;&nbsp;&nbsp;</a>',"</tpl>","<a onclick=\"MailService.downloadAttach('{id}', 'all')\"><b>"+iwebos.message.mail.template_attach+":</b></a> &nbsp;","</td>",'<td valign="top" colspan="3">','<tpl for="attachments">',"<span class={[MailService.getCssAttachment(values.icon)]}>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><a style=\"cursor:pointer;\" onclick=\"MailService.downloadAttach('{parent.id}', '{fkey}','{icon}')\">&nbsp;{fname}</a>  ","</tpl>","</td>","</tr>","</table>","</tpl>"];var itemTplBodyMarkup=['<table width=100% border=0 cellspacing=0 cellpadding=0 bgcolor="#FFFFFF">','<tr><td valign=top style="padding:10px;font-size:15px;">&nbsp;{body}</td></tr></table>'];var itemTpl=new Ext.XTemplate(itemTplHeaderMarkup.join(""),{format:function(value){return(value==0)?"":new Date(value).format("d/m/Y")},isCheck:function(val){return(false==val)?"":val},isDownloadAll:function(attach){return(attach.length>1?true:false)},formatAddress:function(name,address){if(name!=""){return name+" &lt;"+address+"&gt;"}else{return address}},getDownloadName:function(text){text=text.replace(/'/g,"");text=text.replace(/"/g,"");return text},getFkey:function(text){return escape(text)}});var itemTpl2=new Ext.XTemplate(itemTplBodyMarkup.join(""),{});this.grid.getSelectionModel().on("rowselect",function(sm,rowIdx,r){var __records=sm.getSelections();if(__records.length>1){return}var __record=r;var __hId=__record.data.id;if(this.lastIndex==__hId){return}this.lastIndex=__hId;var __sPanel=Ext.getCmp("preview-mail-panel");var __baseParams={iwct:"mailContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"select",action:"select"};__baseParams.hid=__hId;iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:this,method:"POST",success:function(result,request){var __data=Ext.util.JSON.decode(result.responseText);var __success=(__data.success==undefined?true:false);if(__success){__data.id=__hId;__data=MailService.escape(__data);var __detailPanel=Ext.getCmp("previewPanelHeader");if(__detailPanel){itemTpl.overwrite(__detailPanel.body,__data)}var __detailPanel2=Ext.getCmp("previewPanelBody");if(__detailPanel2){itemTpl2.overwrite(__detailPanel2.body,__data)}this.__owner.data=__data;if(__record.data.read==="N"){__record.data.read="Y";__record.commit();Ext.getCmp("mail-tree-folder-id").readMail(1)}if(!__sPanel.isVisible()){__sPanel.setVisible(true)}Ext.EventManager.fireWindowResize()}else{this.__owner.data=null;__sPanel.setVisible(false);Ext.EventManager.fireWindowResize();Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.view_mail_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},failure:function(result,request){},maskEl:this.grid.bwrap})},this);var __gridMain=new Ext.Panel({id:"mail-gridmain-id",layout:"border",region:"center",frame:false,border:false,items:[this.adSearch,this.grid,this.south]});var __fuPanel=new iNet.iwebos.ui.mail.MailFollowUpPanel({id:"mail-follow-up-ctx-id",region:"east",anchor:"100%"});__fuPanel.on("view",this.onViewFollowUp,this,{stopEvent:true});__fuPanel.on("render",function(panel){var __drop=new Ext.dd.DropTarget(__fuPanel.getEl(),{ddAppendOnly:true,appendOnly:true,ddGroup:"Mail-drag-drop-group",dropAllowed:true,appendOnly:true,notifyDrop:function(source,e,data){var __grid=data.grid;var __selects=__grid.getSelectionModel().getSelections();var __ids=[];var __data=[];if(__selects!==undefined){for(var __index=0;__index<__selects.length;__index++){__data[__index]={data:__selects[__index].data.id,name:__selects[__index].data.subject}}panel.save(__data,iNet.iwebos.ui.common.control.FollowUpPanel.TODAY)}else{return false}return true}})},this);var __main=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[__gridMain,__fuPanel]});__main.on("render",this._checkMailAuto.createDelegate(this),this);this.south.on("render",function(panel){var __cmp=Ext.getCmp("mail-gridmain-id");var __gridMain=__cmp.getSize().height;__cmp=Ext.getCmp("email-message-grid-id");__cmp.setHeight(__gridMain/2);__cmp=Ext.getCmp("preview-mail-panel");__cmp.setHeight(__gridMain/2);var __convertMB=function(size){return Math.round(size/1048576)};var _handlerFn=function(response,options){var __result=eval("("+response.responseText+")");if(__result.success==undefined){var __quotaDiv=document.getElementById("quota-id");var __used=__result.used;var __quota=__result.quota;var __percentage=Math.round((__used*100)/__quota);var __content="";if(__percentage<=100){if(__percentage>90){__quotaDiv.className="quota-warning"}else{__quotaDiv.className="quota"}__content="Hiện tại bạn đã sử dụng "+__convertMB(__used)+" MB ("+__percentage+"%) trên tổng số "+__convertMB(__quota)+" MB"}else{__content="Hiện tại bạn đã sử dụng "+__convertMB(__used)+" MB ("+__percentage+"%) vượt so với hạn mức "+__convertMB(__quota)+" MB";__quotaDiv.className="quota-greater"}__quotaDiv.innerHTML=__content}};var __baseParams={iwct:"quotacontent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"loadQuota",action:"loadQuota"};iNet.Ajax.request({url:"jsonajax",success:_handlerFn,failure:_handlerFn,method:"POST",params:__baseParams})},this);iNet.iwebos.ui.mail.grid.MailViewPanel.superclass.constructor.call(this,{id:"main-tabs",activeTab:0,region:"center",anchor:"100%",enableTabScroll:true,autoScroll:true,frame:false,border:false,items:{id:"main-mailbox",title:iwebos.message.mail.title_mailbox,iconCls:"icon-mail-home",layout:"border",hideMode:"offsets",items:[__main]}})};Ext.extend(iNet.iwebos.ui.mail.grid.MailViewPanel,Ext.TabPanel,{configAccount:function(b){var c=Ext.getCmp("main-tabs");var a=Ext.getCmp("mail-config-account");if(!a){a=new iNet.iwebos.ui.mail.ConfigAccount();c.add(a).show();a.loadInfo()}c.setActiveTab(a)},_fnNewTab:function(b){var c=Ext.getCmp("main-tabs");var a=Ext.getCmp("mail-compose");var d=b||"composer";if(!a){a=(d==="composer")?new iNet.iwebos.ui.mail.MailCompose():new iNet.iwebos.ui.mail.MailCompose();c.add(a).show()}c.setActiveTab(a);return a},_fetchMail:function(c){var b=function(f,g){var e=Ext.util.JSON.decode(f.responseText);if(e.success==undefined){__header=e;__header.id=__header.hid;var i=__header.folder;var j=Ext.getCmp("mail-tree-folder-id");var k=j.getInboxFolder();var h=j.getFolder();if((i===h)){var d=this.grid.store;if(d.getCount()>0){d.insert(0,new Ext.data.Record(__header))}else{d.addData(__header)}}j.addMessageUnread2Folder(1,i);if(this.fetchInfo.accounts[c].newMessage<=0){this.fetchInfo.accounts[c].newMessage=0}else{this.fetchInfo.fetched++;this.fetchInfo.accounts[c].newMessage--;this._updateFetchMessage()}if(this.fetchInfo.accounts[c].newMessage==0){this.fetchInfo.accounts[c].fetched=true;this._fetchMail(++c)}else{this._fetchMail(c)}}else{this.fetchInfo.accounts[c].newMessage=0;this.fetchInfo.accounts[c].fetched=true;this.fetchInfo.errors[this.fetchInfo.errors.length]=this.fetchInfo.accounts[c].smtpAccount;this._fetchMail(++c)}};if(!this.fetchInfo.fetching){return}if((c<this.fetchInfo.accounts.length)){if(this.fetchInfo.accounts[c].newMessage>0){var a={iwct:"mailContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"check",action:"check",mode:"fetch",newMessage:this.fetchInfo.accounts[c].newMessage,smtpAccount:this.fetchInfo.accounts[c].smtpAccount};iNet.Ajax.request({url:"jsonajax",params:a,scope:this,method:"POST",success:b,failure:function(d,e){this.stopFetchMail()}})}else{this._fetchMail(++c)}}else{this.stopFetchMail()}},_fetchNewMessage:function(index){var handlerFn=function(response,options){var __newMessage=0;var __result=eval("("+response.responseText+")");if(__result.success==undefined){__newMessage=__result.newMessages}else{__newMessage=0;this.fetchInfo.errors[this.fetchInfo.errors.length]=this.fetchInfo.accounts[index].smtpAccount}this.fetchInfo.total=this.fetchInfo.total+__newMessage;this._updateFetchMessage();this.fetchInfo.accounts[index].fetchNew=true;this.fetchInfo.accounts[index].newMessage=__newMessage;this._fetchNewMessage(++index)};if(!this.fetchInfo.fetching){return}if(index<this.fetchInfo.accounts.length){if(this.fetchInfo.accounts[index].pass){var __baseParams={iwct:"mailContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"check",action:"check",mode:"newMessage",index:index,smtpAccount:this.fetchInfo.accounts[index].smtpAccount};iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:this,method:"POST",success:handlerFn,failure:function(response,options){this.stopFetchMail()}})}else{this._updatePassword(index)}}else{this._fetchMail(0)}},_updateFetchMessage:function(){var a=this.fetchInfo;if(!a.fetching){document.getElementById("result-check-mail").innerHTML=iwebos.message.mail.receive_mail;return}if(a.total==0&&a.fetched==0){document.getElementById("result-check-mail").innerHTML=iwebos.message.mail.receive_mail}else{document.getElementById("result-check-mail").innerHTML="("+a.fetched+"/"+a.total+")"}},stopFetchMail:function(){checkMailLoading(false,this.fetchInfo.errors);this.fetchInfo.fetching=false;this.fetchInfo.total=0;this.fetchInfo.fetched=0;this._updateFetchMessage();var a=this.config.refresh||0;if(!!this.timeout){clearTimeout(this.timeout)}if(a!=0){this.timeout=setTimeout(this._checkAuto.createDelegate(this),a*60000)}},_checkMailAuto:function(panel){var __handlerFn=function(response,options){if(!!response){var __result=eval("("+response.responseText+")");if(__result.success!=undefined){return}this.config=__result;Ext.getCmp("mail-tree-folder-id").reloadMailBox();if(this.config.folder){var __inbox=this.config.folder.inbox;var __store=this.grid.store;var __params=__store.baseParams;__params.id=__inbox;__params.mode="basic";__store.baseParams=__params;__store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}this._checkEmail()}};var __baseParams={iwct:"mailConfigureContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"load",action:"load",mode:"personal"};iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:this,method:"POST",success:__handlerFn,failure:function(response,options){this.stopFetchMail()}})},_checkAuto:function(){if(this.config.refresh!=0){this._checkEmail()}else{if(this.timeout){clearTimeout(this.timeout)}}},loadPersonalConfig:function(){var __handlerFn=function(response,options){this.flag=true;if(!!response){var __result=eval("("+response.responseText+")");if(__result.success!=undefined){return}this.config=__result;this._checkEmail()}};var __baseParams={iwct:"mailConfigureContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"load",action:"load",mode:"personal"};iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:this,method:"POST",success:__handlerFn,failure:function(response,options){this.stopFetchMail()}})},_checkEmail:function(){if(this.fetchInfo.fetching){return}checkMailLoading(true,[]);this.fetchInfo.fetching=true;var c=this.config||{};var a=c.smtpAccount;if(a==undefined){if(this.flag){MailService.showInfo(iwebos.message.mail.error_config_fetch_mail)}else{this.flag=false;this.loadPersonalConfig()}this.stopFetchMail();return}if(a.smtps.length==0){MailService.showInfo(iwebos.message.mail.error_config_fetch_mail);this.stopFetchMail();return}var d=a.smtps;var e=[];for(var b=0;b<d.length;b++){e[b]={smtpAccount:d[b].smtpAccount,pass:d[b].pass,newMessage:0,address:d[b].address,fetchNew:false,fetched:false}}this.fetchInfo.accounts=e;this.fetchInfo.errors=[];if(e.length>0){this._fetchNewMessage(0)}else{this.stopFetchMail()}},_newEmail:function(){var b=Ext.getCmp("main-tabs");var a=Ext.getCmp("mail-compose");if(!a){a=new iNet.iwebos.ui.mail.MailCompose();b.add(a).show();a.loadInfo(0,"")}else{var c=a.__owner||{};if(c.close){a.clearData();a.loadInfo(0,"")}}b.setActiveTab(a)},_composerEmail:function(a){var b=this.grid.getSelectionModel().getSelections();if(b==undefined||b.length==0){return}this.fnComposerMail(b[0].data.id,a)},fnComposerMail:function(d,a){var c=Ext.getCmp("main-tabs");var b=Ext.getCmp("mail-compose");if(!b){b=new iNet.iwebos.ui.mail.MailCompose();c.add(b).show()}c.setActiveTab(b);b.loadInfo(d,a)},replyEmail:function(){this._composerEmail("reply")},replyAllEmail:function(){this._composerEmail("replyA")},forwardEmail:function(){this._composerEmail("forward")},spamEmail:function(){var e=this.grid.getSelectionModel().getSelections();if(!!e){var f=this.config.folder;if(f===undefined){return}MailService.addSpam(f.spam,e);var a=this.grid.store;var h=function(k,l){var i=Ext.util.JSON.decode(k.responseText);if(!!i){for(var j=0;j<e.length;j++){a.remove(e[j])}}};var d=[];for(var c=0;c<e.length;c++){d.push(e[c].data.id)}var g=d.join(";");if(g==""){return}var b={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"move",action:"move",id:f.spam,listid:g};iNet.Ajax.request({url:"jsonajax",success:h,failure:h,method:"POST",scope:this,params:b,maskEl:this.grid.bwrap})}},spam2Email:function(){var e=this.grid.getSelectionModel().getSelections();if(!!e){var f=this.config.folder;if(f===undefined){return}MailService.removeSpam(e);var a=this.grid.store;var h=function(k,l){var i=Ext.util.JSON.decode(k.responseText);if(!!i){for(var j=0;j<e.length;j++){a.remove(e[j])}}};var d=[];for(var c=0;c<e.length;c++){d.push(e[c].data.id)}var g=d.join(";");if(g==""){return}var b={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"move",action:"move",id:f.inbox,listid:g};iNet.Ajax.request({url:"jsonajax",success:h,failure:h,method:"POST",scope:this,params:b,maskEl:this.grid.bwrap})}},composeWithAddress:function(a){var c=Ext.getCmp("main-tabs");var b=Ext.getCmp("mail-compose");if(!b){b=new iNet.iwebos.ui.mail.MailCompose();c.add(b).show();b.loadInfo(0,"")}else{var d=b.__owner||{};if(d.close){b.clearData();b.loadInfo(0,"")}}c.setActiveTab(b);b.setToAddress(a)},_fnCreateMenu:function(){if(!this.menu){this.menu=new Ext.menu.Menu({id:"grid-ctx",items:[{id:"grid-ctx-mnu-reply-id",text:iwebos.message.mail.context_reply,iconCls:"icon-email-reply",scope:this,disabled:true,handler:this.replyEmail},{id:"grid-ctx-mnu-replyall-id",text:iwebos.message.mail.context_replyall,iconCls:"icon-email-reply_all",scope:this,disabled:true,handler:this.replyAllEmail},{id:"grid-ctx-mnu-forward-id",text:iwebos.message.mail.context_forward,iconCls:"icon-email-forward",scope:this,disabled:true,handler:this.forwardEmail},"-",{id:"grid-ctx-mnu-delete-id",text:iwebos.message.mail.context_delete,iconCls:"icon-email-delete_mail",scope:this,disabled:true,handler:this.onDelete},{id:"grid-ctx-mnu-move-id",text:iwebos.message.mail.context_move,iconCls:"icon-email-folder",scope:this,disabled:true,handler:this._onMove2Folder},"-",{id:"grid-ctx-mnu-mark-unread-id",text:iwebos.message.mail.context_mark_unread,iconCls:"icon-email-unread_mail",scope:this,disabled:true,handler:this._markEmailUnRead},{id:"grid-ctx-mnu-mark-read-id",text:iwebos.message.mail.context_mark_read,iconCls:"icon-email-read_mail",scope:this,disabled:true,handler:this._markEmailRead},"-",{id:"grid-ctx-mnu-mark-priority-id",text:iwebos.message.mail.context_mark_priority,iconCls:"icon-email-urgent",scope:this,disabled:true,handler:this._markEmailPriority},{id:"grid-ctx-mnu-mark-unpriority-id",text:iwebos.message.mail.context_mark_unpriority,iconCls:"icon-email-",scope:this,disabled:true,handler:this._markEmailNormal},"-",{id:"grid-ctx-mnu-flag-id",text:iwebos.message.mail.context_flag,disabled:true,menu:{items:[{text:iwebos.message.mail.context_flag_normal,scope:this,handler:this._markFlagNothing},{text:iwebos.message.mail.context_flag_work,iconCls:"icon-email-work",scope:this,handler:this._markFlagWork},{text:iwebos.message.mail.context_flag_personal,iconCls:"icon-email-personal",scope:this,handler:this._markFlagPersonal},{text:iwebos.message.mail.context_flag_todo,iconCls:"icon-email-todo",scope:this,handler:this._markFlagTodo},{text:iwebos.message.mail.context_flag_late,iconCls:"icon-email-late",scope:this,handler:this._markFlagLate},{text:iwebos.message.mail.context_flag_phone,iconCls:"icon-email-phone",scope:this,handler:this._markFlagCall},{text:iwebos.message.mail.context_flag_reply,iconCls:"icon-email-reply",scope:this,handler:this._markFlagReply},{text:iwebos.message.mail.context_flag_approve,iconCls:"icon-email-approve_mail",scope:this,handler:this._markFlagReview}]}},{id:"grid-ctx-mnu-followup-id",iconCls:"icon-followup-flags",text:iwebos.message.followup.flags,menu:{items:[{text:iwebos.message.followup.today,iconCls:"icon-followup-today",scope:this,handler:this._fnOnToday},{text:iwebos.message.followup.tomorrow,iconCls:"icon-followup-tomorrow",scope:this,handler:this._fnOnTomorrow},{text:iwebos.message.followup.week,iconCls:"icon-followup-week",scope:this,handler:this._fnOnWeek},{text:iwebos.message.followup.nextweek,iconCls:"icon-followup-nextweek",scope:this,handler:this._fnOnNextWeek},{text:iwebos.message.followup.others,iconCls:"icon-followup-others",scope:this,handler:this._fnOnOthers}]}},"-",{id:"grid-ctx-mnu-filter-id",text:iwebos.message.mail.filter_create,iconCls:"icon-email-filter",scope:this,handler:this._callDialogFilter}]})}return this.menu},_fnHandleMenu:function(a,b){var g=b||{};if(!g.data){a.items.get("grid-ctx-mnu-reply-id").setDisabled(true);a.items.get("grid-ctx-mnu-replyall-id").setDisabled(true);a.items.get("grid-ctx-mnu-forward-id").setDisabled(true);a.items.get("grid-ctx-mnu-delete-id").setDisabled(true);a.items.get("grid-ctx-mnu-move-id").setDisabled(true);a.items.get("grid-ctx-mnu-mark-unread-id").setDisabled(true);a.items.get("grid-ctx-mnu-mark-read-id").setDisabled(true);a.items.get("grid-ctx-mnu-mark-priority-id").setDisabled(true);a.items.get("grid-ctx-mnu-mark-unpriority-id").setDisabled(true);a.items.get("grid-ctx-mnu-flag-id").setDisabled(true);a.items.get("grid-ctx-mnu-followup-id").setDisabled(true)}else{var e=!(g.data.id>0);var d=g.data.type;var i=(d=="DRAFT");var c=(d=="INBOX"||d=="CUSTOM");var h=this._isTrashFolder();var f=(d!=="DRAFT"&&d!=="SENT"&&!h);a.items.get("grid-ctx-mnu-reply-id").setDisabled(i);a.items.get("grid-ctx-mnu-replyall-id").setDisabled(i);a.items.get("grid-ctx-mnu-forward-id").setDisabled(i);a.items.get("grid-ctx-mnu-delete-id").setDisabled(e);a.items.get("grid-ctx-mnu-move-id").setDisabled(false);a.items.get("grid-ctx-mnu-mark-unread-id").setDisabled(e);a.items.get("grid-ctx-mnu-mark-read-id").setDisabled(e);a.items.get("grid-ctx-mnu-mark-priority-id").setDisabled(e);a.items.get("grid-ctx-mnu-mark-unpriority-id").setDisabled(e);a.items.get("grid-ctx-mnu-flag-id").setDisabled(e);a.items.get("grid-ctx-mnu-followup-id").setDisabled(!f)}},_onGridContext:function(b){b.stopEvent();var a=this._fnCreateMenu();this._fnHandleMenu(a);a.showAt(b.getXY())},_onGridRowContextMenu:function(c,b,d){d.stopEvent();WebOSGridService.handleSelection(c,b);var a=this._fnCreateMenu();this._fnHandleMenu(a,c.store.getAt(b));a.showAt(d.getXY())},_callDialogFilter:function(){var a=new iNet.iwebos.ui.mail.DialogMailFilter();a.show()},_onDoubleClick:function(a,g,i){i.stopEvent();var c=Ext.getCmp("main-tabs");var f=a.store;var d=f.getAt(g).data;var h=d.type;if(this.__owner.data==null){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.view_mail_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}if(h=="DRAFT"||h=="SENT"){var b=this._fnNewTab("composer");if(!b){b=new iNet.iwebos.ui.mail.MailCompose();c.add(b).show()}c.setActiveTab(b);b.loadInfo(d.id,"draft")}else{var j=function(){var k=Ext.getCmp("mail-reader");if(!k){k=new iNet.iwebos.ui.mail.MailReader();c.add(k).show()}c.setActiveTab(k);var e=c.__owner.data||{};k.loadInfo(e)};setTimeout(j,1500)}},doAction:function(a,b){if(this.actions!==undefined&&this.actions[b.id]!==undefined&&typeof this.actions[b.id]=="function"){this.actions[b.id]()}},onDelete:function(){var c=this.owner;var a=this;var b=function(e){if(e==="ok"||e==="yes"){var f=a.grid;var d=f.getSelectionModel().getSelections();a.fnDeleteMail(d,null)}};if(this._isTrashFolder()){Ext.MessageBox.confirm(iwebos.message.mail.announcement,iwebos.message.mail.confirm_delete_email,b,this)}else{b("ok")}},fnDeleteMail:function(mails,panel){var __handlerFn=function(response,options){var __result=eval("("+response.responseText+")");if(__result==undefined){MailService.showError(iwebos.message.mail.error_delete_mail);return}if(__result.success){var __removeItems=options.removeItems;var __unread=0;var __store=this.grid.store;for(var __index=0;__index<__removeItems.length;__index++){var __record=__removeItems[__index];if(!__record){continue}if(__record.data.read==="N"){__unread++}var __cmpFollowUp=Ext.getCmp("mail-follow-up-ctx-id");if(!!__cmpFollowUp){var __followUp=__cmpFollowUp._findByData(__record.data.id);if(__followUp!=null){__cmpFollowUp.store.remove(__followUp)}}__store.remove(__record)}if(__unread>0){var __treeFolder=Ext.getCmp("mail-tree-folder-id");__treeFolder.readMail(__unread);if(!this._isTrashFolder()){var __folderTrash=this.config.folder.trash;__treeFolder.addMessageUnread2Folder(__unread,__folderTrash)}}if(panel!=null){this.remove(panel)}}else{MailService.showError(iwebos.message.mail.error_delete_mail)}};var __ids=[];if(mails!==undefined){for(var __index=0;__index<mails.length;__index++){__ids.push(mails[__index].data.id)}}var __baseParams={iwm:"MAIL",iwct:"mailHeaderContent",iwc:"READ_WRITE",iwa:"delete",action:"delete"};var __selectedIds=__ids.join(";");if(__selectedIds!==""){__baseParams.listid=__selectedIds;iNet.Ajax.request({url:"jsonajax",success:__handlerFn,failure:__handlerFn,method:"POST",scope:this,params:__baseParams,removeItems:mails,maskEl:this.grid.bwrap})}},_markFlag:function(flag){var __grid=this.grid;var handlerFn=function(response,options){var result=eval("("+response.responseText+")");if(result.success){var __updateItems=options.updateItems;var __indexRecord=0;var __followpCmp=Ext.getCmp("mail-follow-up-ctx-id");for(var index=0;index<__updateItems.length;index++){var __mail=__updateItems[index];__mail.data.flag=flag;__mail.commit();__followpCmp.updateFlag(__mail.data.id,__mail.data.flag)}}else{Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.error_task,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var __baseParams={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"flag",action:"flag"};var __selects=__grid.getSelectionModel().getSelections();var __ids=[];if(__selects!==undefined){for(var index=0;index<__selects.length;index++){__ids.push(__selects[index].data.id)}}__baseParams.flag=flag;var __selectedIds=__ids.join(";");if(__selectedIds!==""){__baseParams.listid=__selectedIds;iNet.Ajax.request({url:"jsonajax",success:handlerFn,failure:handlerFn,method:"POST",params:__baseParams,updateItems:__selects,maskEl:__grid.bwrap})}},_markFlagWork:function(){this._markFlag("WORK")},_markFlagPersonal:function(){this._markFlag("PERSONAL")},_markFlagTodo:function(){this._markFlag("TODO")},_markFlagLate:function(){this._markFlag("LATE")},_markFlagReply:function(){this._markFlag("REPLY")},_markFlagCall:function(){this._markFlag("CALL")},_markFlagReview:function(){this._markFlag("REVIEW")},_markFlagNothing:function(){this._markFlag("NOTHING")},_markRead:function(read){var __grid=this.grid;var _handlerFn=function(response,options){var __result=eval("("+response.responseText+")");if(__result.success){var __updateItems=options.updateItems;var __indexRecord=0;for(var index=0;index<__updateItems.length;index++){var __mail=__updateItems[index];var __oldStatus=__mail.data.read;__mail.data.read=read;__mail.commit();if(read=="Y"&&__oldStatus=="N"){Ext.getCmp("mail-tree-folder-id").readMail(1)}else{if(read=="N"&&__oldStatus=="Y"){Ext.getCmp("mail-tree-folder-id").addMessageUnread(1)}}}}else{Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.error_task,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var __baseParams={iwct:"loadMailHeaderContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"read",action:"read",read:read};var __selects=__grid.getSelectionModel().getSelections();var __ids=[];if(__selects!==undefined){for(var index=0;index<__selects.length;index++){__ids.push(__selects[index].data.id)}}var __selectedIds=__ids.join(";");if(__selectedIds!==""){__baseParams.listid=__selectedIds;iNet.Ajax.request({url:"jsonajax",success:_handlerFn,failure:_handlerFn,method:"POST",params:__baseParams,updateItems:__selects,scope:this,maskEl:__grid.bwrap})}},_markEmailRead:function(){this._markRead("Y")},_markEmailUnRead:function(){this._markRead("N")},_markPriority:function(important){var __grid=this.grid;var _handlerFn=function(response,options){var __result=eval("("+response.responseText+")");if(__result.success){var updateItems=options.updateItems;var __indexRecord=0;for(var __index=0;__index<updateItems.length;__index++){var __mail=updateItems[__index];__mail.data.priority=important;__mail.commit()}}else{MailService.showError(iwebos.message.mail.error_task)}};var __baseParams={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"priority",action:"priority",priority:important};var __selects=__grid.getSelectionModel().getSelections();var __ids=[];if(__selects!==undefined){for(var __index=0;__index<__selects.length;__index++){__ids.push(__selects[__index].data.id)}}var __selectedIds=__ids.join(";");if(__selectedIds!==""){__baseParams.listid=__selectedIds;iNet.Ajax.request({url:"jsonajax",success:_handlerFn,failure:_handlerFn,method:"POST",params:__baseParams,updateItems:__selects,maskEl:__grid.bwrap})}},_markEmailPriority:function(){this._markPriority("HIGH")},_markEmailNormal:function(){this._markPriority("NORMAL")},openAddressBook:function(){var b=Ext.getCmp("main-tabs");var a=Ext.getCmp("main-addressbook-panel");if(!a){a=new iNet.iwebos.ui.mail.AddressBookPanel();b.add(a).show()}b.setActiveTab(a)},_updatePassword:function(index){var __panel=this;var __fetchInfo=__panel.fetchInfo;var __okHandler=function(){var __password=this.getPassword();if(__password==""){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.error_empty_password,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var __param={iwct:"mailConfigureContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"updatePW",action:"updatePW"};var __data={address:__fetchInfo.accounts[index].address,pass:__password};__param.object=Ext.util.JSON.encode(__data);iNet.Ajax.request({url:"jsonajax",params:__param,scope:__panel,method:"POST",success:function(response,options){if(!!response){var __result=eval("("+response.responseText+")");if(__result.success){__panel.fetchInfo.accounts[index].pass=true;__panel.config.smtpAccount.smtps[index].pass=true;__panel._fetchNewMessage(index);var __configPanel=Ext.getCmp("mail-config-account");if(__configPanel){__configPanel.updatePassword2Account(__panel.config.smtpAccount.smtps[index].smtpAccount,__password)}return}}this._fetchNewMessage(++index)},failure:function(response,options){__panel._fetchNewMessage(++index)}});this.destroy()};var __dlg=new iNet.iwebos.ui.mail.DialogEnterPassword(this,{address:__fetchInfo.accounts[index].address,okhScope:__dlg,okHandler:__okHandler,cancelHandler:function(){this.destroy();__panel._fetchNewMessage(++index)}});__dlg.show(this)},_fnHandleFunction:function(c){var f=c.getSelections();var i="iwebos-mail-toolbar-";var a="";if(f.length>0){a=f[0].data.type}var d=Ext.getCmp(i+"mail-toolbar-btn-delete");var j=Ext.getCmp(i+"mail-toolbar-reply");var h=Ext.getCmp(i+"mail-toolbar-reply-all");var e=Ext.getCmp(i+"mail-toolbar-forward");var g=Ext.getCmp(i+"mail-toolbar-spam");var b=false;b=(a=="DRAFT");if(f.length>0){d.setDisabled(false);j.setDisabled(b);h.setDisabled(b);e.setDisabled(b);g.setDisabled(false)}else{d.setDisabled(true);j.setDisabled(true);h.setDisabled(true);e.setDisabled(true);g.setDisabled(true)}},_onStoreLoad:function(b,a,c){var d=Ext.getCmp("preview-mail-panel");if(b.getCount()<=0){d.setVisible(false);Ext.EventManager.fireWindowResize()}else{if(!d.isVisible()){d.setVisible(true);Ext.EventManager.fireWindowResize()}}},_onStoreRemove:function(b,a,c){var d=Ext.getCmp("preview-mail-panel");if(this.lastIndex===a.data.id){this.fnVisiblePreviewPanel(false)}if(b.getCount()<=0){this.fnVisiblePreviewPanel(false)}},_fnOnStoreInsert:function(b,a,c){this.fnVisiblePreviewPanel(true)},_onMove2Folder:function(){var __panel=this;var __grid=__panel.grid;var __selects=__grid.getSelectionModel().getSelections();if(__selects==undefined){return}var __ids=[];for(var __index=0;__index<__selects.length;__index++){__ids.push(__selects[__index].data.id)}var __selectedIds=__ids.join(";");if(__selectedIds==""){return}var __okHandler=function(){var __folder=this.getData();if(__folder==undefined){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.filter_error_input_folder,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var __current=Ext.getCmp("mail-tree-folder-id").getFolder();var __inbox=__panel.config.folder.inbox;if(__current==__folder.id){this.destroy();return}var __baseParams={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"move",action:"move",id:__folder.id,listid:__selectedIds};iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:__panel,method:"POST",success:function(response,options){if(!response){return}var __result=eval("("+response.responseText+")");if(__result.success){var __store=this.grid.store;var __folders=this.config.folder;var __isTrash=(__folders.trash==__folder.id);var __cmpFollowUp=Ext.getCmp("mail-follow-up-ctx-id");var __ids=[];var __itemsRemove=options.itemsRemove;for(var i=0;i<__itemsRemove.length;i++){__store.remove(__itemsRemove[i]);if(__isTrash){var __followUp=__cmpFollowUp._findByData(__itemsRemove[i].data.id);if(__followUp!=null){__ids[__ids.length]=__followUp.data.id}}}if(__ids.length>0){__cmpFollowUp._fnDelete(__ids)}}},itemsRemove:__selects,failure:function(response,options){}});this.destroy()};var __dlg=new iNet.iwebos.ui.mail.DialogMailFolder(this,{okHandler:__okHandler,okhScope:__dlg,ttitle:iwebos.message.mail.select_folder_to_move});__dlg.show(this)},_onCreateFilter:function(){var a=this;var e=a.grid;var b=e.getSelectionModel().getSelections();if(b==undefined){return}var c=function(){var f=this.validate();if(f.length>0){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:f,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var g=function(k,l){if(!!k){var j=Ext.util.JSON.decode(k.responseText);var m=j.success==undefined?true:false;if(m){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:"Bộ lọc thư đã được tạo thành công.",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO});return}}Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.filter_error_save,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})};var h=this.getData();var i={iwct:"mailFilterContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"save",action:"save"};i.object=Ext.util.JSON.encode(h);iNet.Ajax.request({url:"jsonajax",params:i,scope:this,method:"POST",success:g,failure:g});this.destroy()};var d=new iNet.iwebos.ui.mail.DialogMailAddFilter(this,{okHandler:c,okhScope:d,data:{data:b.data.sender}});d.show(this)},_isTrashFolder:function(){var c=this.config.folder;var b=Ext.getCmp("mail-tree-folder-id").getFolder();var a=c.trash||-1;return(b==a)},isSpamFolder:function(){var b=this.config.folder;var a=Ext.getCmp("mail-tree-folder-id").getFolder();var c=b.spam||-1;return(a==c)},_fnAddFlag:function(d){var b=this._fnGetSelectedRecord();if(b==null){return}var a=[];for(var c=0;c<b.length;c++){a[c]={data:b[c].data.id,name:b[c].data.subject}}var e=d||iNet.iwebos.ui.common.control.FollowUpPanel.TODAY;var f=Ext.getCmp("mail-follow-up-ctx-id");if(!f){return}f.save(a,e)},_fnGetSelectedRecord:function(){var a=this.grid.getSelectionModel();if(a.getCount()<0){return null}return a.getSelections()},_fnOnToday:function(){this._fnAddFlag(iNet.iwebos.ui.common.control.FollowUpPanel.TODAY)},_fnOnTomorrow:function(){this._fnAddFlag(iNet.iwebos.ui.common.control.FollowUpPanel.TOMORROW)},_fnOnWeek:function(){this._fnAddFlag(iNet.iwebos.ui.common.control.FollowUpPanel.WEEK)},_fnOnNextWeek:function(){this._fnAddFlag(iNet.iwebos.ui.common.control.FollowUpPanel.NEXT_WEEK)},_fnOnOthers:function(){this._fnAddFlag(iNet.iwebos.ui.common.control.FollowUpPanel.OTHERS)},onViewFollowUp:function(c){var a=c||{};if(!a.data){return}var b={iwct:"mailContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"select",action:"select"};b.hid=a.data;iNet.Ajax.request({url:"jsonajax",params:b,scope:this,method:"POST",success:function(e,h){var d=Ext.util.JSON.decode(e.responseText);var i=(d.success==undefined?true:false);if(i){var f=Ext.getCmp("mail-reader");var g=Ext.getCmp("main-tabs");if(!f){f=new iNet.iwebos.ui.mail.MailReader();g.add(f).show()}g.setActiveTab(f);var d=g.__owner.data||{};f.loadInfo(d)}else{this.__owner.data=null;__sPanel.setVisible(false);Ext.EventManager.fireWindowResize();Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.view_mail_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},failure:function(d,e){},maskEl:this.grid.bwrap})},fnVisiblePreviewPanel:function(b){var a=Ext.getCmp("preview-mail-panel");if(b&&!a.isVisible()){a.setVisible(true);Ext.EventManager.fireWindowResize()}else{if(!b&&a.isVisible()){a.setVisible(false);Ext.EventManager.fireWindowResize()}}},findByData:function(d){var a=this.grid.store;if(a.getCount()==0){return null}var b=null;for(var c=0;c<a.getCount();c++){b=a.getAt(c);if(b.data.id===d){return b}}return b},getDomainDefault:function(){var a=this.config.smtpAccount||{};var c=a.smtp;if(c===""||c===undefined){return null}var b=c.indexOf(":");if(b==-1){return null}var e=c.substring(b+1);if(e===""||e===null||e===undefined){return null}var b=e.indexOf("@");if(b==-1){return null}var d=e.substring(b+1);if(d===""||d===null||d===undefined){return null}return d},getRecipients:function(){return this.recipients},setRecipients:function(a){this.recipients=a},searchAdvance:function(f){this.adSearch.searchAdvance(f);var d=Ext.getCmp("main-tabs");var c=Ext.getCmp("main-mailbox");d.setActiveTab(0);c.setTitle(iwebos.message.mail.search);var e=Ext.getCmp("mail-tree-folder-id");var b=e.getSelectionModel();var a=b.getSelectedNode();if(!!a){a.unselect()}this.changeColumn(true)},changeColumn:function(a){var b=this.grid.getColumnModel();if(a){if(b.isHidden(5)){b.setHidden(5,false);b.setHidden(6,true)}}else{if(b.isHidden(6)){b.setHidden(6,false);b.setHidden(5,true)}}},changeSpamButton:function(a){var b="iwebos-mail-toolbar-";var c=Ext.getCmp(b+"mail-toolbar-spam");if(a){c.setText(iwebos.message.mail.mail_spam);c.setIconClass("icon-email-spam-button");c.setHandler(this.spamEmail.createDelegate(this))}else{c.setText(iwebos.message.mail.mail_not_spam);c.setIconClass("icon-email-not-spam-button");c.setHandler(this.spam2Email.createDelegate(this))}},addContact:function(b){if(b==undefined||b==""){MailService.showError("Tài khoản email không hợp l")}var c=b.indexOf("<");var a="";if(c>0){a=b.substring(0,c);b=b.substring(c+1,b.length-1)}var d=function(){var f=this.getData();if(f.mail===""||f.name===""||f.dname===""){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.contact.error_valid_data,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var h="insert";var g=function(k,l){var j=Ext.util.JSON.decode(k.responseText);var m=(j.success===undefined?true:j.success);if(!m){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.contact.add_error,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}return};var i={iwct:"addressBookContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"insert",action:"insert"};i.object=Ext.util.JSON.encode(f);iNet.Ajax.request({url:"jsonajax",params:i,scope:this,method:"POST",success:g,failure:function(j,k){},maskEl:this.bwrap});Ext.form.Field.prototype.msgTarget="side";this.destroy()};var e=new iNet.iwebos.ui.mail.ContactDialog({title:iwebos.message.mail.contact.dialog_title,ttitle:iwebos.message.mail.contact.dialog_desc,btitle:"",iconCls:"icon-contact-users",okHandler:d,width:500,height:470,resizable:true,modal:true,hscope:e});e.show(this);e.setEmail({fullname:a,email:b})}}); 
Ext.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};Ext.grid.CheckColumn.prototype={init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(d,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){d.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);a.set(this.dataIndex,!a.data[this.dataIndex])}},renderer:function(b,c,a){c.css+=" x-grid3-check-col-td";return'<div class="x-grid3-check-col'+(b?"-on":"")+" x-grid3-cc-"+this.id+'">&#160;</div>'}};iNet.iwebos.ui.mail.ConfigAccount=function(i,c){this.prefix=(!this.prefix)?"imail-config-account-commnon":this.prefix;this.fullName=this.prefix+"fullname";this.address=this.prefix+"address";this.signDefault=this.prefix+"sign";this.signature=this.prefix+"signature";this.smtp=this.prefix+"smtp";this.autoCheck=this.prefix+"autocheck";this.autoMinutes=this.prefix+"minutes";this.__owner={check:"",idRemove:[]};var q={field:"user",direction:"DESC"};var f={field:"user",direction:"DESC"};var h=Ext.data.Record.create([{name:"id",mapping:"user",type:"string"},{name:"active",mapping:"active",type:"bool"},{name:"address",mapping:"address",type:"string"},{name:"desc",mapping:"desc",type:"string"},{name:"server",mapping:"server",type:"string"},{name:"protocol",mapping:"protocol",type:"string"},{name:"security",mapping:"security",type:"string"},{name:"user",mapping:"user",type:"string"},{name:"pass",mapping:"pass",type:"string"},{name:"smtpserver",mapping:"smtpserver",type:"string"},{name:"smtpsecurity",mapping:"smtpsecurity",type:"string"},{name:"smtpuser",mapping:"smtpuser",type:"string"},{name:"smtppass",mapping:"smtppass",type:"string"}]);var p=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},h);var g=new Ext.grid.CheckColumn({header:iwebos.message.mail.active,dataIndex:"active",width:70,fixed:true,resizable:true});var n=new Ext.grid.ColumnModel([g,{header:iwebos.message.mail.description,dataIndex:"desc",fixed:true,width:200},{header:iwebos.message.mail.account_name,dataIndex:"user",fixed:true,width:200},{header:iwebos.message.mail.server,dataIndex:"server",fixed:false,width:200}]);this.grid=new iNet.iwebos.ui.common.grid.WebOSEditorGrid({id:"grid-config-account",region:"center",anchor:"100%",minSize:250,autoScroll:true,method:"POST",loadFirst:false,sortInfo:q,reader:p,dsort:f,plugins:g,clicksToEdit:1,selModel:new Ext.grid.RowSelectionModel({singleSelect:true}),cm:n,filter:{data:"all"},view:new Ext.grid.GridView({forceFit:true}),tbar:[{xtype:"button",text:iwebos.message.mail.add_configuration,iconCls:"icon-mail-add",handler:this._addAccount.createDelegate(this)}]});this.grid.store.on("update",this._onUpdateStore,this);var m=Ext.data.Record.create([{name:"sid",mapping:"sid",type:"int"},{name:"sname",mapping:"name",type:"string"},{name:"scontent",mapping:"content",type:"string"},{name:"used",mapping:"used",type:"string"}]);var o=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"sname"},m);var k=new iNet.iwebos.ui.common.store.WebOSSimpleStore({reader:o});var b=Ext.data.Record.create([{name:"id",mapping:"id",type:"string"},{name:"smtpAccount",mapping:"smtpAccount",type:"string"}]);var e=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},m);var a=new iNet.iwebos.ui.common.store.WebOSSimpleStore({reader:o});var d=new Ext.form.FormPanel({columnWidth:1,anchor:"100%",frame:false,border:false,autoHeight:true,labelAlign:"right",bodyStyle:"padding: 5px;",items:[{border:false,html:"<b>"+iwebos.message.mail.info_common+"</b><br/><br/>"},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",border:false,items:[{id:this.fullName,xtype:"textfield",anchor:"95%",allowBlank:false,fieldLabel:iwebos.message.mail.fullname},{id:this.smtp,triggerAction:"all",mode:"local",fieldLabel:iwebos.message.mail.smtp_default,xtype:"combo",displayField:"id",valueField:"smtpAccount",store:a,readOnly:true,selectOnFocus:true,forceSelection:true,typeAhead:true,border:false,anchor:"95%"}]},{columnWidth:0.5,layout:"form",anchor:"100%",labelWidth:90,border:false,items:[{layout:"column",columnWidth:1,anchor:"95%",border:false,items:[{layout:"form",border:false,columnWidth:0.8,labelWidth:90,anchor:"95%",items:[{id:this.signature,triggerAction:"all",mode:"local",fieldLabel:iwebos.message.mail.signature,xtype:"combo",displayField:"sname",valueField:"sname",store:k,selectOnFocus:true,forceSelection:true,readOnly:true,border:false,anchor:"100%"}]},{layout:"form",border:false,columnWidth:0.1,anchor:"100%",items:[{xtype:"button",iconCls:"icon-mail-signature-edit",border:false,handler:this._openSignatureDialog.createDelegate(this)}]},{layout:"form",border:false,columnWidth:0.1,anchor:"100%",items:[{xtype:"button",iconCls:"icon-mail-signature-del",border:false,handler:this._deleteSignature.createDelegate(this)}]}]},{anchor:"100%",layout:"column",columnWidth:1,border:false,items:[{columnWidth:0.7,anchor:"98%",border:false,items:[{layout:"form",anchor:"100%",border:false,bodyStyle:"padding-left: 95px;",items:[{id:this.autoCheck,xtype:"checkbox",border:false,anchor:"100%",hideLabel:true,boxLabel:iwebos.message.mail.auto_check}]}]},{columnWidth:0.1,anchor:"100%",border:false,items:[{layout:"form",anchor:"80%",border:false,items:[{id:this.autoMinutes,xtype:"numberfield",border:false,anchor:"95%",hideLabel:true}]}]},{columnWidth:0.2,layout:"form",border:false,anchor:"100%",bodyStyle:"padding-left: 5px;",items:[{border:false,html:iwebos.message.mail.minute}]}]}]}]}],tbar:[{xtype:"button",iconCls:"icon-save",text:iwebos.message.mail.save,scope:this,handler:this.onSave},{xtype:"button",text:iwebos.message.mail.get_config,scope:this,iconCls:"icon-panel-config-account",handler:this._getConfig}]});var j=new Ext.Panel({region:"north",collapsible:false,border:false,width:"100%",height:145,layout:"column",items:[d]});j.on("resize",this.__resizePanel,this);this.grid.on("rowdblclick",this._onDoubleClick,this);this.grid.on("rowcontextmenu",this._onRowContextMenu,this);this.grid.on("contextmenu",this._onContextmenu,this);Ext.getCmp(this.autoCheck).on("check",this._onAutoCheckChange,this);var l=Ext.getCmp(this.signature);l.on("select",this.onSelectGroup,this);iNet.iwebos.ui.mail.ConfigAccount.superclass.constructor.call(this,{id:"mail-config-account",iconCls:"icon-panel-config-account",title:iwebos.message.mail.configure_account,header:false,frame:false,border:false,closable:true,layout:"border",renderTo:Ext.getBody(),items:[j,this.grid]})};Ext.extend(iNet.iwebos.ui.mail.ConfigAccount,Ext.Panel,{onSelectGroup:function(e,b,d){var a=e.store;var c=a.indexOf(b);this.__owner.check=b.data.sname},loadInfo:function(){var a={iwct:"loadMailConfigureContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"load",action:"load",mode:"detail"};var b=function(d,e){if(!!d){var c=Ext.util.JSON.decode(d.responseText);var f=(c.success===undefined?true:false);if(f){this._setData(c);this.__owner.firstTime=false;return}else{this.__owner.firstTime=true}}else{Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.error_load_configure,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};iNet.Ajax.request({url:"jsonajax",params:a,scope:this,method:"POST",success:b,failure:function(c,d){},maskEl:this.bwrap})},_validateData:function(){return""},_setData:function(c){var n=c.common||{};__comp=Ext.getCmp(this.fullName);__comp.setValue(n.name);__comp=Ext.getCmp(this.autoCheck);__comp.setValue(n.refresh>0);__comp=Ext.getCmp(this.autoMinutes);__comp.setValue(n.refresh);__comp=Ext.getCmp(this.smtp);var b=c.accounts;var m=[];var f=this.grid.store;f.removeAll();var a=__comp.store;a.removeAll();if(b.length>0){for(var h=0;h<b.length;h++){var l=b[h];f.addData(l);if(l.active){a.add(new Ext.data.Record({id:l.smtpuser,smtpAccount:l.smtpserver+":"+l.smtpuser}));m[m.length]={smtpAccount:l.smtpserver+":"+l.smtpuser,address:l.smtpuser,pass:(l.pass.length>0)&&(l.smtppass.length>0)}}}a.suspendEvents();a.clearFilter();a.resumeEvents()}__comp.setValue(n.smtp);__comp=Ext.getCmp(this.signature);var d=c.signs;var g=__comp.store;var k;g.removeAll();if(d.length>0){for(var e=0;e<d.length;e++){k=d[e];if(this.emptyText&&this.el&&v!==undefined&&v!==null&&v!==""){this.el.removeClass(this.emptyClass)}if(Ext.isIE&&this.firstValue==""){this.firstValue=value;return}this.setRawValue(value);this.autoSize();g.add(new Ext.data.Record({sid:k.id,sname:k.name,scontent:k.content,used:k.used}));if(k.used=="Y"){__comp.setValue(k.name)}}g.suspendEvents();g.clearFilter();g.resumeEvents()}var j={};j.smtp=n.smtp;j.refresh=n.refresh;j.smtpAccount={};j.smtpAccount.smtps=m;j.smtpAccount.smtp=n.smtp;j.signs=d;this._updatePersonalConfig(j)},_getData:function(){var k={};var n={};var f=Ext.getCmp(this.fullName);n.name=f.getValue();f=Ext.getCmp(this.smtp);n.smtp=f.getValue();f=Ext.getCmp(this.autoCheck);var h=Ext.getCmp(this.autoMinutes);n.refresh=(f.getValue()?h.getValue():0);var b=[];var g=this.grid.store;if(g.getCount()>0){for(var j=0;j<g.getCount();j++){b[j]=g.getAt(j).data}if(n.smtp===null||n.smtp===""){var c=g.getAt(0).data;n.smtp=c.smtpserver+":"+c.smtpuser}}k.common=n;k.accounts=b;var a=Ext.getCmp(this.signature).store;var d=[];var m="N";if(a.getCount()>0){for(var e=0;e<a.getCount();e++){var l=a.getAt(e).data;if(l.sname==this.__owner.check){m="Y"}else{m="N"}d[e]={id:l.sid,name:l.sname,content:l.scontent,used:m}}}k.signs=d;k.signRemove=this.__owner.idRemove;return k},onSave:function(){var b=this._validateData();if(b!==""){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:b,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var c=function(g,h){if(!!g){var e=Ext.util.JSON.decode(g.responseText);var i=(e.success===undefined);if(i){if(this.__owner.firstTime){var f=Ext.getCmp("mail-tree-folder-id");f.reloadMailBox();Ext.getCmp("main-tabs")._checkMailAuto()}this._setData(e);this.__owner.firstTime=false}}};var a=this._getData();var d={iwct:"mailConfigureContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"save",action:"save"};d.object=Ext.util.JSON.encode(a);iNet.Ajax.request({url:"jsonajax",params:d,scope:this,method:"POST",success:c,failure:c,maskEl:this.bwrap})},_addAccount:function(){var a=this;var b=this.grid.store;var c=function(){var f=this.validate();if(null!=f){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:f,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var e=this.getData();e.id=e.user;e.active=true;b.addData(e);a.addSmtpDefault({id:e.smtpuser,smtpAccount:e.smtpserver+":"+e.smtpuser});this.destroy()};var d=new iNet.iwebos.ui.mail.DialogConfigAccount(this,{okHandler:c,okhScope:d});d.show(this)},_deleteAccount:function(){var g=this.grid.getSelectionModel().getSelections();if(g.length===0){return}var f=this.grid.store;var i=g[0];var c=i.data.user;f.remove(i);var j=Ext.getCmp(this.smtp);var a=j.store;if(a.getCount()>0){for(var b=0;b<a.getCount();b++){var h=a.getAt(b);var d=j.getValue();if(h.data.id==c){a.remove(h);if(d==h.data.smtpAccount){if(a.getCount()>0){var e=a.getAt(0);j.setValue(e.data.smtpAccount)}else{j.setValue("")}}return}}}},__resizePanel:function(){Ext.EventManager.fireWindowResize()},_onDoubleClick:function(c,g,e){e.stopEvent();var a=c.store;var b=a.getAt(g);var d=function(){var j=this.validate();if(null!=j){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:j,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var i=b.data;var h=this.getData();h.id=h.user;h.active=b.data.active;b.data=h;Ext.getCmp("mail-config-account").updateSmtpDefault(i,b.data);b.commit();this.destroy()};var f=new iNet.iwebos.ui.mail.DialogConfigAccount(this,{okHandler:d,okhScope:f});f.show(this);f.loadData(b.data)},_onRowContextMenu:function(b,d,c){c.stopEvent();WebOSGridService.handleSelection(b,d);var a=new Ext.menu.Menu({items:[{text:iwebos.message.mail.delete_account,canActivate:true,scope:this,iconCls:"icon-email-account-delete",handler:this._deleteAccount}]});a.showAt(c.getXY())},_onContextmenu:function(a){a.stopEvent()},_openSignatureDialog:function(){var d=Ext.getCmp(this.signature);var a=d.store;var b;var e;var c=function(){var j=this.validate();if(j!==""){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:j,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}if(e!==undefined){b=a.getAt(e)}var h=this.getData();var g=h.sname.trim();for(var k=0;k<a.getCount();k++){var l=a.getAt(k).data;if(g==l.sname){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.error_signature_duplicate,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}}e=k;if(!!b){var i=a.indexOf(b);a.remove(b);if(a.getCount()===0){h.used="Y";a.insert(i,new Ext.data.Record(h))}}else{a.add(new Ext.data.Record(h))}a.suspendEvents();a.clearFilter();a.resumeEvents();d.setValue(h.sname);this.destroy()};var f=new iNet.iwebos.ui.mail.DialogSignature(this,{okhScope:f,okHandler:c});f.show(this);f.loadData(b)},_onAutoCheckChange:function(a,c){var b=Ext.getCmp(this.autoMinutes);b.setDisabled(!c)},_deleteSignature:function(){var c=Ext.getCmp(this.signature);var d=c.store;var j=c.getValue().trim();var a;var g=[];for(var e=0;e<d.getCount();e++){var f=d.getAt(e).data;g.push(f.sid);this.__owner.idRemove=g.join(";");if(j==f.sname){a=e;break}}if(a!==undefined){var h=d.getAt(a);d.remove(h)}if(d.getCount()>0){for(var b=0;b<d.getCount();b++){f=d.getAt(b).data;c.setValue(f.sname)}}else{c.setValue("")}},_updatePersonalConfig:function(c){var a=Ext.getCmp("main-tabs");a.config.refresh=c.refresh;a.config.smtpAccount=c.smtpAccount;var b=Ext.getCmp("mail-compose");if(b){b.setSmtpAccount(c.smtpAccount.smtps,c.smtp);b.setSignature(c.signs)}if(a.timeout){clearTimeout(a.timeout)}if(c.refresh!==0){a.timeout=setTimeout(a._checkAuto.createDelegate(a),c.refresh*60000)}},_getConfig:function(){var a={iwct:"loadMailConfigureContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"loadDefault",action:"loadDefault",mode:"loadDefault"};var b=function(d,m){if(!!d){var e=Ext.util.JSON.decode(d.responseText);var l=(e.success===undefined?true:false);if(l){if(e.length>0){var h=this.grid.store;for(var c=0;c<e.length;c++){var j=e[c];for(var f=0;f<h.getCount();f++){var k=h.getAt(f);var g=k.data;if(j.address==k.data.address||j.user==k.data.user||j.smtpuser==k.data.smtpuser){if(!j.active){k.data.active=j.active}k.data.address=j.address;k.data.user=j.user;k.data.server=j.server;k.data.protocol=j.protocol;k.data.port=j.port;k.data.security=j.security;k.data.smtpuser=j.smtpuser;k.data.smtpserver=j.smtpserver;k.data.smtpport=j.smtpport;k.data.smtpsecurity=j.smtpsecurity;k.commit();this.updateSmtpDefault(g,k.data);j.exist=true;break}}if(j.exist===undefined){h.addData(j);this.addSmtpDefault({id:j.smtpuser,smtpAccount:j.smtpserver+":"+j.smtpuser})}}}return}}MailService.showError(iwebos.message.mail.error_load_configure_default)};iNet.Ajax.request({url:"jsonajax",params:a,scope:this,method:"POST",success:b,failure:function(c,d){},maskEl:this.bwrap})},updatePassword2Account:function(g,e){var b=this.grid.store;if(b.getCount()>0){var f;var a;var d;for(var c=0;c<b.getCount();c++){d=b.getAt(c);f=d.data;a=f.smtpserver+":"+f.smtpuser;if(g===a){d.data.pass=e;d.data.smtppass=e;d.commit();return}}}},addSmtpDefault:function(d){var c=Ext.getCmp(this.smtp);var b=c.store;var a=new Ext.data.Record(d);if(b.indexOf(a)>=0){return}b.add(a);b.suspendEvents();b.clearFilter();b.resumeEvents();if(b.getCount()==1){c.setValue(d.smtpAccount)}},updateSmtpDefault:function(f,c){var d=Ext.getCmp(this.smtp);var b=d.store;var a=MailService.findById(b,f.smtpuser);if(a==null){return}if(!c.active){b.remove(a);return}a.data.id=c.smtpuser;a.data.smtpAccount=c.smtpserver+":"+c.smtpuser;a.commit();b.suspendEvents();b.clearFilter();b.resumeEvents();var e=d.getValue();if(e===(f.smtpserver+":"+f.smtpuser)){d.setValue(c.smtpserver+":"+c.smtpuser)}},_onUpdateStore:function(i,g,c){if(Ext.data.Record.EDIT===c){var d=g.data;var e=Ext.getCmp(this.smtp);var a=e.store;if(d.active){this.addSmtpDefault({id:d.smtpuser,smtpAccount:d.smtpserver+":"+d.smtpuser})}else{var f=e.getValue();var j=MailService.findById(a,d.smtpuser);if(j!=null){if(f===(d.smtpserver+":"+d.smtpuser)){var b=a.indexOf(j);if(a.getCount()===1){e.setValue("")}else{var k=0;if(b===0){k++}var h=a.getAt(k);e.setValue(h.data.smtpAccount)}}a.remove(j)}}}}}); 
iNet.iwebos.ui.mail.DialogConfigAccount=function(e,b){this.viewer=e;Ext.apply(this,b);this.prefix=(!this.prefix)?"imail-dialog-config-account-":this.prefix;this.address=this.prefix+"address";this.desc=this.prefix+"desc";this.user=this.prefix+"user";this.pass=this.prefix+"pass";this.server=this.prefix+"server";this.port=this.prefix+"port";this.protocol=this.prefix+"protocol";this.security=this.prefix+"security";this.smtpuser=this.prefix+"smtpuser";this.smtppass=this.prefix+"smtppass";this.smtpserver=this.prefix+"smtpserver";this.smtpport=this.prefix+"smtpport";this.smtpsecurity=this.prefix+"smtpsecurity";var d=new Ext.data.SimpleStore({fields:["value","text"],data:[["POP3","POP3"],["IMAP","IMAP"]]});var a=new Ext.data.SimpleStore({fields:["value","text"],data:[["NONE","NONE"],["SSL","SSL"],["TLS","TLS"]]});var c=new Ext.form.FormPanel({columnWidth:1,anchor:"100%",frame:false,border:false,autoHeight:true,autoScroll:true,enableTabScroll:true,labelAlign:"right",bodyStyle:"padding: 5px;",items:[{border:false,html:"<b>"+iwebos.message.mail.info_common+":</b><br/>"},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",border:false,items:[{id:this.address,xtype:"textfield",anchor:"95%",fieldLabel:iwebos.message.mail.email}]},{columnWidth:0.5,layout:"form",anchor:"100%",labelWidth:90,border:false,items:[{id:this.desc,xtype:"textfield",anchor:"95%",fieldLabel:iwebos.message.mail.description}]}]},{border:false,html:iwebos.message.mail.receive_pop3},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",border:false,items:[{id:this.server,xtype:"textfield",anchor:"95%",fieldLabel:iwebos.message.mail.server},{id:this.user,xtype:"textfield",anchor:"95%",fieldLabel:iwebos.message.mail.account},{id:this.pass,xtype:"textfield",inputType:"password",anchor:"95%",fieldLabel:iwebos.message.mail.pass}]},{columnWidth:0.5,layout:"form",anchor:"100%",labelWidth:90,border:false,items:[{id:this.protocol,xtype:"combo",store:d,readOnly:true,displayField:"text",valueField:"value",anchor:"95%",value:"POP3",fieldLabel:iwebos.message.mail.protocol_type,mode:"local",triggerAction:"all",selectOnFocus:true},{id:this.port,xtype:"numberfield",fieldLabel:iwebos.message.mail.port,value:"110",anchor:"95%"},{id:this.security,xtype:"combo",store:a,readOnly:true,displayField:"text",valueField:"value",anchor:"95%",value:"NONE",fieldLabel:iwebos.message.mail.security,mode:"local",triggerAction:"all",selectOnFocus:true}]}]},{border:false,html:iwebos.message.mail.send_smtp},{layout:"column",columnWidth:1,anchor:"100%",border:false,items:[{columnWidth:0.5,layout:"form",labelWidth:90,anchor:"100%",border:false,items:[{id:this.smtpserver,xtype:"textfield",anchor:"95%",fieldLabel:iwebos.message.mail.server},{id:this.smtpuser,xtype:"textfield",anchor:"95%",fieldLabel:iwebos.message.mail.account},{id:this.smtppass,xtype:"textfield",inputType:"password",anchor:"95%",fieldLabel:iwebos.message.mail.pass}]},{columnWidth:0.5,layout:"form",anchor:"100%",labelWidth:90,border:false,items:[{id:this.smtpport,xtype:"numberfield",fieldLabel:iwebos.message.mail.port,value:"25",anchor:"95%"},{id:this.smtpsecurity,xtype:"combo",store:a,readOnly:true,displayField:"text",valueField:"value",anchor:"95%",value:"NONE",fieldLabel:iwebos.message.mail.security,mode:"local",triggerAction:"all",selectOnFocus:true}]}]}]});var f=new Ext.Panel({region:"center",collapsible:false,border:false,enableTabScroll:true,autoScroll:true,width:"100%",layout:"column",items:[c]});c.on("render",function(g){Ext.getCmp(this.address).focus(true,1000);Ext.getCmp(this.address).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.desc).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.user).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.pass).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.server).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.port).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.smtpuser).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.smtppass).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.smtpserver).on("specialkey",this._fnSpecialKey,this);Ext.getCmp(this.smtpport).on("specialkey",this._fnSpecialKey,this)},this);this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogConfigAccount.superclass.constructor.call(this,{id:"mail-config-account-dialog",title:iwebos.message.mail.create_account,iconCls:"icon-email-config-account",region:"center",anchor:"100%",width:600,height:480,modal:true,frame:true,resizable:false,layout:"border",hideMode:"offsets",items:[{region:"center",frame:true,width:"100%",items:f}],buttons:[{text:iwebos.message.mail.ok,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.fnCancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogConfigAccount,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.configure_account,btitle:iwebos.message.mail.setup_properties_for_current_account,setData:function(a){var b=Ext.getCmp(this.address);b.setValue(a.address);b=Ext.getCmp(this.desc);b.setValue(a.desc);b=Ext.getCmp(this.server);b.setValue(a.server);b=Ext.getCmp(this.protocol);b.setValue(a.protocol);b=Ext.getCmp(this.port);b.setValue(a.port);b=Ext.getCmp(this.security);b.setValue(a.security);b=Ext.getCmp(this.user);b.setValue(a.user);b=Ext.getCmp(this.pass);b.setValue(a.pass);b=Ext.getCmp(this.smtpserver);b.setValue(a.smtpserver);b=Ext.getCmp(this.smtpport);b.setValue(a.smtpport);b=Ext.getCmp(this.smtpsecurity);b.setValue(a.smtpsecurity);b=Ext.getCmp(this.smtpuser);b.setValue(a.smtpuser);b=Ext.getCmp(this.smtppass);b.setValue(a.smtppass)},loadData:function(b){var a=b||{};this.setData(a)},getData:function(){var a={};var b;b=Ext.getCmp(this.address);a.address=b.getValue();b=Ext.getCmp(this.desc);a.desc=b.getValue();b=Ext.getCmp(this.server);a.server=b.getValue();b=Ext.getCmp(this.protocol);a.protocol=b.getValue();b=Ext.getCmp(this.port);a.port=b.getValue();b=Ext.getCmp(this.security);a.security=b.getValue();b=Ext.getCmp(this.user);a.user=b.getValue();b=Ext.getCmp(this.pass);a.pass=b.getValue();b=Ext.getCmp(this.smtpserver);a.smtpserver=b.getValue();b=Ext.getCmp(this.smtpport);a.smtpport=b.getValue();b=Ext.getCmp(this.smtpsecurity);a.smtpsecurity=b.getValue();b=Ext.getCmp(this.smtpuser);a.smtpuser=b.getValue();b=Ext.getCmp(this.smtppass);a.smtppass=b.getValue();return a},validate:function(){var j=Ext.getCmp(this.address).getValue();var e=Ext.getCmp(this.desc).getValue();var f=Ext.getCmp(this.server).getValue();var c=Ext.getCmp(this.user).getValue();var i=Ext.getCmp(this.pass).getValue();var a=Ext.getCmp(this.port).getValue();var k=Ext.getCmp(this.smtpuser).getValue();var d=Ext.getCmp(this.smtppass).getValue();var h=Ext.getCmp(this.smtpserver).getValue();var g=Ext.getCmp(this.smtpport).getValue();var b=function(l){return l.replace(/^\s+|\s+$/g,"")};j=b(j);if(""==j||j.length<0||j===null){return iwebos.message.mail.error_empty_mail}e=b(e);if(""==e||e.length<0||e===null){return iwebos.message.mail.error_empty_content}f=b(f);if(""==f||f.length<0||f===null){return iwebos.message.mail.error_empty_server}c=b(c);if(""==c||c.length<0||c===null){return iwebos.message.mail.error_empty_receive_mail}i=b(i);if(""==i||i.length<0||i===null){return iwebos.message.mail.error_empty_password}if(""==a||a.length<0||a===null){return iwebos.message.mail.error_empty_port}k=b(k);if(""==k||k.length<0||k===null){return iwebos.message.mail.error_empty_send_mail}d=b(d);if(""==d||d.length<0||d===null){return iwebos.message.mail.error_empty_password_send}h=b(h);if(""==h||h.length<0||h===null){return iwebos.message.mail.error_empty_server_send}if(""==g||g.length<0||g===null){return iwebos.message.mail.error_empty_port_send}return null},fnCancelHandler:function(){this.destroy()},_fnSpecialKey:function(b,a){if(a.getKey()==Ext.EventObject.ENTER){this.okHandler()}}}); 
iNet.iwebos.ui.mail.DialogTreeMailBox=function(){var b=new Ext.tree.AsyncTreeNode({text:iwebos.message.mail.title_mailbox,draggable:false,id:-1});var a={iwct:"mailFolderContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"build",action:"build"};iNet.iwebos.ui.mail.DialogTreeMailBox.superclass.constructor.call(this,{id:"mailbox-id",useArrows:true,autoScroll:true,animate:true,enableDD:true,draggable:true,containerScroll:true,loader:new iNet.iwebos.ui.common.tree.TreeLoaderWrapper({dataUrl:"jsonajax",baseParams:a}),root:b})};Ext.extend(iNet.iwebos.ui.mail.DialogTreeMailBox,Ext.tree.TreePanel,{loadmail:function(e,c){if(c){var a=Ext.getCmp("emailMessageId");var b=a.store;var d=b.baseParams;d.id=c.id;b.baseParams=d;b.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}},init:function(){this.render();this.root.expand()}});iNet.iwebos.ui.mail.DialogCreateFolder=function(b,a){this.viewer=b;Ext.apply(this,a);this.parentName=this.parentName||"";this.text=new Ext.form.FormPanel({region:"center",bodyStyle:"padding:5px 5px 0",frame:true,border:false,anchor:"100%",items:[{border:false,layout:"form",anchor:"100%",items:[{id:"mail-folder-parent-text-id",xtype:"textfield",fieldLabel:iwebos.message.mail.folder_parent,value:this.parentName,readOnly:true,border:false,anchor:"100%",indexTab:100},{id:"mail-folder-text-id",xtype:"textfield",fieldLabel:iwebos.message.mail.folder_name,border:false,anchor:"100%",indexTab:101,listeners:{specialkey:function(d,c){if(c.getKey()==Ext.EventObject.ENTER){this.okHandler.apply(this.okhScope)}},scope:this}}]}]});this.text.on("render",function(c){Ext.getCmp("mail-folder-text-id").focus(true,1000)},this);this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogCreateFolder.superclass.constructor.call(this,{id:"mail-createfolder",title:iwebos.message.mail.dialog_createfolder,iconCls:"icon-email-createfolder",region:"center",anchor:"100%",width:400,height:270,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.dialog_createfolder_btn_ok,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope,indexTab:102},{text:iwebos.message.mail.dialog_createfolder_btn_cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope,indexTab:103}]})};Ext.extend(iNet.iwebos.ui.mail.DialogCreateFolder,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.dialog_createfolder_ttitle,btitle:iwebos.message.mail.dialog_createfolder_btitle,fnCancelHandler:function(){this.destroy()},getData:function(){var a=Ext.getCmp("mail-folder-text-id").getValue();return a}}); 
iNet.iwebos.ui.mail.DialogEnterPassword=function(b,a){this.viewer=b;Ext.apply(this,a);this.text=new Ext.form.FormPanel({region:"center",bodyStyle:"padding:5px 5px 0",frame:true,border:false,anchor:"100%",labelWidth:58,items:[{border:false,layout:"form",anchor:"100%",items:[{html:'<span class="x-form-field">'+iwebos.message.mail.account+":  <b>"+this.address+"</b></span><br/>"},{id:"dialog-enter-password-txt",xtype:"textfield",inputType:"password",fieldLabel:" "+iwebos.message.mail.pass,border:false,anchor:"100%",listeners:{specialkey:function(d,c){if(c.getKey()==Ext.EventObject.ENTER){this.okHandler()}},scope:this}}]}]});this.text.on("render",function(c){Ext.getCmp("dialog-enter-password-txt").focus(true,1000)},this);this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogEnterPassword.superclass.constructor.call(this,{title:iwebos.message.mail.enter_password,iconCls:"icon-email-enterpassword",region:"center",anchor:"100%",width:450,height:265,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.confirm,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.dialog_createfolder_btn_cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogEnterPassword,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.confirm_password,btitle:iwebos.message.mail.error_enter_password,fnCancelHandler:function(){this.destroy()},getPassword:function(){var a=Ext.getCmp("dialog-enter-password-txt");return a.getValue().trim()}}); 
iNet.iwebos.ui.mail.DialogMailAddFilter=function(f,b){this.viewer=f;Ext.apply(this,b);this.prefix="iwebos-mail-filter-";this.clausese=this.prefix+"calusese";this.name=this.prefix+"name";this.filterOperator=this.prefix+"filter-operator";this.cmdFolder=this.prefix+"button-folder";this.filterActionCombo=this.prefix+"action-combo";this.__owner={fId:0};var a=new Ext.data.SimpleStore({fields:["text","value"],data:[[iwebos.message.mail.filter_operator_and,"AND"],[iwebos.message.mail.filter_operator_or,"OR"]]});var e=new Ext.data.SimpleStore({fields:["text","value"],data:[[iwebos.message.mail.filter_action_send_to_folder,"MOVE"]]});var c=new iNet.iwebos.ui.mail.FilterClauseUnitPanel({layout:"column",border:false,anchor:"100%",columnWidth:1,actionRemove:{scope:this,fn:this._removeClause}});var d=new Ext.form.FormPanel({frame:false,border:false,anchor:"100%",items:[{layout:"column",border:false,anchor:"100%",items:[{columnWidth:1,border:false,anchor:"100%",items:[{layout:"form",border:false,labelWidth:90,items:[{id:this.name,xtype:"textfield",border:false,fieldLabel:iwebos.message.mail.filter_name,anchor:"100%"}]}]}]},{layout:"column",border:false,anchor:"100%",items:[{columnWidth:1,xtype:"fieldset",title:iwebos.message.mail.filter_search_follow_standar,autoHeight:true,anchor:"100%",collapsed:false,items:[{layout:"column",border:false,anchor:"100%",columnWidth:1,items:[{columnWidth:0.2,border:false,anchor:"100%",bodyStyle:"padding:10px 10px;",items:[{xtype:"button",border:false,iconCls:"icon-email-filter-add",text:iwebos.message.mail.filter_unit_add,handler:this._addClause.createDelegate(this)}]},{columnWidth:0.8,border:false,anchor:"100%",bodyStyle:"padding:10px 10px;",items:[{layout:"form",border:false,anchor:"100%",labelWidth:90,items:[{id:this.filterOperator,xtype:"combo",border:false,anchor:"100%",store:a,mode:"local",displayField:"text",valueField:"value",value:"OR",forceSelection:true,selectOnFocus:true,triggerAction:"all",readOnly:true,fieldLabel:iwebos.message.mail.filter_search_email}]}]}]},{layout:"form",border:false,anchor:"100%",items:new Ext.Panel({id:this.clausese,layout:"column",border:false,anchor:"100%",columnWidth:1,height:150,frame:true,autoDestroy:true,autoScroll:true,items:[c]})}]}]},{layout:"column",border:false,anchor:"100%",bodyStyle:"padding:10px 0px;",items:[{columnWidth:0.4,border:false,anchor:"100%",items:[{layout:"form",border:false,items:[{id:this.filterActionCombo,xtype:"combo",border:false,anchor:"100%",store:e,mode:"local",displayField:"text",valueField:"value",value:"MOVE",forceSelection:true,selectOnFocus:true,triggerAction:"all",readOnly:true,hideLabel:true}]}]},{columnWidth:0.6,border:false,anchor:"100%",items:[{layout:"form",border:false,items:[{id:this.cmdFolder,xtype:"button",border:false,text:"...",handler:this._selectFolder.createDelegate(this)}]}]}]},{layout:"fit",border:false,anchor:"100%",items:[{}]}]});c.setEnableRemove(false);Ext.getCmp(this.filterActionCombo).on("beforeselect",this._onBeforeSelectAction,this);this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogMailAddFilter.superclass.constructor.call(this,{id:"mail-add-filter-dialog",title:iwebos.message.mail.filter_add_new,iconCls:"icon-email-filter",region:"center",anchor:"100%",width:500,height:500,modal:true,frame:true,resizable:false,layout:"border",hideMode:"offsets",items:[{region:"center",frame:true,width:"100%",items:d}],buttons:[{text:iwebos.message.mail.save,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.fnCancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogMailAddFilter,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.filter_create,btitle:iwebos.message.mail.filter_create_new_to_management_email,fnCancelHandler:function(){this.destroy()},_addClause:function(){var b=new iNet.iwebos.ui.mail.FilterClauseUnitPanel({layout:"column",border:false,anchor:"100%",columnWidth:1,actionRemove:{scope:this,fn:this._removeClause}});var a=Ext.getCmp(this.clausese);var c=a.findByType(iNet.iwebos.ui.mail.FilterClauseUnitPanel);if(c.length==1){c[0].setEnableRemove(true)}a.add(b);Ext.EventManager.fireWindowResize();return b},_removeClause:function(a){var b=Ext.getCmp(this.clausese);b.remove(a,true);var c=b.findByType(iNet.iwebos.ui.mail.FilterClauseUnitPanel);if(c.length==1){c[0].setEnableRemove(false)}},getData:function(){var c={};var g=this.__owner||{};c.id=this.__owner.id||0;var d=Ext.getCmp(this.name);c.name=d.getValue();var f={};d=Ext.getCmp(this.filterOperator);f.operator=d.getValue();d=Ext.getCmp(this.clausese);var a=[];var e=d.findByType(iNet.iwebos.ui.mail.FilterClauseUnitPanel);for(var b=0;b<e.length;b++){a[b]=e[b].getData()}f.units=a;c.clause=f;c.fId=g.fId;return c},setData:function(f){var d=f||{};this.__owner.id=d.id;var e=Ext.getCmp(this.name);e.setValue(d.name);var h=d.clause;e=Ext.getCmp(this.filterOperator);e.setValue(h.operator);e=Ext.getCmp(this.clausese);var b=h.units;var g=e.findByType(iNet.iwebos.ui.mail.FilterClauseUnitPanel);for(var c=0;c<b.length;c++){if(c==0){var a=g[c];if(!!a){a.setData(b[c])}}else{var h=this._addClause();h.setData(b[c])}}if(d.fId==0){e=Ext.getCmp(this.filterActionCombo);e.setValue("DELETE");e=Ext.getCmp(this.cmdFolder);e.setVisible(false)}else{e=Ext.getCmp(this.cmdFolder);e.setText(d.folder)}this.__owner.fId=d.fId;return d},validate:function(){var a=Ext.getCmp(this.name);if(a.getValue().trim()==""){a.focus(true);return iwebos.message.mail.filter_error_input_name}a=Ext.getCmp(this.filterActionCombo);var b=a.getValue();if(b=="MOVE"&&this.__owner.fId==0){return iwebos.message.mail.filter_error_input_folder}return""},_selectFolder:function(){var a=this;var b=function(){var e=this.getData();if(e==undefined){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.filter_error_input_folder,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var d=Ext.getCmp(a.cmdFolder);d.setText(e.original);a.__owner.fId=e.id;this.destroy()};var c=new iNet.iwebos.ui.mail.DialogMailFolder(this,{okHandler:b,okhScope:c,ttitle:iwebos.message.mail.select_folder_for_filter});c.show(this)},_onBeforeSelectAction:function(e,a,b){var d=a.data.value;var c=Ext.getCmp(this.cmdFolder);if(d=="MOVE"){c.setVisible(true)}else{c.setVisible(false)}}}); 
iNet.iwebos.ui.mail.DialogMailFilter=function(g,b){this.viewer=g;Ext.apply(this,b);this.prefix="iwebos-mail-filter-";this.btnDeleteId=this.prefix+"delete-button";var d={field:"name",direction:"DESC"};var h={field:"name",direction:"DESC"};var e=Ext.data.Record.create([{name:"id",mapping:"id",type:"int"},{name:"name",mapping:"name",type:"string"},{name:"folder",mapping:"folder",type:"string"},{name:"clause",mapping:"clause"},{name:"fId",mapping:"fId",type:"int"}]);var j=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},e);var k=new Ext.grid.ColumnModel([{header:iwebos.message.mail.filter_name,dataIndex:"name",fixed:false,menuDisabled:true,width:100},{header:iwebos.message.mail.filter_folder,dataIndex:"folder",fixed:false,menuDisabled:true,width:100}]);var a={iwct:"loadMailFilterContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",action:"search"};this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({region:"north",anchor:"100%",minSize:150,baseParams:a,autoScroll:true,height:150,url:"jsonajax",method:"POST",loadFirst:true,sortInfo:d,reader:j,dsort:h,cm:k,tbar:[{xtype:"button",border:false,iconCls:"icon-email-filter-add",text:iwebos.message.mail.filter_add,handler:this.__addFilter.createDelegate(this)},{id:this.btnDeleteId,xtype:"button",border:false,disabled:true,iconCls:"icon-email-filter-remove",text:iwebos.message.mail.filter_delete,handler:this._deleteFilter.createDelegate(this)}]});this.grid.on("contextmenu",this._contextMenu,this);this.grid.on("rowcontextmenu",this._rowContextMenu,this);this.grid.on("rowdblclick",this._rowDoubleClick,this);this.preViewFilter=new Ext.Panel({id:"preViewFilter",region:"center",frame:false,border:false,header:true,height:300,autoScroll:true,title:iwebos.message.mail.filter_detail});var c=new Ext.Panel({frame:false,border:false,anchor:"100%",layout:"border",items:[this.grid,this.preViewFilter]});var f=['<div style="overflow:visible; height:100px; background:#fff;">','<table border=0 cellspacing=0 cellpadding=0 bgcolor="#FFFFFF">',"<tr>",'<td valign=top width="100%" style="padding-top:3px;">&nbsp;<span class="mail-icon-dialog-filter-filter">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<b style="color:blue;">{name}</b></td>',"</tr>","<tr>",'<td valign=top style="padding-top:5px;">&nbsp;','<tpl for="clause"><span>&nbsp;&nbsp;&nbsp;&nbsp;</span> <b>{[this.repl(values.operator)]} :</b><br>','<tpl for="units">',"&nbsp;<span>&nbsp;&nbsp;&nbsp;&nbsp;</span> {[this.repl(values.object)]} <span>&nbsp;&nbsp;&nbsp;&nbsp;</span> {[this.repl(values.operator)]} <span>&nbsp;&nbsp;&nbsp;&nbsp;</span> {data} <br />","</tpl>","</tpl>","</td>","</tr>","<tr>",'<td valign=top style="padding-top:5px;padding-bottom:5px;">&nbsp;<span class="mail-icon-dialog-filter-folder">&nbsp;&nbsp;&nbsp;&nbsp;</span> '+iwebos.message.mail.filter_folder+": &nbsp;{folder}</td>","</tr>","</table></div>"];var i=new Ext.XTemplate(f.join(""),{repl:function(l){switch(l){case"AND":return iwebos.message.mail.filter_operator_and;case"OR":return iwebos.message.mail.filter_operator_or;case"SENDER":return iwebos.message.mail.filter_object_sender;case"RECIPIENTS":return iwebos.message.mail.filter_object_recipient;case"SUBJECT":return iwebos.message.mail.filter_object_subject;case"DATE_SENT":return iwebos.message.mail.filter_object_date_sent;case"DATE_RECEIVED":return iwebos.message.mail.filter_object_date_received;case"ALL":return iwebos.message.mail.filter_object_all;case"CONTAINS":return iwebos.message.mail.filter_operator_contain;case"DOES_NOT_CONTAIN":return iwebos.message.mail.filter_operator_does_not_contain;case"IS":return iwebos.message.mail.filter_operator_is;case"IS_NOT":return iwebos.message.mail.filter_operator_is_not;case"STARTS_WITH":return iwebos.message.mail.filter_operator_start_with;case"DOES_NOT_START_WITH":return iwebos.message.mail.filter_operator_does_not_start_with;case"ENDS_WITH":return iwebos.message.mail.filter_operator_end_with;case"DOES_NOT_END_WITH":return iwebos.message.mail.filter_operator_does_not_end_with}}});this.grid.getSelectionModel().on("rowselect",function(p,o,n){var l=this.grid.store.getAt(o);var m=Ext.getCmp("preViewFilter");if(m){i.overwrite(m.body,l.data);Ext.EventManager.fireWindowResize()}},this);this.grid.getSelectionModel().on("selectionchange",function(l){if(!!l.getSelected()){Ext.getCmp(this.btnDeleteId).setDisabled(false)}else{Ext.getCmp(this.btnDeleteId).setDisabled(true)}},this);this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogMailFilter.superclass.constructor.call(this,{id:"mail-filter-dialog",title:iwebos.message.mail.filter_mail,iconCls:"icon-email-filter",region:"center",anchor:"100%",width:500,height:510,modal:true,frame:true,resizable:false,layout:"border",items:[this.grid,this.preViewFilter],buttons:[{text:iwebos.message.mail.close,iconCls:"ok-btn",handler:this.fnCancelHandler,scope:this.okhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogMailFilter,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.filter_mail,btitle:iwebos.message.mail.filter_info,fnCancelHandler:function(){this.destroy()},__addFilter:function(){var a=this.grid.store;var b=function(){var d=this.validate();if(d.length>0){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:d,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var e=function(i,j){if(!!i){var h=Ext.util.JSON.decode(i.responseText);var k=h.success==undefined?true:false;if(k){a.addData({id:h.id,name:h.name,folder:h.folder});return}}Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.filter_error_save,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})};var f=this.getData();var g={iwct:"mailFilterContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"save",action:"save"};g.object=Ext.util.JSON.encode(f);iNet.Ajax.request({url:"jsonajax",params:g,scope:this,method:"POST",success:e,failure:e});this.destroy()};var c=new iNet.iwebos.ui.mail.DialogMailAddFilter(this,{okHandler:b,okhScope:c});c.show(this)},_deleteFilter:function(){var b=this.grid.getSelectionModel().getSelected();var a=this.grid.store;if(!b){return}var c=function(f,g){if(!!f){var e=Ext.util.JSON.decode(f.responseText);if(e.success){a.remove(b);return}}Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.filter_error_delete,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})};var d={iwct:"mailFilterContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"delete",action:"delete",id:b.data.id};iNet.Ajax.request({url:"jsonajax",params:d,scope:this,method:"POST",success:c,failure:c})},_contextMenu:function(a){a.stopEvent()},_rowContextMenu:function(c,b,d){d.stopEvent();WebOSGridService.handleSelection(c,b);var a=new Ext.menu.Menu({items:[{text:iwebos.message.mail.filter_delete,iconCls:"icon-email-filter-remove",scope:this,handler:this._deleteFilter.createDelegate(this)}]});a.showAt(d.getXY())},_rowDoubleClick:function(d,c,f){f.stopEvent();WebOSGridService.handleSelection(d,c);var a=d.store;var b=d.getSelectionModel().getSelected();var e=function(){var h=this.validate();if(h.length>0){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:h,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var i=function(m,n){if(!!m){var l=Ext.util.JSON.decode(m.responseText);var o=l.success==undefined?true:false;if(o){Ext.apply(b.data,l);b.commit();d.getSelectionModel().selectRecords([b]);return}}Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.filter_error_save,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})};var j=this.getData();var k={iwct:"mailFilterContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"save",action:"save"};k.object=Ext.util.JSON.encode(j);iNet.Ajax.request({url:"jsonajax",params:k,scope:this,method:"POST",success:i,failure:i});this.destroy()};var g=new iNet.iwebos.ui.mail.DialogMailAddFilter(this,{okHandler:e,okhScope:g});g.show(this);g.setData(b.data)}}); 
iNet.iwebos.ui.mail.DialogMailFolder=function(d,b){this.viewer=d;Ext.apply(this,b);var a={iwct:"loadMailFolderContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"build",action:"build"};this.treeroot=new Ext.tree.AsyncTreeNode({text:iwebos.message.mail.title_mailbox,draggable:false,expanded:true,id:-1});var c=new Ext.tree.TreePanel({id:"mail-dialog-tree-folder-panel-id",useArrows:true,autoScroll:true,animate:true,enableDD:true,draggable:true,ddScroll:true,frame:false,height:200,containerScroll:true,loader:new iNet.iwebos.ui.common.tree.TreeLoaderWrapper({dataUrl:"jsonajax",baseParams:a}),root:this.treeroot});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogMailFolder.superclass.constructor.call(this,{id:"mail-dialog-mail-folder",title:"Chọn thư mục",iconCls:"icon-email-createfolder",region:"center",anchor:"100%",width:300,height:400,modal:true,autoScroll:true,frame:true,layout:"form",hideMode:"offsets",items:[c],buttons:[{text:iwebos.message.mail.select,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.close,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogMailFolder,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",fnCancelHandler:function(){this.destroy()},getData:function(){var a=Ext.getCmp("mail-dialog-tree-folder-panel-id");var b=a.getSelectionModel().getSelectedNode();if(!!b){return b.attributes}return undefined}}); 
iNet.iwebos.ui.mail.DialogRenameFolder=function(b,a){this.viewer=b;Ext.apply(this,a);this.folderName=this.folderName||"";this.text=new Ext.form.FormPanel({region:"center",bodyStyle:"padding:5px 5px 0",frame:true,border:false,anchor:"100%",items:[{columnWidth:0.9,border:false,layout:"anchor",anchor:"100%",items:[{id:"mail-folder-rename-id",xtype:"textfield",value:this.folderName,border:false,anchor:"100%"}]}]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogRenameFolder.superclass.constructor.call(this,{id:"mail-renamefolder",title:iwebos.message.mail.dialog_renamefolder,iconCls:"icon-email-createfolder",region:"center",anchor:"100%",width:400,height:250,modal:true,frame:true,layout:"border",hideMode:"offsets",items:[this.text],buttons:[{text:iwebos.message.mail.dialog_renamefolder_btn_ok,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.dialog_renamefolder_btn_cancel,iconCls:"cancel-btn",handler:this.cancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogRenameFolder,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.dialog_renamefolder_ttitle,btitle:iwebos.message.mail.dialog_renamefolder_btitle,getData:function(){var a=Ext.getCmp("mail-folder-rename-id").getValue();return a},fnCancelHandler:function(){this.destroy()}}); 
iNet.iwebos.ui.mail.DialogSelectContact=function(c,t){this.viewer=c;Ext.apply(this,t);this.prefix="mail-dialog-select-contact";this.toButton=this.prefix+"to";this.ccButton=this.prefix+"cc";this.bccButton=this.prefix+"bcc";this.searchCombo=this.prefix+"search-combo";this.keyword=this.prefix+"keyword";this.txtWordId=this.prefix+"-txt-word-id";this.departmentId=this.prefix+"-department-id";this.searchBtnId=this.prefix+"-btn-search-id";this.gridId=this.prefix+"-personal-grid-id";this.globalGridId=this.prefix+"-global-grid-id";this.personalPanelId=this.prefix+"-personal-panel-id";this.globalPanelId=this.prefix+"-global-panel-id";this.__owner={mode:"global",id:0,load:false};this.DOMAIN_STORE=new Ext.data.JsonStore({fields:[{name:"text",type:"string"},{name:"value",type:"string"},{name:"desc",type:"string"}]});var s={field:"dname",direction:"ASC"};var v={field:"dname",direction:"ASC"};var h={iwct:"searchAddressBookContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",mode:"personal",action:"search"};var e={iwct:"searchAddressBookContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",mode:"global",action:"search"};var u=Ext.data.Record.create([{name:"id",mapping:"name",type:"string"},{name:"name",mapping:"name",type:"string"},{name:"dname",mapping:"dname",type:"string"},{name:"mail",mapping:"mail",type:"string"},{name:"hphone",mapping:"hphone",type:"string"},{name:"mphone",mapping:"mphone",type:"string"},{name:"fax",mapping:"fax",type:"string"},{name:"pager",mapping:"pager",type:"string"},{name:"addr",mapping:"addr",type:"string"},{name:"group",mapping:"group",type:"string"}]);var p=Ext.data.Record.create([{name:"id",mapping:"id",type:"int"},{name:"fname",mapping:"fname",type:"string"},{name:"lname",mapping:"lname",type:"string"},{name:"dname",mapping:"dname",type:"string"},{name:"mail",mapping:"mail",type:"string"},{name:"alias",mapping:"alias",type:"boolean"},{name:"mailDrop",mapping:"mailDrop"}]);var l=function(w,x){return false};var a=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},p);var n=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},u);var o=new Ext.grid.ColumnModel([{fixed:true,width:24,menuDisabled:true,renderer:function(w){return'<div class="icon-contact-account"></div>'}},{dataIndex:"dname",menuDisabled:true,renderer:function(z,x,w){var y=w.data.mail;if(y==""){return z}else{return z+"&lt;"+y+"&gt;"}}},{header:iwebos.message.mail.contact.department,dataIndex:"group",menuDisabled:true,hidden:true}]);var f=new Ext.grid.ColumnModel([{dataIndex:"alias",fixed:true,width:24,menuDisabled:true,renderer:function(w){if(w){return'<div class="icon-contact-group"></div>'}else{return'<div class="icon-contact-account"></div>'}}},{dataIndex:"dname",menuDisabled:true,renderer:function(z,x,w){var y=w.data.mail;if(y==""){return z}else{return z+"&lt;"+y+"&gt;"}}}]);var d=function(w){return""};this.globalGrid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:this.globalGridId,region:"center",anchor:"100%",autoScroll:true,url:"jsonajax",method:"POST",sortInfo:s,baseParams:e,reader:a,cm:f,dsort:v,filter:{data:"all",fn:true},loadFirst:false,rowClass:d});this.grid=new iNet.iwebos.ui.common.grid.WebOSGrid({id:this.gridId,region:"center",anchor:"100%",autoScroll:true,url:"jsonajax",method:"POST",sortInfo:s,baseParams:h,reader:n,groupLabel:iwebos.message.mail.contact.grid_group_label,groupField:"group",cm:o,dsort:v,loadFirst:false,filter:{data:"all",fn:true},rowClass:d});this.personalPanel=new Ext.Panel({id:this.personalPanelId,title:iwebos.message.mail.contact.personal,border:false,collapsed:true,frame:false,layout:"border",filter:null,iconCls:"icon-contact-personal",items:[this.grid]});this.globalPanel=new Ext.Panel({id:this.globalPanelId,title:iwebos.message.mail.contact.global,border:false,frame:false,layout:"border",iconCls:"icon-contact-global",items:[this.globalGrid]});var i=new Ext.grid.ColumnModel([{fixed:false,header:false,menuDisabled:true,width:120,dataIndex:"name"}]);var b=Ext.data.Record.create([{name:"id",mapping:"email",type:"string"},{name:"name",mapping:"name",type:"string"}]);var g=new Ext.Panel({border:false,frame:false,region:"center",layout:"accordion",anchor:"100%",items:[this.personalPanel,this.globalPanel]});var k=new Ext.Panel({region:"west",border:false,frame:false,layout:"border",minSize:275,maxSize:600,width:350,split:true,items:[g]});this.cboDepartment={id:this.departmentId,xtype:"combo",width:300,store:this.DOMAIN_STORE,valueField:"value",displayField:"text",mode:"local",triggerAction:"all",selectOnFocus:true,forceSelection:true,value:""};var j=new Ext.form.TextField({id:this.txtWordId,xtype:"textfield",width:130,itemCls:"required"});this.searchButton={xtype:"button",id:this.searchBtnId,iconCls:"icon-search",text:iwebos.message.mail.search,tooltip:iwebos.message.mail.search,handler:this.search,scope:this};this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.grid.store,hidden:true,displayInfo:false});this.pagingBar2=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.globalGrid.store,displayInfo:false});this.loadDomain();var q="->";if(Ext.isGecko2){q="-"}else{q="->"}var r=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"name"},b);this.__gridTo=new iNet.iwebos.ui.common.grid.WebOSGrid({anchor:"100%",height:90,frame:false,border:false,autoScroll:true,loadFirst:false,cm:i,reader:r,filter:{data:"all"}});this.__gridCc=new iNet.iwebos.ui.common.grid.WebOSGrid({anchor:"100%",height:90,autoScroll:true,loadFirst:false,frame:false,border:false,cm:i,reader:r,filter:{data:"all"}});this.__gridBcc=new iNet.iwebos.ui.common.grid.WebOSGrid({anchor:"100%",height:90,frame:false,border:false,autoScroll:true,reader:r,loadFirst:false,cm:i,filter:{data:"all"}});this.__gridTo.on("rowcontextmenu",this._onRowContextTo,this);this.__gridTo.on("contextmenu",this._onContextmenu,this);this.__gridCc.on("rowcontextmenu",this._onRowContextCc,this);this.__gridCc.on("contextmenu",this._onContextmenu,this);this.__gridBcc.on("rowcontextmenu",this._onRowContextBcc,this);this.__gridBcc.on("contextmenu",this._onContextmenu,this);var m=new Ext.form.FormPanel({region:"center",frame:true,border:false,minSize:300,anchor:"100%",items:[{frame:false,layout:"column",anchor:"100%",columnWidth:1,items:[{layout:"form",width:70,anchor:"100%",bodyStyle:"padding: 1px;",frame:false,border:false,items:[{frame:false,border:false,bodyStyle:"padding-top: 20px; padding-bottom: 10px;",items:[{id:this.toButton,xtype:"button",hideLabel:true,text:"To: ->",minWidth:65,handler:this._handlerTo.createDelegate(this)}]},{xtype:"button",hideLabel:true,minWidth:65,text:"<- "+iwebos.message.mail.remove,handler:this._removeEmailTo.createDelegate(this)}]},{layout:"form",columnWidth:1,anchor:"100%",items:[this.__gridTo]}]},{frame:false,layout:"column",anchor:"100%",columnWidth:1,items:[{layout:"form",width:70,anchor:"100%",bodyStyle:"padding: 1px;",frame:false,border:false,items:[{frame:false,border:false,bodyStyle:"padding-top: 20px; padding-bottom: 10px;",items:[{id:this.ccButton,xtype:"button",hideLabel:true,text:"Cc: ->",minWidth:65,handler:this._handlerCC.createDelegate(this)}]},{xtype:"button",hideLabel:true,text:"<- "+iwebos.message.mail.remove,minWidth:65,handler:this._removeEmailCc.createDelegate(this)}]},{layout:"form",columnWidth:1,anchor:"100%",items:[this.__gridCc]}]},{frame:false,layout:"column",anchor:"100%",columnWidth:1,items:[{layout:"form",width:70,bodyStyle:"padding: 1px;",frame:false,border:false,anchor:"100%",items:[{frame:false,border:false,bodyStyle:"padding-top: 20px; padding-bottom: 10px;",items:[{id:this.bccButton,xtype:"button",hideLabel:true,text:"Bcc: ->",minWidth:65,handler:this._handlerBCC.createDelegate(this)}]},{xtype:"button",hideLabel:true,text:"<- "+iwebos.message.mail.remove,minWidth:65,handler:this._removeEmailBcc.createDelegate(this)}]},{layout:"form",columnWidth:1,anchor:"100%",items:[this.__gridBcc]}]}]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;this.personalPanel.on("beforeexpand",this.onClickExpand,this,{stopEvent:true});this.globalPanel.on("beforeexpand",this.onClickExpand,this,{stopEvent:true});this.personalPanel.on("collapse",this.onClickCollapse,this,{stopEvent:true});this.globalPanel.on("collapse",this.onClickCollapse,this,{stopEvent:true});this.grid.on("contextmenu",function(w){w.stopEvent(true)},this,{stopEvent:true});this.globalGrid.on("contextmenu",function(w){w.stopEvent(true)},this,{stopEvent:true});this.grid.store.on("beforeload",this.__fnOnStore,this);this.globalGrid.store.on("beforeload",this.__fnOnStore,this);this.main=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,tbar:[this.cboDepartment,j,this.searchButton,q,this.pagingBar,this.pagingBar2],items:[k,m]});k.on("resize",function(){Ext.EventManager.fireWindowResize()},this);j.on("specialkey",function(x,w){if(w.getKey()==Ext.EventObject.ENTER){this.search()}},this);iNet.iwebos.ui.mail.DialogSelectContact.superclass.constructor.call(this,{id:"email-more-id",title:iwebos.message.mail.select_contact,iconCls:"icon-email-group",region:"center",anchor:"100%",width:750,height:515,modal:true,frame:true,resizable:true,layout:"border",hideMode:"offsets",items:[this.main],buttons:[{text:iwebos.message.mail.ok,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.fnCancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogSelectContact,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"icon-email-select-group",ttitle:iwebos.message.mail.dialog_select_contact,btitle:iwebos.message.mail.setup_add_email,fnCancelHandler:function(){this.destroy()},_handlerTo:function(){this._addDataGrid(this.__gridTo.store)},_handlerCC:function(){this._addDataGrid(this.__gridCc.store)},_handlerBCC:function(){this._addDataGrid(this.__gridBcc.store)},_onContextmenu:function(a){a.stopEvent()},_addDataGrid:function(i){var b=null;if(this.__owner.mode=="personal"){b=Ext.getCmp(this.gridId)}else{b=Ext.getCmp(this.globalGridId)}var f=b.getSelectionModel().getSelections();if(f.length===0){return}var c="",a="";var e={};for(var d=0;d<f.length;d++){c=f[d].data.mail;a=f[d].data.dname;if(i.getById(c)){var j=i.getById(c);if(a!=j.data.name){var g=i.indexOf(j);var h=j;h.data.name='"'+a+'" &lt;'+c+"&gt;";i.remove(j);i.insert(g,h)}}else{i.addData({id:c,name:'"'+a+'" &lt;'+c+"&gt;"})}}},getData:function(){var d={};var g={};var a=this.__gridTo.store;var f=[];if(a.getCount()>0){for(var c=0;c<a.getCount();c++){g=a.getAt(c).data;g.name=g.name.replace("&lt;","<");g.name=g.name.replace("&gt;",">");f[c]=g}}a=this.__gridCc.store;var e=[];if(a.getCount()>0){for(var c=0;c<a.getCount();c++){g=a.getAt(c).data;g.name=g.name.replace("&lt;","<");g.name=g.name.replace("&gt;",">");e[c]=g}}a=this.__gridBcc.store;var b=[];if(a.getCount()>0){for(var c=0;c<a.getCount();c++){g=a.getAt(c).data;g.name=g.name.replace("&lt;","<");g.name=g.name.replace("&gt;",">");b[c]=g}}d.to=f;d.cc=e;d.bcc=b;return d},loadData:function(a){this.addData2Store(this.__gridTo.store,a.to);this.addData2Store(this.__gridCc.store,a.cc);this.addData2Store(this.__gridBcc.store,a.bcc)},addData2Store:function(a,d){var c={};for(var b=0;b<d.length;b++){c=d[b];c.name=c.name.replace("<","&lt;");c.name=c.name.replace(">","&gt;");a.addData(c)}},_onRowContextTo:function(b,d,c){c.stopEvent();WebOSGridService.handleSelection(b,d);var a=new Ext.menu.Menu({id:"grid-to-ctx",items:[{text:iwebos.message.mail.remove,iconCls:"icon-email-folder-delete",scope:this,handler:this._removeEmailTo.createDelegate(this)}]});a.showAt(c.getXY())},_onRowContextCc:function(b,d,c){c.stopEvent();WebOSGridService.handleSelection(b,d);var a=new Ext.menu.Menu({id:"grid-cc-ctx",items:[{text:iwebos.message.mail.remove,iconCls:"icon-email-folder-delete",scope:this,handler:this._removeEmailCc.createDelegate(this)}]});a.showAt(c.getXY())},_onRowContextBcc:function(b,d,c){c.stopEvent();WebOSGridService.handleSelection(b,d);var a=new Ext.menu.Menu({id:"grid-bcc-ctx",items:[{text:iwebos.message.mail.remove,iconCls:"icon-email-folder-delete",scope:this,handler:this._removeEmailBcc.createDelegate(this)}]});a.showAt(c.getXY())},_removeEmailTo:function(){var b=this.__gridTo.getSelectionModel().getSelections();if(b.length===0){return}for(var a=0;a<b.length>0;a++){this.__gridTo.store.remove(b[a])}},_removeEmailCc:function(){var b=this.__gridCc.getSelectionModel().getSelections();if(b.length===0){return}for(var a=0;a<b.length>0;a++){this.__gridCc.store.remove(b[a])}},_removeEmailBcc:function(){var b=this.__gridBcc.getSelectionModel().getSelections();if(b.length===0){return}for(var a=0;a<b.length>0;a++){this.__gridBcc.store.remove(b[a])}},createBaseParams:function(d,b,a,c){return{iwm:d,iwct:b,iwc:a,iwa:c}},search:function(){if(this.__owner.mode=="personal"){this.grid.store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}else{this.globalGrid.store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}},loadDomain:function(){var a=this.createBaseParams("MAIL","searchAddressBookContent","READ_ONLY","loadDomain");a.action="loadDomain";iNet.Ajax.request({url:"jsonajax",params:a,scope:this,method:"POST",success:function(b,g){var h=Ext.util.JSON.decode(b.responseText);var i=Ext.getCmp(this.departmentId);this.DOMAIN_STORE.removeAll();this.DOMAIN_STORE.add(new Ext.data.Record({text:iwebos.message.mail.filter_object_all,value:"",desc:""}));var c=function(j,k){if(k==" "){return j}else{return j+" ["+k+"]"}};if(h!==null){if(h.length>0){var f=Ext.getCmp("main-tabs");var e=f.getDomainDefault();var d=false;for(index=0;index<h.length;index++){if(h[index].domain==e){d=true}this.DOMAIN_STORE.add(new Ext.data.Record({text:c(h[index].domain,h[index].desc),value:h[index].domain,desc:h[index].desc}))}this.DOMAIN_STORE.sort("value");i.store.loadData(this.DOMAIN_STORE,true);if(e!=null){if(d){i.setValue(e)}else{i.setValue("")}}}}this.globalGrid.store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})},failure:function(b,c){},maskEl:this.bwrap})},onClickExpand:function(d,b){var c=Ext.getCmp(this.departmentId);if(d.id==this.personalPanelId){this.__owner.mode="personal";c.setDisabled(true);this.pagingBar.setVisible(true);this.pagingBar2.setVisible(false);if(!this.grid.loadFirst){this.grid.loadFirst=true;this.grid.store.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}}else{this.__owner.mode="global";c.setDisabled(false);this.pagingBar.setVisible(false);this.pagingBar2.setVisible(true)}},onClickCollapse:function(a){if(a){var c=(a.id==this.personalPanelId?this.globalPanelId:this.personalPanelId);var b=Ext.getCmp(c);if(b){b.expand(true)}}},__fnOnStore:function(b,d){var f=Ext.getCmp(this.txtWordId);var a=f.getValue();var c=Ext.getCmp(this.departmentId);var e=c.getValue();e=(e===""||e===null?"":e);b.baseParams={iwct:"searchAddressBookContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",mode:"global",action:"search",keyword:a,group:e,mode:this.__owner.mode}}}); 
iNet.iwebos.ui.mail.DialogSignature=function(c,a){this.viewer=c;Ext.apply(this,a);this.prefix="iwebos-mail-signature-dialog";this.signatureName=this.prefix+"-name";this.signatureContent=this.prefix+"-content";var b=new Ext.form.FormPanel({frame:false,border:false,anchor:"100%",items:[{layout:"column",border:false,anchor:"100%",items:[{columnWidth:1,border:false,anchor:"100%",items:[{layout:"form",border:false,labelWidth:70,items:[{id:this.signatureName,xtype:"textfield",border:false,fieldLabel:iwebos.message.mail.signature_name,anchor:"100%"}]}]},{columnWidth:1,border:false,layout:"fit",items:[{id:this.signatureContent,xtype:"htmleditor",border:false,height:160}]}]}]});this.okHandler=this.okHandler||this.fnOkHandler;this.cancelHandler=this.cancelHandler||this.fnCancelHandler;this.okhScope=this.okhScope||this;this.cancelhScope=this.cancelhScope||this;iNet.iwebos.ui.mail.DialogSignature.superclass.constructor.call(this,{id:"mail-signature-dialog",title:iwebos.message.mail.create_signature,iconCls:"icon-email-signature",region:"center",anchor:"100%",width:528,height:400,modal:true,frame:true,resizable:false,layout:"border",hideMode:"offsets",items:[{region:"center",frame:true,width:"100%",items:b}],buttons:[{text:iwebos.message.mail.ok,iconCls:"ok-btn",handler:this.okHandler,scope:this.okhScope},{text:iwebos.message.mail.cancel,iconCls:"cancel-btn",handler:this.fnCancelHandler,scope:this.cancelhScope}]})};Ext.extend(iNet.iwebos.ui.mail.DialogSignature,iNet.iwebos.ui.common.dialog.TitleDialog,{bodyBorder:false,dragContent:false,hdImgCls:"",ttitle:iwebos.message.mail.create_signature,btitle:iwebos.message.mail.create_signature_for_user,fnCancelHandler:function(){this.destroy()},validate:function(){var a=Ext.getCmp(this.signatureName);var b=a.getValue().trim();if(b.length===0){return iwebos.message.mail.error_input_signature_name}return""},getData:function(){var a={};var b;b=Ext.getCmp(this.signatureName);a.sname=b.getValue().trim();b=Ext.getCmp(this.signatureContent);a.scontent=b.getValue();a.sid=0;a.used="N";return a},loadData:function(b){if(!b){return}var a=b.data;var c=Ext.getCmp(this.signatureName);c.setValue(a.sname);c=Ext.getCmp(this.signatureContent);c.setValue(a.scontent)}}); 
iNet.iwebos.ui.mail.FilterClauseUnitPanel=Ext.extend(Ext.Panel,{initComponent:function(){var c=new Ext.data.SimpleStore({fields:["text","value"],data:[[iwebos.message.mail.filter_object_sender,"SENDER"],[iwebos.message.mail.filter_object_recipient,"RECIPIENTS"],[iwebos.message.mail.filter_object_subject,"SUBJECT"],[iwebos.message.mail.filter_object_date_sent,"DATE_SENT"],[iwebos.message.mail.filter_object_date_received,"DATE_RECEIVED"],[iwebos.message.mail.filter_object_all,"ALL"]]});var d=new Ext.data.SimpleStore({fields:["text","value"],data:[[iwebos.message.mail.filter_operator_contain,"CONTAINS"],[iwebos.message.mail.filter_operator_does_not_contain,"DOES_NOT_CONTAIN"],[iwebos.message.mail.filter_operator_is,"IS"],[iwebos.message.mail.filter_operator_is_not,"IS_NOT"],[iwebos.message.mail.filter_operator_start_with,"STARTS_WITH"],[iwebos.message.mail.filter_operator_does_not_start_with,"DOES_NOT_START_WITH"],[iwebos.message.mail.filter_operator_end_with,"ENDS_WITH"],[iwebos.message.mail.filter_operator_does_not_end_with,"DOES_NOT_END_WITH"]]});this.__objectCombo=new Ext.form.ComboBox({xtype:"combo",border:false,anchor:"100%",store:c,mode:"local",displayField:"text",valueField:"value",value:"SENDER",forceSelection:true,selectOnFocus:true,triggerAction:"all",readOnly:true,hideLabel:true});this.__operatorCombo=new Ext.form.ComboBox({xtype:"combo",border:false,anchor:"100%",store:d,mode:"local",displayField:"text",valueField:"value",value:"CONTAINS",forceSelection:true,selectOnFocus:true,triggerAction:"all",readOnly:true,hideLabel:true});this.__txtData=new Ext.form.TextField({xtype:"textfield",border:false,anchor:"95%",hideLabel:true});this.__cmdRemove=new Ext.Button({xtype:"button",border:false,iconCls:"icon-email-filter-remove",text:iwebos.message.mail.filter_remove,handler:this.remove.createDelegate(this)});var b=new Ext.Panel({layout:"column",border:false,anchor:"100%",columnWidth:1,items:[{columnWidth:0.25,border:false,anchor:"100%",bodyStyle:"padding:10px 5px;",items:[{layout:"form",border:false,anchor:"100%",items:[this.__objectCombo]}]},{columnWidth:0.25,border:false,anchor:"100%",bodyStyle:"padding:10px 5px;",items:[{layout:"form",border:false,anchor:"100%",items:[this.__operatorCombo]}]},{columnWidth:0.33,border:false,anchor:"100%",bodyStyle:"padding:10px 5px;",items:[{layout:"form",border:false,anchor:"100%",items:[this.__txtData]}]},{columnWidth:0.17,border:false,anchor:"100%",bodyStyle:"padding:10px 5px;",items:[{layout:"form",border:false,anchor:"100%",items:[this.__cmdRemove]}]}]});var a=[b];this.items=a;iNet.iwebos.ui.mail.FilterClauseUnitPanel.superclass.initComponent.call(this)},remove:function(){var a=this.actionRemove;if(!a.scope){a.fn(__owner.cardId)}else{a.fn.apply(a.scope,[this])}},getData:function(){var a={};a.object=this.__objectCombo.getValue();a.operator=this.__operatorCombo.getValue();a.data=this.__txtData.getValue();return a},setEnableRemove:function(a){this.__cmdRemove.setDisabled(!a)},setData:function(a){var b=a||{};this.__objectCombo.setValue(b.object);this.__operatorCombo.setValue(b.operator);this.__txtData.setValue(b.data)}}); 
Ext.namespace("Ext.ux");Ext.ux.BoxSelect=Ext.extend(Ext.form.ComboBox,{growMin:20,growMax:60,growAppend:"&#160;\n&#160;",growPad:0,grow:true,enterIsSpecial:false,hideTrigger:true,firstValue:"",preventScrollbars:false,initComponent:function(){Ext.apply(this,{current:false,options:{className:"bit",separator:","}});Ext.ux.BoxSelect.superclass.initComponent.call(this)},initEvents:function(){Ext.form.ComboBox.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{up:function(a){this.inKeyMode=true;this.selectPrev()},esc:function(a){this.collapse()},tab:function(a){this.onViewClick(false);return true},scope:this,doRelay:function(c,b,a){if(a=="down"||this.scope.isExpanded()){return Ext.KeyNav.prototype.doRelay.apply(this,arguments)}return true},forceKeyDown:true});this.queryDelay=Math.max(this.queryDelay||10,this.mode=="local"?10:250);this.dqTask=new Ext.util.DelayedTask(this.initQuery,this);if(this.typeAhead){this.taTask=new Ext.util.DelayedTask(this.onTypeAhead,this)}if(this.editable!==false){this.el.on("keyup",this.onKeyUp,this);this.el.on("keypress",this.onKeyPress,this)}if(this.forceSelection){this.on("blur",this.doForce,this)}},onRender:function(b,a){if(!this.el){this.defaultAutoCreate={tag:"textarea",style:"width:100px;height:20px;",autocomplete:"off"}}Ext.ux.BoxSelect.superclass.onRender.call(this,b,a);if(this.grow){this.textSizeEl=Ext.DomHelper.append(document.body,{tag:"pre",cls:"x-form-grow-sizer"});if(this.preventScrollbars){this.el.setStyle("overflow","hidden")}this.el.setHeight(this.growMin+2)}},afterRender:function(){Ext.app.SearchField.superclass.afterRender.call(this);if(Ext.isIE){this.el.setStyle("top","1px");if(this.firstValue!=undefined&&this.firstValue!=""){if(this.emptyText&&this.el&&v!==undefined&&v!==null&&v!==""){this.el.removeClass(this.emptyClass)}this.setRawValue(this.firstValue);this.autoSize()}}this.firstValue=undefined},onSelect:function(c,d){this.collapse();var f=this.getRawValue();f=f.replace(/;/g,",");var b=f.lastIndexOf(",");var a="";if(b>0){a=f.substring(0,b+1)+" "}var e=c.data.text;e=e.replace("&lt;","<");e=e.replace("&gt;",">");this.setValue(a+e+", ")},getValue:function(){return this.getRawValue()},setValue:function(a){if(this.emptyText&&this.el&&v!==undefined&&v!==null&&v!==""){this.el.removeClass(this.emptyClass)}if(Ext.isIE&&this.firstValue==""){this.firstValue=a;return}this.setRawValue(a);this.autoSize()},onKeyPress:function(a){if(a.getKey()==a.ENTER){if(!this.isExpanded()){a.stopEvent()}}},onKeyUp:function(a){if(!a.isNavKeyPress()){this.autoSize()}else{if(a.getKey()==a.DOWN){if(!this.isExpanded()){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}}else{if(a.getKey()==a.ENTER){if(!this.isExpanded()){return}else{this.onViewClick();this.delayedCheck=true;this.unsetDelayCheck.defer(10,this)}}}}if(this.editable!==false&&!a.isSpecialKey()){this.lastKey=a.getKey();this.dqTask.delay(this.queryDelay)}},autoSize:function(){Ext.ux.BoxSelect.superclass.autoSize.call();if(!this.grow||!this.textSizeEl){return}var c=this.el;var a=c.dom.value;var d=this.textSizeEl;d.innerHTML="";d.appendChild(document.createTextNode(a));a=d.innerHTML;Ext.fly(d).setWidth(this.el.getWidth(),true);if(a.length<1){a="&#160;&#160;"}else{if(Ext.isIE){a=a.replace(/\n/g,"<p>&#160;</p>")}a+=this.growAppend}d.innerHTML=a;var b=this.lastHeight;if(Ext.isIE){if(d.offsetHeight<40){b=23}else{if(d.offsetHeight>40&&d.offsetHeight<50){b=40}else{if(d.offsetHeight>70){b=60}}}}else{if(d.offsetHeight<50){b=23}else{if(d.offsetHeight>50&&d.offsetHeight<65){b=40}else{if(d.offsetHeight>70){b=60}}}}if(b!=this.lastHeight){var e=b-this.lastHeight;this.lastHeight=b;this.el.setHeight(b);if(this.firstTime){this.fireEvent("autosize",this,b,e)}else{this.firstTime=true}}},doQuery:function(c,b){if(c===undefined||c===null){c=""}var d=function(g){if(g==""){return g}g=g.replace(/;/g,",");var e=g.lastIndexOf(",");if(e>0){var f=g.substring(e+1,g.length);if(f.length>0){return f}else{return""}}else{return g}};var a={query:d(c),forceAll:b,combo:this,cancel:false};if(this.fireEvent("beforequery",a)===false||a.cancel){return false}c=a.query.trim();b=a.forceAll;if(b===true||(c.length>=this.minChars)){if(this.lastQuery!==c){this.lastQuery=c;if(this.mode=="local"){this.selectedIndex=-1;if(b){this.store.clearFilter()}else{if(c.length>0){this.store.filter(this.displayField,c,true)}else{this.store.filter(this.displayField,"#$%&*",true)}}this.onLoad()}else{this.store.baseParams[this.queryParam]=c;this.store.load({params:this.getParams(c)});this.expand()}}else{this.selectedIndex=-1;this.onLoad()}}},loadData:function(a){if(Ext.isArray(a)){if(Ext.isArray(a[0])){this.store=new Ext.data.SimpleStore({fields:["value","text"],data:a});this.valueField="value"}else{this.store=new Ext.data.SimpleStore({fields:["text"],data:a,expandData:true});this.valueField="text"}this.displayField="text"}}});Ext.reg("boxselect",Ext.ux.BoxSelect); 
function removeAttach(f){var e=Ext.getCmp("mail-compose");if(!e){return}var a=e.store;var c=[];var d={};if(!!a){for(var b=0;b<a.length;b++){d=a[b];if(!!d){if(a[b].fkey!==f){c[c.length]=a[b]}}}}e.store=c;e._showListAttach()}iNet.iwebos.ui.mail.MailCompose=function(c,v){this.viewer=c;Ext.apply(this,v);var g=0;this.store=[];this.ieLoad=false;var s=v||{};var m=s.prefix||"iwebos";delete s.prefix;this.subjectId=m+"-mail-comp-subject-id";this.toId=m+"-mail-comp-to-id";this.ccId=m+"-mail-comp-cc-id";this.bccId=m+"-mail-comp-bcc-id";this.bccPanelId=m+"mail-comp-bcc-panel-id";this.contentId=m+"-mail-comp-content-id";this.attachId=m+"-mail-attach-panel-id";this.topPanelId=m+"-mail-top-panel-id";this.signId=m+"-mail-sign-id";this.priorityId=m+"-mail-priority-id";this.btShowBccId=m+"-mail-visible-bcc-button";this.__toStore=[];this.__ccStore=[];this.__bccStore=[];this.__fullAddressPattern=/((?:<)([^ @<,>!#$%&*]+@[^ @<,>!#$%&*]+)(?:>))/;this.__addressPattern=/(^\s*[^ @<,>!#$%&*]+@[^ @<,>!#$%&*]+)/;var x=new Ext.data.SimpleStore({fields:["value","text"],data:[["HIGH",iwebos.message.mail.priority_high],["NORMAL",iwebos.message.mail.priority_normal],["LOW",iwebos.message.mail.priority_low]]});var u=new Ext.data.SimpleStore({fields:["recipient"],sortInfo:{field:"recipient",direction:"ASC"}});var w=new Ext.form.FormPanel({region:"center",labelAlign:"left",collapsible:false,anchor:"100%",bodyStyle:"padding: 2px;",autoHeight:true,border:true,width:"100%",items:[{layout:"form",anchor:"100%",border:false,items:[{layout:"form",anchor:"100%",border:false,items:[{layout:"column",bodyStyle:"padding:4px 4px 0px",anchor:"100%",border:false,columnWidth:1,items:[{width:80,border:false,items:[{xtype:"button",minWidth:75,text:iwebos.message.mail.compose_to,handler:this.__chMoreMail.createDelegate(this)}]},{columnWidth:1,layout:"form",border:false,anchor:"100%",items:[{id:this.toId,tabIndex:150,xtype:"boxselect",resizable:true,hideLabel:true,anchor:"100%",store:u,mode:"local",displayField:"text",displayFieldTpl:"text",tpl:'<tpl for="."><div class="x-combo-list-item">{text}</div></tpl>',valueField:"recipient"}]}]}]},{layout:"form",anchor:"100%",border:false,items:[{layout:"column",bodyStyle:"padding:4px 4px 0px",anchor:"100%",border:false,items:[{width:80,layout:"form",border:false,items:[{xtype:"button",minWidth:75,text:iwebos.message.mail.compose_cc,handler:this.__chMoreMail.createDelegate(this)}]},{columnWidth:1,layout:"form",border:false,anchor:"100%",items:[{id:this.ccId,tabIndex:151,xtype:"boxselect",resizable:true,hideLabel:true,anchor:"100%",store:u,mode:"local",displayField:"text",displayFieldTpl:"text",tpl:'<tpl for="."><div class="x-combo-list-item">{text}</div></tpl>',valueField:"recipient"}]}]}]},{id:this.bccPanelId,layout:"form",anchor:"100%",border:false,height:0,items:[{layout:"column",bodyStyle:"padding:4px 4px 0px",anchor:"100%",border:false,items:[{width:80,layout:"form",border:false,items:[{xtype:"button",minWidth:75,text:iwebos.message.mail.compose_bcc,handler:this.__chMoreMail.createDelegate(this)}]},{columnWidth:1,layout:"form",border:false,anchor:"100%",items:[{id:this.bccId,xtype:"boxselect",resizable:true,hideLabel:true,anchor:"100%",store:u,mode:"local",displayField:"text",displayFieldTpl:"text",tpl:'<tpl for="."><div class="x-combo-list-item">{text}</div></tpl>',valueField:"recipient"}]}]}]},{layout:"form",anchor:"100%",border:false,items:[{layout:"column",bodyStyle:"padding:4px 4px 0px",anchor:"100%",border:false,items:[{width:80,layout:"form",border:false,items:[{xtype:"button",minWidth:75,text:iwebos.message.mail.compose_subject}]},{columnWidth:0.7,layout:"form",anchor:"100%",border:false,items:[{id:this.subjectId,tabIndex:153,hideLabel:true,xtype:"textfield",anchor:"98%"}]},{columnWidth:0.3,layout:"form",anchor:"100%",border:false,labelWidth:50,items:[{id:this.priorityId,xtype:"combo",fieldLabel:iwebos.message.mail.priority,triggerAction:"all",mode:"local",readOnly:true,displayField:"text",valueField:"value",value:"NORMAL",store:x,selectOnFocus:true,forceSelection:true,border:false,anchor:"100%"}]}]}]},{id:this.attachId,layout:"fit",height:70,autoScroll:true,bodyStyle:"padding:5px 5px 5px 5px",border:false}]}]});var q=new Ext.form.FormPanel({region:"center",labelAlign:"left",collapsible:false,anchor:"100%",bodyStyle:"padding: 0px;",renderHidden:true,autoHeight:true,border:false,width:"100%",items:[{layout:"fit",border:false,anchor:"100%",bodyStyle:"padding:5px 5px 5px 5px",items:[{id:this.contentId,tabIndex:154,xtype:"htmleditor",enableColors:true,enableAlignments:true,enableSourceEdit:true,enableFontSize:true,plugins:[new iNet.iwebos.ui.common.form.HtmlEditorPlugins.Table()],onFirstFocus:function(){this.activated=true;this.tb.items.each(function(C){C.enable()});var y=this.getValue();if(y==="&nbsp;"||y===""){this.setValue("")}if(Ext.isGecko){try{this.win.focus();var z=this.win.getSelection();if(!z.focusNode||z.focusNode.nodeType!=3){var A=z.getRangeAt(0);A.selectNodeContents(this.getEditorBody());A.collapse(true);this.deferFocus()}}catch(B){}try{this.execCmd("useCSS",true);this.execCmd("styleWithCSS",false)}catch(B){}}this.fireEvent("activate",this)}}]}]});var j={xtype:"button",iconCls:"icon-email-sendmail",text:iwebos.message.mail.mail_send_tip,tooltip:iwebos.message.mail.mail_send_tip,handler:this._sendEmail,scope:this};var a={xtype:"button",iconCls:"icon-email-attachment-button",text:iwebos.message.mail.mail_attachment,tooltip:iwebos.message.mail.mail_attachment_tip,handler:this._attachFile,scope:this};var l={xtype:"button",id:this.chSaveDraftId,iconCls:"icon-email-save-draft",text:iwebos.message.mail.mail_save_draf,tooltip:iwebos.message.mail.mail_save_draf_tip,handler:this._saveEmail,scope:this};var k=Ext.data.Record.create([{name:"id",mapping:"id",type:"string"},{name:"smtpAccount",mapping:"smtpAccount",type:"string"}]);var h=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"id"},k);var t=new iNet.iwebos.ui.common.store.WebOSSimpleStore({reader:h});var p=Ext.data.Record.create([{name:"name",mapping:"name",type:"string"},{name:"content",mapping:"content",type:"string"}]);var n=new Ext.data.JsonReader({totalProperty:"results",root:"rows",id:"name"},p);var f=new iNet.iwebos.ui.common.store.WebOSSimpleStore({reader:n});this.signCombo=new Ext.form.ComboBox({triggerAction:"all",mode:"local",store:f,displayField:"name",valueField:"content",typeAhead:true,selectOnFocus:true,forceSelection:true,border:false,readOnly:true,anchor:"95%"});this.comboSmtp=new Ext.form.ComboBox({triggerAction:"all",mode:"local",displayField:"id",valueField:"smtpAccount",store:t,selectOnFocus:true,forceSelection:true,border:false,readOnly:true,anchor:"95%"});var o={id:this.btShowBccId,xtype:"button",text:iwebos.message.mail.show_bcc,tooltip:iwebos.message.mail.show_bcc_tip,handler:this._visibleBcc,scope:this};var r={xtype:"label",text:iwebos.message.mail.account+":"};var i={xtype:"label",text:iwebos.message.mail.signature_name+":"};var b="->";if(Ext.isGecko2){b="-"}else{b="->"}var e=[j,"-",r,this.comboSmtp,"-",l,"-",a,"-",o,b,i,this.signCombo];var d=new Ext.Panel({id:this.topPanelId,region:"north",anchor:"100%",border:false,width:"100%",height:95,items:[w]});this.main=new Ext.Panel({layout:"border",region:"center",frame:true,border:false,items:[d,q]});this.signCombo.on("beforeSelect",this._changeSignature.createDelegate(this),{scope:this});iNet.iwebos.ui.mail.MailCompose.superclass.constructor.call(this,{id:"mail-compose",iconCls:"icon-email-composer",title:iwebos.message.mail.title_mailcompose,closable:true,frame:false,border:false,layout:"border",tbar:e,items:[this.main]});this.on("resize",this._onResize,this);this.on("close",function(y){this.__owner.close=true},{scope:this});this.on("render",function(y){var B=Ext.getCmp("main-tabs");var A=B.getRecipients();var z=this.topPanelId;var D=function(E){Ext.getCmp(E).on("autosize",function(G,H,J){var I=Ext.getCmp(z);var F=I.getSize().height;I.setHeight(F+J);Ext.EventManager.fireWindowResize()},this)};D(this.toId);D(this.ccId);Ext.getCmp(this.bccId).on("autosize",function(F,G,J){var H=Ext.getCmp(z);var E=H.getSize().height;H.setHeight(E+J);var I=Ext.getCmp(this.bccPanelId).getInnerHeight();Ext.getCmp(this.bccPanelId).setHeight(I+J);Ext.EventManager.fireWindowResize()},this);if(A!=null&&A!=undefined){Ext.getCmp(this.toId).loadData(A);Ext.getCmp(this.ccId).loadData(A);Ext.getCmp(this.bccId).loadData(A)}else{var C={iwct:"recipientContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"loadRecipient",action:"loadRecipient"};iNet.Ajax.request({url:"jsonajax",params:C,scope:this,method:"POST",success:function(F,G){if(!!F){var E=Ext.util.JSON.decode(F.responseText);if(E.success==undefined){B.setRecipients(E.results);Ext.getCmp(this.toId).loadData(E.results);Ext.getCmp(this.ccId).loadData(E.results);Ext.getCmp(this.bccId).loadData(E.results)}}},failure:function(E,F){}})}},this)};Ext.extend(iNet.iwebos.ui.mail.MailCompose,Ext.Panel,{__chMoreMail:function(){var e=Ext.getCmp(this.toId);var d=Ext.getCmp(this.ccId);var c=Ext.getCmp(this.bccId);var b=this;var h=function(i,k){if(k.length>0){var l="";for(var j=0;j<k.length;j++){if(j==k.length-1){l+=k[j].name}else{l+=k[j].name+", "}}i.setValue(l)}};var f=function(){var i=this.getData();b.__toStore=i.to;h(e,i.to);b.__ccStore=i.cc;h(d,i.cc);b.__bccStore=i.bcc;h(c,i.bcc);if(i.bcc.length>0&&!b._fnHasBcc()){b._visibleBcc()}this.destroy()};var a=this._getAddressObject(this.__toStore,this.__ccStore,this.__bccStore);var g=new iNet.iwebos.ui.mail.DialogSelectContact(this,{okHandler:f,okhScope:g});g.show(this);g.loadData(a)},_getAddressObject:function(c,b,d){var a={};a.to=this._getAddress(this.toId,c);a.cc=this._getAddress(this.ccId,b);if(this._fnHasBcc()){a.bcc=this._getAddress(this.bccId,d)}else{a.bcc=[]}return a},_getAddress:function(f,h){var g=[];var c=Ext.getCmp(f);var a="";var m="";var e="";var l=c.getValue();l=l.replace(/;/g,",");var k=l.split(",");for(var d=0;d<k.length;d++){e=k[d].trim();if(e===""){continue}m=e;var i=e.match(this.__addressPattern);if(i==null){i=e.match(this.__fullAddressPattern)}if(i==null){continue}a=i[0];for(var b=0;b<h.length;b++){if(h[b].id==a){m=h[b].name;break}}if(a!==""){g[d]={id:a,name:m}}}return g},_onResize:function(e,f,a,d,c){Ext.EventManager.fireWindowResize();if(!Ext.isIE){var b=Ext.getCmp(this.topPanelId);var g=b.getInnerHeight();var b=Ext.getCmp(this.contentId);b.setHeight(this.getSize().height-g-50)}else{var b=Ext.getCmp(this.topPanelId);var g=0;if(!this.ieLoad){g=95;this.ieLoad=true}else{g=b.getSize().height}var b=Ext.getCmp(this.contentId);b.setHeight(this.getSize().height-g-50)}},setData:function(a){this.setHeaderId(a.hid);var h=Ext.getCmp(this.toId);if(a.to!=undefined){h.setValue(a.to)}else{h.setValue("")}var b=Ext.getCmp(this.ccId);if(a.cc!=undefined){b.setValue(a.cc)}else{b.setValue("")}var c=Ext.getCmp(this.bccId);if(a.bcc!=undefined&&a.bcc!==""){if(!this._fnHasBcc()){this._visibleBcc()}c.setValue(a.bcc)}else{if(this._fnHasBcc()){this._visibleBcc()}c.setValue("")}var g=Ext.getCmp(this.subjectId);g.setValue(a.subject);var f=Ext.getCmp(this.priorityId);f.setValue(a.priority);var e=a.attachments;if(!!e){for(var d=0;d<e.length;d++){e[d].hid=a.hid}}this.store=(e==undefined)?[]:e;this._showListAttach();var j=Ext.getCmp(this.contentId);j.setValue(a.body)},clearData:function(){this.setHeaderId(0);var a=Ext.getCmp(this.toId);a.setValue("");a=Ext.getCmp(this.ccId);a.setValue("");a=Ext.getCmp(this.bccId);a.setValue("");a=Ext.getCmp(this.subjectId);a.setValue("");this.store=[];this._showListAttach();a=Ext.getCmp(this.contentId);a.setValue("")},loadInfo:function(a,b){this._loadSmtp();if(a==0){return}var c={iwct:"mailComposerContent",iwm:"MAIL",iwa:b,action:b};if(b==="draft"){c.iwc="READ_ONLY";c.iwct="loadMailComposerContent"}else{c.iwc="READ_WRITE"}c.hid=a;iNet.Ajax.request({url:"jsonajax",params:c,scope:this,method:"POST",success:function(d,e){var f=Ext.util.JSON.decode(d.responseText);if(this.setData!==undefined){this.setData(f)}},failure:function(d,e){},maskEl:this.bwrap})},setToAddress:function(a){var b=Ext.getCmp(this.toId);b.setValue(a)},getData:function(){var a={};var c=Ext.getCmp(this.toId);a.to=c.getValue().replace(/;/g,",");c=Ext.getCmp(this.ccId);a.cc=c.getValue().replace(/;/g,",");if(this._fnHasBcc()){c=Ext.getCmp(this.bccId);a.bcc=c.getValue().replace(/;/g,",")}else{a.bcc=""}c=Ext.getCmp(this.subjectId);a.subject=c.getValue();c=Ext.getCmp(this.priorityId);a.priority=c.getValue();c=Ext.getCmp(this.contentId);a.body=c.getValue();var b=[];if(this.store){b=this.store}a.attachments=b;return a},validateData:function(e){if(e){var c=Ext.getCmp(this.toId);var d=c.getValue().trim();if(d.length==0){c.focus();return iwebos.message.mail.error_email_address_empty}c=Ext.getCmp(this.subjectId);var b=c.getValue().trim();if(b.length==0){c.focus();return iwebos.message.mail.error_subject_empty}}var a=this.validAddresComp(this.toId);if(a.length>0){return a}a=this.validAddresComp(this.ccId);if(a.length>0){return a}if(this._fnHasBcc()){a=this.validAddresComp(this.bccId);if(a.length>0){return a}}return""},validAddresComp:function(a){var f=Ext.getCmp(a);var g=f.getValue().trim();if(g.length==0){return""}g=g.replace(/;/g,",");var e=g.split(",");var b="";for(var c=0;c<e.length;c++){b=e[c];var d=this.checkValidation(b.trim());if(!d){f.focus(true,true);b=b.replace(/</,"&lt;");b=b.replace(/>/,"&gt;");return iwebos.message.mail.error_email_address+b+iwebos.message.mail.error_email_address_invalid}}return""},getHeaderId:function(){if(this.__headerId==undefined){this.__headerId=0}return this.__headerId},setHeaderId:function(a){this.__headerId=a},onExternalDocument:function(){if(!this.udialog){this.udialog=new Ext.ux.UploadDialog.Dialog({url:"mail-upload-file",reset_on_hide:false,allow_close_on_upload:true,upload_autostart:false,post_var_name:"upload"});this.udialog.on("uploadsuccess",this.onUploadSuccess,this)}this.udialog.show(this)},setDataAttach:function(a){if(!this.store){this.store=[]}this.store[this.store.length]=a},onUploadSuccess:function(h,a,e,f){if(e.success){var b=function(l,n){var m=l.original;var k=m.lastIndexOf("\\");if(k>0){m=m.substring(k+1,m.length)}else{k=m.lastIndexOf("/");if(k>0){m=m.substring(k+1,m.length)}}return{hid:0,icon:n,fname:m,fkey:l.file}};var i=e.files;var j="";var c=null,d=null;for(var g=0;g<i.length;g++){c=i[g];j=iNet.DocumentFormat.getExtension(c.original);d=b(c,j);this.setDataAttach(d)}this._showListAttach()}},_showListAttach:function(){var b=['<tpl if="this.isCheck(attachments)">',"<table width=100% border=0 cellspacing=0 cellpadding=0>","<tr>",'<td width=5% NOWRAP valign="top">',"<b>"+iwebos.message.mail.template_attach+": &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</b>","</td>",'<td align="left">',"<tpl for=\"attachments\"><span class={[MailService.getCssAttachment(values.icon)]}>&nbsp;&nbsp;&nbsp;&nbsp;</span><a style=\"cursor:pointer;\" onclick=\"MailService.download('{hid}','{fname}', '{fkey}','{icon}')\">{[this.formatName(values.fname)]}</a> <a onclick=\"removeAttach('{fkey}')\">["+iwebos.message.mail.remove+']{[xindex % 2 === 0 ? "<br>" : ","]}</a> </tpl>',"</td>","</tr>","</table>","</tpl>"];var f=new Ext.XTemplate(b.join(""),{isCheck:function(k){return(false==k)?"":k},formatName:function(k){return k}});var d=[];d.attachments=this.store;var h=Ext.getCmp(this.topPanelId);var e=Ext.getCmp(this.bccPanelId);var j=e.getInnerHeight();var c=(j>0?125:95);if(this.store!=null&&this.store.length>0){var a=this.store.length;var i=1;i=Math.round(a/2);if(i>3){i=3}c=c+i*25;if(Math.round(a/2)==2){c=c-10}if(Math.round(a/2)==3){c=c-20}if(Math.round(a/2)==4){c=c-10}h.setHeight(c)}else{h.setHeight(c)}this._onResize();var g=Ext.getCmp(this.attachId);f.overwrite(g.body,d)},checkValidation:function(b){if(b==""){return true}var a=false;a=this.__fullAddressPattern.test(b);if(a){return a}a=this.__addressPattern.test(b);return a},_noAtSign:function(a){if(a.indexOf("@",0)==-1){return(true)}else{return(false)}},_nothingBeforeAt:function(a){if(a.indexOf("@",0)<1){return(true)}else{return(false)}},_noLeftBracket:function(a){if(a.indexOf("[",0)==-1&&a.charAt(a.length-1)=="]"){return(true)}else{return(false)}},_noRightBracket:function(a){if(a.indexOf("[",0)>-1&&a.charAt(a.length-1)!="]"){return(true)}else{return(false)}},_noValidPeriod:function(a){if(a.indexOf("@",0)>1&&a.charAt(a.length-1)=="]"){return(false)}if(a.indexOf(".",0)==-1){return(true)}return(false)},_noValidSuffix:function(b){if(b.indexOf("@",0)>1&&b.charAt(b.length-1)=="]"){return(false)}var a=b.length;var c=b.lastIndexOf(".",a-1)+1;if((a-c)<2||(a-c)>3){return(true)}else{return(false)}},_sendEmail:function(){var f=this.validateData(true);if(f.length>0){MailService.showError(f);return}var a={iwct:"mailComposerContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"send",action:"send"};var h=this.getData();var d=this.comboSmtp.getValue();if(d==""){MailService.showError(iwebos.message.mail.error_smtp);return}var e=Ext.getCmp("main-tabs");var b=e.fetchInfo.accounts;var i=false;if(b.length>0){for(var c=0;c<b.length;c++){var j=b[c];if(j.smtpAccount==d){if(j.pass){i=true;break}else{this._updatePassword(e,c)}}}}else{MailService.showError(iwebos.message.mail.error_smtp)}if(!i){return}h.smtpAccount=d;var g=this.comboSmtp.store;h.from=this._getEmailAddress(g,d);h.newRecipients=this.analyticAddress(h);a.hid=this.getHeaderId();a.object=Ext.util.JSON.encode(h);iNet.Ajax.request({url:"jsonajax",params:a,scope:this,method:"POST",success:function(k,m){this._removeEmail(this.getHeaderId());var l=Ext.getCmp("main-tabs");l.remove(this)},failure:function(k,l){},maskEl:this.bwrap})},analyticAddress:function(f){var d=this._getAddressObject(this.__toStore,this.__ccStore,this.__bccStore);var e=Ext.getCmp("main-tabs").getRecipients()||[];var c=[];var a=function(l){for(var k=0;k<l.length;k++){var g=l[k].name;g=g.replace("<","&lt;");g=g.replace(">","&gt;");var h=0;for(h=0;h<e.length;h++){if(g==e[h]){break}}if(h==e.length){c.push(l[k].name)}}};a(d.to);a(d.cc);a(d.bcc);for(var b=0;b<c.length;b++){e.push(c[b])}return c.join(",")},_attachFile:function(){this.onExternalDocument()},_visibleBcc:function(){var f=Ext.getCmp(this.bccPanelId);var e=Ext.getCmp(this.topPanelId);var c=f.getInnerHeight();var d=Ext.getCmp(this.bccId);var b=e.getInnerHeight();var a=Ext.getCmp(this.btShowBccId);if(c===0){e.setHeight(b+d.getSize().height+5);f.setHeight(d.getSize().height+5);a.setText(iwebos.message.mail.hide_bcc);try{d.el.dom.setAttribute("tabIndex",152)}catch(g){}}else{e.setHeight(b-f.getSize().height);f.setHeight(0);a.setText(iwebos.message.mail.show_bcc);try{d.el.dom.setAttribute("tabIndex","")}catch(g){}}this._onResize();Ext.EventManager.fireWindowResize()},_saveEmail:function(){var d=this.validateData(false);if(d.length>0){MailService.showError(d);return}var c={iwct:"mailComposerContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"save",action:"save"};var e=this.getData();var a=this.comboSmtp.getValue();if(a==""){MailService.showError(iwebos.message.mail.error_smtp);return}e.smtpAccount=a;var b=this.comboSmtp.store;e.from=this._getEmailAddress(b,a);c.hid=this.getHeaderId();c.object=Ext.util.JSON.encode(e);iNet.Ajax.request({url:"jsonajax",params:c,scope:this,method:"POST",success:function(g,i){var f=Ext.util.JSON.decode(g.responseText);if(this.setHeaderId!==undefined){this.setHeaderId(f.hid);var k=f.attachments;for(var h=0;h<k.length;h++){k[h].hid=f.hid}this.store=k;this._showListAttach()}},failure:function(f,g){},maskEl:this.bwrap})},_loadSmtp:function(){var __baseParams={iwct:"loadMailConfigureContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"load",action:"load",mode:"smtp"};iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:this,method:"POST",success:function(result,request){if(result==undefined||result===""){return}var __data=result.responseText;__data=eval("("+__data+")");var __success=(__data.success==undefined);if(__success){this.setSmtpAccount(__data.smtps,__data.smtp);this.setSignature(__data.signs)}else{MailService.showError(iwebos.message.mail.error_smtp)}},failure:function(result,request){}})},_getEmailAddress:function(c,d){if(c.getCount()>0){var a={};for(var b=0;b<c.getCount();b++){a=c.getAt(b).data;if(a.smtpAccount==d){return a.id}}}return""},_changeSignature:function(c,a,b){this._addSignature(a.data.content)},_addSignature:function(b){var e=Ext.getCmp(this.contentId);var h=e.getValue();var a="<!--Start Signature-->";var g="<!--End Signature-->";var i=h.lastIndexOf(a);var d=h.lastIndexOf(g);if(i<=0||d<=0){h=h+"<br/><br/><br/>"+a+b+g;e.setValue(h)}else{if(i>0||d>0){var f=h.substring(0,i);var c=h.substring(d,h.length);e.setValue(f+a+b+c)}}},_removeEmail:function(e){var d=Ext.getCmp("email-message-grid-id");if(!d){return}var a=d.store;if(a.getCount()>0){var c;for(var b=0;b<a.getCount();b++){c=a.getAt(b);if(c.data.id==e){a.remove(c);return}}}},_updatePassword:function(mainTab,index){var __panel=this;var __fetchInfo=mainTab.fetchInfo;var __okHandler=function(){var __password=this.getPassword();if(__password==""){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.error_empty_password,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var __param={iwct:"mailConfigureContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"updatePW",action:"updatePW"};var __data={address:__fetchInfo.accounts[index].address,pass:__password};__param.object=Ext.util.JSON.encode(__data);iNet.Ajax.request({url:"jsonajax",params:__param,scope:__panel,method:"POST",success:function(response,options){if(!!response){var __result=eval("("+response.responseText+")");if(__result.success){mainTab.fetchInfo.accounts[index].pass=true;mainTab.config.smtpAccount.smtps[index].pass=true;__panel._sendEmail()}}},failure:function(response,options){}});this.destroy()};var __dlg=new iNet.iwebos.ui.mail.DialogEnterPassword(this,{address:__fetchInfo.accounts[index].address,okhScope:__dlg,okHandler:__okHandler,cancelHandler:function(){this.destroy()}});__dlg.show(this)},setSmtpAccount:function(d,e){var c=d||[];var b=this.comboSmtp.store;b.removeAll();if(c.length>0){for(var a=0;a<c.length;a++){b.add(new Ext.data.Record({id:c[a].address,smtpAccount:c[a].smtpAccount}))}this.comboSmtp.setValue(e)}else{this.comboSmtp.setValue("")}},setSignature:function(b){var a=b||[];var d=this.signCombo.store;d.removeAll();if(a.length>0){for(var c=0;c<a.length;c++){var e=a[c];d.add(new Ext.data.Record({name:e.name,content:e.content}));if(e.used=="Y"){this.signCombo.setValue(e.content)}}}else{this.signCombo.setValue("")}},_fnHasBcc:function(){var b=Ext.getCmp(this.bccPanelId);var a=b.getInnerHeight();return(a>0)}}); 
iNet.iwebos.ui.mail.MailFollowUpPanel=function(b){var a={title:iwebos.message.mail.follow_up_make_work,url:"jsonajax",baseParams:{iwct:"loadFollowUpContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"load",action:"load"},autoScroll:true,collapsible:true,titleCollapse:true,frame:false,border:true,collapsed:true,split:true,collapseFirst:true,width:230,minSize:230};this.operator=b.operator||{};Ext.apply(this.operator,{save:{fn:this._fnSave,scope:this},update:{fn:this._fnUpdate,scope:this},remove:{fn:this._fnDelete,scope:this}});var c=b||{};Ext.apply(c,a);iNet.iwebos.ui.mail.MailFollowUpPanel.superclass.constructor.call(this,c)};Ext.extend(iNet.iwebos.ui.mail.MailFollowUpPanel,iNet.iwebos.ui.common.control.FollowUpPanel,{save:function(d,f){var c=d||[];var a=this._getDate(f);var e=[];var g=[];for(var b=0;b<d.length;b++){var i=c[b];var h=this._findByData(i.data);if(h==null){i.date=a;i.fdate=iNet.INET_DATE_FORMAT;i.type=this.type;e[e.length]=i}else{var j=i.name||h.data.name;i=h.data;i.date=a;i.name=j;i.fdate=iNet.INET_DATE_FORMAT;g[g.length]=i}}if(e.length>0){this._savedb(e)}if(g.length>0){this._updatedb(g,f)}},_fnRequestSuccess:function(a,b){var d=null;try{d=Ext.util.JSON.decode(a.responseText)}catch(c){}var e=(d==null||d.success==undefined)?true:d.success;if(e){if(b.params.action==="delete"){d=Ext.util.JSON.decode(b.params.data)}this.fireEvent("dbevent",b.params.action,e,d)}else{var f=iwebos.message.followup.none_saved;if(b.params.action==="update"){f=iwebos.message.followup.none_updated}else{if(b.params.action==="remove"){f=iwebos.message.followup.none_deleted}}this.fireEvent("dbevent",b.params.action,false,Ext.util.JSON.decode(b.params.data));Ext.MessageBox.show({title:iwebos.message.paperwork.ed.error,msg:f,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},_fnSave:function(a){var b={iwct:"followUpContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"save"};b.action="save";b.object=Ext.util.JSON.encode(a);iNet.Ajax.request({url:"jsonajax",success:this._fnRequestSuccess,failure:function(c,d){},scope:this,method:"POST",params:b,maskEl:this.bwrap})},_fnUpdate:function(d,c){var e={iwct:"followUpContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"update"};e.action="update";var b=[];if(d!==undefined){for(var a=0;a<d.length;a++){b.push(d[a].id)}}else{return}e.date=this._getDate(c);e.fdate=iNet.INET_DATE_FORMAT;e.ids=b.join(";");iNet.Ajax.request({url:"jsonajax",success:this._fnRequestSuccess,failure:function(f,g){},scope:this,method:"POST",params:e,maskEl:this.bwrap})},_fnDelete:function(a){var b={iwct:"followUpContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"delete"};b.action="delete";b.ids=a.join(";");b.data=Ext.util.JSON.encode(a);iNet.Ajax.request({url:"jsonajax",success:this._fnRequestSuccess,failure:function(c,d){},scope:this,method:"POST",params:b,maskEl:this.bwrap})},updateFlag:function(c,a){var b=this._findByData(c);if(b!=null){b.data.flag=a;b.commit()}}}); 
function loadPrintPage(){window.open("print.html","Print","toolbar=no,location=no,directories=no,status=yes,menubar=yes,scrollbars=yes,copyhistory=yes,resizable=yes")}function showHeaderMailReader(e){var a=document.getElementById("mail-head-down-reader");var c=document.getElementById("header-mail-show-reader");var b='<div class="mail-head-down-reader" onclick="showHeaderMailReader(false);"></div>';var d='<div class="mail-head-right-reader" onclick="showHeaderMailReader(true);"></div>';a.innerHTML=(true==e)?b:d;c.style.display=(true==e)?"":"none";Ext.EventManager.fireWindowResize()}iNet.iwebos.ui.mail.MailReader=function(b,a){this.viewer=b;Ext.apply(this,a);this.__id=0;this.mailToolbar=new iNet.iwebos.ui.mail.Toolbar({prefix:"iwebos-mail-reader-",region:"north",width:"100%",height:27,frame:false,showmybutton:true,border:false});this.itemTplHeaderMarkup=["<table width=100% border=0 cellspacing=0 cellpadding=0 >","<tr>",'<td width="16">&nbsp;</td>','<td width="84" align="right" class="mail-subject-content" >&nbsp;'+iwebos.message.mail.subject+": &nbsp;</td>",'<td class="mail-subject-content" colspan="3" >{subject}</td>',"</tr>","<tr>",'<td width="16" align="left" valign="top"><div id="mail-head-down-reader"><div class="mail-head-down-reader" onclick="showHeaderMailReader(false);"></div></div></td>','<td align="right" valign="top" width="84">&nbsp;<b>'+iwebos.message.mail.grid_sender+": &nbsp;</b> </td>",'<td valign="top">{from}<br /></td>','<td valign="top" align="right">&nbsp;<b>'+iwebos.message.mail.grid_sent+": &nbsp;</b> </td>",'<td valign="top" width="15%" align="right">{[this.format(values.sent)]}</td>',"</tr>","</table>",'<table width=100% border=0 cellspacing=0 cellpadding=0 id="header-mail-show-reader" style="display: ;">','<tpl if="this.isCheck(to)">',"<tr>",'<td width="100" align="right" valign="top">&nbsp;<b>'+iwebos.message.mail.template_mailto+": &nbsp;</b> </td>",'<td valign="top"><tpl for="to"><a onclick="">{[this.formatAddress(values.name,values.address)]},</a> </tpl></td>',"</tr>","</tpl>",'<tpl if="this.isCheck(cc)">',"<tr>",'<td align="right" valign="top">',"<b>CC: &nbsp;</b>","</td>",'<td valign="top">','<tpl for="cc">{[this.formatAddress(values.name,values.address)]}, </tpl>',"</td>","</tr>","</tpl>",'<tpl if="this.isCheck(attachments)">',"<tr>",'<td width="96" align="right" valign="top" NOWRAP>','<tpl if="this.isDownloadAll(attachments)">','<a class="icon-email-download-all" style="cursor:pointer;" onclick="MailService.downloadAttach(\'{id}\', \'all\')">&nbsp;&nbsp;&nbsp;&nbsp;</a>',"</tpl>","<a onclick=\"MailService.downloadAttach('{id}', 'all')\"><b>"+iwebos.message.mail.template_attach+": &nbsp;</b></a>","</td>",'<td valign="top" colspan="3">','<tpl if="this.isEml(eml)">','<tpl for="attachments">',"<span class={[MailService.getCssAttachment(values.icon)]}>&nbsp;&nbsp;&nbsp;&nbsp;</span><a style=\"cursor:pointer;\" onclick=\"MailService.downloadEmlAttach('{parent.contentId}','{parent.emlKey}', '{fkey}', '{icon}')\">&nbsp;{fname}</a>, ","</tpl>","</tpl>",'<tpl if="this.isNotEml(eml)">','<tpl for="attachments">',"<span class={[MailService.getCssAttachment(values.icon)]}>&nbsp;&nbsp;&nbsp;&nbsp;</span><a style=\"cursor:pointer;\" onclick=\"MailService.downloadAttach('{parent.id}', '{fkey}', '{icon}')\">&nbsp;{fname}</a>, ","</tpl>","</tpl>","</td>","</tr>","</tpl>","</table>"];this.itemTplBodyMarkup=['<table width=100% border=0 cellspacing=0 cellpadding=0 bgcolor="#FFFFFF">','<tr><td valign=top style="padding:10px;font-size:15px;" id="mail-body-document">&nbsp;{body}</td></tr></table>'];this.itemTpl=new Ext.XTemplate(this.itemTplHeaderMarkup.join(""),{format:function(c){return(c==0)?"":new Date(c).format("d/m/Y")},isCheck:function(c){return(false==c)?"":c},isDownloadAll:function(c){return(c.length>1?true:false)},formatAddress:function(d,c){if(d!=""){return d+" &lt;"+c+"&gt;"}else{return c}},isEml:function(c){return !!c},isNotEml:function(c){return !c}});this.itemTpl2=new Ext.XTemplate(this.itemTplBodyMarkup.join(""),{});this.viewHeader=new Ext.Panel({id:"readPanelHeader",region:"north",autoHeight:true,frame:true,border:false});this.viewBody=new Ext.Panel({id:"readPanelBody",region:"center",frame:false,border:false,autoScroll:true});this.mainContent=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,autoScroll:true,items:[this.viewHeader,this.viewBody]});this.main=new Ext.Panel({layout:"border",region:"center",frame:false,border:false,items:[this.mailToolbar,this.mainContent]});this.mailToolbar.on("delete",this.fnDelete,this);this.mailToolbar.on("reply",this.fnReplyEmail,this);this.mailToolbar.on("replyall",this.fnReplyAllEmail,this);this.mailToolbar.on("forward",this.fnForwardEmail,this);iNet.iwebos.ui.mail.MailReader.superclass.constructor.call(this,{id:"mail-reader",title:iwebos.message.mail.view_mail,iconCls:"icon-email-read_mail",header:false,closable:true,frame:false,border:false,layout:"border",items:[this.main]})};Ext.extend(iNet.iwebos.ui.mail.MailReader,Ext.Panel,{loadInfo:function(a){if(a.eml==undefined){a.eml=false}this.__id=a.id;this.itemTpl.overwrite(this.viewHeader.body,a);this.itemTpl2.overwrite(this.viewBody.body,a);Ext.EventManager.fireWindowResize()},loadEmlInfo:function(a){a.eml=true;this.loadInfo(a)},fnDelete:function(){var b=Ext.getCmp("main-tabs");var a=b.findByData(this.__id);if(a!=null){var c=[];c[0]=a;b.fnDeleteMail(c,this)}},fnReplyEmail:function(){var a=Ext.getCmp("main-tabs");a.fnComposerMail(this.__id,"reply")},fnReplyAllEmail:function(){var a=Ext.getCmp("main-tabs");a.fnComposerMail(this.__id,"replyA")},fnForwardEmail:function(){var a=Ext.getCmp("main-tabs");a.fnComposerMail(this.__id,"forward")}}); 
Ext.app.SearchField=Ext.extend(Ext.form.TwinTriggerField,{initComponent:function(){Ext.app.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){this.onTrigger2Click()}},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",hideTrigger1:true,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.el.dom.value="";var a={start:0};this.store.baseParams=this.store.baseParams||{};this.store.baseParams[this.paramName]="";this.store.reload({params:a});this.triggers[0].hide();this.hasSearch=false}},afterRender:function(){Ext.app.SearchField.superclass.afterRender.call(this);if(Ext.isIE&&/msie 8/.test(navigator.userAgent.toLowerCase())){this.el.setStyle("top","1px")}}}); 
iNet.iwebos.ui.mail.MailSearchPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.store=this.store||{};this.__owner={field:"all"};var b=new Ext.app.SearchField({id:"mail-search-field-id",store:this.store,width:"100%",onTrigger2Click:this.search.createDelegate(this)});var a=new Ext.Panel({id:"mail-search-panel-id",height:25,layout:"column",anchor:"100%",width:"100%",items:[{width:35,items:[{width:32,iconCls:"icon-email-inbox",xtype:"button",menu:{id:"email-search",cls:"form-search-trigger",items:[{text:iwebos.message.mail.search_all,checked:true,group:"email-search-group",scope:this,iconCls:"email-icon-searchall",handler:this.searchAll.createDelegate(this)},{text:iwebos.message.mail.search_subject,checked:false,group:"email-search-group",scope:this,iconCls:"email-icon-searchsubject",handler:this.searchSubject.createDelegate(this)},{text:iwebos.message.mail.search_date,checked:false,group:"email-search-group",scope:this,iconCls:"email-icon-searchdate",handler:this.searchDate.createDelegate(this)},{text:iwebos.message.mail.search_sender,checked:false,group:"email-search-group",scope:this,iconCls:"email-icon-searchsent",handler:this.searchSender.createDelegate(this)}]}}]},{columnWidth:1,anchor:"100%",width:"100%",items:[b]}]});this.items=[a];iNet.iwebos.ui.mail.MailSearchPanel.superclass.initComponent.call(this)},search:function(){var c=[];var b=Ext.getCmp("mail-search-field-id");var a=b.getRawValue()||"";a=a.replace(/'/g,"");c.key=a;c.field=this.__owner.field;c.mode="advanced";this.fireEvent("search",c)},searchAll:function(){this.__owner.field="all"},searchSubject:function(){this.__owner.field="subject"},searchDate:function(){this.__owner.field="date"},searchSender:function(){this.__owner.field="sender"}}); 
(function(){MailService={};Ext.apply(MailService,{getCssAttachment:function(ext){var __ext=ext.toLowerCase();if(__ext=="avi"||__ext=="wmv"){return"icon-email-attach-avi"}else{if(__ext=="bmp"||__ext=="png"){return"icon-email-attach-bmp"}else{if(__ext=="doc"){return"icon-email-attach-doc"}else{if(__ext=="xls"){return"icon-email-attach-xls"}else{if(__ext=="exe"){return"icon-email-attach-exe"}else{if(__ext=="gif"){return"icon-email-attach-gif"}else{if(__ext=="html"){return"icon-email-attach-html"}else{if(__ext=="jpg"){return"icon-email-attach-jpg"}else{if(__ext=="mdb"){return"icon-email-attach-mdb"}else{if(__ext=="mp3"||__ext=="wma"){return"icon-email-attach-mp3"}else{if(__ext=="mpg"){return"icon-email-attach-mpg"}else{if(__ext=="mpp"){return"icon-email-attach-mpp"}else{if(__ext=="odb"){return"icon-email-attach-odb"}else{if(__ext=="odg"){return"icon-email-attach-odg"}else{if(__ext=="odp"){return"icon-email-attach-odp"}else{if(__ext=="ods"){return"icon-email-attach-ods"}else{if(__ext=="odt"){return"icon-email-attach-odt"}else{if(__ext=="pdf"){return"icon-email-attach-pdf"}else{if(__ext=="ppt"){return"icon-email-attach-ppt"}else{if(__ext=="rar"){return"icon-email-attach-rar"}else{if(__ext=="swf"){return"icon-email-attach-swf"}else{if(__ext=="txt"){return"icon-email-attach-txt"}else{if(__ext=="vsd"){return"icon-email-attach-vsd"}else{if(__ext=="xml"){return"icon-email-attach-xml"}else{if(__ext=="zip"||__ext=="tar"||__ext=="tar.bz2"||__ext=="tar.gz"||__ext=="tar.lzma"||__ext=="cbz"||__ext=="lzma"||__ext=="gz"){return"icon-email-attach-zip"}else{if(__ext=="eml"){return"icon-email-attach-eml"}}}}}}}}}}}}}}}}}}}}}}}}}}return"icon-email-attach-unknown"},download:function(hid,name,fkey,ext){if(hid==0){MailService.downloadReviewAttach(name,fkey)}else{MailService.downloadAttach(hid,fkey,ext)}},downloadAttach:function(contentId,fkey,ext){if(contentId==0){return}var __ext=ext||"";__ext=__ext.toLowerCase();if(__ext=="eml"){MailService.openEml(contentId,fkey)}else{var __form=document.getElementById("viewdownloadAttach_");__form.action="mail-download-file";__form.contentId.value=contentId;__form.fkey.value=unescape(fkey);__form.style.value="";__form.target="";__form.type.value="ORIGINAL";__form.bean.value="mailBean";__form.submit()}},downloadReviewAttach:function(name,fkey){var __form=document.getElementById("viewdownload_");__form.action="mail-download-file";__form.name.value=unescape(name);__form.code.value=unescape(fkey);__form.bean.value="mailReviewBean";__form.submit()},downloadEmlAttach:function(contentId,eml,fkey,ext){var __form=document.getElementById("viewdownloadAttach_");__form.action="mail-download-file";__form.contentId.value=contentId;__form.fkey.value=unescape(fkey);__form.emlkey.value=unescape(eml);__form.style.value="";__form.target="";__form.type.value="ORIGINAL";__form.bean.value="mailEmlBean";__form.submit()},openEml:function(contentId,fkey){var __handlerFn=function(response,option){if(!response){return}var __result=eval("("+response.responseText+")");var __success=(__result.success==undefined);if(!__success){return}var __mainTab=Ext.getCmp("main-tabs");var __tab=Ext.getCmp("mail-reader");if(!__tab){__tab=new iNet.iwebos.ui.mail.MailReader();__mainTab.add(__tab).show()}__mainTab.setActiveTab(__tab);__result.contentId=contentId;__result.emlKey=fkey;__tab.loadEmlInfo(__result)};var __baseParams={iwct:"mailContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"openEml",action:"openEml",contentId:contentId,fkey:unescape(fkey)};iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:this,method:"POST",success:__handlerFn,failure:function(response,options){}})},showError:function(content){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:content,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})},showInfo:function(content){Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:content,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})},stopFetch:function(){var __okHandler=function(btn){if(btn==="ok"||btn==="yes"){var __panel=Ext.getCmp("main-tabs");__panel.stopFetchMail()}};Ext.MessageBox.confirm(iwebos.message.mail.announcement,iwebos.message.mail.confirm_stop_fetch,__okHandler)},findTreeNodeByTarget:function(parent,target){if(parent.getUI().getTextEl()==target){return parent}if(parent.firstChild!=null){var __children=parent.childNodes;var __node=null;for(var __index=0;__index<__children.length;__index++){__node=MailService.findTreeNodeByTarget(__children[__index],target);if(__node!=null){return __node}}}else{return null}return null},findById:function(store,id){for(var __index=0;__index<store.getCount();__index++){var __record=store.getAt(__index);if(__record.data.id===id){return __record}}return null},addSpam:function(folderId,records){var __handlerFn=function(response,options){var __result=Ext.util.JSON.decode(response.responseText);if(__result==undefined||__result.rows==undefined){return}var __spams=__result.rows;var __checkSpamExist=function(email,units){var __unit={};for(var i=0;i<units.length;i++){__unit=units[i];if(email==__unit.data&&__unit.object=="SENDER"&&__unit.operator=="CONTAINS"){return true}}return false};var __getEmailAddress=function(fullAdd){var __email="";var __start=fullAdd.lastIndexOf("&lt");var __end=fullAdd.lastIndexOf("&gt");if(__start>0&&__end>0){__email=fullAdd.substring(__start+4,__end)}else{__email=fullAdd}return __email};var __spam=null;for(var i=0;i<__spams.length;i++){if(__spams[i].name==="Spam"){__spam=__spams[i];break}}if(__spam==null){__spam={id:0,name:"Spam",fId:folderId};__spam.clause={operator:"OR",units:[]}}var __units=__spam.clause.units||[];for(var __index=0;__index<records.length;__index++){var __email=__getEmailAddress(records[__index].data.sender);if(__email!=undefined&&__email.trim()!=""){if(!__checkSpamExist(__email,__units)){__units[__units.length]={object:"SENDER",operator:"CONTAINS",data:__email}}}}__spam.clause={operator:"OR",units:__units};var __param={iwct:"mailFilterContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"save",action:"save"};__param.object=Ext.util.JSON.encode(__spam);iNet.Ajax.request({url:"jsonajax",params:__param,scope:this,method:"POST",success:function(response,request){},failure:function(response,request){}})};var __baseParams={iwct:"loadMailFilterContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",action:"search"};iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:this,method:"POST",success:__handlerFn,failure:function(response,request){}})},removeSpam:function(records){var __handlerFn=function(response,options){var __result=Ext.util.JSON.decode(response.responseText);if(__result==undefined||__result.rows==undefined){return}var __spams=__result.rows;var __removeSpamExist=function(email,units){var __temp=[];var __unit={};for(var i=0;i<units.length;i++){__unit=units[i];if(email==__unit.data&&__unit.object=="SENDER"&&__unit.operator=="CONTAINS"){continue}else{__temp[__temp.length]=__unit}}return __temp};var __getEmailAddress=function(fullAdd){var __email="";var __start=fullAdd.lastIndexOf("&lt");var __end=fullAdd.lastIndexOf("&gt");if(__start>0&&__end>0){__email=fullAdd.substring(__start+4,__end)}else{__email=fullAdd}return __email};var __spam=null;for(var i=0;i<__spams.length;i++){if(__spams[i].name=="Spam"){__spam=__spams[i];break}}if(__spam==null){return}var __units=__spam.clause.units||[];for(var __index=0;__index<records.length;__index++){var __email=__getEmailAddress(records[__index].data.sender);__units=__removeSpamExist(__email,__units)}if(__units.length>0){__spam.clause={operator:"OR",units:__units};var __param={iwct:"mailFilterContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"save",action:"save"};__param.object=Ext.util.JSON.encode(__spam);iNet.Ajax.request({url:"jsonajax",params:__param,scope:this,method:"POST",success:function(response,request){},failure:function(response,request){}})}else{var __param={iwct:"mailFilterContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"delete",action:"delete",id:__spam.id};iNet.Ajax.request({url:"jsonajax",params:__param,scope:this,method:"POST",success:function(response,request){},failure:function(response,request){}})}};var __baseParams={iwct:"loadMailFilterContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",action:"search"};iNet.Ajax.request({url:"jsonajax",params:__baseParams,scope:this,method:"POST",success:__handlerFn,failure:function(response,request){}})},escape:function(data){var attachments=data.attachments;if(!!attachments&&attachments.length>0){for(var i=0;i<attachments.length;i++){attachments[i].fkey=escape(attachments[i].fkey)}data.attachments=attachments}data.body=data.body.replace(/<javascript/g,"<javascriptss");data.body=data.body.replace(/<JAVASCRIPT/g,"<JAVASCRIPTSS");data.body=data.body.replace(/<style/g,"<styless");data.body=data.body.replace(/<STYLE/g,"<STYLESS");return data}})})(); 
iNet.iwebos.ui.mail.Toolbar=Ext.extend(Ext.Panel,{initComponent:function(){this.prefix=(!this.prefix)?"iwebos-mail-toolbar-":this.prefix;this.id=this.nextId("cmb",6);this.chDeleteId=this.prefix+"mail-toolbar-btn-delete";this.menuReply=this.prefix+"mail-toolbar-menu-reply";this.forwardId=this.prefix+"mail-toolbar-forward";this.replyId=this.prefix+"mail-toolbar-reply";this.replyAllId=this.prefix+"mail-toolbar-reply-all";this.spamId=this.prefix+"mail-toolbar-spam";var f={xtype:"button",id:this.chDeleteId,iconCls:"icon-email-trash",text:iwebos.message.mail.mail_delete,tooltip:iwebos.message.mail.mail_delete_tip,handler:this._deleteEmail,scope:this};var c={id:this.menuReply,text:iwebos.message.mail.mail_reply,tooltip:iwebos.message.mail.mail_reply_tip,iconCls:"icon-email-reply-button",menu:{id:"toolbar-reply-menu",cls:"reading-menu",width:150,items:[{text:iwebos.message.mail.filter_object_sender,handler:this._replyEmail,scope:this,checked:false,group:"rp-group-reply",iconCls:"icon-email-reply-button"},{text:iwebos.message.mail.filter_object_all,handler:this._replyAllEmail,scope:this,checked:false,group:"rp-group-reply",iconCls:"icon-email-reply_all"}]}};var a={xtype:"button",id:this.replyId,iconCls:"icon-email-reply-button",text:iwebos.message.mail.mail_reply,tooltip:iwebos.message.mail.mail_reply_tip,handler:this._replyEmail,scope:this};var h={xtype:"button",id:this.replyAllId,iconCls:"icon-email-reply_all",text:iwebos.message.mail.mail_reply_all,tooltip:iwebos.message.mail.mail_reply_all_tip,handler:this._replyAllEmail,scope:this};var b={xtype:"button",id:this.forwardId,iconCls:"icon-email-forward-button",text:iwebos.message.mail.mail_forward,tooltip:iwebos.message.mail.mail_forward_tip,handler:this._forwardEmail,scope:this};this.printBtnId=this.nextId("printbtn",6);var i={xtype:"button",id:this.printBtnId,iconCls:"icon-email-printer",text:iwebos.message.mail.mail_print,tooltip:iwebos.message.mail.mail_print_tip,handler:loadPrintPage,scope:this};var e={xtype:"button",id:this.spamId,iconCls:"icon-email-spam-button",text:iwebos.message.mail.mail_spam,tooltip:iwebos.message.mail.mail_spam,handler:this._fnSpamMail,scope:this};this.__viewMenu=new Ext.Toolbar.Button({text:iwebos.message.mail.mail_view+"-"+iwebos.message.mail.search_all,tooltip:iwebos.message.mail.mail_view,iconCls:"icon-email-view",menu:{id:"toolbar-view-menu",cls:"reading-menu",width:150,items:[{id:"iwebos-mail-toolbar-view-all",text:iwebos.message.mail.search_all,checked:false,group:"view-group",checkHandler:this._fnViewAll,iconCls:"icon-email-view",scope:this},{text:iwebos.message.mail.mail_unread,checked:false,group:"view-group",checkHandler:this._fnViewUnread,iconCls:"icon-email-unread",scope:this},{text:iwebos.message.mail.mail_priority_high,checked:false,group:"view-group",checkHandler:this._fnViewImportant,iconCls:"icon-email-urgent",scope:this},{text:iwebos.message.mail.mail_attched,checked:false,group:"view-group",checkHandler:this._fnViewAttach,iconCls:"icon-email-attachment",scope:this},"-",{text:iwebos.message.mail.context_flag_work,checked:false,group:"view-group",checkHandler:this._fnViewWork,iconCls:"icon-email-work",scope:this},{text:iwebos.message.mail.context_flag_personal,checked:false,group:"view-group",checkHandler:this._fnViewPersonal,iconCls:"icon-email-personal",scope:this},{text:iwebos.message.mail.context_flag_todo,checked:false,group:"view-group",checkHandler:this._fnViewToDo,iconCls:"icon-email-todo",scope:this},{text:iwebos.message.mail.context_flag_late,checked:false,group:"view-group",checkHandler:this._fnViewLate,iconCls:"icon-email-late",scope:this},{text:iwebos.message.mail.context_flag_phone,checked:false,group:"view-group",checkHandler:this._fnViewCall,iconCls:"icon-email-phone",scope:this},{text:iwebos.message.mail.context_flag_reply,checked:false,group:"view-group",checkHandler:this._fnViewReply,iconCls:"icon-email-reply",scope:this},{text:iwebos.message.mail.context_flag_approve,checked:false,group:"view-group",checkHandler:this._fnViewReview,iconCls:"icon-email-approve_mail",scope:this}]}});var g={text:iwebos.message.mail.mail_group,tooltip:iwebos.message.mail.mail_group_tip,iconCls:"icon-email-address_book_16",handler:this.moreAction,menu:{id:"toolbar-reading-menu",cls:"reading-menu",width:150,items:[{text:iwebos.message.mail.mail_more_action_groupbyday,checked:true,group:"rp-group",checkHandler:this._groupBySentDate,scope:this,iconCls:"preview-bottom"},{text:iwebos.message.mail.mail_more_action_groupbyfrom,checked:false,group:"rp-group",checkHandler:this._groupBySender,scope:this,iconCls:"preview-right"},{text:iwebos.message.mail.mail_more_action_groupbysubject,checked:false,group:"rp-group",checkHandler:this._groupBySubject,scope:this,iconCls:"preview-right"}]}};var d=[];if(this.showmybutton){d=[f,"-",a,"-",h,"-",b,"-",e,"-",i]}else{d=[f,"-",a,"-",h,"-",b,"-",e,"-",g,this.__viewMenu]}if(this.store){this.pagingBar=new Ext.PagingToolbar({pageSize:iNet.INET_PAGE_LIMIT,store:this.store,displayInfo:false});if(Ext.isGecko2){d[d.length]="-"}else{d[d.length]="->"}d[d.length]=this.pagingBar}this.tbar=d;iNet.iwebos.ui.mail.Toolbar.superclass.initComponent.call(this);this.addEvents("changemode","search");this.on("changemode",this.onChangeMode,this);this.on("afterlayout",this.onAfterLayout,this)},afterRender:function(){iNet.iwebos.ui.mail.Toolbar.superclass.afterRender.call(this)},onAfterLayout:function(a,b){},changeMode:function(){this.fireEvent("changemode",!this.mode,this.mode)},search:function(){var c=this.getQuickContent(this.mode);if(this.mode){c.push({key:"mode",value:"advancedSearch"});var b=this.advanced.getSearchContent();if(!b){b=[]}var a=0;for(a=0;a<b.length;a++){c.push(b[a])}}else{c.push({key:"mode",value:"quickSearch"})}this.fireEvent("search",c)},nextId:function(e,a){var d=String(new Date().getTime()).substr(a);var c="abcdefghijklmnopqrstuvwxyz";for(var b=0;b<a;b++){d+=c.charAt(Math.floor(Math.random()*26))}return this.prefix+"-"+e+"-"+d+"-id"},_forwardEmail:function(){this.fireEvent("forward")},_replyEmail:function(){this.fireEvent("reply")},_replyAllEmail:function(){this.fireEvent("replyall")},_deleteEmail:function(){this.fireEvent("delete")},_fnSpamMail:function(){this.fireEvent("spam")},_groupBySentDate:function(){Ext.getCmp("email-message-grid-id").store.groupBy("received")},_groupBySender:function(){Ext.getCmp("email-message-grid-id").store.groupBy("sender")},_groupBySubject:function(){Ext.getCmp("email-message-grid-id").store.groupBy("subject")},disabledForward:function(b){var a=Ext.getCmp(this.forwardBtnId);a.setDisabled(b)},_fnViewAll:function(){this.updateIconView("icon-email-view");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.search_all);if(this.__lock){this.__lock=false;return}var a=this.store;var b=a.baseParams;b.field="all";a.baseParams=b;a.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})},_fnViewUnread:function(){this.updateIconView("icon-email-unread");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.mail_unread);var a=this.store;var b=a.baseParams;b.field="read";b.key="N";a.baseParams=b;a.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})},_fnViewImportant:function(){this.updateIconView("icon-email-urgent");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.mail_priority_high);var a=this.store;var b=a.baseParams;b.field="priority";b.key="HIGH";a.baseParams=b;a.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})},_fnViewWork:function(){this.updateIconView("icon-email-work");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.context_flag_work);this._fnViewByFlag("WORK")},_fnViewPersonal:function(){this.updateIconView("icon-email-personal");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.context_flag_personal);this._fnViewByFlag("PERSONAL")},_fnViewToDo:function(){this.updateIconView("icon-email-todo");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.context_flag_todo);this._fnViewByFlag("TODO")},_fnViewLate:function(){this.updateIconView("icon-email-late");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.context_flag_late);this._fnViewByFlag("LATE")},_fnViewCall:function(){this.updateIconView("icon-email-phone");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.context_flag_phone);this._fnViewByFlag("CALL")},_fnViewReply:function(){this.updateIconView("icon-email-reply");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.context_flag_reply);this._fnViewByFlag("REPLY")},_fnViewReview:function(){this.updateIconView("icon-email-approve_mail");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.context_flag_approve);this._fnViewByFlag("REVIEW")},_fnViewByFlag:function(b){var a=this.store;var c=a.baseParams;c.field="flag";c.key=b;a.baseParams=c;a.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})},_fnViewAttach:function(){this.updateIconView("icon-email-attachment");this.updateFilterView(iwebos.message.mail.mail_view+"-"+iwebos.message.mail.mail_attched);var a=this.store;var b=a.baseParams;b.field="attached";b.key="Y";a.baseParams=b;a.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})},updateFilterView:function(a){this.__viewMenu.setText(a)},updateIconView:function(a){this.__viewMenu.setIconClass(a)},checkSearchAll:function(){this.__lock=true;var a=Ext.getCmp("iwebos-mail-toolbar-view-all");if(a){a.setChecked(true)}},searchAdvance:function(b){this.updateIconView("icon-email-attachment");var a=this.store;var c=a.baseParams;Ext.apply(a.baseParams||{},b);a.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}})}}); 
iNet.iwebos.ui.mail.TreeMailbox=function(){this.__owner={path:"",allowLoad:true};this.folderTemp=[];var a={iwct:"loadMailFolderContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"build",action:"build"};this.treeroot=new Ext.tree.AsyncTreeNode({text:iwebos.message.mail.title_mailbox,draggable:false,id:-1});iNet.iwebos.ui.mail.TreeMailbox.superclass.constructor.call(this,{id:"mail-tree-folder-id",ddGroup:"Mail-drag-drop-group",useArrows:true,autoScroll:true,animate:true,rootVisible:false,lines:true,enableDrop:true,frame:false,collapsible:true,containerScroll:true,loader:new iNet.iwebos.ui.common.tree.TreeLoaderWrapper({dataUrl:"jsonajax",baseParams:a}),root:this.treeroot});this.getSelectionModel().on({beforeselect:function(c,b){if(b.id>0){return true}else{return(b.id=-2)}return false},selectionchange:this._fnLoadmail.createDelegate(this)});this.on("contextmenu",this.onContextMenu,this);this.on("expandnode",this.onExpandNode,this)};Ext.extend(iNet.iwebos.ui.mail.TreeMailbox,Ext.tree.TreePanel,{init:function(){this.render();this.root.expand()},treeResize:function(){var a=true;var b=Ext.getCmp("mail-tree-folder-id");a=b.__owner.load;b=Ext.getCmp("action-panel");var c=b.getSize().height;b=Ext.getCmp("mail-task-n-search");var d=b.getSize().height;b=Ext.getCmp("mail-tree-folder-panel");if(a){b.setHeight(c-d-8)}else{b.setHeight(c-d-10);b=Ext.getCmp("mail-tree-folder-id");b.__owner.load=true}Ext.EventManager.fireWindowResize()},afterRender:function(){iNet.iwebos.ui.mail.TreeMailbox.superclass.afterRender.call(this);this.treeResize();var a=Ext.getCmp("main-tabs");a.on("resize",this.treeResize,this)},_fnLoadmail:function(c,d){if(!d){return}if(!this.__owner.allowLoad){this.__owner.allowLoad=true;return}if(d.id>0){this.__owner.path=d.getPath();var j=Ext.getCmp("email-message-grid-id");var f=Ext.getCmp("main-tabs");var h=Ext.getCmp("main-mailbox");f.setActiveTab(0);h.setTitle(d.attributes.original);var g=j.store;var k=g.baseParams;k.id=d.id;k.mode="basic";k.field="all";g.baseParams=k;this.folder=d.id;g.load({params:{start:0,limit:iNet.INET_PAGE_LIMIT}});var i=d.attributes.type;if(i=="SENT"||i=="DRAFT"){f.changeColumn(false)}else{if(i=="SPAM"){f.changeSpamButton(false)}else{f.changeColumn(true);f.changeSpamButton(true)}}f.adSearch.checkSearchAll()}else{if(d.id===-2){var f=Ext.getCmp("main-tabs");var b=Ext.getCmp("main-addressbook-panel");if(!b){b=new iNet.iwebos.ui.mail.AddressBookPanel();f.add(b).show()}f.setActiveTab(b);var l=this.__owner.path;if(this.__owner.path==""){var e=this.getInboxFolder();var a=this.getNodeById();if(!a){return}l=a.getPath();this.__owner.path=l}this.__owner.allowLoad=false;this.selectPath(l)}}},init:function(){this.render();this.root.expand()},onContextMenu:function(d,b){b.stopEvent();var i=d.attributes.type;if(i===undefined){return}var j=(i=="INBOX"||i=="DRAFT"||i=="CUSTOM"||i=="TRASH");var f=(i=="CUSTOM");var h=(i=="CUSTOM"||i=="INBOX");var c=true;var g=true;Ext.apply(this.__owner,d.attributes);if(j||f||h||c||g){var e=[];if(j){e.push({text:iwebos.message.mail.create_folder,iconCls:"icon-email-folder-new",scope:this,handler:this._createFolder})}if(f){e.push({text:iwebos.message.mail.delete_folder,iconCls:"icon-email-folder-delete",scope:this,handler:this._deleteFolder});e.push({text:iwebos.message.mail.rename_folder,iconCls:"icon-email-clean",scope:this,handler:this._renameFolder})}if(g){e.push({text:iwebos.message.mail.context_mark_read,iconCls:"icon-email-read_mail",scope:this,handler:this._fnMarkAsRead})}if(h){e.push({text:iwebos.message.mail.filter_create,iconCls:"icon-email-filter",scope:this,handler:this._openDialogFilter})}if(c){e.push({text:iwebos.message.mail.context_empty_folder,iconCls:"icon-email-clean",scope:this,handler:this._fnEmtyFolder})}var a=new Ext.menu.Menu({id:"tree-ctx",items:e});a.showAt(b.getXY())}},onExpandNode:function(d){if(this.folderTemp.length===0){return}var a=d.childNodes;for(var b=0;b<a.length;b++){var f=a[b];for(var c=0;c<this.folderTemp.length;c++){var e=this.folderTemp[c];if(!e.update&&f.attributes.id===e.id){this.addMessageUnread2Folder(e.message,e.id);this.folderTemp[c].update=true}}}},updateUnreadFolder:function(c,a){var b=this.getNodeById(c);if(b){b.attributes.unread=a;b.setText(b.attributes.original+(a>0?"("+a+")":""));b.attributes.cls=a>0?"mail-folder-unread":""}},_createFolder:function(){var d=this.__owner;var a=this;var b=function(){var g=this.getData();var f=function(k,l){var h=Ext.util.JSON.decode(k.responseText);if(!!h){var j=h.id;if(!j){return}var m=a.getNodeById(d.id);if(!!m){if(m.leaf){m.leaf=false;m.child=[]}var i=new Ext.tree.TreeNode({id:j,parent:d.id,type:"CUSTOM",unread:0,iconCls:"icon-email-custom",original:g,text:g,leaf:true});m.appendChild(i);m.expand()}}};if(g.length>0){var e={iwct:"mailFolderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"create",action:"create",text:g,parent:d.id};iNet.Ajax.request({url:"jsonajax",success:f,failure:f,method:"POST",params:e,scope:this});this.destroy()}else{Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.error_blank_folder_name,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};var c=new iNet.iwebos.ui.mail.DialogCreateFolder(this,{fnOkHandler:b,parentName:d.original});c.show(c)},_deleteFolder:function(){var d=this.__owner;var a=this;var c=function(f,g){var e=Ext.util.JSON.decode(f.responseText);if(e.success){var h=a.getNodeById(d.id);if(!!h){h.remove()}}};var b=function(f){if(f=="yes"||f=="ok"){var e={iwct:"mailFolderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"delete",action:"delete",id:d.id};iNet.Ajax.request({url:"jsonajax",success:c,failure:c,method:"POST",params:e,scope:this})}};Ext.MessageBox.confirm(iwebos.message.mail.announcement,iwebos.message.mail.confirm_delete_folder,b.createDelegate(this))},_renameFolder:function(){var c=this.__owner;var b=this;var a=function(){var f=this.getData();var e=function(h,i){var g=Ext.util.JSON.decode(h.responseText);if(g!==undefined&&g.success){var j=b.getNodeById(c.id);if(!!j){j.setText(f)}}};if(f.length>0){var d={iwct:"mailFolderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"rename",action:"rename",text:f,id:c.id};iNet.Ajax.request({url:"jsonajax",success:e,failure:e,method:"POST",params:d,scope:this});this.destroy()}else{Ext.MessageBox.show({title:iwebos.message.mail.announcement,msg:iwebos.message.mail.error_blank_folder_name,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}};this.dlg=new iNet.iwebos.ui.mail.DialogRenameFolder(this,{okHandler:a,folderName:c.text});this.dlg.show(this.dlg)},setFolder:function(a){this.folder=a.inbox},getFolder:function(){if(!this.folder){this.folder=this.getInboxFolder()}return this.folder},getInboxFolder:function(){var b=Ext.getCmp("main-tabs");var a=b.config||{};var c=a.folder;if(c===undefined){return 0}return c.inbox},updateInbox:function(b){var a=this.getRootNode();var c=a.childNodes[0];if(c){this.updateUnreadFolder(c.id,b)}},readMail:function(c){var b=this.getFolder();if(b===0){return}var d=this.getNodeById(b);if(d){var a=d.attributes.unread-c;d.attributes.unread=(a<0)?0:a;d.attributes.cls=a>0?"mail-folder-unread":"";if(a<=0){d.setText(d.attributes.original);d.getUI().removeClass("mail-folder-unread")}else{d.setText(d.attributes.original+" ("+a+")");d.getUI().addClass("mail-folder-unread")}}},addNewMessage:function(){var b=this.getInboxFolder();var c=this.getNodeById(b);if(c){var a=c.attributes.unread+1;c.attributes.unread=a;if(a<=0){c.setText(c.attributes.original);c.getUI().removeClass("mail-folder-unread")}else{c.setText(c.attributes.original+" ("+a+")");c.getUI().addClass("mail-folder-unread")}c.attributes.cls=a>0?"mail-folder-unread":""}},addMessageUnread:function(b){var a=this.getFolder();this.addMessageUnread2Folder(b,a)},addMessageUnread2Folder:function(c,b){var d=this.getNodeById(b);if(d){var a=d.attributes.unread+c;d.attributes.unread=a<0?0:a;if(a<=0){d.setText(d.attributes.original);d.getUI().removeClass("mail-folder-unread")}else{d.setText(d.attributes.original+" ("+a+")");d.getUI().addClass("mail-folder-unread")}d.attributes.cls=a>0?"mail-folder-unread":""}else{this._fnPutUnreadMessage2Temp(c,b)}},_fnPutUnreadMessage2Temp:function(d,c){if(this.folderTemp.length===0){this.folderTemp[0]={id:c,message:d,update:false}}else{var b=this.folderTemp;for(var a=0;a<b.length;a++){if(b[a].id===c){b[a].message=b[a].message+d;return}}b[b.length]={id:c,message:d,update:false}}},reloadMailBox:function(){this.treeroot.reload()},_fnEmtyFolder:function(){var f=this.__owner;var a=this;var e=Ext.getCmp("email-message-grid-id");var d=function(h,i){if(h){var g=Ext.util.JSON.decode(h.responseText);if(g!=undefined&&g.success){this.updateUnreadFolder(f.id,0);if(this.getFolder()==f.id){e.store.removeAll()}return}}MailService.showError(iwebos.message.mail.error_delete_mail)};var b=function(h){if(h=="yes"||h=="ok"){var g={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"emptyFolder",action:"emptyFolder",id:f.id};iNet.Ajax.request({url:"jsonajax",success:d,failure:d,method:"POST",params:g,scope:this,maskEl:e.bwrap})}};var c=function(h){if(h=="yes"||h=="ok"){var g={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"emptyFolder",action:"emptyFolder",id:f.id};iNet.Ajax.request({url:"jsonajax",success:d,failure:d,method:"POST",params:g,scope:this,maskEl:e.bwrap})}};Ext.MessageBox.confirm(iwebos.message.mail.announcement,iwebos.message.mail.confirm_empty_folder,b.createDelegate(this))},_openDialogFilter:function(){var a=new iNet.iwebos.ui.mail.DialogMailFilter();a.show()},_fnMarkAsRead:function(){var e=this.__owner;var a=this;var d=Ext.getCmp("email-message-grid-id");var c=function(g,h){if(g){var f=Ext.util.JSON.decode(g.responseText);if(f!=undefined&&f.success){this.updateUnreadFolder(e.id,0);if(this.getFolder()==e.id){d.store.reload()}return}}MailService.showError(iwebos.message.mail.error_mark_as_read_folder)};var b={iwct:"mailHeaderContent",iwm:"MAIL",iwc:"READ_WRITE",iwa:"markAsReadFolder",action:"markAsReadFolder",id:e.id};iNet.Ajax.request({url:"jsonajax",success:c,failure:c,method:"POST",params:b,scope:this,maskEl:d.bwrap})}}); 
iNet.iwebos.ui.mail.TreeSelectContact=function(){var a={iwct:"addressBookManagementContent",iwm:"MAIL",iwc:"READ_ONLY",iwa:"search",action:"search",mode:"global",key:""};this.treeroot=new Ext.tree.AsyncTreeNode({text:iwebos.message.mail.fullname,draggable:false,expanded:true,id:-1});iNet.iwebos.ui.mail.TreeSelectContact.superclass.constructor.call(this,{id:"mail-tree-select-user",useArrows:false,autoScroll:true,border:false,animate:true,selModel:new Ext.tree.MultiSelectionModel(),enableDD:true,draggable:true,containerScroll:true,loader:new iNet.iwebos.ui.common.tree.TreeLoaderWrapper({dataUrl:"jsonajax",baseParams:a}),root:this.treeroot})};Ext.extend(iNet.iwebos.ui.mail.TreeSelectContact,Ext.tree.TreePanel,{loadData:function(c,b){var a=this.getLoader();if(a){a.baseParams.mode=c;a.baseParams.key=b;a.load(this.treeroot,function(){})}}}); 
